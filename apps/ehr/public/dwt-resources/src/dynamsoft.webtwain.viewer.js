/* ! 20250813201232
* Dynamsoft JavaScript Library
* Product: Dynamic Web TWAIN
* Web Site: https://www.dynamsoft.com
*
* Copyright 2025, Dynamsoft Corporation
* Author: Dynamsoft Support Team
* Version: 19.2
*/function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o;}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o;},_typeof(o);}!function(){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e;}var i={},r={get exports(){return i;},set exports(e){i=e;}},n=function n(e){return e&&e.Math===Math&&e;},o=n("object"==(typeof globalThis==="undefined"?"undefined":_typeof(globalThis))&&globalThis)||n("object"==(typeof window==="undefined"?"undefined":_typeof(window))&&window)||n("object"==(typeof self==="undefined"?"undefined":_typeof(self))&&self)||n("object"==_typeof(e)&&e)||n("object"==_typeof(e)&&e)||function(){return this;}()||Function("return this")(),a=function a(e){try{return!!e();}catch(e){return!0;}},s=!a(function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype");}),l=s,u=Function.prototype,c=u.apply,h=u.call,d="object"==(typeof Reflect==="undefined"?"undefined":_typeof(Reflect))&&Reflect.apply||(l?h.bind(c):function(){return h.apply(c,arguments);}),f=s,v=Function.prototype,g=v.call,m=f&&v.bind.bind(g,g),y=f?m:function(e){return function(){return g.apply(e,arguments);};},p=y,w=p({}.toString),b=p("".slice),k=function k(e){return b(w(e),8,-1);},S=k,x=y,C=function C(e){if("Function"===S(e))return x(e);},V="object"==(typeof document==="undefined"?"undefined":_typeof(document))&&document.all,T=void 0===V&&void 0!==V?function(e){return"function"==typeof e||e===V;}:function(e){return"function"==typeof e;},I={},E=!a(function(){return 7!==Object.defineProperty({},1,{get:function get(){return 7;}})[1];}),P=s,B=Function.prototype.call,D=P?B.bind(B):function(){return B.apply(B,arguments);},M={},A={}.propertyIsEnumerable,U=Object.getOwnPropertyDescriptor,z=U&&!A.call({1:2},1);M.f=z?function(e){var t=U(this,e);return!!t&&t.enumerable;}:A;var R,N,O=function O(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t};},L=a,W=k,H=Object,F=y("".split),j=L(function(){return!H("z").propertyIsEnumerable(0);})?function(e){return"String"===W(e)?F(e,""):H(e);}:H,Y=function Y(e){return null==e;},X=Y,q=TypeError,Z=function Z(e){if(X(e))throw new q("Can't call method on "+e);return e;},_=j,G=Z,K=function K(e){return _(G(e));},$=T,Q=function Q(e){return"object"==_typeof(e)?null!==e:$(e);},J={},ee=J,te=o,ie=T,re=function re(e){return ie(e)?e:void 0;},ne=function ne(e,t){return arguments.length<2?re(ee[e])||re(te[e]):ee[e]&&ee[e][t]||te[e]&&te[e][t];},oe=y({}.isPrototypeOf),ae=o.navigator,se=ae&&ae.userAgent,le=se?String(se):"",ue=o,ce=le,he=ue.process,de=ue.Deno,fe=he&&he.versions||de&&de.version,ve=fe&&fe.v8;ve&&(N=(R=ve.split("."))[0]>0&&R[0]<4?1:+(R[0]+R[1])),!N&&ce&&(!(R=ce.match(/Edge\/(\d+)/))||R[1]>=74)&&(R=ce.match(/Chrome\/(\d+)/))&&(N=+R[1]);var ge=N,me=ge,ye=a,pe=o.String,we=!!Object.getOwnPropertySymbols&&!ye(function(){var e=Symbol("symbol detection");return!pe(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&me&&me<41;}),be=we&&!Symbol.sham&&"symbol"==_typeof(Symbol.iterator),ke=ne,Se=T,xe=oe,Ce=Object,Ve=be?function(e){return"symbol"==_typeof(e);}:function(e){var t=ke("Symbol");return Se(t)&&xe(t.prototype,Ce(e));},Te=String,Ie=function Ie(e){try{return Te(e);}catch(e){return"Object";}},Ee=T,Pe=Ie,Be=TypeError,De=function De(e){if(Ee(e))return e;throw new Be(Pe(e)+" is not a function");},Me=De,Ae=Y,Ue=function Ue(e,t){var i=e[t];return Ae(i)?void 0:Me(i);},ze=D,Re=T,Ne=Q,Oe=TypeError,Le={},We={get exports(){return Le;},set exports(e){Le=e;}},He=!0,Fe=o,je=Object.defineProperty,Ye=o,Xe=function Xe(e,t){try{je(Fe,e,{value:t,configurable:!0,writable:!0});}catch(i){Fe[e]=t;}return t;},qe="__core-js_shared__",Ze=We.exports=Ye[qe]||Xe(qe,{});(Ze.versions||(Ze.versions=[])).push({version:"3.45.0",mode:"pure",copyright:"Â© 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.45.0/LICENSE",source:"https://github.com/zloirock/core-js"});var _e=Le,Ge=function Ge(e,t){return _e[e]||(_e[e]=t||{});},Ke=Z,$e=Object,Qe=function Qe(e){return $e(Ke(e));},Je=Qe,et=y({}.hasOwnProperty),tt=Object.hasOwn||function(e,t){return et(Je(e),t);},it=y,rt=0,nt=Math.random(),ot=it(1.1.toString),at=function at(e){return"Symbol("+(void 0===e?"":e)+")_"+ot(++rt+nt,36);},st=Ge,lt=tt,ut=at,ct=we,ht=be,dt=o.Symbol,ft=st("wks"),vt=ht?dt.for||dt:dt&&dt.withoutSetter||ut,gt=function gt(e){return lt(ft,e)||(ft[e]=ct&&lt(dt,e)?dt[e]:vt("Symbol."+e)),ft[e];},mt=D,yt=Q,pt=Ve,wt=Ue,bt=function bt(e,t){var i,r;if("string"===t&&Re(i=e.toString)&&!Ne(r=ze(i,e)))return r;if(Re(i=e.valueOf)&&!Ne(r=ze(i,e)))return r;if("string"!==t&&Re(i=e.toString)&&!Ne(r=ze(i,e)))return r;throw new Oe("Can't convert object to primitive value");},kt=TypeError,St=gt("toPrimitive"),xt=function xt(e,t){if(!yt(e)||pt(e))return e;var i,r=wt(e,St);if(r){if(void 0===t&&(t="default"),i=mt(r,e,t),!yt(i)||pt(i))return i;throw new kt("Can't convert object to primitive value");}return void 0===t&&(t="number"),bt(e,t);},Ct=xt,Vt=Ve,Tt=function Tt(e){var t=Ct(e,"string");return Vt(t)?t:t+"";},It=Q,Et=o.document,Pt=It(Et)&&It(Et.createElement),Bt=function Bt(e){return Pt?Et.createElement(e):{};},Dt=Bt,Mt=!E&&!a(function(){return 7!==Object.defineProperty(Dt("div"),"a",{get:function get(){return 7;}}).a;}),At=E,Ut=D,zt=M,Rt=O,Nt=K,Ot=Tt,Lt=tt,Wt=Mt,Ht=Object.getOwnPropertyDescriptor;I.f=At?Ht:function(e,t){if(e=Nt(e),t=Ot(t),Wt)try{return Ht(e,t);}catch(e){}if(Lt(e,t))return Rt(!Ut(zt.f,e,t),e[t]);};var Ft=a,jt=T,Yt=/#|\.prototype\./,Xt=function Xt(e,t){var i=Zt[qt(e)];return i===Gt||i!==_t&&(jt(t)?Ft(t):!!t);},qt=Xt.normalize=function(e){return String(e).replace(Yt,".").toLowerCase();},Zt=Xt.data={},_t=Xt.NATIVE="N",Gt=Xt.POLYFILL="P",Kt=Xt,$t=De,Qt=s,Jt=C(C.bind),ei=function ei(e,t){return $t(e),void 0===t?e:Qt?Jt(e,t):function(){return e.apply(t,arguments);};},ti={},ii=E&&a(function(){return 42!==Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype;}),ri=Q,ni=String,oi=TypeError,ai=function ai(e){if(ri(e))return e;throw new oi(ni(e)+" is not an object");},si=E,li=Mt,ui=ii,ci=ai,hi=Tt,di=TypeError,fi=Object.defineProperty,vi=Object.getOwnPropertyDescriptor,gi="enumerable",mi="configurable",yi="writable";ti.f=si?ui?function(e,t,i){if(ci(e),t=hi(t),ci(i),"function"==typeof e&&"prototype"===t&&"value"in i&&yi in i&&!i[yi]){var r=vi(e,t);r&&r[yi]&&(e[t]=i.value,i={configurable:mi in i?i[mi]:r[mi],enumerable:gi in i?i[gi]:r[gi],writable:!1});}return fi(e,t,i);}:fi:function(e,t,i){if(ci(e),t=hi(t),ci(i),li)try{return fi(e,t,i);}catch(e){}if("get"in i||"set"in i)throw new di("Accessors not supported");return"value"in i&&(e[t]=i.value),e;};var pi=ti,wi=O,bi=E?function(e,t,i){return pi.f(e,t,wi(1,i));}:function(e,t,i){return e[t]=i,e;},ki=o,Si=d,xi=C,Ci=T,Vi=I.f,Ti=Kt,Ii=J,Ei=ei,Pi=bi,Bi=tt,Di=function Di(e){var _t2=function t(i,r,n){if(this instanceof _t2){switch(arguments.length){case 0:return new e();case 1:return new e(i);case 2:return new e(i,r);}return new e(i,r,n);}return Si(e,this,arguments);};return _t2.prototype=e.prototype,_t2;},Mi=function Mi(e,t){var i,r,n,o,a,s,l,u,c,h=e.target,d=e.global,f=e.stat,v=e.proto,g=d?ki:f?ki[h]:ki[h]&&ki[h].prototype,m=d?Ii:Ii[h]||Pi(Ii,h,{})[h],y=m.prototype;for(o in t)r=!(i=Ti(d?o:h+(f?".":"#")+o,e.forced))&&g&&Bi(g,o),s=m[o],r&&(l=e.dontCallGetSet?(c=Vi(g,o))&&c.value:g[o]),a=r&&l?l:t[o],(i||v||_typeof(s)!=_typeof(a))&&(u=e.bind&&r?Ei(a,ki):e.wrap&&r?Di(a):v&&Ci(a)?xi(a):a,(e.sham||a&&a.sham||s&&s.sham)&&Pi(u,"sham",!0),Pi(m,o,u),v&&(Bi(Ii,n=h+"Prototype")||Pi(Ii,n,{}),Pi(Ii[n],o,a),e.real&&y&&(i||!y[o])&&Pi(y,o,a)));},Ai=y([].slice),Ui=y,zi=De,Ri=Q,Ni=tt,Oi=Ai,Li=s,Wi=Function,Hi=Ui([].concat),Fi=Ui([].join),ji={},Yi=Li?Wi.bind:function(e){var t=zi(this),i=t.prototype,r=Oi(arguments,1),_n2=function n(){var i=Hi(r,Oi(arguments));return this instanceof _n2?function(e,t,i){if(!Ni(ji,t)){for(var r=[],n=0;n<t;n++)r[n]="a["+n+"]";ji[t]=Wi("C,a","return new C("+Fi(r,",")+")");}return ji[t](e,i);}(t,i.length,i):t.apply(e,i);};return Ri(i)&&(_n2.prototype=i),_n2;},Xi={};Xi[gt("toStringTag")]="z";var qi="[object z]"===String(Xi),Zi=qi,_i=T,Gi=k,Ki=gt("toStringTag"),$i=Object,Qi="Arguments"===Gi(function(){return arguments;}()),Ji=Zi?Gi:function(e){var t,i,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(i=function(e,t){try{return e[t];}catch(e){}}(t=$i(e),Ki))?i:Qi?Gi(t):"Object"===(r=Gi(t))&&_i(t.callee)?"Arguments":r;},er=T,tr=Le,ir=y(Function.toString);er(tr.inspectSource)||(tr.inspectSource=function(e){return ir(e);});var rr=tr.inspectSource,nr=y,or=a,ar=T,sr=Ji,lr=rr,ur=function ur(){},cr=ne("Reflect","construct"),hr=/^\s*(?:class|function)\b/,dr=nr(hr.exec),fr=!hr.test(ur),vr=function vr(e){if(!ar(e))return!1;try{return cr(ur,[],e),!0;}catch(e){return!1;}},gr=function gr(e){if(!ar(e))return!1;switch(sr(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1;}try{return fr||!!dr(hr,lr(e));}catch(e){return!0;}};gr.sham=!0;var mr=!cr||or(function(){var e;return vr(vr.call)||!vr(Object)||!vr(function(){e=!0;})||e;})?gr:vr,yr=mr,pr=Ie,wr=TypeError,br=function br(e){if(yr(e))return e;throw new wr(pr(e)+" is not a constructor");},kr={},Sr=Math.ceil,xr=Math.floor,Cr=Math.trunc||function(e){var t=+e;return(t>0?xr:Sr)(t);},Vr=Cr,Tr=function Tr(e){var t=+e;return t!=t||0===t?0:Vr(t);},Ir=Tr,Er=Math.max,Pr=Math.min,Br=function Br(e,t){var i=Ir(e);return i<0?Er(i+t,0):Pr(i,t);},Dr=Tr,Mr=Math.min,Ar=function Ar(e){var t=Dr(e);return t>0?Mr(t,9007199254740991):0;},Ur=Ar,zr=function zr(e){return Ur(e.length);},Rr=K,Nr=Br,Or=zr,Lr=function Lr(e){return function(t,i,r){var n=Rr(t),o=Or(n);if(0===o)return!e&&-1;var a,s=Nr(r,o);if(e&&i!=i){for(;o>s;)if((a=n[s++])!=a)return!0;}else for(;o>s;s++)if((e||s in n)&&n[s]===i)return e||s||0;return!e&&-1;};},Wr={includes:Lr(!0),indexOf:Lr(!1)},Hr={},Fr=tt,jr=K,Yr=Wr.indexOf,Xr=Hr,qr=y([].push),Zr=function Zr(e,t){var i,r=jr(e),n=0,o=[];for(i in r)!Fr(Xr,i)&&Fr(r,i)&&qr(o,i);for(;t.length>n;)Fr(r,i=t[n++])&&(~Yr(o,i)||qr(o,i));return o;},_r=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Gr=Zr,Kr=_r,$r=Object.keys||function(e){return Gr(e,Kr);},Qr=E,Jr=ii,en=ti,tn=ai,rn=K,nn=$r;kr.f=Qr&&!Jr?Object.defineProperties:function(e,t){tn(e);for(var i,r=rn(t),n=nn(t),o=n.length,a=0;o>a;)en.f(e,i=n[a++],r[i]);return e;};var on,an=ne("document","documentElement"),sn=at,ln=Ge("keys"),un=function un(e){return ln[e]||(ln[e]=sn(e));},cn=ai,hn=kr,dn=_r,fn=Hr,vn=an,gn=Bt,mn="prototype",yn="script",pn=un("IE_PROTO"),wn=function wn(){},bn=function bn(e){return"<"+yn+">"+e+"</"+yn+">";},kn=function kn(e){e.write(bn("")),e.close();var t=e.parentWindow.Object;return e=null,t;},_Sn=function Sn(){try{on=new ActiveXObject("htmlfile");}catch(e){}var e,t,i;_Sn="undefined"!=typeof document?document.domain&&on?kn(on):(t=gn("iframe"),i="java"+yn+":",t.style.display="none",vn.appendChild(t),t.src=String(i),(e=t.contentWindow.document).open(),e.write(bn("document.F=Object")),e.close(),e.F):kn(on);for(var r=dn.length;r--;)delete _Sn[mn][dn[r]];return _Sn();};fn[pn]=!0;var xn=Object.create||function(e,t){var i;return null!==e?(wn[mn]=cn(e),i=new wn(),wn[mn]=null,i[pn]=e):i=_Sn(),void 0===t?i:hn.f(i,t);},Cn=Mi,Vn=d,Tn=Yi,In=br,En=ai,Pn=Q,Bn=xn,Dn=a,Mn=ne("Reflect","construct"),An=Object.prototype,Un=[].push,zn=Dn(function(){function e(){}return!(Mn(function(){},[],e)instanceof e);}),Rn=!Dn(function(){Mn(function(){});}),Nn=zn||Rn;Cn({target:"Reflect",stat:!0,forced:Nn,sham:Nn},{construct:function construct(e,t){In(e),En(t);var i=arguments.length<3?e:In(arguments[2]);if(Rn&&!zn)return Mn(e,t,i);if(e===i){switch(t.length){case 0:return new e();case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);}var r=[null];return Vn(Un,r,t),new(Vn(Tn,e,r))();}var n=i.prototype,o=Bn(Pn(n)?n:An),a=Vn(e,o,t);return Pn(a)?a:o;}});var On=J.Reflect.construct;r.exports=On;var Ln=t(i),Wn={},Hn={get exports(){return Wn;},set exports(e){Wn=e;}},Fn=k,jn=Array.isArray||function(e){return"Array"===Fn(e);},Yn=TypeError,Xn=function Xn(e){if(e>9007199254740991)throw Yn("Maximum allowed index exceeded");return e;},qn=E,Zn=ti,_n=O,Gn=function Gn(e,t,i){qn?Zn.f(e,t,_n(0,i)):e[t]=i;},Kn=jn,$n=mr,Qn=Q,Jn=gt("species"),eo=Array,to=function to(e){var t;return Kn(e)&&(t=e.constructor,($n(t)&&(t===eo||Kn(t.prototype))||Qn(t)&&null===(t=t[Jn]))&&(t=void 0)),void 0===t?eo:t;},io=function io(e,t){return new(to(e))(0===t?0:t);},ro=a,no=ge,oo=gt("species"),ao=function ao(e){return no>=51||!ro(function(){var t=[];return(t.constructor={})[oo]=function(){return{foo:1};},1!==t[e](Boolean).foo;});},so=Mi,lo=a,uo=jn,co=Q,ho=Qe,fo=zr,vo=Xn,go=Gn,mo=io,yo=ao,po=ge,wo=gt("isConcatSpreadable"),bo=po>=51||!lo(function(){var e=[];return e[wo]=!1,e.concat()[0]!==e;}),ko=function ko(e){if(!co(e))return!1;var t=e[wo];return void 0!==t?!!t:uo(e);};so({target:"Array",proto:!0,arity:1,forced:!bo||!yo("concat")},{concat:function concat(e){var t,i,r,n,o,a=ho(this),s=mo(a,0),l=0;for(t=-1,r=arguments.length;t<r;t++)if(ko(o=-1===t?a:arguments[t]))for(n=fo(o),vo(l+n),i=0;i<n;i++,l++)i in o&&go(s,l,o[i]);else vo(l+1),go(s,l++,o);return s.length=l,s;}});var So=Ji,xo=String,Co=function Co(e){if("Symbol"===So(e))throw new TypeError("Cannot convert a Symbol value to a string");return xo(e);},Vo={},To=Zr,Io=_r.concat("length","prototype");Vo.f=Object.getOwnPropertyNames||function(e){return To(e,Io);};var Eo={},Po=k,Bo=K,Do=Vo.f,Mo=Ai,Ao="object"==(typeof window==="undefined"?"undefined":_typeof(window))&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];Eo.f=function(e){return Ao&&"Window"===Po(e)?function(e){try{return Do(e);}catch(e){return Mo(Ao);}}(e):Do(Bo(e));};var Uo={};Uo.f=Object.getOwnPropertySymbols;var zo=bi,Ro=function Ro(e,t,i,r){return r&&r.enumerable?e[t]=i:zo(e,t,i),e;},No=ti,Oo=function Oo(e,t,i){return No.f(e,t,i);},Lo={},Wo=gt;Lo.f=Wo;var Ho,Fo,jo,Yo=J,Xo=tt,qo=Lo,Zo=ti.f,_o=function _o(e){var t=Yo.Symbol||(Yo.Symbol={});Xo(t,e)||Zo(t,e,{value:qo.f(e)});},Go=D,Ko=ne,$o=gt,Qo=Ro,Jo=function Jo(){var e=Ko("Symbol"),t=e&&e.prototype,i=t&&t.valueOf,r=$o("toPrimitive");t&&!t[r]&&Qo(t,r,function(e){return Go(i,this);},{arity:1});},ea=Ji,ta=qi?{}.toString:function(){return"[object "+ea(this)+"]";},ia=qi,ra=ti.f,na=bi,oa=tt,aa=ta,sa=gt("toStringTag"),la=function la(e,t,i,r){var n=i?e:e&&e.prototype;n&&(oa(n,sa)||ra(n,sa,{configurable:!0,value:t}),r&&!ia&&na(n,"toString",aa));},ua=T,ca=o.WeakMap,ha=ua(ca)&&/native code/.test(String(ca)),da=o,fa=Q,va=bi,ga=tt,ma=Le,ya=un,pa=Hr,wa="Object already initialized",ba=da.TypeError,ka=da.WeakMap;if(ha||ma.state){var Sa=ma.state||(ma.state=new ka());Sa.get=Sa.get,Sa.has=Sa.has,Sa.set=Sa.set,Ho=function Ho(e,t){if(Sa.has(e))throw new ba(wa);return t.facade=e,Sa.set(e,t),t;},Fo=function Fo(e){return Sa.get(e)||{};},jo=function jo(e){return Sa.has(e);};}else{var xa=ya("state");pa[xa]=!0,Ho=function Ho(e,t){if(ga(e,xa))throw new ba(wa);return t.facade=e,va(e,xa,t),t;},Fo=function Fo(e){return ga(e,xa)?e[xa]:{};},jo=function jo(e){return ga(e,xa);};}var Ca={set:Ho,get:Fo,has:jo,enforce:function enforce(e){return jo(e)?Fo(e):Ho(e,{});},getterFor:function getterFor(e){return function(t){var i;if(!fa(t)||(i=Fo(t)).type!==e)throw new ba("Incompatible receiver, "+e+" required");return i;};}},Va=ei,Ta=j,Ia=Qe,Ea=zr,Pa=io,Ba=y([].push),Da=function Da(e){var t=1===e,i=2===e,r=3===e,n=4===e,o=6===e,a=7===e,s=5===e||o;return function(l,u,c,h){for(var d,f,v=Ia(l),g=Ta(v),m=Ea(g),y=Va(u,c),p=0,w=h||Pa,b=t?w(l,m):i||a?w(l,0):void 0;m>p;p++)if((s||p in g)&&(f=y(d=g[p],p,v),e))if(t)b[p]=f;else if(f)switch(e){case 3:return!0;case 5:return d;case 6:return p;case 2:Ba(b,d);}else switch(e){case 4:return!1;case 7:Ba(b,d);}return o?-1:r||n?n:b;};},Ma={forEach:Da(0),map:Da(1),filter:Da(2),some:Da(3),every:Da(4),find:Da(5),findIndex:Da(6),filterReject:Da(7)},Aa=Mi,Ua=o,za=D,Ra=y,Na=E,Oa=we,La=a,Wa=tt,Ha=oe,Fa=ai,ja=K,Ya=Tt,Xa=Co,qa=O,Za=xn,_a=$r,Ga=Vo,Ka=Eo,$a=Uo,Qa=I,Ja=ti,es=kr,ts=M,is=Ro,rs=Oo,ns=Ge,os=Hr,as=at,ss=gt,ls=Lo,us=_o,cs=Jo,hs=la,ds=Ca,fs=Ma.forEach,vs=un("hidden"),gs="Symbol",ms="prototype",ys=ds.set,ps=ds.getterFor(gs),ws=Object[ms],bs=Ua.Symbol,ks=bs&&bs[ms],Ss=Ua.RangeError,xs=Ua.TypeError,Cs=Ua.QObject,Vs=Qa.f,Ts=Ja.f,Is=Ka.f,Es=ts.f,Ps=Ra([].push),Bs=ns("symbols"),Ds=ns("op-symbols"),Ms=ns("wks"),As=!Cs||!Cs[ms]||!Cs[ms].findChild,Us=function Us(e,t,i){var r=Vs(ws,t);r&&delete ws[t],Ts(e,t,i),r&&e!==ws&&Ts(ws,t,r);},zs=Na&&La(function(){return 7!==Za(Ts({},"a",{get:function get(){return Ts(this,"a",{value:7}).a;}})).a;})?Us:Ts,Rs=function Rs(e,t){var i=Bs[e]=Za(ks);return ys(i,{type:gs,tag:e,description:t}),Na||(i.description=t),i;},_Ns=function Ns(e,t,i){e===ws&&_Ns(Ds,t,i),Fa(e);var r=Ya(t);return Fa(i),Wa(Bs,r)?(i.enumerable?(Wa(e,vs)&&e[vs][r]&&(e[vs][r]=!1),i=Za(i,{enumerable:qa(0,!1)})):(Wa(e,vs)||Ts(e,vs,qa(1,Za(null))),e[vs][r]=!0),zs(e,r,i)):Ts(e,r,i);},Os=function Os(e,t){Fa(e);var i=ja(t),r=_a(i).concat(Fs(i));return fs(r,function(t){Na&&!za(Ls,i,t)||_Ns(e,t,i[t]);}),e;},Ls=function Ls(e){var t=Ya(e),i=za(Es,this,t);return!(this===ws&&Wa(Bs,t)&&!Wa(Ds,t))&&(!(i||!Wa(this,t)||!Wa(Bs,t)||Wa(this,vs)&&this[vs][t])||i);},Ws=function Ws(e,t){var i=ja(e),r=Ya(t);if(i!==ws||!Wa(Bs,r)||Wa(Ds,r)){var n=Vs(i,r);return!n||!Wa(Bs,r)||Wa(i,vs)&&i[vs][r]||(n.enumerable=!0),n;}},Hs=function Hs(e){var t=Is(ja(e)),i=[];return fs(t,function(e){Wa(Bs,e)||Wa(os,e)||Ps(i,e);}),i;},Fs=function Fs(e){var t=e===ws,i=Is(t?Ds:ja(e)),r=[];return fs(i,function(e){!Wa(Bs,e)||t&&!Wa(ws,e)||Ps(r,Bs[e]);}),r;};Oa||(bs=function bs(){if(Ha(ks,this))throw new xs("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?Xa(arguments[0]):void 0,t=as(e),_i2=function i(e){var r=void 0===this?Ua:this;r===ws&&za(_i2,Ds,e),Wa(r,vs)&&Wa(r[vs],t)&&(r[vs][t]=!1);var n=qa(1,e);try{zs(r,t,n);}catch(e){if(!(e instanceof Ss))throw e;Us(r,t,n);}};return Na&&As&&zs(ws,t,{configurable:!0,set:_i2}),Rs(t,e);},is(ks=bs[ms],"toString",function(){return ps(this).tag;}),is(bs,"withoutSetter",function(e){return Rs(as(e),e);}),ts.f=Ls,Ja.f=_Ns,es.f=Os,Qa.f=Ws,Ga.f=Ka.f=Hs,$a.f=Fs,ls.f=function(e){return Rs(ss(e),e);},Na&&rs(ks,"description",{configurable:!0,get:function get(){return ps(this).description;}})),Aa({global:!0,constructor:!0,wrap:!0,forced:!Oa,sham:!Oa},{Symbol:bs}),fs(_a(Ms),function(e){us(e);}),Aa({target:gs,stat:!0,forced:!Oa},{useSetter:function useSetter(){As=!0;},useSimple:function useSimple(){As=!1;}}),Aa({target:"Object",stat:!0,forced:!Oa,sham:!Na},{create:function create(e,t){return void 0===t?Za(e):Os(Za(e),t);},defineProperty:_Ns,defineProperties:Os,getOwnPropertyDescriptor:Ws}),Aa({target:"Object",stat:!0,forced:!Oa},{getOwnPropertyNames:Hs}),cs(),hs(bs,gs),os[vs]=!0;var js=we&&!!Symbol.for&&!!Symbol.keyFor,Ys=Mi,Xs=ne,qs=tt,Zs=Co,_s=Ge,Gs=js,Ks=_s("string-to-symbol-registry"),$s=_s("symbol-to-string-registry");Ys({target:"Symbol",stat:!0,forced:!Gs},{for:function _for(e){var t=Zs(e);if(qs(Ks,t))return Ks[t];var i=Xs("Symbol")(t);return Ks[t]=i,$s[i]=t,i;}});var Qs=Mi,Js=tt,el=Ve,tl=Ie,il=js,rl=Ge("symbol-to-string-registry");Qs({target:"Symbol",stat:!0,forced:!il},{keyFor:function keyFor(e){if(!el(e))throw new TypeError(tl(e)+" is not a symbol");if(Js(rl,e))return rl[e];}});var nl=jn,ol=T,al=k,sl=Co,ll=y([].push),ul=Mi,cl=ne,hl=d,dl=D,fl=y,vl=a,gl=T,ml=Ve,yl=Ai,pl=function pl(e){if(ol(e))return e;if(nl(e)){for(var t=e.length,i=[],r=0;r<t;r++){var n=e[r];"string"==typeof n?ll(i,n):"number"!=typeof n&&"Number"!==al(n)&&"String"!==al(n)||ll(i,sl(n));}var o=i.length,a=!0;return function(e,t){if(a)return a=!1,t;if(nl(this))return t;for(var r=0;r<o;r++)if(i[r]===e)return t;};}},wl=we,bl=String,kl=cl("JSON","stringify"),Sl=fl(/./.exec),xl=fl("".charAt),Cl=fl("".charCodeAt),Vl=fl("".replace),Tl=fl(1.1.toString),Il=/[\uD800-\uDFFF]/g,El=/^[\uD800-\uDBFF]$/,Pl=/^[\uDC00-\uDFFF]$/,Bl=!wl||vl(function(){var e=cl("Symbol")("stringify detection");return"[null]"!==kl([e])||"{}"!==kl({a:e})||"{}"!==kl(Object(e));}),Dl=vl(function(){return"\"\\udf06\\ud834\""!==kl("\uDF06\uD834")||"\"\\udead\""!==kl("\uDEAD");}),Ml=function Ml(e,t){var i=yl(arguments),r=pl(t);if(gl(r)||void 0!==e&&!ml(e))return i[1]=function(e,t){if(gl(r)&&(t=dl(r,this,bl(e),t)),!ml(t))return t;},hl(kl,null,i);},Al=function Al(e,t,i){var r=xl(i,t-1),n=xl(i,t+1);return Sl(El,e)&&!Sl(Pl,n)||Sl(Pl,e)&&!Sl(El,r)?"\\u"+Tl(Cl(e,0),16):e;};kl&&ul({target:"JSON",stat:!0,arity:3,forced:Bl||Dl},{stringify:function stringify(e,t,i){var r=yl(arguments),n=hl(Bl?Ml:kl,null,r);return Dl&&"string"==typeof n?Vl(n,Il,Al):n;}});var Ul=Uo,zl=Qe;Mi({target:"Object",stat:!0,forced:!we||a(function(){Ul.f(1);})},{getOwnPropertySymbols:function getOwnPropertySymbols(e){var t=Ul.f;return t?t(zl(e)):[];}}),_o("asyncDispose"),_o("asyncIterator"),_o("dispose"),_o("hasInstance"),_o("isConcatSpreadable"),_o("iterator"),_o("match"),_o("matchAll"),_o("replace"),_o("search"),_o("species"),_o("split");var Rl=Jo;_o("toPrimitive"),Rl();var Nl=ne,Ol=la;_o("toStringTag"),Ol(Nl("Symbol"),"Symbol"),_o("unscopables"),la(o.JSON,"JSON",!0);var Ll,Wl,Hl,Fl=J.Symbol,jl={},Yl=E,Xl=tt,ql=Function.prototype,Zl=Yl&&Object.getOwnPropertyDescriptor,_l=Xl(ql,"name"),Gl={EXISTS:_l,PROPER:_l&&"something"===function(){}.name,CONFIGURABLE:_l&&(!Yl||Yl&&Zl(ql,"name").configurable)},Kl=!a(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e())!==e.prototype;}),$l=tt,Ql=T,Jl=Qe,eu=Kl,tu=un("IE_PROTO"),iu=Object,ru=iu.prototype,nu=eu?iu.getPrototypeOf:function(e){var t=Jl(e);if($l(t,tu))return t[tu];var i=t.constructor;return Ql(i)&&t instanceof i?i.prototype:t instanceof iu?ru:null;},ou=a,au=T,su=Q,lu=xn,uu=nu,cu=Ro,hu=gt("iterator"),du=!1;[].keys&&("next"in(Hl=[].keys())?(Wl=uu(uu(Hl)))!==Object.prototype&&(Ll=Wl):du=!0);var fu=!su(Ll)||ou(function(){var e={};return Ll[hu].call(e)!==e;});au((Ll=fu?{}:lu(Ll))[hu])||cu(Ll,hu,function(){return this;});var vu={IteratorPrototype:Ll,BUGGY_SAFARI_ITERATORS:du},gu=vu.IteratorPrototype,mu=xn,yu=O,pu=la,wu=jl,bu=function bu(){return this;},ku=function ku(e,t,i,r){var n=t+" Iterator";return e.prototype=mu(gu,{next:yu(+!r,i)}),pu(e,n,!1,!0),wu[n]=bu,e;},Su=y,xu=De,Cu=Q,Vu=function Vu(e){return Cu(e)||null===e;},Tu=String,Iu=TypeError,Eu=function Eu(e,t,i){try{return Su(xu(Object.getOwnPropertyDescriptor(e,t)[i]));}catch(e){}},Pu=Q,Bu=Z,Du=function Du(e){if(Vu(e))return e;throw new Iu("Can't set "+Tu(e)+" as a prototype");},Mu=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,i={};try{(e=Eu(Object.prototype,"__proto__","set"))(i,[]),t=i instanceof Array;}catch(e){}return function(i,r){return Bu(i),Du(r),Pu(i)?(t?e(i,r):i.__proto__=r,i):i;};}():void 0),Au=Mi,Uu=D,zu=Gl,Ru=ku,Nu=nu,Ou=la,Lu=Ro,Wu=jl,Hu=vu,Fu=zu.PROPER,ju=Hu.BUGGY_SAFARI_ITERATORS,Yu=gt("iterator"),Xu="keys",qu="values",Zu="entries",_u=function _u(){return this;},Gu=function Gu(e,t,i,r,n,o,a){Ru(i,t,r);var s,l,u,c=function c(e){if(e===n&&g)return g;if(!ju&&e&&e in f)return f[e];switch(e){case Xu:case qu:case Zu:return function(){return new i(this,e);};}return function(){return new i(this);};},h=t+" Iterator",d=!1,f=e.prototype,v=f[Yu]||f["@@iterator"]||n&&f[n],g=!ju&&v||c(n),m="Array"===t&&f.entries||v;if(m&&(s=Nu(m.call(new e())))!==Object.prototype&&s.next&&(Ou(s,h,!0,!0),Wu[h]=_u),Fu&&n===qu&&v&&v.name!==qu&&(d=!0,g=function g(){return Uu(v,this);}),n)if(l={values:c(qu),keys:o?g:c(Xu),entries:c(Zu)},a)for(u in l)(ju||d||!(u in f))&&Lu(f,u,l[u]);else Au({target:t,proto:!0,forced:ju||d},l);return a&&f[Yu]!==g&&Lu(f,Yu,g,{name:n}),Wu[t]=g,l;},Ku=function Ku(e,t){return{value:e,done:t};},$u=K,Qu=function Qu(){},Ju=jl,ec=Ca,tc=(ti.f,Gu),ic=Ku,rc="Array Iterator",nc=ec.set,oc=ec.getterFor(rc);tc(Array,"Array",function(e,t){nc(this,{type:rc,target:$u(e),index:0,kind:t});},function(){var e=oc(this),t=e.target,i=e.index++;if(!t||i>=t.length)return e.target=null,ic(void 0,!0);switch(e.kind){case"keys":return ic(i,!1);case"values":return ic(t[i],!1);}return ic([i,t[i]],!1);},"values");Ju.Arguments=Ju.Array;Qu(),Qu(),Qu();var ac={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},sc=o,lc=la,uc=jl;for(var cc in ac)lc(sc[cc],cc),uc[cc]=uc.Array;var hc=Fl;!function(e){e.exports=hc;}(Hn);var dc=t(Wn),fc={},vc={get exports(){return fc;},set exports(e){fc=e;}};Mi({target:"Object",stat:!0,sham:!E},{create:xn});var gc=J.Object,mc=function mc(e,t){return gc.create(e,t);},yc=mc;!function(e){e.exports=yc;}(vc);var pc=t(fc),wc={},bc={get exports(){return wc;},set exports(e){wc=e;}},kc=Qe,Sc=nu,xc=Kl;Mi({target:"Object",stat:!0,forced:a(function(){Sc(1);}),sham:!xc},{getPrototypeOf:function getPrototypeOf(e){return Sc(kc(e));}});var Cc=J.Object.getPrototypeOf;!function(e){e.exports=Cc;}(bc);var Vc=t(wc),Tc={},Ic={get exports(){return Tc;},set exports(e){Tc=e;}};Mi({target:"Object",stat:!0},{setPrototypeOf:Mu});var Ec=J.Object.setPrototypeOf;!function(e){e.exports=Ec;}(Ic);var Pc=t(Tc),Bc={},Dc={get exports(){return Bc;},set exports(e){Bc=e;}},Mc={},Ac={get exports(){return Mc;},set exports(e){Mc=e;}},Uc=gt,zc=ti.f,Rc=Uc("metadata"),Nc=Function.prototype;void 0===Nc[Rc]&&zc(Nc,Rc,{value:null}),_o("metadata");var Oc=hc,Lc=y,Wc=ne("Symbol"),Hc=Wc.keyFor,Fc=Lc(Wc.prototype.valueOf),jc=Wc.isRegisteredSymbol||function(e){try{return void 0!==Hc(Fc(e));}catch(e){return!1;}};Mi({target:"Symbol",stat:!0},{isRegisteredSymbol:jc});for(var Yc=Ge,Xc=ne,qc=y,Zc=Ve,_c=gt,Gc=Xc("Symbol"),Kc=Gc.isWellKnownSymbol,$c=Xc("Object","getOwnPropertyNames"),Qc=qc(Gc.prototype.valueOf),Jc=Yc("wks"),eh=0,th=$c(Gc),ih=th.length;eh<ih;eh++)try{var rh=th[eh];Zc(Gc[rh])&&_c(rh);}catch(e){}var nh=function nh(e){if(Kc&&Kc(e))return!0;try{for(var t=Qc(e),i=0,r=$c(Jc),n=r.length;i<n;i++)if(Jc[r[i]]==t)return!0;}catch(e){}return!1;};Mi({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:nh}),_o("customMatcher"),_o("observable"),Mi({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:jc}),Mi({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:nh}),_o("matcher"),_o("metadataKey"),_o("patternMatch"),_o("replaceAll");var oh=Oc;!function(e){e.exports=oh;}(Ac),function(e){e.exports=Mc;}(Dc);var ah=t(Bc),sh={},lh={get exports(){return sh;},set exports(e){sh=e;}},uh={},ch={get exports(){return uh;},set exports(e){uh=e;}},hh=y,dh=Tr,fh=Co,vh=Z,gh=hh("".charAt),mh=hh("".charCodeAt),yh=hh("".slice),ph=function ph(e){return function(t,i){var r,n,o=fh(vh(t)),a=dh(i),s=o.length;return a<0||a>=s?e?"":void 0:(r=mh(o,a))<55296||r>56319||a+1===s||(n=mh(o,a+1))<56320||n>57343?e?gh(o,a):r:e?yh(o,a,a+2):n-56320+(r-55296<<10)+65536;};},wh={codeAt:ph(!1),charAt:ph(!0)},bh=wh.charAt,kh=Co,Sh=Ca,xh=Gu,Ch=Ku,Vh="String Iterator",Th=Sh.set,Ih=Sh.getterFor(Vh);xh(String,"String",function(e){Th(this,{type:Vh,string:kh(e),index:0});},function(){var e,t=Ih(this),i=t.string,r=t.index;return r>=i.length?Ch(void 0,!0):(e=bh(i,r),t.index+=e.length,Ch(e,!1));});var Eh=Lo.f("iterator");!function(e){e.exports=Eh;}(ch),function(e){e.exports=uh;}(lh);var Ph=t(sh);function Bh(e){return Bh="function"==typeof ah&&"symbol"==_typeof(Ph)?function(e){return _typeof(e);}:function(e){return e&&"function"==typeof ah&&e.constructor===ah&&e!==ah.prototype?"symbol":_typeof(e);},Bh(e);}var Dh={},Mh={get exports(){return Dh;},set exports(e){Dh=e;}},Ah={},Uh={get exports(){return Ah;},set exports(e){Ah=e;}};Mi({target:"Array",stat:!0},{isArray:jn});var zh=J.Array.isArray,Rh=zh;!function(e){e.exports=Rh;}(Uh),function(e){e.exports=Ah;}(Mh);var Nh=t(Dh);function Oh(e){if(Nh(e))return e;}var Lh={},Wh={get exports(){return Lh;},set exports(e){Lh=e;}},Hh={},Fh={get exports(){return Hh;},set exports(e){Hh=e;}},jh=Ji,Yh=Ue,Xh=Y,qh=jl,Zh=gt("iterator"),_h=function _h(e){if(!Xh(e))return Yh(e,Zh)||Yh(e,"@@iterator")||qh[jh(e)];},Gh=_h;!function(e){e.exports=Gh;}(Fh),function(e){e.exports=Hh;}(Wh);var Kh=t(Lh),$h={},Qh={get exports(){return $h;},set exports(e){$h=e;}},Jh={},ed={get exports(){return Jh;},set exports(e){Jh=e;}},td=D,id=ai,rd=Ue,nd=function nd(e,t,i){var r,n;id(e);try{if(!(r=rd(e,"return"))){if("throw"===t)throw i;return i;}r=td(r,e);}catch(e){n=!0,r=e;}if("throw"===t)throw i;if(n)throw r;return id(r),i;},od=ai,ad=nd,sd=jl,ld=gt("iterator"),ud=Array.prototype,cd=function cd(e){return void 0!==e&&(sd.Array===e||ud[ld]===e);},hd=D,dd=De,fd=ai,vd=Ie,gd=_h,md=TypeError,yd=function yd(e,t){var i=arguments.length<2?gd(e):t;if(dd(i))return fd(hd(i,e));throw new md(vd(e)+" is not iterable");},pd=ei,wd=D,bd=Qe,kd=function kd(e,t,i,r){try{return r?t(od(i)[0],i[1]):t(i);}catch(t){ad(e,"throw",t);}},Sd=cd,xd=mr,Cd=zr,Vd=Gn,Td=yd,Id=_h,Ed=Array,Pd=function Pd(e){var t=bd(e),i=xd(this),r=arguments.length,n=r>1?arguments[1]:void 0,o=void 0!==n;o&&(n=pd(n,r>2?arguments[2]:void 0));var a,s,l,u,c,h,d=Id(t),f=0;if(!d||this===Ed&&Sd(d))for(a=Cd(t),s=i?new this(a):Ed(a);a>f;f++)h=o?n(t[f],f):t[f],Vd(s,f,h);else for(s=i?new this():[],c=(u=Td(t,d)).next;!(l=wd(c,u)).done;f++)h=o?kd(u,n,[l.value,f],!0):l.value,Vd(s,f,h);return s.length=f,s;},Bd=gt("iterator"),Dd=!1;try{var Md=0,Ad={next:function next(){return{done:!!Md++};},return:function _return(){Dd=!0;}};Ad[Bd]=function(){return this;},Array.from(Ad,function(){throw 2;});}catch(e){}var Ud=function Ud(e,t){try{if(!t&&!Dd)return!1;}catch(e){return!1;}var i=!1;try{var r={};r[Bd]=function(){return{next:function next(){return{done:i=!0};}};},e(r);}catch(e){}return i;},zd=Pd;Mi({target:"Array",stat:!0,forced:!Ud(function(e){Array.from(e);})},{from:zd});var Rd=J.Array.from,Nd=Rd;!function(e){e.exports=Nd;}(ed),function(e){e.exports=Jh;}(Qh);var Od=t($h);function Ld(e){if(void 0!==ah&&null!=Kh(e)||null!=e["@@iterator"])return Od(e);}var Wd={},Hd={get exports(){return Wd;},set exports(e){Wd=e;}},Fd={},jd={get exports(){return Fd;},set exports(e){Fd=e;}},Yd=Mi,Xd=jn,qd=mr,Zd=Q,_d=Br,Gd=zr,Kd=K,$d=Gn,Qd=gt,Jd=Ai,ef=ao("slice"),tf=Qd("species"),rf=Array,nf=Math.max;Yd({target:"Array",proto:!0,forced:!ef},{slice:function slice(e,t){var i,r,n,o=Kd(this),a=Gd(o),s=_d(e,a),l=_d(void 0===t?a:t,a);if(Xd(o)&&(i=o.constructor,(qd(i)&&(i===rf||Xd(i.prototype))||Zd(i)&&null===(i=i[tf]))&&(i=void 0),i===rf||void 0===i))return Jd(o,s,l);for(r=new(void 0===i?rf:i)(nf(l-s,0)),n=0;s<l;s++,n++)s in o&&$d(r,n,o[s]);return r.length=n,r;}});var of=o,af=J,sf=function sf(e,t){var i=af[e+"Prototype"],r=i&&i[t];if(r)return r;var n=of[e],o=n&&n.prototype;return o&&o[t];},lf=sf("Array","slice"),uf=oe,cf=lf,hf=Array.prototype,df=function df(e){var t=e.slice;return e===hf||uf(hf,e)&&t===hf.slice?cf:t;},ff=df,vf=ff;!function(e){e.exports=vf;}(jd),function(e){e.exports=Fd;}(Hd);var gf=t(Wd);function mf(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r;}function yf(e,t){var i;if(e){if("string"==typeof e)return mf(e,t);var r=gf(i=Object.prototype.toString.call(e)).call(i,8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Od(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?mf(e,t):void 0;}}function pf(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var wf={},bf={get exports(){return wf;},set exports(e){wf=e;}},kf={},Sf={get exports(){return kf;},set exports(e){kf=e;}},xf=J.Object.getOwnPropertySymbols;!function(e){e.exports=xf;}(Sf),function(e){e.exports=kf;}(bf);var Cf=t(wf),Vf={},Tf={get exports(){return Vf;},set exports(e){Vf=e;}},If={},Ef={get exports(){return If;},set exports(e){If=e;}},Pf=a,Bf=function Bf(e,t){var i=[][e];return!!i&&Pf(function(){i.call(null,t||function(){return 1;},1);});},Df=Mi,Mf=Wr.indexOf,Af=Bf,Uf=C([].indexOf),zf=!!Uf&&1/Uf([1],1,-0)<0;Df({target:"Array",proto:!0,forced:zf||!Af("indexOf")},{indexOf:function indexOf(e){var t=arguments.length>1?arguments[1]:void 0;return zf?Uf(this,e,t)||0:Mf(this,e,t);}});var Rf=sf("Array","indexOf"),Nf=oe,Of=Rf,Lf=Array.prototype,Wf=function Wf(e){var t=e.indexOf;return e===Lf||Nf(Lf,e)&&t===Lf.indexOf?Of:t;},Hf=Wf,Ff=Hf;!function(e){e.exports=Ff;}(Ef),function(e){e.exports=If;}(Tf);var jf=t(Vf),Yf={},Xf={get exports(){return Yf;},set exports(e){Yf=e;}},qf={},Zf={get exports(){return qf;},set exports(e){qf=e;}},_f=Qe,Gf=$r;Mi({target:"Object",stat:!0,forced:a(function(){Gf(1);})},{keys:function keys(e){return Gf(_f(e));}});var Kf=J.Object.keys,$f=Kf;!function(e){e.exports=$f;}(Zf),function(e){e.exports=qf;}(Xf);var Qf=t(Yf);function Jf(e,t){if(null==e)return{};var i,r,n=function(e,t){if(null==e)return{};var i,r,n={},o=Qf(e);for(r=0;r<o.length;r++)i=o[r],jf(t).call(t,i)>=0||(n[i]=e[i]);return n;}(e,t);if(Cf){var o=Cf(e);for(r=0;r<o.length;r++)i=o[r],jf(t).call(t,i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i]);}return n;}var ev={},tv={get exports(){return ev;},set exports(e){ev=e;}},iv={},rv={get exports(){return iv;},set exports(e){iv=e;}},nv=Yi;Mi({target:"Function",proto:!0,forced:Function.bind!==nv},{bind:nv});var ov=sf("Function","bind"),av=oe,sv=ov,lv=Function.prototype,uv=function uv(e){var t=e.bind;return e===lv||av(lv,e)&&t===lv.bind?sv:t;},cv=uv,hv=cv;!function(e){e.exports=hv;}(rv),function(e){e.exports=iv;}(tv);var dv=t(ev),fv={},vv={get exports(){return fv;},set exports(e){fv=e;}},gv={},mv={get exports(){return gv;},set exports(e){gv=e;}},yv=On;!function(e){e.exports=yv;}(mv),function(e){e.exports=gv;}(vv);var pv=t(fv),wv={},bv={get exports(){return wv;},set exports(e){wv=e;}},kv={},Sv={get exports(){return kv;},set exports(e){kv=e;}},xv=Ec;!function(e){e.exports=xv;}(Sv),function(e){e.exports=kv;}(bv);var Cv=t(wv);function Vv(e,t){var i;return Vv=Cv?dv(i=Cv).call(i):function(e,t){return e.__proto__=t,e;},Vv(e,t);}function Tv(){if("undefined"==typeof Reflect||!pv)return!1;if(pv.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(pv(Boolean,[],function(){})),!0;}catch(e){return!1;}}function Iv(e,t,i){var r;Tv()?Iv=dv(r=pv).call(r):Iv=function Iv(e,t,i){var r=[null];r.push.apply(r,t);var n=new(dv(Function).apply(e,r))();return i&&Vv(n,i.prototype),n;};return Iv.apply(null,arguments);}var Ev={},Pv={get exports(){return Ev;},set exports(e){Ev=e;}},Bv={},Dv={get exports(){return Bv;},set exports(e){Bv=e;}},Mv=ne,Av=Vo,Uv=Uo,zv=ai,Rv=y([].concat),Nv=Mv("Reflect","ownKeys")||function(e){var t=Av.f(zv(e)),i=Uv.f;return i?Rv(t,i(e)):t;},Ov=tt,Lv=Nv,Wv=I,Hv=ti,Fv=Q,jv=bi,Yv=Error,Xv=y("".replace),qv=String(new Yv("zxcasd").stack),Zv=/\n\s*at [^:]*:[^\n]*/,_v=Zv.test(qv),Gv=O,Kv=!a(function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",Gv(1,7)),7!==e.stack);}),$v=bi,Qv=function Qv(e,t){if(_v&&"string"==typeof e&&!Yv.prepareStackTrace)for(;t--;)e=Xv(e,Zv,"");return e;},Jv=Kv,eg=Error.captureStackTrace,tg=ei,ig=D,rg=ai,ng=Ie,og=cd,ag=zr,sg=oe,lg=yd,ug=_h,cg=nd,hg=TypeError,dg=function dg(e,t){this.stopped=e,this.result=t;},fg=dg.prototype,vg=function vg(e,t,i){var r,n,o,a,s,l,u,c=i&&i.that,h=!(!i||!i.AS_ENTRIES),d=!(!i||!i.IS_RECORD),f=!(!i||!i.IS_ITERATOR),v=!(!i||!i.INTERRUPTED),g=tg(t,c),m=function m(e){return r&&cg(r,"normal"),new dg(!0,e);},y=function y(e){return h?(rg(e),v?g(e[0],e[1],m):g(e[0],e[1])):v?g(e,m):g(e);};if(d)r=e.iterator;else if(f)r=e;else{if(!(n=ug(e)))throw new hg(ng(e)+" is not iterable");if(og(n)){for(o=0,a=ag(e);a>o;o++)if((s=y(e[o]))&&sg(fg,s))return s;return new dg(!1);}r=lg(e,n);}for(l=d?e.next:r.next;!(u=ig(l,r)).done;){try{s=y(u.value);}catch(e){cg(r,"throw",e);}if("object"==_typeof(s)&&s&&sg(fg,s))return s;}return new dg(!1);},gg=Co,mg=Mi,yg=oe,pg=nu,wg=Mu,bg=function bg(e,t,i){for(var r=Lv(t),n=Hv.f,o=Wv.f,a=0;a<r.length;a++){var s=r[a];Ov(e,s)||i&&Ov(i,s)||n(e,s,o(t,s));}},kg=xn,Sg=bi,xg=O,Cg=function Cg(e,t){Fv(t)&&"cause"in t&&jv(e,"cause",t.cause);},Vg=function Vg(e,t,i,r){Jv&&(eg?eg(e,t):$v(e,"stack",Qv(i,r)));},Tg=vg,Ig=function Ig(e,t){return void 0===e?arguments.length<2?"":t:gg(e);},Eg=gt("toStringTag"),Pg=Error,Bg=[].push,_Dg=function Dg(e,t){var i,r=yg(Mg,this);wg?i=wg(new Pg(),r?pg(this):Mg):(i=r?this:kg(Mg),Sg(i,Eg,"Error")),void 0!==t&&Sg(i,"message",Ig(t)),Vg(i,_Dg,i.stack,1),arguments.length>2&&Cg(i,arguments[2]);var n=[];return Tg(e,Bg,{that:n}),Sg(i,"errors",n),i;};wg?wg(_Dg,Pg):bg(_Dg,Pg,{name:!0});var Mg=_Dg.prototype=kg(Pg.prototype,{constructor:xg(1,_Dg),message:xg(1,""),name:xg(1,"AggregateError")});mg({global:!0,constructor:!0,arity:2},{AggregateError:_Dg});var Ag,Ug,zg,Rg,Ng=o,Og=le,Lg=k,Wg=function Wg(e){return Og.slice(0,e.length)===e;},Hg=Wg("Bun/")?"BUN":Wg("Cloudflare-Workers")?"CLOUDFLARE":Wg("Deno/")?"DENO":Wg("Node.js/")?"NODE":Ng.Bun&&"string"==typeof Bun.version?"BUN":Ng.Deno&&"object"==_typeof(Deno.version)?"DENO":"process"===Lg(Ng.process)?"NODE":Ng.window&&Ng.document?"BROWSER":"REST",Fg="NODE"===Hg,jg=ne,Yg=Oo,Xg=E,qg=gt("species"),Zg=function Zg(e){var t=jg(e);Xg&&t&&!t[qg]&&Yg(t,qg,{configurable:!0,get:function get(){return this;}});},_g=oe,Gg=TypeError,Kg=function Kg(e,t){if(_g(t,e))return e;throw new Gg("Incorrect invocation");},$g=ai,Qg=br,Jg=Y,em=gt("species"),tm=function tm(e,t){var i,r=$g(e).constructor;return void 0===r||Jg(i=$g(r)[em])?t:Qg(i);},im=TypeError,rm=function rm(e,t){if(e<t)throw new im("Not enough arguments");return e;},nm=/(?:ipad|iphone|ipod).*applewebkit/i.test(le),om=o,am=d,sm=ei,lm=T,um=tt,cm=a,hm=an,dm=Ai,fm=Bt,vm=rm,gm=nm,mm=Fg,ym=om.setImmediate,pm=om.clearImmediate,wm=om.process,bm=om.Dispatch,km=om.Function,Sm=om.MessageChannel,xm=om.String,Cm=0,Vm={},Tm="onreadystatechange";cm(function(){Ag=om.location;});var Im=function Im(e){if(um(Vm,e)){var t=Vm[e];delete Vm[e],t();}},Em=function Em(e){return function(){Im(e);};},Pm=function Pm(e){Im(e.data);},Bm=function Bm(e){om.postMessage(xm(e),Ag.protocol+"//"+Ag.host);};ym&&pm||(ym=function ym(e){vm(arguments.length,1);var t=lm(e)?e:km(e),i=dm(arguments,1);return Vm[++Cm]=function(){am(t,void 0,i);},Ug(Cm),Cm;},pm=function pm(e){delete Vm[e];},mm?Ug=function Ug(e){wm.nextTick(Em(e));}:bm&&bm.now?Ug=function Ug(e){bm.now(Em(e));}:Sm&&!gm?(Rg=(zg=new Sm()).port2,zg.port1.onmessage=Pm,Ug=sm(Rg.postMessage,Rg)):om.addEventListener&&lm(om.postMessage)&&!om.importScripts&&Ag&&"file:"!==Ag.protocol&&!cm(Bm)?(Ug=Bm,om.addEventListener("message",Pm,!1)):Ug=Tm in fm("script")?function(e){hm.appendChild(fm("script"))[Tm]=function(){hm.removeChild(this),Im(e);};}:function(e){setTimeout(Em(e),0);});var Dm={set:ym,clear:pm},Mm=o,Am=E,Um=Object.getOwnPropertyDescriptor,zm=function zm(e){if(!Am)return Mm[e];var t=Um(Mm,e);return t&&t.value;},Rm=function Rm(){this.head=null,this.tail=null;};Rm.prototype={add:function add(e){var t={item:e,next:null},i=this.tail;i?i.next=t:this.head=t,this.tail=t;},get:function get(){var e=this.head;if(e)return null===(this.head=e.next)&&(this.tail=null),e.item;}};var Nm,Om,Lm,Wm,Hm,Fm=Rm,jm=/ipad|iphone|ipod/i.test(le)&&"undefined"!=typeof Pebble,Ym=/web0s(?!.*chrome)/i.test(le),Xm=o,qm=zm,Zm=ei,_m=Dm.set,Gm=Fm,Km=nm,$m=jm,Qm=Ym,Jm=Fg,ey=Xm.MutationObserver||Xm.WebKitMutationObserver,ty=Xm.document,iy=Xm.process,ry=Xm.Promise,ny=qm("queueMicrotask");if(!ny){var oy=new Gm(),ay=function ay(){var e,t;for(Jm&&(e=iy.domain)&&e.exit();t=oy.get();)try{t();}catch(e){throw oy.head&&Nm(),e;}e&&e.enter();};Km||Jm||Qm||!ey||!ty?!$m&&ry&&ry.resolve?((Wm=ry.resolve(void 0)).constructor=ry,Hm=Zm(Wm.then,Wm),Nm=function Nm(){Hm(ay);}):Jm?Nm=function Nm(){iy.nextTick(ay);}:(_m=Zm(_m,Xm),Nm=function Nm(){_m(ay);}):(Om=!0,Lm=ty.createTextNode(""),new ey(ay).observe(Lm,{characterData:!0}),Nm=function Nm(){Lm.data=Om=!Om;}),ny=function ny(e){oy.head||Nm(),oy.add(e);};}var sy=ny,ly=function ly(e){try{return{error:!1,value:e()};}catch(e){return{error:!0,value:e};}},uy=o.Promise,cy=o,hy=uy,dy=T,fy=Kt,vy=rr,gy=gt,my=Hg,yy=ge,py=hy&&hy.prototype,wy=gy("species"),by=!1,ky=dy(cy.PromiseRejectionEvent),Sy=fy("Promise",function(){var e=vy(hy),t=e!==String(hy);if(!t&&66===yy)return!0;if(!py.catch||!py.finally)return!0;if(!yy||yy<51||!/native code/.test(e)){var i=new hy(function(e){e(1);}),r=function r(e){e(function(){},function(){});};if((i.constructor={})[wy]=r,!(by=i.then(function(){})instanceof r))return!0;}return!(t||"BROWSER"!==my&&"DENO"!==my||ky);}),xy={CONSTRUCTOR:Sy,REJECTION_EVENT:ky,SUBCLASSING:by},Cy={},Vy=De,Ty=TypeError,Iy=function Iy(e){var t,i;this.promise=new e(function(e,r){if(void 0!==t||void 0!==i)throw new Ty("Bad Promise constructor");t=e,i=r;}),this.resolve=Vy(t),this.reject=Vy(i);};Cy.f=function(e){return new Iy(e);};var Ey,Py,By,Dy=Mi,My=Fg,Ay=o,Uy=J,zy=D,Ry=Ro,Ny=la,Oy=Zg,Ly=De,Wy=T,Hy=Q,Fy=Kg,jy=tm,Yy=Dm.set,Xy=sy,qy=function qy(e,t){try{1===arguments.length?console.error(e):console.error(e,t);}catch(e){}},Zy=ly,_y=Fm,Gy=Ca,Ky=uy,$y=xy,Qy=Cy,Jy="Promise",ep=$y.CONSTRUCTOR,tp=$y.REJECTION_EVENT,ip=Gy.getterFor(Jy),rp=Gy.set,np=Ky&&Ky.prototype,op=Ky,ap=np,sp=Ay.TypeError,lp=Ay.document,up=Ay.process,cp=Qy.f,hp=cp,dp=!!(lp&&lp.createEvent&&Ay.dispatchEvent),fp="unhandledrejection",vp=function vp(e){var t;return!(!Hy(e)||!Wy(t=e.then))&&t;},gp=function gp(e,t){var i,r,n,o=t.value,a=1===t.state,s=a?e.ok:e.fail,l=e.resolve,u=e.reject,c=e.domain;try{s?(a||(2===t.rejection&&bp(t),t.rejection=1),!0===s?i=o:(c&&c.enter(),i=s(o),c&&(c.exit(),n=!0)),i===e.promise?u(new sp("Promise-chain cycle")):(r=vp(i))?zy(r,i,l,u):l(i)):u(o);}catch(e){c&&!n&&c.exit(),u(e);}},mp=function mp(e,t){e.notified||(e.notified=!0,Xy(function(){for(var i,r=e.reactions;i=r.get();)gp(i,e);e.notified=!1,t&&!e.rejection&&pp(e);}));},yp=function yp(e,t,i){var r,n;dp?((r=lp.createEvent("Event")).promise=t,r.reason=i,r.initEvent(e,!1,!0),Ay.dispatchEvent(r)):r={promise:t,reason:i},!tp&&(n=Ay["on"+e])?n(r):e===fp&&qy("Unhandled promise rejection",i);},pp=function pp(e){zy(Yy,Ay,function(){var t,i=e.facade,r=e.value;if(wp(e)&&(t=Zy(function(){My?up.emit("unhandledRejection",r,i):yp(fp,i,r);}),e.rejection=My||wp(e)?2:1,t.error))throw t.value;});},wp=function wp(e){return 1!==e.rejection&&!e.parent;},bp=function bp(e){zy(Yy,Ay,function(){var t=e.facade;My?up.emit("rejectionHandled",t):yp("rejectionhandled",t,e.value);});},kp=function kp(e,t,i){return function(r){e(t,r,i);};},Sp=function Sp(e,t,i){e.done||(e.done=!0,i&&(e=i),e.value=t,e.state=2,mp(e,!0));},_xp=function xp(e,t,i){if(!e.done){e.done=!0,i&&(e=i);try{if(e.facade===t)throw new sp("Promise can't be resolved itself");var r=vp(t);r?Xy(function(){var i={done:!1};try{zy(r,t,kp(_xp,i,e),kp(Sp,i,e));}catch(t){Sp(i,t,e);}}):(e.value=t,e.state=1,mp(e,!1));}catch(t){Sp({done:!1},t,e);}}};ep&&(ap=(op=function op(e){Fy(this,ap),Ly(e),zy(Ey,this);var t=ip(this);try{e(kp(_xp,t),kp(Sp,t));}catch(e){Sp(t,e);}}).prototype,(Ey=function Ey(e){rp(this,{type:Jy,done:!1,notified:!1,parent:!1,reactions:new _y(),rejection:!1,state:0,value:null});}).prototype=Ry(ap,"then",function(e,t){var i=ip(this),r=cp(jy(this,op));return i.parent=!0,r.ok=!Wy(e)||e,r.fail=Wy(t)&&t,r.domain=My?up.domain:void 0,0===i.state?i.reactions.add(r):Xy(function(){gp(r,i);}),r.promise;}),Py=function Py(){var e=new Ey(),t=ip(e);this.promise=e,this.resolve=kp(_xp,t),this.reject=kp(Sp,t);},Qy.f=cp=function cp(e){return e===op||e===By?new Py(e):hp(e);}),Dy({global:!0,constructor:!0,wrap:!0,forced:ep},{Promise:op}),By=Uy.Promise,Ny(op,Jy,!1,!0),Oy(Jy);var Cp=uy,Vp=xy.CONSTRUCTOR||!Ud(function(e){Cp.all(e).then(void 0,function(){});}),Tp=D,Ip=De,Ep=Cy,Pp=ly,Bp=vg;Mi({target:"Promise",stat:!0,forced:Vp},{all:function all(e){var t=this,i=Ep.f(t),r=i.resolve,n=i.reject,o=Pp(function(){var i=Ip(t.resolve),o=[],a=0,s=1;Bp(e,function(e){var l=a++,u=!1;s++,Tp(i,t,e).then(function(e){u||(u=!0,o[l]=e,--s||r(o));},n);}),--s||r(o);});return o.error&&n(o.value),i.promise;}});var Dp=Mi,Mp=xy.CONSTRUCTOR;uy&&uy.prototype,Dp({target:"Promise",proto:!0,forced:Mp,real:!0},{catch:function _catch(e){return this.then(void 0,e);}});var Ap=D,Up=De,zp=Cy,Rp=ly,Np=vg;Mi({target:"Promise",stat:!0,forced:Vp},{race:function race(e){var t=this,i=zp.f(t),r=i.reject,n=Rp(function(){var n=Up(t.resolve);Np(e,function(e){Ap(n,t,e).then(i.resolve,r);});});return n.error&&r(n.value),i.promise;}});var Op=Cy;Mi({target:"Promise",stat:!0,forced:xy.CONSTRUCTOR},{reject:function reject(e){var t=Op.f(this);return(0,t.reject)(e),t.promise;}});var Lp=ai,Wp=Q,Hp=Cy,Fp=function Fp(e,t){if(Lp(e),Wp(t)&&t.constructor===e)return t;var i=Hp.f(e);return(0,i.resolve)(t),i.promise;},jp=Mi,Yp=uy,Xp=xy.CONSTRUCTOR,qp=Fp,Zp=ne("Promise"),_p=!Xp;jp({target:"Promise",stat:!0,forced:true},{resolve:function resolve(e){return qp(_p&&this===Zp?Yp:this,e);}});var Gp=D,Kp=De,$p=Cy,Qp=ly,Jp=vg;Mi({target:"Promise",stat:!0,forced:Vp},{allSettled:function allSettled(e){var t=this,i=$p.f(t),r=i.resolve,n=i.reject,o=Qp(function(){var i=Kp(t.resolve),n=[],o=0,a=1;Jp(e,function(e){var s=o++,l=!1;a++,Gp(i,t,e).then(function(e){l||(l=!0,n[s]={status:"fulfilled",value:e},--a||r(n));},function(e){l||(l=!0,n[s]={status:"rejected",reason:e},--a||r(n));});}),--a||r(n);});return o.error&&n(o.value),i.promise;}});var ew=D,tw=De,iw=ne,rw=Cy,nw=ly,ow=vg,aw="No one promise resolved";Mi({target:"Promise",stat:!0,forced:Vp},{any:function any(e){var t=this,i=iw("AggregateError"),r=rw.f(t),n=r.resolve,o=r.reject,a=nw(function(){var r=tw(t.resolve),a=[],s=0,l=1,u=!1;ow(e,function(e){var c=s++,h=!1;l++,ew(r,t,e).then(function(e){h||u||(u=!0,n(e));},function(e){h||u||(h=!0,a[c]=e,--l||o(new i(a,aw)));});}),--l||o(new i(a,aw));});return a.error&&o(a.value),r.promise;}});var sw=Mi,lw=d,uw=Ai,cw=Cy,hw=De,dw=ly,fw=o.Promise,vw=!1;sw({target:"Promise",stat:!0,forced:!fw||!fw.try||dw(function(){fw.try(function(e){vw=8===e;},8);}).error||!vw},{try:function _try(e){var t=arguments.length>1?uw(arguments,1):[],i=cw.f(this),r=dw(function(){return lw(hw(e),void 0,t);});return(r.error?i.reject:i.resolve)(r.value),i.promise;}});var gw=Cy;Mi({target:"Promise",stat:!0},{withResolvers:function withResolvers(){var e=gw.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject};}});var mw=Mi,yw=uy,pw=a,ww=ne,bw=T,kw=tm,Sw=Fp,xw=yw&&yw.prototype;mw({target:"Promise",proto:!0,real:!0,forced:!!yw&&pw(function(){xw.finally.call({then:function then(){}},function(){});})},{finally:function _finally(e){var t=kw(this,ww("Promise")),i=bw(e);return this.then(i?function(i){return Sw(t,e()).then(function(){return i;});}:e,i?function(i){return Sw(t,e()).then(function(){throw i;});}:e);}});var Cw=J.Promise,Vw=Cw;!function(e){e.exports=Vw;}(Dv),function(e){e.exports=Bv;}(Pv);var Tw=t(Ev);function Iw(e,t,i,r,n,o,a){try{var s=e[o](a),l=s.value;}catch(e){return void i(e);}s.done?t(l):Tw.resolve(l).then(r,n);}function Ew(e){return function(){var t=this,i=arguments;return new Tw(function(r,n){var o=e.apply(t,i);function a(e){Iw(o,r,n,a,s,"next",e);}function s(e){Iw(o,r,n,a,s,"throw",e);}a(void 0);});};}function Pw(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e;}var Bw={},Dw={get exports(){return Bw;},set exports(e){Bw=e;}},Mw={},Aw={get exports(){return Mw;},set exports(e){Mw=e;}},Uw=Cc;!function(e){e.exports=Uw;}(Aw),function(e){e.exports=Mw;}(Dw);var zw=t(Bw);function Rw(e){var t;return Rw=Cv?dv(t=zw).call(t):function(e){return e.__proto__||zw(e);},Rw(e);}var Nw={},Ow={get exports(){return Nw;},set exports(e){Nw=e;}},Lw={},Ww={get exports(){return Lw;},set exports(e){Lw=e;}},Hw=tt,Fw=D,jw=Q,Yw=ai,Xw=function Xw(e){return void 0!==e&&(Hw(e,"value")||Hw(e,"writable"));},qw=I,Zw=nu;Mi({target:"Reflect",stat:!0},{get:function e(t,i){var r,n,o=arguments.length<3?t:arguments[2];return Yw(t)===o?t[i]:(r=qw.f(t,i))?Xw(r)?r.value:void 0===r.get?void 0:Fw(r.get,o):jw(n=Zw(t))?e(n,i,o):void 0;}});var _w=J.Reflect.get;!function(e){e.exports=_w;}(Ww),function(e){e.exports=Lw;}(Ow);var Gw=t(Nw),Kw={},$w={get exports(){return Kw;},set exports(e){Kw=e;}},Qw={},Jw={get exports(){return Qw;},set exports(e){Qw=e;}},eb={},tb={get exports(){return eb;},set exports(e){eb=e;}},ib=Mi,rb=a,nb=K,ob=I.f,ab=E;ib({target:"Object",stat:!0,forced:!ab||rb(function(){ob(1);}),sham:!ab},{getOwnPropertyDescriptor:function getOwnPropertyDescriptor(e,t){return ob(nb(e),t);}});var sb=J.Object,lb=tb.exports=function(e,t){return sb.getOwnPropertyDescriptor(e,t);};sb.getOwnPropertyDescriptor.sham&&(lb.sham=!0);var ub=eb;!function(e){e.exports=ub;}(Jw),function(e){e.exports=Qw;}($w);var cb=t(Kw);function hb(){var e;"undefined"!=typeof Reflect&&Gw?hb=dv(e=Gw).call(e):hb=function hb(e,t,i){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Rw(e)););return e;}(e,t);if(r){var n=cb(r,t);return n.get?n.get.call(arguments.length<3?e:i):n.value;}};return hb.apply(this,arguments);}var db={},fb={get exports(){return db;},set exports(e){db=e;}},vb={},gb={get exports(){return vb;},set exports(e){vb=e;}},mb=yc;!function(e){e.exports=mb;}(gb),function(e){e.exports=vb;}(fb);var yb=t(db),pb={},wb={get exports(){return pb;},set exports(e){pb=e;}},bb={},kb={get exports(){return bb;},set exports(e){bb=e;}},Sb={},xb={get exports(){return Sb;},set exports(e){Sb=e;}},Cb=Mi,Vb=E,Tb=ti.f;Cb({target:"Object",stat:!0,forced:Object.defineProperty!==Tb,sham:!Vb},{defineProperty:Tb});var Ib=J.Object,Eb=xb.exports=function(e,t,i){return Ib.defineProperty(e,t,i);};Ib.defineProperty.sham&&(Eb.sham=!0);var Pb=Sb,Bb=Pb;!function(e){e.exports=Bb;}(kb),function(e){e.exports=bb;}(wb);var Db=t(pb);function Mb(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=yb(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Db(e,"prototype",{writable:!1}),t&&Vv(e,t);}function Ab(e,t){return Oh(e)||function(e,t){var i=null==e?null:void 0!==ah&&Kh(e)||e["@@iterator"];if(null!=i){var r,n,o,a,s=[],l=!0,u=!1;try{if(o=(i=i.call(e)).next,0===t){if(Object(i)!==i)return;l=!1;}else for(;!(l=(r=o.call(i)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(e){u=!0,n=e;}finally{try{if(!l&&null!=i.return&&(a=i.return(),Object(a)!==a))return;}finally{if(u)throw n;}}return s;}}(e,t)||yf(e,t)||pf();}function Ub(e){return function(e){if(Nh(e))return mf(e);}(e)||Ld(e)||yf(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}();}var zb={},Rb={get exports(){return zb;},set exports(e){zb=e;}},Nb={},Ob={get exports(){return Nb;},set exports(e){Nb=e;}},Lb=Ma.filter;Mi({target:"Array",proto:!0,forced:!ao("filter")},{filter:function filter(e){return Lb(this,e,arguments.length>1?arguments[1]:void 0);}});var Wb=sf("Array","filter"),Hb=oe,Fb=Wb,jb=Array.prototype,Yb=function Yb(e){var t=e.filter;return e===jb||Hb(jb,e)&&t===jb.filter?Fb:t;},Xb=Yb,qb=Xb;!function(e){e.exports=qb;}(Ob),function(e){e.exports=Nb;}(Rb);var Zb=t(zb),_b={},Gb={get exports(){return _b;},set exports(e){_b=e;}},Kb={},$b={get exports(){return Kb;},set exports(e){Kb=e;}},Qb=Ma.forEach,Jb=Bf("forEach")?[].forEach:function(e){return Qb(this,e,arguments.length>1?arguments[1]:void 0);};Mi({target:"Array",proto:!0,forced:[].forEach!==Jb},{forEach:Jb});var ek=sf("Array","forEach"),tk=Ji,ik=tt,rk=oe,nk=ek,ok=Array.prototype,ak={DOMTokenList:!0,NodeList:!0},sk=function sk(e){var t=e.forEach;return e===ok||rk(ok,e)&&t===ok.forEach||ik(ak,tk(e))?nk:t;},lk=sk;!function(e){e.exports=lk;}($b),function(e){e.exports=Kb;}(Gb);var uk=t(_b),ck={},hk={get exports(){return ck;},set exports(e){ck=e;}},dk={},fk={get exports(){return dk;},set exports(e){dk=e;}},vk=Nv,gk=K,mk=I,yk=Gn;Mi({target:"Object",stat:!0,sham:!E},{getOwnPropertyDescriptors:function getOwnPropertyDescriptors(e){for(var t,i,r=gk(e),n=mk.f,o=vk(r),a={},s=0;o.length>s;)void 0!==(i=n(r,t=o[s++]))&&yk(a,t,i);return a;}});var pk=J.Object.getOwnPropertyDescriptors;!function(e){e.exports=pk;}(fk),function(e){e.exports=dk;}(hk);var wk=t(ck),bk={},kk={get exports(){return bk;},set exports(e){bk=e;}},Sk={},xk={get exports(){return Sk;},set exports(e){Sk=e;}},Ck={},Vk={get exports(){return Ck;},set exports(e){Ck=e;}},Tk=Mi,Ik=E,Ek=kr.f;Tk({target:"Object",stat:!0,forced:Object.defineProperties!==Ek,sham:!Ik},{defineProperties:Ek});var Pk=J.Object,Bk=Vk.exports=function(e,t){return Pk.defineProperties(e,t);};Pk.defineProperties.sham&&(Bk.sham=!0);var Dk=Ck;!function(e){e.exports=Dk;}(xk),function(e){e.exports=Sk;}(kk);var Mk=t(bk),Ak={},Uk={get exports(){return Ak;},set exports(e){Ak=e;}},zk={},Rk={get exports(){return zk;},set exports(e){zk=e;}},Nk=Lo.f("toPrimitive");!function(e){e.exports=Nk;}(Rk),function(e){e.exports=zk;}(Uk);var Ok=t(Ak);function Lk(e){var t=function(e,t){if("object"!==Bh(e)||null===e)return e;var i=e[Ok];if(void 0!==i){var r=i.call(e,t||"default");if("object"!==Bh(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.");}return("string"===t?String:Number)(e);}(e,"string");return"symbol"===Bh(t)?t:String(t);}function Wk(e,t,i){return(t=Lk(t))in e?Db(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e;}function Hk(e,t){var i=Qf(e);if(Cf){var r=Cf(e);t&&(r=Zb(r).call(r,function(t){return cb(e,t).enumerable;})),i.push.apply(i,r);}return i;}function Fk(e){for(var t=1;t<arguments.length;t++){var i,r,n=null!=arguments[t]?arguments[t]:{};t%2?uk(i=Hk(Object(n),!0)).call(i,function(t){Wk(e,t,n[t]);}):wk?Mk(e,wk(n)):uk(r=Hk(Object(n))).call(r,function(t){Db(e,t,cb(n,t));});}return e;}function jk(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Db(e,Lk(r.key),r);}}function Yk(e,t,i){return t&&jk(e.prototype,t),i&&jk(e,i),Db(e,"prototype",{writable:!1}),e;}function Xk(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function");}var qk={},Zk={get exports(){return qk;},set exports(e){qk=e;}};!function(e){e.exports=zh;}(Zk);var _k=t(qk),Gk={},Kk={get exports(){return Gk;},set exports(e){Gk=e;}};!function(e){e.exports=sk;}(Kk);var $k=t(Gk),Qk={},Jk={get exports(){return Qk;},set exports(e){Qk=e;}};!function(e){e.exports=Kf;}(Jk);var eS=t(Qk),tS={},iS={get exports(){return tS;},set exports(e){tS=e;}},rS=sf("Array","concat"),nS=oe,oS=rS,aS=Array.prototype,sS=function sS(e){var t=e.concat;return e===aS||nS(aS,e)&&t===aS.concat?oS:t;},lS=sS;!function(e){e.exports=lS;}(iS);var uS=t(tS),cS={},hS={get exports(){return cS;},set exports(e){cS=e;}};Mi({target:"Number",stat:!0},{isNaN:function isNaN(e){return e!=e;}});var dS=J.Number.isNaN;!function(e){e.exports=dS;}(hS);var fS=t(cS),vS={},gS={get exports(){return vS;},set exports(e){vS=e;}},mS="\t\n\x0B\f\r \xA0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF",yS=Z,pS=Co,wS=mS,bS=y("".replace),kS=RegExp("^["+wS+"]+"),SS=RegExp("(^|[^"+wS+"])["+wS+"]+$"),xS=function xS(e){return function(t){var i=pS(yS(t));return 1&e&&(i=bS(i,kS,"")),2&e&&(i=bS(i,SS,"$1")),i;};},CS={start:xS(1),end:xS(2),trim:xS(3)},VS=Gl.PROPER,TS=a,IS=mS,ES=CS.trim;Mi({target:"String",proto:!0,forced:function(e){return TS(function(){return!!IS[e]()||"âÂá "!=="âÂá "[e]()||VS&&IS[e].name!==e;});}("trim")},{trim:function trim(){return ES(this);}});var PS=sf("String","trim"),BS=oe,DS=PS,MS=String.prototype,AS=function AS(e){var t=e.trim;return"string"==typeof e||e===MS||BS(MS,e)&&t===MS.trim?DS:t;},US=AS;!function(e){e.exports=US;}(gS);var zS=t(vS),RS={},NS={get exports(){return RS;},set exports(e){RS=e;}},OS=o,LS=a,WS=y,HS=Co,FS=CS.trim,jS=mS,YS=OS.parseInt,XS=OS.Symbol,qS=XS&&XS.iterator,ZS=/^[+-]?0x/i,_S=WS(ZS.exec),GS=8!==YS(jS+"08")||22!==YS(jS+"0x16")||qS&&!LS(function(){YS(Object(qS));})?function(e,t){var i=FS(HS(e));return YS(i,t>>>0||(_S(ZS,i)?16:10));}:YS;Mi({global:!0,forced:parseInt!==GS},{parseInt:GS});var KS=J.parseInt;!function(e){e.exports=KS;}(NS);var $S=t(RS),QS={},JS={get exports(){return QS;},set exports(e){QS=e;}},ex=De,tx=Qe,ix=j,rx=zr,nx=TypeError,ox="Reduce of empty array with no initial value",ax=function ax(e){return function(t,i,r,n){var o=tx(t),a=ix(o),s=rx(o);if(ex(i),0===s&&r<2)throw new nx(ox);var l=e?s-1:0,u=e?-1:1;if(r<2)for(;;){if(l in a){n=a[l],l+=u;break;}if(l+=u,e?l<0:s<=l)throw new nx(ox);}for(;e?l>=0:s>l;l+=u)l in a&&(n=i(n,a[l],l,o));return n;};},sx={left:ax(!1),right:ax(!0)}.left;Mi({target:"Array",proto:!0,forced:!Fg&&ge>79&&ge<83||!Bf("reduce")},{reduce:function reduce(e){var t=arguments.length;return sx(this,e,t,t>1?arguments[1]:void 0);}});var lx=sf("Array","reduce"),ux=oe,cx=lx,hx=Array.prototype,dx=function dx(e){var t=e.reduce;return e===hx||ux(hx,e)&&t===hx.reduce?cx:t;},fx=dx;!function(e){e.exports=fx;}(JS);var vx=t(QS),gx={},mx={get exports(){return gx;},set exports(e){gx=e;}};!function(e){e.exports=Xb;}(mx);var yx=t(gx),px={},wx={get exports(){return px;},set exports(e){px=e;}},bx=Mi,kx=y,Sx=Br,xx=RangeError,Cx=String.fromCharCode,Vx=String.fromCodePoint,Tx=kx([].join);bx({target:"String",stat:!0,arity:1,forced:!!Vx&&1!==Vx.length},{fromCodePoint:function fromCodePoint(e){for(var t,i=[],r=arguments.length,n=0;r>n;){if(t=+arguments[n++],Sx(t,1114111)!==t)throw new xx(t+" is not a valid code point");i[n]=t<65536?Cx(t):Cx(55296+((t-=65536)>>10),t%1024+56320);}return Tx(i,"");}});var Ix=a,Ex=He,Px=gt("iterator"),Bx=!Ix(function(){var e=new URL("b?a=1&b=2&c=3","https://a"),t=e.searchParams,i=new URLSearchParams("a=1&a=2&b=3"),r="";return e.pathname="c%20d",t.forEach(function(e,i){t.delete("b"),r+=i+e;}),i.delete("a",2),i.delete("b",void 0),!e.toJSON||!i.has("a",1)||i.has("a",2)||!i.has("a",void 0)||i.has("b")||!t.size&&Ex||!t.sort||"https://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[Px]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("https://ÑÐµÑÑ").host||"#%D0%B1"!==new URL("https://a#Ð±").hash||"a1c3"!==r||"x"!==new URL("https://x",void 0).host;}),Dx=Ro,Mx=function Mx(e,t,i){for(var r in t)i&&i.unsafe&&e[r]?e[r]=t[r]:Dx(e,r,t[r],i);return e;},Ax=Ai,Ux=Math.floor,_zx=function zx(e,t){var i=e.length;if(i<8)for(var r,n,o=1;o<i;){for(n=o,r=e[o];n&&t(e[n-1],r)>0;)e[n]=e[--n];n!==o++&&(e[n]=r);}else for(var a=Ux(i/2),s=_zx(Ax(e,0,a),t),l=_zx(Ax(e,a),t),u=s.length,c=l.length,h=0,d=0;h<u||d<c;)e[h+d]=h<u&&d<c?t(s[h],l[d])<=0?s[h++]:l[d++]:h<u?s[h++]:l[d++];return e;},Rx=_zx,Nx=Mi,Ox=o,Lx=zm,Wx=ne,Hx=D,Fx=y,jx=E,Yx=Bx,Xx=Ro,qx=Oo,Zx=Mx,_x=la,Gx=ku,Kx=Ca,$x=Kg,Qx=T,Jx=tt,eC=ei,tC=Ji,iC=ai,rC=Q,nC=Co,oC=xn,aC=O,sC=yd,lC=_h,uC=Ku,cC=rm,hC=Rx,dC=gt("iterator"),fC="URLSearchParams",vC=fC+"Iterator",gC=Kx.set,mC=Kx.getterFor(fC),yC=Kx.getterFor(vC),pC=Lx("fetch"),wC=Lx("Request"),bC=Lx("Headers"),kC=wC&&wC.prototype,SC=bC&&bC.prototype,xC=Ox.TypeError,CC=Ox.encodeURIComponent,VC=String.fromCharCode,TC=Wx("String","fromCodePoint"),IC=parseInt,EC=Fx("".charAt),PC=Fx([].join),BC=Fx([].push),DC=Fx("".replace),MC=Fx([].shift),AC=Fx([].splice),UC=Fx("".split),zC=Fx("".slice),RC=Fx(/./.exec),NC=/\+/g,OC=/^[0-9a-f]+$/i,LC=function LC(e,t){var i=zC(e,t,t+2);return RC(OC,i)?IC(i,16):NaN;},WC=function WC(e){for(var t=0,i=128;i>0&&0!==(e&i);i>>=1)t++;return t;},HC=function HC(e){var t=null;switch(e.length){case 1:t=e[0];break;case 2:t=(31&e[0])<<6|63&e[1];break;case 3:t=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:t=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3];}return t>1114111?null:t;},FC=function FC(e){for(var t=(e=DC(e,NC," ")).length,i="",r=0;r<t;){var n=EC(e,r);if("%"===n){if("%"===EC(e,r+1)||r+3>t){i+="%",r++;continue;}var o=LC(e,r+1);if(o!=o){i+=n,r++;continue;}r+=2;var a=WC(o);if(0===a)n=VC(o);else{if(1===a||a>4){i+="ï¿½",r++;continue;}for(var s=[o],l=1;l<a&&!(++r+3>t||"%"!==EC(e,r));){var u=LC(e,r+1);if(u!=u){r+=3;break;}if(u>191||u<128)break;BC(s,u),r+=2,l++;}if(s.length!==a){i+="ï¿½";continue;}var c=HC(s);null===c?i+="ï¿½":n=TC(c);}}i+=n,r++;}return i;},jC=/[!'()~]|%20/g,YC={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},XC=function XC(e){return YC[e];},qC=function qC(e){return DC(CC(e),jC,XC);},ZC=Gx(function(e,t){gC(this,{type:vC,target:mC(e).entries,index:0,kind:t});},fC,function(){var e=yC(this),t=e.target,i=e.index++;if(!t||i>=t.length)return e.target=null,uC(void 0,!0);var r=t[i];switch(e.kind){case"keys":return uC(r.key,!1);case"values":return uC(r.value,!1);}return uC([r.key,r.value],!1);},!0),_C=function _C(e){this.entries=[],this.url=null,void 0!==e&&(rC(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===EC(e,0)?zC(e,1):e:nC(e)));};_C.prototype={type:fC,bindURL:function bindURL(e){this.url=e,this.update();},parseObject:function parseObject(e){var t,i,r,n,o,a,s,l=this.entries,u=lC(e);if(u)for(i=(t=sC(e,u)).next;!(r=Hx(i,t)).done;){if(o=(n=sC(iC(r.value))).next,(a=Hx(o,n)).done||(s=Hx(o,n)).done||!Hx(o,n).done)throw new xC("Expected sequence with length 2");BC(l,{key:nC(a.value),value:nC(s.value)});}else for(var c in e)Jx(e,c)&&BC(l,{key:c,value:nC(e[c])});},parseQuery:function parseQuery(e){if(e)for(var t,i,r=this.entries,n=UC(e,"&"),o=0;o<n.length;)(t=n[o++]).length&&(i=UC(t,"="),BC(r,{key:FC(MC(i)),value:FC(PC(i,"="))}));},serialize:function serialize(){for(var e,t=this.entries,i=[],r=0;r<t.length;)e=t[r++],BC(i,qC(e.key)+"="+qC(e.value));return PC(i,"&");},update:function update(){this.entries.length=0,this.parseQuery(this.url.query);},updateURL:function updateURL(){this.url&&this.url.update();}};var GC=function GC(){$x(this,KC);var e=gC(this,new _C(arguments.length>0?arguments[0]:void 0));jx||(this.size=e.entries.length);},KC=GC.prototype;if(Zx(KC,{append:function append(e,t){var i=mC(this);cC(arguments.length,2),BC(i.entries,{key:nC(e),value:nC(t)}),jx||this.length++,i.updateURL();},delete:function _delete(e){for(var t=mC(this),i=cC(arguments.length,1),r=t.entries,n=nC(e),o=i<2?void 0:arguments[1],a=void 0===o?o:nC(o),s=0;s<r.length;){var l=r[s];if(l.key!==n||void 0!==a&&l.value!==a)s++;else if(AC(r,s,1),void 0!==a)break;}jx||(this.size=r.length),t.updateURL();},get:function get(e){var t=mC(this).entries;cC(arguments.length,1);for(var i=nC(e),r=0;r<t.length;r++)if(t[r].key===i)return t[r].value;return null;},getAll:function getAll(e){var t=mC(this).entries;cC(arguments.length,1);for(var i=nC(e),r=[],n=0;n<t.length;n++)t[n].key===i&&BC(r,t[n].value);return r;},has:function has(e){for(var t=mC(this).entries,i=cC(arguments.length,1),r=nC(e),n=i<2?void 0:arguments[1],o=void 0===n?n:nC(n),a=0;a<t.length;){var s=t[a++];if(s.key===r&&(void 0===o||s.value===o))return!0;}return!1;},set:function set(e,t){var i=mC(this);cC(arguments.length,1);for(var r,n=i.entries,o=!1,a=nC(e),s=nC(t),l=0;l<n.length;l++)(r=n[l]).key===a&&(o?AC(n,l--,1):(o=!0,r.value=s));o||BC(n,{key:a,value:s}),jx||(this.size=n.length),i.updateURL();},sort:function sort(){var e=mC(this);hC(e.entries,function(e,t){return e.key>t.key?1:-1;}),e.updateURL();},forEach:function forEach(e){for(var t,i=mC(this).entries,r=eC(e,arguments.length>1?arguments[1]:void 0),n=0;n<i.length;)r((t=i[n++]).value,t.key,this);},keys:function keys(){return new ZC(this,"keys");},values:function values(){return new ZC(this,"values");},entries:function entries(){return new ZC(this,"entries");}},{enumerable:!0}),Xx(KC,dC,KC.entries,{name:"entries"}),Xx(KC,"toString",function(){return mC(this).serialize();},{enumerable:!0}),jx&&qx(KC,"size",{get:function get(){return mC(this).entries.length;},configurable:!0,enumerable:!0}),_x(GC,fC),Nx({global:!0,constructor:!0,forced:!Yx},{URLSearchParams:GC}),!Yx&&Qx(bC)){var $C=Fx(SC.has),QC=Fx(SC.set),JC=function JC(e){if(rC(e)){var t,i=e.body;if(tC(i)===fC)return t=e.headers?new bC(e.headers):new bC(),$C(t,"content-type")||QC(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),oC(e,{body:aC(0,nC(i)),headers:aC(0,t)});}return e;};if(Qx(pC)&&Nx({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function fetch(e){return pC(e,arguments.length>1?JC(arguments[1]):{});}}),Qx(wC)){var eV=function eV(e){return $x(this,kC),new wC(e,arguments.length>1?JC(arguments[1]):{});};kC.constructor=eV,eV.prototype=kC,Nx({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:eV});}}var tV,iV={URLSearchParams:GC,getState:mC},rV=E,nV=y,oV=D,aV=a,sV=$r,lV=Uo,uV=M,cV=Qe,hV=j,dV=Object.assign,fV=Object.defineProperty,vV=nV([].concat),gV=!dV||aV(function(){if(rV&&1!==dV({b:1},dV(fV({},"a",{enumerable:!0,get:function get(){fV(this,"b",{value:3,enumerable:!1});}}),{b:2})).b)return!0;var e={},t={},i=Symbol("assign detection"),r="abcdefghijklmnopqrst";return e[i]=7,r.split("").forEach(function(e){t[e]=e;}),7!==dV({},e)[i]||sV(dV({},t)).join("")!==r;})?function(e,t){for(var i=cV(e),r=arguments.length,n=1,o=lV.f,a=uV.f;r>n;)for(var s,l=hV(arguments[n++]),u=o?vV(sV(l),o(l)):sV(l),c=u.length,h=0;c>h;)s=u[h++],rV&&!oV(a,l,s)||(i[s]=l[s]);return i;}:dV,mV=y,yV=2147483647,pV=/[^\0-\u007E]/,wV=/[.\u3002\uFF0E\uFF61]/g,bV="Overflow: input needs wider integers to process",kV=RangeError,SV=mV(wV.exec),xV=Math.floor,CV=String.fromCharCode,VV=mV("".charCodeAt),TV=mV([].join),IV=mV([].push),EV=mV("".replace),PV=mV("".split),BV=mV("".toLowerCase),DV=function DV(e){return e+22+75*(e<26);},MV=function MV(e,t,i){var r=0;for(e=i?xV(e/700):e>>1,e+=xV(e/t);e>455;)e=xV(e/35),r+=36;return xV(r+36*e/(e+38));},AV=function AV(e){var t=[];e=function(e){for(var t=[],i=0,r=e.length;i<r;){var n=VV(e,i++);if(n>=55296&&n<=56319&&i<r){var o=VV(e,i++);56320==(64512&o)?IV(t,((1023&n)<<10)+(1023&o)+65536):(IV(t,n),i--);}else IV(t,n);}return t;}(e);var i,r,n=e.length,o=128,a=0,s=72;for(i=0;i<e.length;i++)(r=e[i])<128&&IV(t,CV(r));var l=t.length,u=l;for(l&&IV(t,"-");u<n;){var c=yV;for(i=0;i<e.length;i++)(r=e[i])>=o&&r<c&&(c=r);var h=u+1;if(c-o>xV((yV-a)/h))throw new kV(bV);for(a+=(c-o)*h,o=c,i=0;i<e.length;i++){if((r=e[i])<o&&++a>yV)throw new kV(bV);if(r===o){for(var d=a,f=36;;){var v=f<=s?1:f>=s+26?26:f-s;if(d<v)break;var g=d-v,m=36-v;IV(t,CV(DV(v+g%m))),d=xV(g/m),f+=36;}IV(t,CV(DV(d))),s=MV(a,h,u===l),a=0,u++;}}a++,o++;}return TV(t,"");},UV=Mi,zV=E,RV=Bx,NV=o,OV=ei,LV=y,WV=Ro,HV=Oo,FV=Kg,jV=tt,YV=gV,XV=Pd,qV=Ai,ZV=wh.codeAt,_V=function _V(e){var t,i,r=[],n=PV(EV(BV(e),wV,"."),".");for(t=0;t<n.length;t++)i=n[t],IV(r,SV(pV,i)?"xn--"+AV(i):i);return TV(r,".");},GV=Co,KV=la,$V=rm,QV=iV,JV=Ca,eT=JV.set,tT=JV.getterFor("URL"),iT=QV.URLSearchParams,rT=QV.getState,nT=NV.URL,oT=NV.TypeError,aT=NV.parseInt,sT=Math.floor,lT=Math.pow,uT=LV("".charAt),cT=LV(/./.exec),hT=LV([].join),dT=LV(1.1.toString),fT=LV([].pop),vT=LV([].push),gT=LV("".replace),mT=LV([].shift),yT=LV("".split),pT=LV("".slice),wT=LV("".toLowerCase),bT=LV([].unshift),kT="Invalid scheme",ST="Invalid host",xT="Invalid port",CT=/[a-z]/i,VT=/[\d+-.a-z]/i,TT=/\d/,IT=/^0x/i,ET=/^[0-7]+$/,PT=/^\d+$/,BT=/^[\da-f]+$/i,DT=/[\0\t\n\r #%/:<>?@[\\\]^|]/,MT=/[\0\t\n\r #/:<>?@[\\\]^|]/,AT=/^[\u0000-\u0020]+/,UT=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,zT=/[\t\n\r]/g,RT=function RT(e){var t,i,r,n;if("number"==typeof e){for(t=[],i=0;i<4;i++)bT(t,e%256),e=sT(e/256);return hT(t,".");}if("object"==_typeof(e)){for(t="",r=function(e){for(var t=null,i=1,r=null,n=0,o=0;o<8;o++)0!==e[o]?(n>i&&(t=r,i=n),r=null,n=0):(null===r&&(r=o),++n);return n>i?r:t;}(e),i=0;i<8;i++)n&&0===e[i]||(n&&(n=!1),r===i?(t+=i?":":"::",n=!0):(t+=dT(e[i],16),i<7&&(t+=":")));return"["+t+"]";}return e;},NT={},OT=YV({},NT,{" ":1,'"':1,"<":1,">":1,"`":1}),LT=YV({},OT,{"#":1,"?":1,"{":1,"}":1}),WT=YV({},LT,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),HT=function HT(e,t){var i=ZV(e,0);return i>32&&i<127&&!jV(t,e)?e:encodeURIComponent(e);},FT={ftp:21,file:null,http:80,https:443,ws:80,wss:443},jT=function jT(e,t){var i;return 2===e.length&&cT(CT,uT(e,0))&&(":"===(i=uT(e,1))||!t&&"|"===i);},YT=function YT(e){var t;return e.length>1&&jT(pT(e,0,2))&&(2===e.length||"/"===(t=uT(e,2))||"\\"===t||"?"===t||"#"===t);},XT=function XT(e){return"."===e||"%2e"===wT(e);},qT=function qT(e){return".."===(e=wT(e))||"%2e."===e||".%2e"===e||"%2e%2e"===e;},ZT={},_T={},GT={},KT={},$T={},QT={},JT={},eI={},tI={},iI={},rI={},nI={},oI={},aI={},sI={},lI={},uI={},cI={},hI={},dI={},fI={},_vI=function vI(e,t,i){var r,n,o,a=GV(e);if(t){if(n=this.parse(a))throw new oT(n);this.searchParams=null;}else{if(void 0!==i&&(r=new _vI(i,!0)),n=this.parse(a,null,r))throw new oT(n);(o=rT(new iT())).bindURL(this),this.searchParams=o;}};_vI.prototype={type:"URL",parse:function parse(e,t,i){var r,n,o,a,s=this,l=t||ZT,u=0,c="",h=!1,d=!1,f=!1;for(e=GV(e),t||(s.scheme="",s.username="",s.password="",s.host=null,s.port=null,s.path=[],s.query=null,s.fragment=null,s.cannotBeABaseURL=!1,e=gT(e,AT,""),e=gT(e,UT,"$1")),e=gT(e,zT,""),r=XV(e);u<=r.length;){switch(n=r[u],l){case ZT:if(!n||!cT(CT,n)){if(t)return kT;l=GT;continue;}c+=wT(n),l=_T;break;case _T:if(n&&(cT(VT,n)||"+"===n||"-"===n||"."===n))c+=wT(n);else{if(":"!==n){if(t)return kT;c="",l=GT,u=0;continue;}if(t&&(s.isSpecial()!==jV(FT,c)||"file"===c&&(s.includesCredentials()||null!==s.port)||"file"===s.scheme&&!s.host))return;if(s.scheme=c,t)return void(s.isSpecial()&&FT[s.scheme]===s.port&&(s.port=null));c="","file"===s.scheme?l=aI:s.isSpecial()&&i&&i.scheme===s.scheme?l=KT:s.isSpecial()?l=eI:"/"===r[u+1]?(l=$T,u++):(s.cannotBeABaseURL=!0,vT(s.path,""),l=hI);}break;case GT:if(!i||i.cannotBeABaseURL&&"#"!==n)return kT;if(i.cannotBeABaseURL&&"#"===n){s.scheme=i.scheme,s.path=qV(i.path),s.query=i.query,s.fragment="",s.cannotBeABaseURL=!0,l=fI;break;}l="file"===i.scheme?aI:QT;continue;case KT:if("/"!==n||"/"!==r[u+1]){l=QT;continue;}l=tI,u++;break;case $T:if("/"===n){l=iI;break;}l=cI;continue;case QT:if(s.scheme=i.scheme,n===tV)s.username=i.username,s.password=i.password,s.host=i.host,s.port=i.port,s.path=qV(i.path),s.query=i.query;else if("/"===n||"\\"===n&&s.isSpecial())l=JT;else if("?"===n)s.username=i.username,s.password=i.password,s.host=i.host,s.port=i.port,s.path=qV(i.path),s.query="",l=dI;else{if("#"!==n){s.username=i.username,s.password=i.password,s.host=i.host,s.port=i.port,s.path=qV(i.path),s.path.length--,l=cI;continue;}s.username=i.username,s.password=i.password,s.host=i.host,s.port=i.port,s.path=qV(i.path),s.query=i.query,s.fragment="",l=fI;}break;case JT:if(!s.isSpecial()||"/"!==n&&"\\"!==n){if("/"!==n){s.username=i.username,s.password=i.password,s.host=i.host,s.port=i.port,l=cI;continue;}l=iI;}else l=tI;break;case eI:if(l=tI,"/"!==n||"/"!==uT(c,u+1))continue;u++;break;case tI:if("/"!==n&&"\\"!==n){l=iI;continue;}break;case iI:if("@"===n){h&&(c="%40"+c),h=!0,o=XV(c);for(var v=0;v<o.length;v++){var g=o[v];if(":"!==g||f){var m=HT(g,WT);f?s.password+=m:s.username+=m;}else f=!0;}c="";}else if(n===tV||"/"===n||"?"===n||"#"===n||"\\"===n&&s.isSpecial()){if(h&&""===c)return"Invalid authority";u-=XV(c).length+1,c="",l=rI;}else c+=n;break;case rI:case nI:if(t&&"file"===s.scheme){l=lI;continue;}if(":"!==n||d){if(n===tV||"/"===n||"?"===n||"#"===n||"\\"===n&&s.isSpecial()){if(s.isSpecial()&&""===c)return ST;if(t&&""===c&&(s.includesCredentials()||null!==s.port))return;if(a=s.parseHost(c))return a;if(c="",l=uI,t)return;continue;}"["===n?d=!0:"]"===n&&(d=!1),c+=n;}else{if(""===c)return ST;if(a=s.parseHost(c))return a;if(c="",l=oI,t===nI)return;}break;case oI:if(!cT(TT,n)){if(n===tV||"/"===n||"?"===n||"#"===n||"\\"===n&&s.isSpecial()||t){if(""!==c){var y=aT(c,10);if(y>65535)return xT;s.port=s.isSpecial()&&y===FT[s.scheme]?null:y,c="";}if(t)return;l=uI;continue;}return xT;}c+=n;break;case aI:if(s.scheme="file","/"===n||"\\"===n)l=sI;else{if(!i||"file"!==i.scheme){l=cI;continue;}switch(n){case tV:s.host=i.host,s.path=qV(i.path),s.query=i.query;break;case"?":s.host=i.host,s.path=qV(i.path),s.query="",l=dI;break;case"#":s.host=i.host,s.path=qV(i.path),s.query=i.query,s.fragment="",l=fI;break;default:YT(hT(qV(r,u),""))||(s.host=i.host,s.path=qV(i.path),s.shortenPath()),l=cI;continue;}}break;case sI:if("/"===n||"\\"===n){l=lI;break;}i&&"file"===i.scheme&&!YT(hT(qV(r,u),""))&&(jT(i.path[0],!0)?vT(s.path,i.path[0]):s.host=i.host),l=cI;continue;case lI:if(n===tV||"/"===n||"\\"===n||"?"===n||"#"===n){if(!t&&jT(c))l=cI;else if(""===c){if(s.host="",t)return;l=uI;}else{if(a=s.parseHost(c))return a;if("localhost"===s.host&&(s.host=""),t)return;c="",l=uI;}continue;}c+=n;break;case uI:if(s.isSpecial()){if(l=cI,"/"!==n&&"\\"!==n)continue;}else if(t||"?"!==n){if(t||"#"!==n){if(n!==tV&&(l=cI,"/"!==n))continue;}else s.fragment="",l=fI;}else s.query="",l=dI;break;case cI:if(n===tV||"/"===n||"\\"===n&&s.isSpecial()||!t&&("?"===n||"#"===n)){if(qT(c)?(s.shortenPath(),"/"===n||"\\"===n&&s.isSpecial()||vT(s.path,"")):XT(c)?"/"===n||"\\"===n&&s.isSpecial()||vT(s.path,""):("file"===s.scheme&&!s.path.length&&jT(c)&&(s.host&&(s.host=""),c=uT(c,0)+":"),vT(s.path,c)),c="","file"===s.scheme&&(n===tV||"?"===n||"#"===n))for(;s.path.length>1&&""===s.path[0];)mT(s.path);"?"===n?(s.query="",l=dI):"#"===n&&(s.fragment="",l=fI);}else c+=HT(n,LT);break;case hI:"?"===n?(s.query="",l=dI):"#"===n?(s.fragment="",l=fI):n!==tV&&(s.path[0]+=HT(n,NT));break;case dI:t||"#"!==n?n!==tV&&("'"===n&&s.isSpecial()?s.query+="%27":s.query+="#"===n?"%23":HT(n,NT)):(s.fragment="",l=fI);break;case fI:n!==tV&&(s.fragment+=HT(n,OT));}u++;}},parseHost:function parseHost(e){var t,i,r;if("["===uT(e,0)){if("]"!==uT(e,e.length-1))return ST;if(t=function(e){var t,i,r,n,o,a,s,l=[0,0,0,0,0,0,0,0],u=0,c=null,h=0,d=function d(){return uT(e,h);};if(":"===d()){if(":"!==uT(e,1))return;h+=2,c=++u;}for(;d();){if(8===u)return;if(":"!==d()){for(t=i=0;i<4&&cT(BT,d());)t=16*t+aT(d(),16),h++,i++;if("."===d()){if(0===i)return;if(h-=i,u>6)return;for(r=0;d();){if(n=null,r>0){if(!("."===d()&&r<4))return;h++;}if(!cT(TT,d()))return;for(;cT(TT,d());){if(o=aT(d(),10),null===n)n=o;else{if(0===n)return;n=10*n+o;}if(n>255)return;h++;}l[u]=256*l[u]+n,2!==++r&&4!==r||u++;}if(4!==r)return;break;}if(":"===d()){if(h++,!d())return;}else if(d())return;l[u++]=t;}else{if(null!==c)return;h++,c=++u;}}if(null!==c)for(a=u-c,u=7;0!==u&&a>0;)s=l[u],l[u--]=l[c+a-1],l[c+--a]=s;else if(8!==u)return;return l;}(pT(e,1,-1)),!t)return ST;this.host=t;}else if(this.isSpecial()){if(e=_V(e),cT(DT,e))return ST;if(t=function(e){var t,i,r,n,o,a,s,l=yT(e,".");if(l.length&&""===l[l.length-1]&&l.length--,(t=l.length)>4)return e;for(i=[],r=0;r<t;r++){if(""===(n=l[r]))return e;if(o=10,n.length>1&&"0"===uT(n,0)&&(o=cT(IT,n)?16:8,n=pT(n,8===o?1:2)),""===n)a=0;else{if(!cT(10===o?PT:8===o?ET:BT,n))return e;a=aT(n,o);}vT(i,a);}for(r=0;r<t;r++)if(a=i[r],r===t-1){if(a>=lT(256,5-t))return null;}else if(a>255)return null;for(s=fT(i),r=0;r<i.length;r++)s+=i[r]*lT(256,3-r);return s;}(e),null===t)return ST;this.host=t;}else{if(cT(MT,e))return ST;for(t="",i=XV(e),r=0;r<i.length;r++)t+=HT(i[r],NT);this.host=t;}},cannotHaveUsernamePasswordPort:function cannotHaveUsernamePasswordPort(){return!this.host||this.cannotBeABaseURL||"file"===this.scheme;},includesCredentials:function includesCredentials(){return""!==this.username||""!==this.password;},isSpecial:function isSpecial(){return jV(FT,this.scheme);},shortenPath:function shortenPath(){var e=this.path,t=e.length;!t||"file"===this.scheme&&1===t&&jT(e[0],!0)||e.length--;},serialize:function serialize(){var e=this,t=e.scheme,i=e.username,r=e.password,n=e.host,o=e.port,a=e.path,s=e.query,l=e.fragment,u=t+":";return null!==n?(u+="//",e.includesCredentials()&&(u+=i+(r?":"+r:"")+"@"),u+=RT(n),null!==o&&(u+=":"+o)):"file"===t&&(u+="//"),u+=e.cannotBeABaseURL?a[0]:a.length?"/"+hT(a,"/"):"",null!==s&&(u+="?"+s),null!==l&&(u+="#"+l),u;},setHref:function setHref(e){var t=this.parse(e);if(t)throw new oT(t);this.searchParams.update();},getOrigin:function getOrigin(){var e=this.scheme,t=this.port;if("blob"===e)try{return new gI(e.path[0]).origin;}catch(e){return"null";}return"file"!==e&&this.isSpecial()?e+"://"+RT(this.host)+(null!==t?":"+t:""):"null";},getProtocol:function getProtocol(){return this.scheme+":";},setProtocol:function setProtocol(e){this.parse(GV(e)+":",ZT);},getUsername:function getUsername(){return this.username;},setUsername:function setUsername(e){var t=XV(GV(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var i=0;i<t.length;i++)this.username+=HT(t[i],WT);}},getPassword:function getPassword(){return this.password;},setPassword:function setPassword(e){var t=XV(GV(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var i=0;i<t.length;i++)this.password+=HT(t[i],WT);}},getHost:function getHost(){var e=this.host,t=this.port;return null===e?"":null===t?RT(e):RT(e)+":"+t;},setHost:function setHost(e){this.cannotBeABaseURL||this.parse(e,rI);},getHostname:function getHostname(){var e=this.host;return null===e?"":RT(e);},setHostname:function setHostname(e){this.cannotBeABaseURL||this.parse(e,nI);},getPort:function getPort(){var e=this.port;return null===e?"":GV(e);},setPort:function setPort(e){this.cannotHaveUsernamePasswordPort()||(""===(e=GV(e))?this.port=null:this.parse(e,oI));},getPathname:function getPathname(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+hT(e,"/"):"";},setPathname:function setPathname(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,uI));},getSearch:function getSearch(){var e=this.query;return e?"?"+e:"";},setSearch:function setSearch(e){""===(e=GV(e))?this.query=null:("?"===uT(e,0)&&(e=pT(e,1)),this.query="",this.parse(e,dI)),this.searchParams.update();},getSearchParams:function getSearchParams(){return this.searchParams.facade;},getHash:function getHash(){var e=this.fragment;return e?"#"+e:"";},setHash:function setHash(e){""!==(e=GV(e))?("#"===uT(e,0)&&(e=pT(e,1)),this.fragment="",this.parse(e,fI)):this.fragment=null;},update:function update(){this.query=this.searchParams.serialize()||null;}};var gI=function gI(e){var t=FV(this,mI),i=$V(arguments.length,1)>1?arguments[1]:void 0,r=eT(t,new _vI(e,!1,i));zV||(t.href=r.serialize(),t.origin=r.getOrigin(),t.protocol=r.getProtocol(),t.username=r.getUsername(),t.password=r.getPassword(),t.host=r.getHost(),t.hostname=r.getHostname(),t.port=r.getPort(),t.pathname=r.getPathname(),t.search=r.getSearch(),t.searchParams=r.getSearchParams(),t.hash=r.getHash());},mI=gI.prototype,yI=function yI(e,t){return{get:function get(){return tT(this)[e]();},set:t&&function(e){return tT(this)[t](e);},configurable:!0,enumerable:!0};};if(zV&&(HV(mI,"href",yI("serialize","setHref")),HV(mI,"origin",yI("getOrigin")),HV(mI,"protocol",yI("getProtocol","setProtocol")),HV(mI,"username",yI("getUsername","setUsername")),HV(mI,"password",yI("getPassword","setPassword")),HV(mI,"host",yI("getHost","setHost")),HV(mI,"hostname",yI("getHostname","setHostname")),HV(mI,"port",yI("getPort","setPort")),HV(mI,"pathname",yI("getPathname","setPathname")),HV(mI,"search",yI("getSearch","setSearch")),HV(mI,"searchParams",yI("getSearchParams")),HV(mI,"hash",yI("getHash","setHash"))),WV(mI,"toJSON",function(){return tT(this).serialize();},{enumerable:!0}),WV(mI,"toString",function(){return tT(this).serialize();},{enumerable:!0}),nT){var pI=nT.createObjectURL,wI=nT.revokeObjectURL;pI&&WV(gI,"createObjectURL",OV(pI,nT)),wI&&WV(gI,"revokeObjectURL",OV(wI,nT));}KV(gI,"URL"),UV({global:!0,constructor:!0,forced:!RV,sham:!zV},{URL:gI});var bI=Mi,kI=a,SI=rm,xI=Co,CI=Bx,VI=ne("URL"),TI=CI&&kI(function(){VI.canParse();}),II=kI(function(){return 1!==VI.canParse.length;});bI({target:"URL",stat:!0,forced:!TI||II},{canParse:function canParse(e){var t=SI(arguments.length,1),i=xI(e),r=t<2||void 0===arguments[1]?void 0:xI(arguments[1]);try{return!!new VI(i,r);}catch(e){return!1;}}});var EI=Mi,PI=rm,BI=Co,DI=Bx,MI=ne("URL");EI({target:"URL",stat:!0,forced:!DI},{parse:function parse(e){var t=PI(arguments.length,1),i=BI(e),r=t<2||void 0===arguments[1]?void 0:BI(arguments[1]);try{return new MI(i,r);}catch(e){return null;}}});var AI=J.URL;!function(e){e.exports=AI;}(wx);var UI=t(px),zI={},RI={get exports(){return zI;},set exports(e){zI=e;}};!function(e){e.exports=ff;}(RI);var NI=t(zI),OI={},LI={get exports(){return OI;},set exports(e){OI=e;}};!function(e){e.exports=Hf;}(LI);var WI=t(OI),HI={},FI={get exports(){return HI;},set exports(e){HI=e;}},jI=E,YI=jn,XI=TypeError,qI=Object.getOwnPropertyDescriptor,ZI=jI&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1;}catch(e){return e instanceof TypeError;}}()?function(e,t){if(YI(e)&&!qI(e,"length").writable)throw new XI("Cannot set read only .length");return e.length=t;}:function(e,t){return e.length=t;},_I=Ie,GI=TypeError,KI=function KI(e,t){if(!delete e[t])throw new GI("Cannot delete property "+_I(t)+" of "+_I(e));},$I=Mi,QI=Qe,JI=Br,eE=Tr,tE=zr,iE=ZI,rE=Xn,nE=io,oE=Gn,aE=KI,sE=ao("splice"),lE=Math.max,uE=Math.min;$I({target:"Array",proto:!0,forced:!sE},{splice:function splice(e,t){var i,r,n,o,a,s,l=QI(this),u=tE(l),c=JI(e,u),h=arguments.length;for(0===h?i=r=0:1===h?(i=0,r=u-c):(i=h-2,r=uE(lE(eE(t),0),u-c)),rE(u+i-r),n=nE(l,r),o=0;o<r;o++)(a=c+o)in l&&oE(n,o,l[a]);if(n.length=r,i<r){for(o=c;o<u-r;o++)s=o+i,(a=o+r)in l?l[s]=l[a]:aE(l,s);for(o=u;o>u-r+i;o--)aE(l,o-1);}else if(i>r)for(o=u-r;o>c;o--)s=o+i-1,(a=o+r-1)in l?l[s]=l[a]:aE(l,s);for(o=0;o<i;o++)l[o+c]=arguments[o+2];return iE(l,u-r+i),n;}});var cE=sf("Array","splice"),hE=oe,dE=cE,fE=Array.prototype,vE=function vE(e){var t=e.splice;return e===fE||hE(fE,e)&&t===fE.splice?dE:t;},gE=vE;!function(e){e.exports=gE;}(FI);var mE=t(HI),yE={},pE={get exports(){return yE;},set exports(e){yE=e;}},wE=Mi,bE=Ma.findIndex,kE="findIndex",SE=!0;kE in[]&&Array(1)[kE](function(){SE=!1;}),wE({target:"Array",proto:!0,forced:SE},{findIndex:function findIndex(e){return bE(this,e,arguments.length>1?arguments[1]:void 0);}});var xE=sf("Array","findIndex"),CE=oe,VE=xE,TE=Array.prototype,IE=function IE(e){var t=e.findIndex;return e===TE||CE(TE,e)&&t===TE.findIndex?VE:t;},EE=IE;!function(e){e.exports=EE;}(pE);var PE=t(yE),BE={},DE={get exports(){return BE;},set exports(e){BE=e;}},ME=Mi,AE=Math.hypot,UE=Math.abs,zE=Math.sqrt;ME({target:"Math",stat:!0,arity:2,forced:!!AE&&AE(1/0,NaN)!==1/0},{hypot:function hypot(e,t){for(var i,r,n=0,o=0,a=arguments.length,s=0;o<a;)s<(i=UE(arguments[o++]))?(n=n*(r=s/i)*r+1,s=i):n+=i>0?(r=i/s)*r:i;return s===1/0?1/0:s*zE(n);}});var RE=J.Math.hypot;!function(e){e.exports=RE;}(DE);var NE=t(BE),OE={},LE={get exports(){return OE;},set exports(e){OE=e;}},WE=Math.sign||function(e){var t=+e;return 0===t||t!=t?t:t<0?-1:1;};Mi({target:"Math",stat:!0},{sign:WE});var HE=J.Math.sign;!function(e){e.exports=HE;}(LE);var FE=t(OE),jE={},YE={get exports(){return jE;},set exports(e){jE=e;}},XE=Ma.map;Mi({target:"Array",proto:!0,forced:!ao("map")},{map:function map(e){return XE(this,e,arguments.length>1?arguments[1]:void 0);}});var qE=sf("Array","map"),ZE=oe,_E=qE,GE=Array.prototype,KE=function KE(e){var t=e.map;return e===GE||ZE(GE,e)&&t===GE.map?_E:t;},$E=KE;!function(e){e.exports=$E;}(YE);var QE=t(jE),JE={},eP={get exports(){return JE;},set exports(e){JE=e;}},tP=Qe,iP=Br,rP=zr,nP=function nP(e){for(var t=tP(this),i=rP(t),r=arguments.length,n=iP(r>1?arguments[1]:void 0,i),o=r>2?arguments[2]:void 0,a=void 0===o?i:iP(o,i);a>n;)t[n++]=e;return t;};Mi({target:"Array",proto:!0},{fill:nP});var oP=sf("Array","fill"),aP=oe,sP=oP,lP=Array.prototype,uP=function uP(e){var t=e.fill;return e===lP||aP(lP,e)&&t===lP.fill?sP:t;},cP=uP;!function(e){e.exports=cP;}(eP);var hP=t(JE),dP={},fP={get exports(){return dP;},set exports(e){dP=e;}},vP=Mi,gP=Ma.find,mP="find",yP=!0;mP in[]&&Array(1)[mP](function(){yP=!1;}),vP({target:"Array",proto:!0,forced:yP},{find:function find(e){return gP(this,e,arguments.length>1?arguments[1]:void 0);}});var pP=sf("Array","find"),wP=oe,bP=pP,kP=Array.prototype,SP=function SP(e){var t=e.find;return e===kP||wP(kP,e)&&t===kP.find?bP:t;},xP=SP;!function(e){e.exports=xP;}(fP);var CP=t(dP),VP={},TP={get exports(){return VP;},set exports(e){VP=e;}},IP=o,EP=d,PP=T,BP=Hg,DP=le,MP=Ai,AP=rm,UP=IP.Function,zP=/MSIE .\./.test(DP)||"BUN"===BP&&function(){var e=IP.Bun.version.split(".");return e.length<3||"0"===e[0]&&(e[1]<3||"3"===e[1]&&"0"===e[2]);}(),RP=function RP(e,t){var i=t?2:1;return zP?function(r,n){var o=AP(arguments.length,1)>i,a=PP(r)?r:UP(r),s=o?MP(arguments,i):[],l=o?function(){EP(a,this,s);}:a;return t?e(l,n):e(l);}:e;},NP=Mi,OP=o,LP=RP(OP.setInterval,!0);NP({global:!0,bind:!0,forced:OP.setInterval!==LP},{setInterval:LP});var WP=Mi,HP=o,FP=RP(HP.setTimeout,!0);WP({global:!0,bind:!0,forced:HP.setTimeout!==FP},{setTimeout:FP});var jP=J.setTimeout;!function(e){e.exports=jP;}(TP);var YP=t(VP),XP={},qP={get exports(){return XP;},set exports(e){XP=e;}},ZP=E,_P=a,GP=y,KP=nu,$P=$r,QP=K,JP=GP(M.f),eB=GP([].push),tB=ZP&&_P(function(){var e=Object.create(null);return e[2]=2,!JP(e,2);}),iB=function iB(e){return function(t){for(var i,r=QP(t),n=$P(r),o=tB&&null===KP(r),a=n.length,s=0,l=[];a>s;)i=n[s++],ZP&&!(o?i in r:JP(r,i))||eB(l,e?[i,r[i]]:r[i]);return l;};},rB={entries:iB(!0),values:iB(!1)},nB=rB.entries;Mi({target:"Object",stat:!0},{entries:function entries(e){return nB(e);}});var oB=J.Object.entries;!function(e){e.exports=oB;}(qP);var aB=t(XP),sB={},lB={get exports(){return sB;},set exports(e){sB=e;}};!function(e){e.exports=Cw;}(lB);var uB=t(sB),cB={},hB={get exports(){return cB;},set exports(e){cB=e;}},dB=Wr.includes;Mi({target:"Array",proto:!0,forced:a(function(){return!Array(1).includes();})},{includes:function includes(e){return dB(this,e,arguments.length>1?arguments[1]:void 0);}});var fB=sf("Array","includes"),vB=Q,gB=k,mB=gt("match"),yB=function yB(e){var t;return vB(e)&&(void 0!==(t=e[mB])?!!t:"RegExp"===gB(e));},pB=TypeError,wB=function wB(e){if(yB(e))throw new pB("The method doesn't accept regular expressions");return e;},bB=gt("match"),kB=function kB(e){var t=/./;try{"/./"[e](t);}catch(i){try{return t[bB]=!1,"/./"[e](t);}catch(e){}}return!1;},SB=Mi,xB=wB,CB=Z,VB=Co,TB=kB,IB=y("".indexOf);SB({target:"String",proto:!0,forced:!TB("includes")},{includes:function includes(e){return!!~IB(VB(CB(this)),VB(xB(e)),arguments.length>1?arguments[1]:void 0);}});var EB=sf("String","includes"),PB=oe,BB=fB,DB=EB,MB=Array.prototype,AB=String.prototype,UB=function UB(e){var t=e.includes;return e===MB||PB(MB,e)&&t===MB.includes?BB:"string"==typeof e||e===AB||PB(AB,e)&&t===AB.includes?DB:t;},zB=UB;!function(e){e.exports=zB;}(hB);var RB=t(cB),NB={},OB={get exports(){return NB;},set exports(e){NB=e;}};!function(e){e.exports=Rd;}(OB);var LB=t(NB),WB={},HB={get exports(){return WB;},set exports(e){WB=e;}},FB=sf("Array","keys"),jB=Ji,YB=tt,XB=oe,qB=FB,ZB=Array.prototype,_B={DOMTokenList:!0,NodeList:!0},GB=function GB(e){var t=e.keys;return e===ZB||XB(ZB,e)&&t===ZB.keys||YB(_B,jB(e))?qB:t;};!function(e){e.exports=GB;}(HB);var KB=t(WB),$B={},QB={get exports(){return $B;},set exports(e){$B=e;}},JB={},eD={get exports(){return JB;},set exports(e){JB=e;}},tD=a(function(){if("function"==typeof ArrayBuffer){var e=new ArrayBuffer(8);Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8});}}),iD=a,rD=Q,nD=k,oD=tD,aD=Object.isExtensible,sD=iD(function(){aD(1);})||oD?function(e){return!!rD(e)&&(!oD||"ArrayBuffer"!==nD(e))&&(!aD||aD(e));}:aD,lD=!a(function(){return Object.isExtensible(Object.preventExtensions({}));}),uD=Mi,cD=y,hD=Hr,dD=Q,fD=tt,vD=ti.f,gD=Vo,mD=Eo,yD=sD,pD=lD,wD=!1,bD=at("meta"),kD=0,SD=function SD(e){vD(e,bD,{value:{objectID:"O"+kD++,weakData:{}}});},xD=eD.exports={enable:function enable(){xD.enable=function(){},wD=!0;var e=gD.f,t=cD([].splice),i={};i[bD]=1,e(i).length&&(gD.f=function(i){for(var r=e(i),n=0,o=r.length;n<o;n++)if(r[n]===bD){t(r,n,1);break;}return r;},uD({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:mD.f}));},fastKey:function fastKey(e,t){if(!dD(e))return"symbol"==_typeof(e)?e:("string"==typeof e?"S":"P")+e;if(!fD(e,bD)){if(!yD(e))return"F";if(!t)return"E";SD(e);}return e[bD].objectID;},getWeakData:function getWeakData(e,t){if(!fD(e,bD)){if(!yD(e))return!0;if(!t)return!1;SD(e);}return e[bD].weakData;},onFreeze:function onFreeze(e){return pD&&wD&&yD(e)&&!fD(e,bD)&&SD(e),e;}};hD[bD]=!0;var CD=Mi,VD=o,TD=JB,ID=a,ED=bi,PD=vg,BD=Kg,DD=T,MD=Q,AD=Y,UD=la,zD=ti.f,RD=Ma.forEach,ND=E,OD=Ca.set,LD=Ca.getterFor,WD=xn,HD=Oo,FD=Mx,jD=ei,YD=Kg,XD=Y,qD=vg,ZD=Gu,_D=Ku,GD=Zg,KD=E,$D=JB.fastKey,QD=Ca.set,JD=Ca.getterFor,eM={getConstructor:function getConstructor(e,t,i,r){var n=e(function(e,n){YD(e,o),QD(e,{type:t,index:WD(null),first:null,last:null,size:0}),KD||(e.size=0),XD(n)||qD(n,e[r],{that:e,AS_ENTRIES:i});}),o=n.prototype,a=JD(t),s=function s(e,t,i){var r,n,o=a(e),s=l(e,t);return s?s.value=i:(o.last=s={index:n=$D(t,!0),key:t,value:i,previous:r=o.last,next:null,removed:!1},o.first||(o.first=s),r&&(r.next=s),KD?o.size++:e.size++,"F"!==n&&(o.index[n]=s)),e;},l=function l(e,t){var i,r=a(e),n=$D(t);if("F"!==n)return r.index[n];for(i=r.first;i;i=i.next)if(i.key===t)return i;};return FD(o,{clear:function clear(){for(var e=a(this),t=e.first;t;)t.removed=!0,t.previous&&(t.previous=t.previous.next=null),t=t.next;e.first=e.last=null,e.index=WD(null),KD?e.size=0:this.size=0;},delete:function _delete(e){var t=this,i=a(t),r=l(t,e);if(r){var n=r.next,o=r.previous;delete i.index[r.index],r.removed=!0,o&&(o.next=n),n&&(n.previous=o),i.first===r&&(i.first=n),i.last===r&&(i.last=o),KD?i.size--:t.size--;}return!!r;},forEach:function forEach(e){for(var t,i=a(this),r=jD(e,arguments.length>1?arguments[1]:void 0);t=t?t.next:i.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous;},has:function has(e){return!!l(this,e);}}),FD(o,i?{get:function get(e){var t=l(this,e);return t&&t.value;},set:function set(e,t){return s(this,0===e?0:e,t);}}:{add:function add(e){return s(this,e=0===e?0:e,e);}}),KD&&HD(o,"size",{configurable:!0,get:function get(){return a(this).size;}}),n;},setStrong:function setStrong(e,t,i){var r=t+" Iterator",n=JD(t),o=JD(r);ZD(e,t,function(e,t){QD(this,{type:r,target:e,state:n(e),kind:t,last:null});},function(){for(var e=o(this),t=e.kind,i=e.last;i&&i.removed;)i=i.previous;return e.target&&(e.last=i=i?i.next:e.state.first)?_D("keys"===t?i.key:"values"===t?i.value:[i.key,i.value],!1):(e.target=null,_D(void 0,!0));},i?"entries":"values",!i,!0),GD(t);}},tM=function tM(e,t,i){var r,n=-1!==e.indexOf("Map"),o=-1!==e.indexOf("Weak"),a=n?"set":"add",s=VD[e],l=s&&s.prototype,u={};if(ND&&DD(s)&&(o||l.forEach&&!ID(function(){new s().entries().next();}))){var c=(r=t(function(t,i){OD(BD(t,c),{type:e,collection:new s()}),AD(i)||PD(i,t[a],{that:t,AS_ENTRIES:n});})).prototype,h=LD(e);RD(["add","clear","delete","forEach","get","has","set","keys","values","entries"],function(e){var t="add"===e||"set"===e;!(e in l)||o&&"clear"===e||ED(c,e,function(i,r){var n=h(this).collection;if(!t&&o&&!MD(i))return"get"===e&&void 0;var a=n[e](0===i?0:i,r);return t?this:a;});}),o||zD(c,"size",{configurable:!0,get:function get(){return h(this).collection.size;}});}else r=i.getConstructor(t,e,n,a),TD.enable();return UD(r,e,!1,!0),u[e]=r,CD({global:!0,forced:!0},u),o||i.setStrong(r,e,n),r;};tM("Set",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0);};},eM);var iM=Ie,rM=TypeError,nM=function nM(e){if("object"==_typeof(e)&&"size"in e&&"has"in e&&"add"in e&&"delete"in e&&"keys"in e)return e;throw new rM(iM(e)+" is not a set");},oM=function oM(e,t){return 1===t?function(t,i){return t[e](i);}:function(t,i,r){return t[e](i,r);};},aM=ne("Set"),sM=aM.prototype,lM={Set:aM,add:oM("add",1),has:oM("has",1),remove:oM("delete",1),proto:sM},uM=D,cM=function cM(e,t,i){for(var r,n,o=i?e:e.iterator,a=e.next;!(r=uM(a,o)).done;)if(void 0!==(n=t(r.value)))return n;},hM=cM,dM=function dM(e,t,i){return i?hM(e.keys(),t,!0):e.forEach(t);},fM=dM,vM=lM.Set,gM=lM.add,mM=function mM(e){var t=new vM();return fM(e,function(e){gM(t,e);}),t;},yM=function yM(e){return e.size;},pM=De,wM=ai,bM=D,kM=Tr,SM=function SM(e){return{iterator:e,next:e.next,done:!1};},xM="Invalid size",CM=RangeError,VM=TypeError,TM=Math.max,IM=function IM(e,t){this.set=e,this.size=TM(t,0),this.has=pM(e.has),this.keys=pM(e.keys);};IM.prototype={getIterator:function getIterator(){return SM(wM(bM(this.keys,this.set)));},includes:function includes(e){return bM(this.has,this.set,e);}};var EM=function EM(e){wM(e);var t=+e.size;if(t!=t)throw new VM(xM);var i=kM(t);if(i<0)throw new CM(xM);return new IM(e,i);},PM=nM,BM=mM,DM=yM,MM=EM,AM=dM,UM=cM,zM=lM.has,RM=lM.remove,NM=function NM(){return!1;},OM=function OM(e){var t=PM(this),i=MM(e),r=BM(t);return DM(t)<=i.size?AM(t,function(e){i.includes(e)&&RM(r,e);}):UM(i.getIterator(),function(e){zM(r,e)&&RM(r,e);}),r;},LM=a;Mi({target:"Set",proto:!0,real:!0,forced:!NM()||LM(function(){var e={size:1,has:function has(){return!0;},keys:function keys(){var e=0;return{next:function next(){var i=e++>1;return t.has(1)&&t.clear(),{done:i,value:2};}};}},t=new Set([1,2,3,4]);return 3!==t.difference(e).size;})},{difference:OM});var WM=nM,HM=yM,FM=EM,jM=dM,YM=cM,XM=lM.Set,qM=lM.add,ZM=lM.has,_M=a,GM=function GM(e){var t=WM(this),i=FM(e),r=new XM();return HM(t)>i.size?YM(i.getIterator(),function(e){ZM(t,e)&&qM(r,e);}):jM(t,function(e){i.includes(e)&&qM(r,e);}),r;};Mi({target:"Set",proto:!0,real:!0,forced:!NM()||_M(function(){return"3,2"!==String(Array.from(new Set([1,2,3]).intersection(new Set([3,2]))));})},{intersection:GM});var KM=nM,$M=lM.has,QM=yM,JM=EM,eA=dM,tA=cM,iA=nd,rA=function rA(e){var t=KM(this),i=JM(e);if(QM(t)<=i.size)return!1!==eA(t,function(e){if(i.includes(e))return!1;},!0);var r=i.getIterator();return!1!==tA(r,function(e){if($M(t,e))return iA(r,"normal",!1);});};Mi({target:"Set",proto:!0,real:!0,forced:!NM()},{isDisjointFrom:rA});var nA=nM,oA=yM,aA=dM,sA=EM,lA=function lA(e){var t=nA(this),i=sA(e);return!(oA(t)>i.size)&&!1!==aA(t,function(e){if(!i.includes(e))return!1;},!0);};Mi({target:"Set",proto:!0,real:!0,forced:!NM()},{isSubsetOf:lA});var uA=nM,cA=lM.has,hA=yM,dA=EM,fA=cM,vA=nd,gA=function gA(e){var t=uA(this),i=dA(e);if(hA(t)<i.size)return!1;var r=i.getIterator();return!1!==fA(r,function(e){if(!cA(t,e))return vA(r,"normal",!1);});};Mi({target:"Set",proto:!0,real:!0,forced:!NM()},{isSupersetOf:gA});var mA=nM,yA=mM,pA=EM,wA=cM,bA=lM.add,kA=lM.has,SA=lM.remove,xA=function xA(e){try{var t=new Set(),i={size:0,has:function has(){return!0;},keys:function keys(){return Object.defineProperty({},"next",{get:function get(){return t.clear(),t.add(4),function(){return{done:!0};};}});}},r=t[e](i);return 1===r.size&&4===r.values().next().value;}catch(e){return!1;}},CA=function CA(e){var t=mA(this),i=pA(e).getIterator(),r=yA(t);return wA(i,function(e){kA(t,e)?SA(r,e):bA(r,e);}),r;},VA=xA;Mi({target:"Set",proto:!0,real:!0,forced:!NM()||!VA("symmetricDifference")},{symmetricDifference:CA});var TA=nM,IA=lM.add,EA=mM,PA=EM,BA=cM,DA=function DA(e){var t=TA(this),i=PA(e).getIterator(),r=EA(t);return BA(i,function(e){IA(r,e);}),r;},MA=xA;Mi({target:"Set",proto:!0,real:!0,forced:!NM()||!MA("union")},{union:DA});var AA=J.Set;!function(e){e.exports=AA;}(QB);var UA=t($B),zA={},RA={get exports(){return zA;},set exports(e){zA=e;}},NA=jn,OA=zr,LA=Xn,WA=ei,_HA=function HA(e,t,i,r,n,o,a,s){for(var l,u,c=n,h=0,d=!!a&&WA(a,s);h<r;)h in i&&(l=d?d(i[h],h,t):i[h],o>0&&NA(l)?(u=OA(l),c=_HA(e,t,l,u,c,o-1)-1):(LA(c+1),e[c]=l),c++),h++;return c;},FA=_HA,jA=Qe,YA=zr,XA=Tr,qA=io;Mi({target:"Array",proto:!0},{flat:function flat(){var e=arguments.length?arguments[0]:void 0,t=jA(this),i=YA(t),r=qA(t,0);return r.length=FA(r,t,t,i,0,void 0===e?1:XA(e)),r;}});var ZA=sf("Array","flat"),_A=oe,GA=ZA,KA=Array.prototype,$A=function $A(e){var t=e.flat;return e===KA||_A(KA,e)&&t===KA.flat?GA:t;},QA=$A;!function(e){e.exports=QA;}(RA);var JA=t(zA),eU={},tU={get exports(){return eU;},set exports(e){eU=e;}},iU=o.isFinite,rU=Number.isFinite||function(e){return"number"==typeof e&&iU(e);};Mi({target:"Number",stat:!0},{isFinite:rU});var nU=J.Number.isFinite;!function(e){e.exports=nU;}(tU);var oU=t(eU),aU={},sU={get exports(){return aU;},set exports(e){aU=e;}},lU=o,uU=a,cU=Co,hU=CS.trim,dU=mS,fU=y("".charAt),vU=lU.parseFloat,gU=lU.Symbol,mU=gU&&gU.iterator,yU=1/vU(dU+"-0")!=-1/0||mU&&!uU(function(){vU(Object(mU));})?function(e){var t=hU(cU(e)),i=vU(t);return 0===i&&"-"===fU(t,0)?-0:i;}:vU;Mi({global:!0,forced:parseFloat!==yU},{parseFloat:yU});var pU=J.parseFloat;!function(e){e.exports=pU;}(sU);var wU=t(aU),bU={},kU={get exports(){return bU;},set exports(e){bU=e;}},SU=Mi,xU=C;I.f;var CU=Ar,VU=Co,TU=wB,IU=Z,EU=kB,PU=xU("".slice),BU=Math.min;SU({target:"String",proto:!0,forced:!EU("startsWith")},{startsWith:function startsWith(e){var t=VU(IU(this));TU(e);var i=CU(BU(arguments.length>1?arguments[1]:void 0,t.length)),r=VU(e);return PU(t,i,i+r.length)===r;}});var DU=sf("String","startsWith"),MU=oe,AU=DU,UU=String.prototype,zU=function zU(e){var t=e.startsWith;return"string"==typeof e||e===UU||MU(UU,e)&&t===UU.startsWith?AU:t;},RU=zU;!function(e){e.exports=RU;}(kU);var NU=t(bU),OU={},LU={get exports(){return OU;},set exports(e){OU=e;}},WU=gV;Mi({target:"Object",stat:!0,arity:2,forced:Object.assign!==WU},{assign:WU});var HU=J.Object.assign;!function(e){e.exports=HU;}(LU);var FU=t(OU),jU={},YU={get exports(){return jU;},set exports(e){jU=e;}},XU=le.match(/firefox\/(\d+)/i),qU=!!XU&&+XU[1],ZU=/MSIE|Trident/.test(le),_U=le.match(/AppleWebKit\/(\d+)\./),GU=!!_U&&+_U[1],KU=Mi,$U=y,QU=De,JU=Qe,ez=zr,tz=KI,iz=Co,rz=a,nz=Rx,oz=Bf,az=qU,sz=ZU,lz=ge,uz=GU,cz=[],hz=$U(cz.sort),dz=$U(cz.push),fz=rz(function(){cz.sort(void 0);}),vz=rz(function(){cz.sort(null);}),gz=oz("sort"),mz=!rz(function(){if(lz)return lz<70;if(!(az&&az>3)){if(sz)return!0;if(uz)return uz<603;var e,t,i,r,n="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:i=3;break;case 68:case 71:i=4;break;default:i=2;}for(r=0;r<47;r++)cz.push({k:t+r,v:i});}for(cz.sort(function(e,t){return t.v-e.v;}),r=0;r<cz.length;r++)t=cz[r].k.charAt(0),n.charAt(n.length-1)!==t&&(n+=t);return"DGBEFHACIJK"!==n;}});KU({target:"Array",proto:!0,forced:fz||!vz||!gz||!mz},{sort:function sort(e){void 0!==e&&QU(e);var t=JU(this);if(mz)return void 0===e?hz(t):hz(t,e);var i,r,n=[],o=ez(t);for(r=0;r<o;r++)r in t&&dz(n,t[r]);for(nz(n,function(e){return function(t,i){return void 0===i?-1:void 0===t?1:void 0!==e?+e(t,i)||0:iz(t)>iz(i)?1:-1;};}(e)),i=ez(n),r=0;r<i;)t[r]=n[r++];for(;r<o;)tz(t,r++);return t;}});var yz=sf("Array","sort"),pz=oe,wz=yz,bz=Array.prototype,kz=function kz(e){var t=e.sort;return e===bz||pz(bz,e)&&t===bz.sort?wz:t;},Sz=kz;!function(e){e.exports=Sz;}(YU);var xz=t(jU),Cz={},Vz={get exports(){return Cz;},set exports(e){Cz=e;}},Tz={},Iz={get exports(){return Tz;},set exports(e){Tz=e;}},Ez=o;Mi({global:!0,forced:Ez.globalThis!==Ez},{globalThis:Ez});var Pz={},Bz={get exports(){return Pz;},set exports(e){Pz=e;}};!function(e){e.exports=o;}(Bz);var Dz=Pz;!function(e){e.exports=Dz;}(Iz),function(e){e.exports=Tz;}(Vz);var Mz=t(Cz),Az={},Uz={get exports(){return Az;},set exports(e){Az=e;}},zz=Mi,Rz=jn,Nz=y([].reverse),Oz=[1,2];zz({target:"Array",proto:!0,forced:String(Oz)===String(Oz.reverse())},{reverse:function reverse(){return Rz(this)&&(this.length=this.length),Nz(this);}});var Lz=sf("Array","reverse"),Wz=oe,Hz=Lz,Fz=Array.prototype,jz=function jz(e){var t=e.reverse;return e===Fz||Wz(Fz,e)&&t===Fz.reverse?Hz:t;},Yz=jz;!function(e){e.exports=Yz;}(Uz);var Xz=t(Az),qz={},Zz={get exports(){return qz;},set exports(e){qz=e;}},_z=Mi,Gz=Date,Kz=y(Gz.prototype.getTime);_z({target:"Date",stat:!0},{now:function now(){return Kz(new Gz());}});var $z=J.Date.now;!function(e){e.exports=$z;}(Zz);var Qz=t(qz),Jz={},eR={get exports(){return Jz;},set exports(e){Jz=e;}},tR=Tr,iR=Co,rR=Z,nR=RangeError,oR=y,aR=Ar,sR=Co,lR=function lR(e){var t=iR(rR(this)),i="",r=tR(e);if(r<0||r===1/0)throw new nR("Wrong number of repetitions");for(;r>0;(r>>>=1)&&(t+=t))1&r&&(i+=t);return i;},uR=Z,cR=oR(lR),hR=oR("".slice),dR=Math.ceil,fR=function fR(e){return function(t,i,r){var n,o,a=sR(uR(t)),s=aR(i),l=a.length,u=void 0===r?" ":sR(r);return s<=l||""===u?a:((o=cR(u,dR((n=s-l)/u.length))).length>n&&(o=hR(o,0,n)),e?a+o:o+a);};},vR=y,gR=a,mR={start:fR(!1),end:fR(!0)}.start,yR=RangeError,pR=isFinite,wR=Math.abs,bR=Date.prototype,kR=bR.toISOString,SR=vR(bR.getTime),xR=vR(bR.getUTCDate),CR=vR(bR.getUTCFullYear),VR=vR(bR.getUTCHours),TR=vR(bR.getUTCMilliseconds),IR=vR(bR.getUTCMinutes),ER=vR(bR.getUTCMonth),PR=vR(bR.getUTCSeconds),BR=gR(function(){return"0385-07-25T07:06:39.999Z"!==kR.call(new Date(-50000000000001));})||!gR(function(){kR.call(new Date(NaN));})?function(){if(!pR(SR(this)))throw new yR("Invalid time value");var e=this,t=CR(e),i=TR(e),r=t<0?"-":t>9999?"+":"";return r+mR(wR(t),r?6:4,0)+"-"+mR(ER(e)+1,2,0)+"-"+mR(xR(e),2,0)+"T"+mR(VR(e),2,0)+":"+mR(IR(e),2,0)+":"+mR(PR(e),2,0)+"."+mR(i,3,0)+"Z";}:kR,DR=D,MR=Qe,AR=xt,UR=BR,zR=k;Mi({target:"Date",proto:!0,forced:a(function(){return null!==new Date(NaN).toJSON()||1!==DR(Date.prototype.toJSON,{toISOString:function toISOString(){return 1;}});})},{toJSON:function toJSON(e){var t=MR(this),i=AR(t,"number");return"number"!=typeof i||isFinite(i)?"toISOString"in t||"Date"!==zR(t)?t.toISOString():DR(UR,t):null;}});var RR=J,NR=d;RR.JSON||(RR.JSON={stringify:JSON.stringify});var OR=function OR(e,t,i){return NR(RR.JSON.stringify,null,arguments);},LR=OR;!function(e){e.exports=LR;}(eR);var WR=t(Jz),HR={},FR={get exports(){return HR;},set exports(e){HR=e;}},jR=rB.values;Mi({target:"Object",stat:!0},{values:function values(e){return jR(e);}});var YR=J.Object.values;!function(e){e.exports=YR;}(FR);var XR=t(HR),qR={},ZR={get exports(){return qR;},set exports(e){qR=e;}};!function(e){e.exports=cv;}(ZR);var _R=t(qR),GR={},KR={get exports(){return GR;},set exports(e){GR=e;}},$R=Ma.some;Mi({target:"Array",proto:!0,forced:!Bf("some")},{some:function some(e){return $R(this,e,arguments.length>1?arguments[1]:void 0);}});var QR=sf("Array","some"),JR=oe,eN=QR,tN=Array.prototype,iN=function iN(e){var t=e.some;return e===tN||JR(tN,e)&&t===tN.some?eN:t;},rN=iN;!function(e){e.exports=rN;}(KR);var nN=t(GR),oN={},aN={get exports(){return oN;},set exports(e){oN=e;}};!function(e){e.exports=Pb;}(aN);var sN,lN,uN,cN,hN,dN,fN,vN,gN,mN=t(oN),yN=["style"],pN=["style"],wN=["style"],bN=["style"],kN=["style"],SN=["style"],xN=["style"],CN=["style"];function VN(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var e,t,i="function"==typeof dc?dc:{},r=i.iterator||"@@iterator",n=i.toStringTag||"@@toStringTag";function o(i,r,n,o){var l=r&&r.prototype instanceof s?r:s,u=pc(l.prototype);return _TN(u,"_invoke",function(i,r,n){var o,s,l,u=0,c=n||[],h=!1,_d2={p:0,n:0,v:e,a:f,f:_R(f).call(f,e,4),d:function d(t,i){return o=t,s=0,l=e,_d2.n=i,a;}};function f(i,r){for(s=i,l=r,t=0;!h&&u&&!n&&t<c.length;t++){var n,o=c[t],f=_d2.p,v=o[2];i>3?(n=v===r)&&(l=o[(s=o[4])?5:(s=3,3)],o[4]=o[5]=e):o[0]<=f&&((n=i<2&&f<o[1])?(s=0,_d2.v=r,_d2.n=o[1]):f<v&&(n=i<3||o[0]>r||r>v)&&(o[4]=i,o[5]=r,_d2.n=v,s=0));}if(n||i>1)return a;throw h=!0,r;}return function(n,c,v){if(u>1)throw TypeError("Generator is already running");for(h&&1===c&&f(c,v),s=c,l=v;(t=s<2?e:l)||!h;){o||(s?s<3?(s>1&&(_d2.n=-1),f(s,l)):_d2.n=l:_d2.v=l);try{if(u=2,o){if(s||(n="next"),t=o[n]){if(!(t=t.call(o,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,s<2&&(s=0);}else 1===s&&(t=o.return)&&t.call(o),s<2&&(l=TypeError("The iterator does not provide a '"+n+"' method"),s=1);o=e;}else if((t=(h=_d2.n<0)?l:i.call(r,_d2))!==a)break;}catch(t){o=e,s=1,l=t;}finally{u=1;}}return{value:t,done:h};};}(i,n,o),!0),u;}var a={};function s(){}function l(){}function u(){}t=Vc;var c=[][r]?t(t([][r]())):(_TN(t={},r,function(){return this;}),t),h=u.prototype=s.prototype=pc(c);function d(e){return Pc?Pc(e,u):(e.__proto__=u,_TN(e,n,"GeneratorFunction")),e.prototype=pc(h),e;}return l.prototype=u,_TN(h,"constructor",u),_TN(u,"constructor",l),l.displayName="GeneratorFunction",_TN(u,n,"GeneratorFunction"),_TN(h),_TN(h,n,"Generator"),_TN(h,r,function(){return this;}),_TN(h,"toString",function(){return"[object Generator]";}),(VN=function VN(){return{w:o,m:d};})();}function _TN(e,t,i,r){var n=mN;try{n({},"",{});}catch(e){n=0;}_TN=function TN(e,t,i,r){function o(t,i){_TN(e,t,function(e){return this._invoke(t,i,e);});}t?n?n(e,t,{value:i,enumerable:!r,configurable:!r,writable:!r}):e[t]=i:(o("next",0),o("throw",1),o("return",2));},_TN(e,t,i,r);}function IN(e,t,i){return t=Rw(t),function(e,t){if(t&&("object"===Bh(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Pw(e);}(e,Tv()?Ln(t,i||[],Rw(e).constructor):t.apply(e,i));}function EN(e,t,i,r){var n=hb(Rw(1&r?e.prototype:e),t,i);return 2&r&&"function"==typeof n?function(e){return n.apply(i,e);}:n;}var PN={code:0,message:"ok."},BN={code:8e4,message:"The parameter type is wrong."},DN={code:80002,message:"The parameter is out of range."},MN={code:80003,message:"The image does not exist."},AN={code:80013,message:"The parameter is invalid."},UN={code:80021,message:"The size is invalid."},zN=function zN(e){return e.replace(/[A-Z]/g,function(e){return"-".concat(e.toLowerCase());});},RN=function RN(e){return Object.prototype.toString.call(e);},NN=function NN(e){return _k?_k(e):"[object Array]"===RN(e);},ON=function ON(e){return null!==e&&"[object Object]"===RN(e);},_LN=function LN(e){var t,i=null;return NN(e)&&(i||(i=[]),$k(e).call(e,function(e){i.push(_LN(e));})),ON(e)&&(i||(i={}),$k(t=eS(e)).call(t,function(t){i[t]=_LN(e[t]);})),i||e;};function WN(e,t){for(var i in t)e[i]=e[i]&&"[object Object]"===e[i].toString()?WN(e[i],t[i]):e[i]=t[i];return e;}var HN=function HN(e){return void 0===e;},FN=function FN(e,t){var i,r;e=null!==(i=e)&&void 0!==i?i:"yyyy-MM-dd hh:mm:ss";var n=HN(t)?new Date():new Date(t),o={"M+":(n.getMonth()+1).toString(),"d+":n.getDate().toString(),"h+":n.getHours().toString(),"m+":n.getMinutes().toString(),"s+":n.getSeconds().toString(),"q+":Math.floor((n.getMonth()+3)/3).toString(),S:n.getMilliseconds().toString()};return /(y+)/.test(e)&&(e=e.replace(RegExp.$1,"".concat(n.getFullYear()).substring(4-RegExp.$1.length))),$k(r=eS(o)).call(r,function(t){new RegExp("(".concat(t,")")).test(e)&&(e=e.replace(RegExp.$1,1===RegExp.$1.length?o[t]:"00".concat(o[t]).substring("".concat(o[t]).length)));}),e;},jN=function jN(e){return"string"==typeof e;};function YN(e,t){return Math.pow(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2),.5);}function XN(e){var t=e.type,i=e.value;return"hex"===t?"#".concat(i):"literal"===t?i:"rgb"===t?"rgb(".concat(i.join(","),")"):"rgba(".concat(i.join(","),")");}var qN=function(){var e=/^(linear\-gradient)/i,t=/^(repeating\-linear\-gradient)/i,i=/^(radial\-gradient)/i,r=/^(repeating\-radial\-gradient)/i,n=/^(conic\-gradient)/i,o=/^to (left (top|bottom)|right (top|bottom)|top (left|right)|bottom (left|right)|left|right|top|bottom)/i,a=/^(closest\-side|closest\-corner|farthest\-side|farthest\-corner|contain|cover)/,s=/^(left|center|right|top|bottom)/i,l=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))px/,u=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))\%/,c=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))em/,h=/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,d=/^\(/,f=/^\)/,v=/^,/,g=/^\#([0-9a-fA-F]+)/,m=/^([a-zA-Z]+)/,y=/^rgb/i,p=/^rgba/i,w=/^(([0-9]*\.[0-9]+)|([0-9]+\.?))/,b="";function k(e){var t;throw new Error(uS(t="".concat(b,": ")).call(t,e));}function S(){return x("linear-gradient",e,V)||x("repeating-linear-gradient",t,V)||x("radial-gradient",i,T)||x("repeating-radial-gradient",r,T)||x("conic-gradient",n,T);}function x(e,t,i){return C(t,function(t){var r=i();return r&&(N(v)||k("Missing comma before color stops")),{type:e,orientation:r,colorStops:D(M)};});}function C(e,t){var i=N(e);if(i){N(d)||k("Missing (");var r=t(i);return N(f)||k("Missing )"),r;}}function V(){return R("directional",o,1)||R("angular",h,1);}function T(){var e,t,i=I();return i&&((e=[]).push(i),t=b,N(v)&&((i=I())?e.push(i):b=t)),e;}function I(){var e=function(){var e=R("shape",/^(circle)/i,0);return e&&(e.style=z()||E()),e;}()||function(){var e=R("shape",/^(ellipse)/i,0);return e&&(e.style=U()||E()),e;}();if(e)e.at=P();else{var t=E();if(t){e=t;var i=P();i&&(e.at=i);}else{var r=B();r&&(e={type:"default-radial",at:r});}}return e;}function E(){return R("extent-keyword",a,1);}function P(){if(R("position",/^at/,0)){var e=B();return e||k("Missing positioning value"),e;}}function B(){var e={x:U(),y:U()};if(e.x||e.y)return{type:"position",value:e};}function D(e){var t=e(),i=[];if(t)for(i.push(t);N(v);)(t=e())?i.push(t):k("One extra comma");return i;}function M(){var e=R("hex",g,1)||C(p,function(){return{type:"rgba",value:D(A)};})||C(y,function(){return{type:"rgb",value:D(A)};})||R("literal",m,0);return e||k("Expected color definition"),e.length=U(),e;}function A(){return N(w)[1];}function U(){return R("%",u,1)||R("position-keyword",s,1)||z();}function z(){return R("px",l,1)||R("em",c,1);}function R(e,t,i){var r=N(t);if(r)return{type:e,value:r[i]};}function N(e){var t=/^[\n\r\t\s]+/.exec(b);t&&O(t[0].length);var i=e.exec(b);return i&&O(i[0].length),i;}function O(e){b=b.substring(e);}return function(e){return b=e,function(){var e=D(S);return b.length>0&&k("Invalid input not EOF"),e;}();};}(),ZN=function ZN(e){return"number"==typeof e&&!fS(e);},_N=function _N(e){return"[object Boolean]"===RN(e);},GN=function GN(e){return"function"==typeof e;},KN=function KN(){return void 0!==document.documentMode;},$N=function $N(){return"ontouchstart"in document.documentElement;};function QN(e){return null==e;}var JN=function JN(e,t){return e in t;},eO=function eO(e,t){for(var i=[];e;){var r=e.match(t);if(!r)break;i.push(r),e=e.substring(r.index+r[0].length);}return i;};function tO(e,t){var i;return $k(i=eS(e)).call(i,function(i){HN(t[i])?t[i]=e[i]:ON(e[i])?tO(e[i],t[i]):t[i]=e[i];}),t;}var iO=0,rO=function rO(){var e;return iO+=1,uS(e="".concat(new Date().getTime().toString(36))).call(e,iO.toString(36));},nO=function nO(e,t,i){return Math.min(Math.max(e,t),i);},oO="\\s*([+-]?\\d+)\\s*",aO="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",sO="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",lO=/^#([0-9a-f]{3,8})$/,uO=new RegExp(uS(sN="^rgb\\(".concat(oO,",").concat(oO,",")).call(sN,oO,"\\)$")),cO=new RegExp(uS(lN="^rgb\\(".concat(sO,",").concat(sO,",")).call(lN,sO,"\\)$")),hO=new RegExp(uS(uN=uS(cN="^rgba\\(".concat(oO,",").concat(oO,",")).call(cN,oO,",")).call(uN,aO,"\\)$")),dO=new RegExp(uS(hN=uS(dN="^rgba\\(".concat(sO,",").concat(sO,",")).call(dN,sO,",")).call(hN,aO,"\\)$")),fO=new RegExp(uS(fN="^hsl\\(".concat(aO,",").concat(sO,",")).call(fN,sO,"\\)$")),vO=new RegExp(uS(vN=uS(gN="^hsla\\(".concat(aO,",").concat(sO,",")).call(gN,sO,",")).call(vN,aO,"\\)$")),gO={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},mO=Yk(function e(t,i,r,n){Xk(this,e),Wk(this,"r",void 0),Wk(this,"g",void 0),Wk(this,"b",void 0),Wk(this,"opacity",void 0),this.r=t,this.g=i,this.b=r,this.opacity=n;});function yO(e){return new mO(e>>16&255,e>>8&255,255&e,1);}function pO(e,t,i,r){return r<=0&&(e=NaN,t=NaN,i=NaN),new mO(e,t,i,r);}function wO(e,t,i,r){return r<=0?(e=NaN,t=NaN,i=NaN):i<=0||i>=1?(e=NaN,t=NaN):t<=0&&(e=NaN),{h:e,s:t,l:i,opacity:r};}function bO(e,t,i){return e<60?(t+(i-t)*e)/60*255:e<180?255*i:e<240?(t+(i-t)*(240-e))/60*255:255*t;}function kO(e){var t=e.h<0?e.h%360+360:e.h%360,i=fS(t)||fS(e.s)?0:e.s,r=e.l,n=r+(r<.5?r:1-r)*i,o=2*r-n;return new mO(bO(t>=240?t-240:t+120,o,n),bO(t,o,n),bO(t<120?t+240:t-120,o,n),e.opacity);}var SO;function xO(e){var t,i;return e?vx(t=yx(i=eS(e)).call(i,function(t){return null!==e[t]&&void 0!==e[t];})).call(t,function(t,i){return Fk(Fk({},t),{},Wk({},i,e[i]));},{}):{};}function CO(){return void 0===SO&&(SO=/Mac OS/.test(navigator.userAgent)),SO;}var VO,TO={"&amp;":"&","&gt;":">","&lt;":"<","&nbsp;":" ","&quot;":'"',"&#x27;":"'"},IO={};function EO(e,t){for(var i=eS(e),r=0;r<i.length;r++){var n=i[r];if(!1===t.call(null,e[n],n,e))break;}}function PO(e){return 0===e.length?"":e.replace(function(){if(VO)return VO;var e="";return EO(IO,function(t){e+="".concat(t,"|");}),e+="&#(\\d{1,5});",VO=new RegExp(e,"g");}(),function(e,t){return TO[e]||String.fromCharCode(+t);});}EO(TO,function(e,t){IO[e]=t;}),function(e,t){for(var i=eS(e),r=0;r<i.length;r++){var n=i[r];if(!1===t.call(null,e[n],n,e))break;}}({"&amp;":"&","&gt;":">","&lt;":"<","&nbsp;":" ","&quot;":'"',"&#x27;":"'"},function(e,t){});var BO=function BO(e,t,i){void 0===t?i.appendChild(e):i.insertBefore(e,t);},DO=function DO(e,t){var i=t.parentNode;i.lastChild===t?i.appendChild(e):BO(e,t.nextSibling,i);},MO=function MO(e){e&&(e.stopPropagation?e.stopPropagation():e.cancelBubble=!0);},AO=function AO(e){var t=UI||window.webkitURL,i="string";return jN(e)?i="string":"[object Blob]"===RN(e)?(i="blob",e=t.createObjectURL(e)):("[object ArrayBuffer]"===RN(e)||NN(e))&&(i="blob",e=t.createObjectURL(new Blob([e]))),{type:i,data:e};},UO=function UO(){var e=window;if(e){if(e.devicePixelRatio)return e.devicePixelRatio;if(e.screen.deviceXDPI&&e.screen.logicalXDPI)return e.screen.deviceXDPI/e.screen.logicalXDPI;}return 1;},zO=function zO(e){var t=UI||window.webkitURL;/^blob:/.test(e)&&t.revokeObjectURL(e);},RO=function RO(){return{scrollX:void 0===window.scrollX?window.pageXOffset:window.scrollX,scrollY:void 0===window.scrollY?window.pageYOffset:window.scrollY};},NO=function NO(e){return(e/=.5)<1?Math.pow(e,3):.5*(Math.pow(e-2,3)+2);},OO=function OO(e){return Math.pow(e-1,3)+1;},LO=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";Xk(this,e),Wk(this,"prefix",void 0),Wk(this,"postfix",void 0),Wk(this,"isDestroyed",!1),Wk(this,"uid",rO()),Wk(this,"cacheEvents",void 0),Wk(this,"events",void 0),Wk(this,"isCached",void 0),this.cacheEvents=[],this.events={},this.isCached=!1,this.prefix=t,this.postfix=i;}return Yk(e,[{key:"save",value:function value(){this.isCached=!0;}},{key:"restore",value:function value(){var e,t=this;this.isCached=!1,$k(e=this.cacheEvents).call(e,function(e){var i,r=e.eventName,n=e.param;t.emit.apply(t,uS(i=[r]).call(i,Ub(n)));}),this.cacheEvents.length=0;}},{key:"destroy",value:function value(){var e=this;if(!this.isDestroyed){for(var t in this.events)if(Object.prototype.hasOwnProperty.call(this.events,t)){var i,r=this.events[t];r&&$k(i=NI(r).call(r)).call(i,function(t){var i=t.name,r=t.fn,n=t.context,o=t.once;e.off(i,r,n,o);});}this.events={},this.isDestroyed=!0;}}},{key:"on",value:function value(e,t,i){var r,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=this.events,a={name:e=this.format(e),uid:rO(),context:i,once:n,fn:t};return o[e]||(o[e]=[]),WI(r=o[e]).call(r,a)<0&&o[e].push(a),a;}},{key:"once",value:function value(e,t,i){return this.on(e,t,i,!0);}},{key:"emit",value:function value(e){for(var t,i,r=this,n=arguments.length,o=new Array(n>1?n-1:0),a=1;a<n;a++)o[a-1]=arguments[a];if(this.isCached)return this.cacheEvents.push({eventName:e,param:o}),!0;var s=this.events[e=this.format(e)];return!(!s||!s.length||($k(t=NI(s).call(s)).call(t,function(e){var t,i=e.fn,r=e.context;i.call.apply(i,uS(t=[r||null]).call(t,o));}),$k(i=NI(s).call(s)).call(i,function(t){var i=t.fn,n=t.context,o=t.once;o&&r.off(e,i,n,o);}),0));}},{key:"off",value:function value(e,t,i,r){var n=this.events[e=this.format(e)];if(!n)return!1;if(!arguments.length)return n.length=0,!0;for(var o=n.length-1;o>=0;o--){var a=n[o];t&&a.fn!==t||i&&a.context!==i||r&&a.once!==r||mE(n).call(n,o,1);}return!0;}},{key:"removeAllEventListeners",value:function value(e){if(e){var t,i;e=this.format(e);var r=PE(t=this.cacheEvents).call(t,function(t){return t.eventName===e;});r>-1&&mE(i=this.cacheEvents).call(i,r,1),this.events[e]&&delete this.events[e];}else this.cacheEvents=[],this.events={};}},{key:"getAllEvents",value:function value(){return this.events;}},{key:"format",value:function value(e){var t,i;return uS(t=uS(i="".concat(this.prefix||"")).call(i,e)).call(t,this.postfix||"");}}],[{key:"create",value:function value(t,i){return new e(t,i);}}]);}(),WO="default",HO=function(){function e(){Xk(this,e),Wk(this,"emitter",new LO());}return Yk(e,[{key:"on",value:function value(e){this.emitter.on(WO,e);}},{key:"emit",value:function value(){for(var e,t,i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];(e=this.emitter).emit.apply(e,uS(t=[WO]).call(t,r));}},{key:"off",value:function value(e){this.emitter.off(WO,e);}}],[{key:"create",value:function value(){return new e();}}]);}(),FO=function FO(e){return e/180*Math.PI;},jO=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Xk(this,e),Wk(this,"x",void 0),Wk(this,"y",void 0),Wk(this,"z",void 0),this.x=t,this.y=i,this.z=r;}return Yk(e,[{key:"setFromVector",value:function value(e){var t;this.x=e.x,this.y=e.y,this.z=null!==(t=e.z)&&void 0!==t?t:0;}},{key:"clone",value:function value(){return new e(this.x,this.y,this.z);}},{key:"norm",value:function value(){return NE(this.x,this.y,this.z);}},{key:"dot",value:function value(e){var t;return this.x*e.x+this.y*e.y+this.z*(null!==(t=e.z)&&void 0!==t?t:0);}},{key:"projectionTo",value:function value(e){var t=NE(e.x,e.y,e.z);return this.dot(e)/t;}},{key:"angle",value:function value(e){var t=this.norm()*NE(e.x,e.y,e.z),i=t&&this.dot(e)/t;return Math.acos(nO(i,-1,1));}},{key:"equals",value:function value(e){var t;return this.x===e.x&&this.y===e.y&&this.z===(null!==(t=e.z)&&void 0!==t?t:0);}},{key:"distance",value:function value(e){var t;return NE(this.x-e.x,this.y-e.y,this.z-(null!==(t=e.z)&&void 0!==t?t:0));}},{key:"lerp",value:function value(t){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,n=this.x,o=this.y,a=this.z;return new e(n+r*(t.x-n),o+r*(t.y-o),a+r*((null!==(i=t.z)&&void 0!==i?i:0)-a));}},{key:"normalize",value:function value(){var e=this,t=e.norm();return e.x/=t,e.y/=t,e.z/=t,this;}},{key:"negate",value:function value(){return this.x*=-1,this.y*=-1,this.z*=-1,this;}},{key:"cross",value:function value(e){var t=this;return{x:t.y*e.z-t.z*e.y,y:t.z*e.x-t.x*e.z,z:t.x*e.y-t.y*e.x};}},{key:"add",value:function value(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this;}},{key:"multiply",value:function value(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this;}}],[{key:"fromPoint",value:function value(t){return new e(t.x,t.y,t.z);}},{key:"fromTwoPoint",value:function value(t,i){var r,n,o,a,s,l;return new e((null!==(r=i.x)&&void 0!==r?r:0)-(null!==(n=t.x)&&void 0!==n?n:0),(null!==(o=i.y)&&void 0!==o?o:0)-(null!==(a=t.y)&&void 0!==a?a:0),(null!==(s=i.z)&&void 0!==s?s:0)-(null!==(l=t.z)&&void 0!==l?l:0));}},{key:"fromValue",value:function value(t,i,r){return new e(t,i,r);}}]);}();function YO(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return ZN(e)?jO.fromValue(e,t,i):jO.fromPoint(e);}function XO(e,t){return jO.fromTwoPoint(e,t);}var qO=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Xk(this,e),Wk(this,"x",void 0),Wk(this,"y",void 0),Wk(this,"z",void 0),this.x=t,this.y=i,this.z=r;}return Yk(e,[{key:"matrixTransform",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.x,i=this.y,r=this.z,n=e.m11,o=e.m21,a=e.m31,s=e.m41,l=e.m12,u=e.m22,c=e.m32,h=e.m42,d=e.m13,f=e.m23,v=e.m33,g=e.m43,m=e.m14*t+e.m24*i+e.m34*r+e.m44;return ZO({x:(n*t+o*i+a*r+s)/m,y:(l*t+u*i+c*r+h)/m,z:(d*t+f*i+v*r+g)/m});}},{key:"setFromPoint",value:function value(e){return this.x=e.x||0,this.y=e.y||0,this.z=e.z||0,this;}},{key:"clone",value:function value(){return ZO(this);}},{key:"equals",value:function value(e){var t=e.x,i=void 0===t?0:t,r=e.y,n=void 0===r?0:r,o=e.z,a=void 0===o?0:o,s=this;return s.x===i&&s.y===n&&s.z===a;}},{key:"distanceTo",value:function value(e){var t=e.x,i=void 0===t?0:t,r=e.y,n=void 0===r?0:r,o=e.z,a=void 0===o?0:o,s=this;return NE(s.x-i,s.y-n,s.z-a);}},{key:"lerpTo",value:function value(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,i=e.x,r=void 0===i?0:i,n=e.y,o=void 0===n?0:n,a=e.z,s=void 0===a?0:a,l=this;return ZO({x:l.x+t*(r-l.x),y:l.y+t*(o-l.y),z:l.z+t*(s-l.z)});}},{key:"footPointInSegment",value:function value(e,t){var i=XO(e,this),r=XO(e,t),n=r.norm(),o=ZO(e);if(0===n)return o;var a=i.projectionTo(r)/n;return o.lerpTo(t,a);}},{key:"perpendicularToSegment",value:function value(e,t){var i=this.footPointInSegment(e,t);return this.distanceTo(i);}}],[{key:"fromPoint",value:function value(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new e(t.x,t.y,t.z);}}]);}();function ZO(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return ZN(e)?new qO(e,t,i):new qO(e.x,e.y,e.z);}var _O=function _O(e){return e/Math.PI*180;},GO=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Xk(this,e),Wk(this,"x",void 0),Wk(this,"y",void 0),Wk(this,"z",void 0),Wk(this,"w",void 0),this.x=t,this.y=i,this.z=r,this.w=n;}return Yk(e,[{key:"clone",value:function value(){var t=new e();return t.setFromQuat(this),t;}},{key:"setFromQuat",value:function value(e){var t,i,r,n,o=this;return o.x=null!==(t=e.x)&&void 0!==t?t:0,o.y=null!==(i=e.y)&&void 0!==i?i:0,o.z=null!==(r=e.z)&&void 0!==r?r:0,o.w=null!==(n=e.w)&&void 0!==n?n:1,this;}},{key:"toEuler",value:function value(){var e=this.x,t=this.y,i=this.z,r=this.w,n=.4990234375,o=this.w*this.y-this.x*this.z;if(o<-n||o>n){var a=FE(o);return{z:-2*a*Math.atan2(this.x,this.w),y:a*(Math.PI/2),x:0};}return{x:_O(Math.atan2(2*(t*i+r*e),r*r-e*e-t*t+i*i)),y:_O(Math.asin(-2*(e*i-r*t))),z:_O(Math.atan2(2*(e*t+r*i),r*r+e*e-t*t-i*i))};}},{key:"invert",value:function value(){var e=this.x,t=this.y,i=this.z,r=this.w,n=e*e+t*t+i*i+r*r,o=n?1/n:0;return this.x=-e*o,this.y=-t*o,this.z=-i*o,this.w=r*o,this;}},{key:"multiply",value:function value(e){var t=this.x,i=this.y,r=this.z,n=this.w,o=e.x,a=e.y,s=e.z,l=e.w;return this.x=t*l+n*o+i*s-r*a,this.y=i*l+n*a+r*o-t*s,this.z=r*l+n*s+t*a-i*o,this.w=n*l-t*o-i*a-r*s,this;}},{key:"normalize",value:function value(){var e=this.x,t=this.y,i=this.z,r=this.w,n=e*e+t*t+i*i+r*r;return this.x/=n,this.y/=n,this.z/=n,this.w/=n,this;}}],[{key:"fromQuat",value:function value(t){return new e().setFromQuat(t);}},{key:"fromEuler",value:function value(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t=FO(t)/2,i=FO(i)/2,r=FO(r)/2;var n=Math.sin(t),o=Math.cos(t),a=Math.sin(i),s=Math.cos(i),l=Math.sin(r),u=Math.cos(r),c=new e();return c.setFromQuat({x:n*s*u-o*a*l,y:o*a*u+n*s*l,z:o*s*l-n*a*u,w:o*s*u+n*a*l}),c;}}]);}();function KO(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return ZN(e)?new GO(e,t,i,r):GO.fromQuat(e);}function $O(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return GO.fromEuler(e,t,i);}var QO=function(){return Yk(function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Xk(this,e),Wk(this,"x",void 0),Wk(this,"y",void 0),Wk(this,"z",void 0),Wk(this,"w",void 0),this.x=t,this.y=i,this.z=r,this.w=n;},[{key:"negate",value:function value(){this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1;}},{key:"normalize",value:function value(){var e=this.norm();this.x/=e,this.y/=e,this.z/=e,this.w/=e;}},{key:"norm",value:function value(){return NE(this.x,this.y,this.z,this.w);}}]);}();function JO(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return ZN(e)?new QO(e,t,i,r):new QO(e.x,e.y,e.z,e.w);}var eL=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],tL=function(){function e(t){if(Xk(this,e),Wk(this,"a",1),Wk(this,"b",0),Wk(this,"c",0),Wk(this,"d",1),Wk(this,"e",0),Wk(this,"f",0),Wk(this,"m11",1),Wk(this,"m12",0),Wk(this,"m13",0),Wk(this,"m14",0),Wk(this,"m21",0),Wk(this,"m22",1),Wk(this,"m23",0),Wk(this,"m24",0),Wk(this,"m31",0),Wk(this,"m32",0),Wk(this,"m33",1),Wk(this,"m34",0),Wk(this,"m41",0),Wk(this,"m42",0),Wk(this,"m43",0),Wk(this,"m44",1),Wk(this,"is2D",void 0),t||(t=eL),jN(t));else{if(!NN(t))throw new Error("DefaultMatrix error.");oL(t,this);}}return Yk(e,[{key:"isIdentity",get:function get(){for(var e=this.toArray(),t=0;t<16;t++)if(e[t]!==eL[t])return!1;return!0;}},{key:"translate",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.clone().translateSelf(e,t,i);}},{key:"scale",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return HN(t)&&(t=e),this.clone().scaleSelf(e,t,i,r,n,o);}},{key:"scale3d",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this.clone().scale3dSelf(e,t,i,r);}},{key:"rotate",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;return this.clone().rotateSelf(e,t,i);}},{key:"rotateFromVector",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.clone().rotateFromVectorSelf(e,t);}},{key:"rotateAxisAngle",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this.clone().rotateAxisAngleSelf(e,t,i,r);}},{key:"skewX",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.clone().skewXSelf(e);}},{key:"skewY",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.clone().skewYSelf(e);}},{key:"multiply",value:function value(e){return this.clone().multiplySelf(e);}},{key:"flipX",value:function value(){return this.clone().multiplySelf(new e([-1,0,0,1,0,0]));}},{key:"flipY",value:function value(){return this.clone().multiplySelf(new e([1,0,0,-1,0,0]));}},{key:"inverse",value:function value(){return this.clone().invertSelf();}},{key:"transformPoint",value:function value(){return ZO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).matrixTransform(this);}},{key:"toFloat32Array",value:function value(){var e=this.toArray();return new Float32Array(e);}},{key:"toFloat64Array",value:function value(){var e=this.toArray();return new Float64Array(e);}},{key:"toJSON",value:function value(){}},{key:"multiplySelf",value:function value(){var e=aL(this,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return this.setFromMatrix(e),this;}},{key:"preMultiplySelf",value:function value(){var e=aL(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},this);return this.setFromMatrix(e),this;}},{key:"translateSelf",value:function value(){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,t=function(){return{m11:1,m21:0,m31:0,m41:arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,m12:0,m22:1,m32:0,m42:arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,m13:0,m23:0,m33:1,m43:arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,m14:0,m24:0,m34:0,m44:1};}(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e);return this.multiplySelf(t),e&&(this.is2D=!1),this;}},{key:"scaleSelf",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;this.translateSelf(r,n,o),HN(t)&&(t=e);var a=function(){return{m11:arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,m21:0,m31:0,m41:0,m12:0,m22:arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,m32:0,m42:0,m13:0,m23:0,m33:arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,m43:0,m14:0,m24:0,m34:0,m44:1};}(e,t,i);return this.multiplySelf(a),this.translateSelf(-r,-n,-o),1!==i&&(this.is2D=!1),this;}},{key:"scale3dSelf",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return this.scaleSelf(e,e,e,t,i,r);}},{key:"rotateSelf",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;HN(t)&&HN(i)&&(i=e,e=0,t=0),HN(t)&&(t=0),HN(i)&&(i=0),0===e&&0===t||(this.is2D=!1);var r=sL(i,[0,0,1]),n=sL(t,[0,1,0]),o=sL(e,[1,0,0]);return this.multiplySelf(r),this.multiplySelf(n),this.multiplySelf(o),this;}},{key:"rotateFromVectorSelf",value:function value(){var e=YO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),t=YO(1,0),i=sL(e.angle(t),[0,0,1]);return this.multiplySelf(i),this;}},{key:"rotateAxisAngleSelf",value:function value(){var e=sL(arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,[arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0]);return this.multiplySelf(e),this;}},{key:"skewXSelf",value:function value(){var e=lL(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,0);return this.multiplySelf(e),this;}},{key:"skewYSelf",value:function value(){var e=lL(0,arguments.length>0&&void 0!==arguments[0]?arguments[0]:0);return this.multiplySelf(e),this;}},{key:"invertSelf",value:function value(){var e=function(e){if(e[0].length!==e.length)throw new Error();for(var t=rL(e),i=function(e,t,i){if(e[0].length!==e.length)throw new Error("Not square matrix.");for(var r=e.length,n=QE(t=hP(i=new Array(r)).call(i,0)).call(t,function(e){var t;return hP(t=new Array(r)).call(t,0);}),o=0;o<r;o++)for(var a=0;a<r;a++)n[o][a]=nL(e,o,a);return function(e,t,i){for(var r=QE(t=hP(i=new Array(e.length)).call(i,0)).call(t,function(t){var i;return hP(i=new Array(e[0].length)).call(i,0);}),n=0;n<r.length;n++)for(var o=0;o<r[0].length;o++)r[n][o]=e[o][n];return r;}(n);}(e),r=0;r<i.length;r++)for(var n=0;n<i.length;n++)i[r][n]/=t;return i;}(this.toTwoDimensionalArray());return this.setFromTwoDimensionalArray(e),this;}},{key:"setMatrixValue",value:function value(e){}},{key:"setFromMatrix",value:function value(e){var t=this;t.m11=e.m11,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m21=e.m21,t.m22=e.m22,t.m23=e.m23,t.m24=e.m24,t.m31=e.m31,t.m32=e.m32,t.m33=e.m33,t.m34=e.m34,t.m41=e.m41,t.m42=e.m42,t.m43=e.m43,t.m44=e.m44,t.a=e.m11,t.b=e.m12,t.c=e.m21,t.d=e.m22,t.e=e.m41,t.f=e.m42,!1===e.is2D&&(t.is2D=!1);}},{key:"setFromTwoDimensionalArray",value:function value(e){var t=Ab(e,4),i=Ab(t[0],4),r=i[0],n=i[1],o=i[2],a=i[3],s=Ab(t[1],4),l=s[0],u=s[1],c=s[2],h=s[3],d=Ab(t[2],4),f=d[0],v=d[1],g=d[2],m=d[3],y=Ab(t[3],4),p=y[0],w=y[1],b=y[2],k=y[3];this.setFromMatrix({m11:r,m21:n,m31:o,m41:a,m12:l,m22:u,m32:c,m42:h,m13:f,m23:v,m33:g,m43:m,m14:p,m24:w,m34:b,m44:k});}},{key:"clone",value:function value(){return e.fromMatrix(this);}},{key:"determinant",value:function value(){return rL(this.toTwoDimensionalArray());}},{key:"toTwoDimensionalArray",value:function value(){var e=this;return[[e.m11,e.m21,e.m31,e.m41],[e.m12,e.m22,e.m32,e.m42],[e.m13,e.m23,e.m33,e.m43],[e.m14,e.m24,e.m34,e.m44]];}},{key:"toArray",value:function value(){var e=this;return[e.m11,e.m12,e.m13,e.m14,e.m21,e.m22,e.m23,e.m24,e.m31,e.m32,e.m33,e.m34,e.m41,e.m42,e.m43,e.m44];}},{key:"decompose",value:function value(){if(0===this.m44)return{};var e=JO(0,0,0,1),t=KO(0,0,0,1),i=YO(0,0,0),r=YO(0,0,0),n=YO(0,0,0),o=this;o.normalize();var a=o.clone();if(a.m14=0,a.m24=0,a.m34=0,a.m44=1,0===a.determinant())return!1;if(0!==o.m14||0!==o.m24||0!==o.m34){var s={x:o.m14,y:o.m24,z:o.m34,w:o.m44};e=a.invertSelf().transposeSelf().multiplyVector(s);}else e.x=0,e.y=0,e.z=0,e.w=1;n.x=o.m41,n.y=o.m42,n.z=o.m43;var l=[YO(o.m11,o.m12,o.m13),YO(o.m21,o.m22,o.m23),YO(o.m31,o.m32,o.m33)];i.x=l[0].norm(),l[0].normalize(),r.x=l[0].dot(l[1]),l[1]=YO(iL(l[1],l[0],1,-r.x)),i.y=l[1].norm(),l[1].normalize(),r.x/=i.y,r.y=l[0].dot(l[2]),l[2]=YO(iL(l[2],l[0],1,-r.y)),r.z=l[1].dot(l[2]),l[2]=YO(iL(l[2],l[1],1,-r.z)),i.z=l[2].norm(),l[2].normalize(),r.y/=i.z,r.z/=i.z;var u,c=l[1].cross(l[2]);if(l[0].dot(c)<0&&(i.negate(),l[0].negate(),l[1].negate(),l[2].negate()),t.x=.5*Math.pow(Math.max(1+l[0].x-l[1].y-l[2].z,0),.5),t.y=.5*Math.pow(Math.max(1-l[0].x+l[1].y-l[2].z,0),.5),t.z=.5*Math.pow(Math.max(1-l[0].x-l[1].y+l[2].z,0),.5),t.w=.5*Math.pow(Math.max(1+l[0].x+l[1].y+l[2].z,0),.5),l[2].y>l[1].z&&(t.x*=-1),l[0].z>l[2].x&&(t.y*=-1),l[1].x>l[0].y&&(t.z*=-1),t.x<.001&&t.x>=0&&t.y<.001&&t.y>=0){var h=Math.atan2(l[0].y,l[0].x);u={x:0,y:0,z:Number(_O(h).toFixed(3))};}else u=t.toEuler();return{rotation:u,scale:i,translation:n,skew:r,quaternion:t,perspective:e};}},{key:"multiplyVector",value:function value(e){var t=this,i=e.x,r=e.y,n=e.z,o=e.w;return{x:t.m11*i+t.m21*r+t.m31*n+t.m41*o,y:t.m12*i+t.m22*r+t.m32*n+t.m42*o,z:t.m13*i+t.m23*r+t.m33*n+t.m43*o,w:t.m14*i+t.m24*r+t.m34*n+t.m44*o};}},{key:"transpose",value:function value(){var e=this.clone();return e.transposeSelf(),e;}},{key:"transposeSelf",value:function value(){var e=this.m11,t=this.m21,i=this.m31,r=this.m41,n=this.m12,o=this.m22,a=this.m32,s=this.m42,l=this.m13,u=this.m23,c=this.m33,h=this.m43,d=this.m14,f=this.m24,v=this.m34,g=this.m44;return this.setFromMatrix({m11:e,m21:n,m31:l,m41:d,m12:t,m22:o,m32:u,m42:f,m13:i,m23:a,m33:c,m43:v,m14:r,m24:s,m34:h,m44:g}),this;}},{key:"normalize",value:function value(){var e=this,t=e.m44;e.m11/=t,e.m12/=t,e.m13/=t,e.m14/=t,e.m21/=t,e.m22/=t,e.m23/=t,e.m24/=t,e.m31/=t,e.m32/=t,e.m33/=t,e.m34/=t,e.m41/=t,e.m42/=t,e.m43/=t,e.m44/=t;}},{key:"getTranslation",value:function value(){return YO(this.m41,this.m42,this.m43);}},{key:"getRotation",value:function value(){var e=this,t=.5*Math.pow(e.m11+e.m22+e.m33+1,.5);return KO(.25*(e.m23-e.m32)/t,.25*(e.m31-e.m13)/t,.25*(e.m12-e.m21)/t,t);}},{key:"getScaling",value:function value(){var e=this;return YO(NE(e.m11,e.m12,e.m13),NE(e.m21,e.m22,e.m23),NE(e.m31,e.m32,e.m33));}},{key:"toEuler",value:function value(){var e=this.getRotation().toEuler();return YO(e.x,e.y,e.z);}}],[{key:"fromQuat",value:function value(t){var i=t.x,r=t.y,n=t.z,o=t.w,a=new e();return a.m11=1-2*(r*r+n*n),a.m12=2*(i*r+n*o),a.m13=2*(i*n-r*o),a.m21=2*(i*r-n*o),a.m22=1-2*(i*i+n*n),a.m23=2*(r*n+i*o),a.m31=2*(i*n+r*o),a.m32=2*(r*n-i*o),a.m33=1-2*(i*i+r*r),a.setFromMatrix(a),a;}},{key:"fromMatrix",value:function value(t){var i=new e();return i.setFromMatrix(t),i.is2D=!!t.is2D,i;}},{key:"fromFloat32Array",value:function value(t){var i=new e();return oL(t,i),i;}},{key:"fromFloat64Array",value:function value(t){var i=new e();return oL(t,i),i;}}]);}();function iL(e,t,i,r){return{x:i*e.x+r*t.x,y:i*e.y+r*t.y,z:i*e.z+r*t.z};}function rL(e){var t;if(e.length!==e[0].length)throw new Error();var i=e.length,r=0;if(i>3)for(var n=0;n<i;n++)r+=e[0][n]*nL(e,0,n);else 3===i?r=e[0][0]*e[1][1]*e[2][2]+e[0][1]*e[1][2]*e[2][0]+e[0][2]*e[1][0]*e[2][1]-e[0][2]*e[1][1]*e[2][0]-e[0][1]*e[1][0]*e[2][2]-e[0][0]*e[1][2]*e[2][1]:2===i?r=e[0][0]*e[1][1]-e[0][1]*e[1][0]:1===i&&(t=Ab(e,1),r=Ab(t[0],1)[0]);return r;}function nL(e){for(var t,i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=e.length,a=QE(t=hP(i=new Array(o-1)).call(i,0)).call(t,function(e){var t;return hP(t=new Array(o-1)).call(t,0);}),s=0;s<o-1;s++)for(var l=0;l<o-1;l++){var u=s<r?s:s+1,c=l<n?l:l+1;a[s][l]=e[u][c];}return Math.pow(-1,r+n)*rL(a);}function oL(e,t){var i=Ab(e,16),r=i[0],n=i[1],o=i[2],a=i[3],s=i[4],l=i[5],u=i[6],c=i[7],h=i[8],d=i[9],f=i[10],v=i[11],g=i[12],m=i[13],y=i[14],p=i[15];if(6===e.length)t.m11=r,t.m12=n,t.m21=o,t.m22=a,t.m41=s,t.m42=l,t.m13=0,t.m14=0,t.m23=0,t.m24=0,t.m31=0,t.m32=0,t.m34=0,t.m33=1,t.m44=1,t.is2D=!0;else{if(16!==e.length)throw new Error();t.m11=r,t.m12=n,t.m13=o,t.m14=a,t.m21=s,t.m22=l,t.m23=u,t.m24=c,t.m31=h,t.m32=d,t.m33=f,t.m34=v,t.m41=g,t.m42=m,t.m43=y,t.m44=p,t.is2D=!1;}}function aL(e,t){var i={},r=e.m11,n=e.m21,o=e.m31,a=e.m41,s=e.m12,l=e.m22,u=e.m32,c=e.m42,h=e.m13,d=e.m23,f=e.m33,v=e.m43,g=e.m14,m=e.m24,y=e.m34,p=e.m44,w=t.m11,b=t.m21,k=t.m31,S=t.m41,x=t.m12,C=t.m22,V=t.m32,T=t.m42,I=t.m13,E=t.m23,P=t.m33,B=t.m43,D=t.m14,M=t.m24,A=t.m34,U=t.m44;return i.m11=r*w+n*x+o*I+a*D,i.m21=r*b+n*C+o*E+a*M,i.m31=r*k+n*V+o*P+a*A,i.m41=r*S+n*T+o*B+a*U,i.m12=s*w+l*x+u*I+c*D,i.m22=s*b+l*C+u*E+c*M,i.m32=s*k+l*V+u*P+c*A,i.m42=s*S+l*T+u*B+c*U,i.m13=h*w+d*x+f*I+v*D,i.m23=h*b+d*C+f*E+v*M,i.m33=h*k+d*V+f*P+v*A,i.m43=h*S+d*T+f*B+v*U,i.m14=g*w+m*x+y*I+p*D,i.m24=g*b+m*C+y*E+p*M,i.m34=g*k+m*V+y*P+p*A,i.m44=g*S+m*T+y*B+p*U,i;}function sL(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,1];e=FO(e);var i=Math.sin(e/2)*Math.cos(e/2),r=Math.pow(Math.sin(e/2),2),n=Ab(t,3),o=n[0],a=n[1],s=n[2];return{m11:1-2*(Math.pow(a,2)+Math.pow(s,2))*r,m21:2*(o*a*r-s*i),m31:2*(o*s*r+a*i),m41:0,m12:2*(o*a*r+s*i),m22:1-2*(Math.pow(o,2)+Math.pow(a,2))*r,m32:2*(a*s*r-o*i),m42:0,m13:2*(o*s*r-a*i),m23:2*(a*s*r+o*i),m33:1-2*(Math.pow(o,2)+Math.pow(a,2))*r,m43:0,m14:0,m24:0,m34:0,m44:1};}function lL(e,t){var i=new tL();return e&&(i.m21=Math.tan(FO(e))),t&&(i.m12=Math.tan(FO(t))),i;}function uL(e,t,i){var r=e.x-t.x,n=e.y-t.y,o=(i.x-e.x)*r+(i.y-e.y)*n;return o/=r*r+n*n,new qO(e.x+o*r,e.y+o*n);}function cL(e,t){return Math.pow(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2),.5);}function hL(e,t,i){return(i.x-e.x)*(t.y-e.y)===(t.x-e.x)*(i.y-e.y)&&Math.min(e.x,t.x)<=i.x&&i.x<=Math.max(e.x,t.x)&&Math.min(e.y,t.y)<=i.y&&i.y<=Math.max(e.y,t.y);}var dL=function(){return Yk(function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;Xk(this,e),Wk(this,"x",0),Wk(this,"y",0),Wk(this,"left",0),Wk(this,"top",0),Wk(this,"right",0),Wk(this,"bottom",0),Wk(this,"width",0),Wk(this,"height",0),this.update(t,i,r,n);},[{key:"update",value:function value(e,t,i,r){this.x=e,this.y=t,this.left=e,this.top=t,this.right=e+i,this.bottom=t+r,this.width=i,this.height=r;}},{key:"toJSON",value:function value(){}}]);}();function fL(e,t,i,r,n){var o=Math.cos,a=Math.sin;return{x:(e-i)*o(n)-(t-r)*a(n)+i,y:(e-i)*a(n)+(t-r)*o(n)+r};}var vL=function(){return Yk(function e(t){Xk(this,e),Wk(this,"uid",void 0),Wk(this,"children",void 0),this.uid=t.uid,this.children=t.children||[];},[{key:"append",value:function value(e){var t=this.children;return WI(t).call(t,e)<0&&(t.push(e),!0);}},{key:"insert",value:function value(e,t){var i=this.children;return!(t<0||(t>i.length&&(t=i.length),mE(i).call(i,t,0,e),0));}},{key:"remove",value:function value(e){var t=this.children,i=WI(t).call(t,e);return!(i<0||(mE(t).call(t,i,1),0));}},{key:"clear",value:function value(){return this.children=[],!0;}},{key:"move",value:function value(e,t){if(e===t)return!0;var i=this.children,r=Ab(mE(i).call(i,e,1),1)[0];return mE(i).call(i,t,0,r),!0;}},{key:"switch",value:function value(e,t){if(e===t)return!0;var i=this.children,r=i[e];return i[e]=i[t],i[t]=r,!0;}},{key:"reorder",value:function value(e){var t=this.children,i=e.length,r=[],n=0;if(t.length!==i||0===i)return!1;for(var o=0;o<i;o++)e[o]===o&&(n+=1);if(n===i)return!0;for(var a=0;a<i;a++)r[a]=t[e[a]];for(var s=0;s<i;s++)t[s]=r[s];return!0;}}]);}(),gL=function(){return Yk(function e(){Xk(this,e),Wk(this,"strategies",{});},[{key:"executeStrategy",value:function value(e){for(var t,i,r,n=arguments.length,o=new Array(n>1?n-1:0),a=1;a<n;a++)o[a-1]=arguments[a];return null===(t=(i=this.strategies)[e])||void 0===t?void 0:t.call.apply(t,uS(r=[i]).call(r,o));}},{key:"addStrategy",value:function value(e,t){var i=this.strategies;return!i[e]&&(i[e]=t,!0);}}]);}(),mL=new(function(){return Yk(function e(){Xk(this,e),Wk(this,"tasks",[]);},[{key:"createTimer",value:function value(e,t){var i=rO();return this.tasks.push({uid:i,callback:e,time:t}),this.executeTimer(i),i;}},{key:"executeTimer",value:function value(e){var t,i=CP(t=this.tasks).call(t,function(t){return t.uid===e;});if(i){var _r2=function r(){i.callback(),null!==i.timer&&(i.timer=YP(_r2,i.time));};i.timer=YP(_r2,i.time);}}},{key:"clearTimer",value:function value(e){var t,i,r=PE(t=this.tasks).call(t,function(t){return t.uid===e;});r>-1&&(clearTimeout(this.tasks[r].timer),this.tasks[r].timer=null,mE(i=this.tasks).call(i,r,1));}}]);}())(),yL=function(){return Yk(function e(t,i){Xk(this,e),Wk(this,"isDestroyed",!1),Wk(this,"data",void 0),Wk(this,"table",["database","table","item"]),Wk(this,"dbName",void 0),Wk(this,"tableName",void 0),this.data={},this.dbName=t,this.tableName=i,this.createDatabase(t,i);},[{key:"destroy",value:function value(){if(!this.isDestroyed){for(var e=0,t=aB(this.data);e<t.length;e++){var i=Ab(t[e],2),r=i[0];i[1],this.data[r]=null;}this.data=null,this.isDestroyed=!0;}}},{key:"createDatabase",value:function value(e,t){this.data[e]={},this.data[e][t]={};}},{key:"set",value:function value(e,t){var i=this,r=this.dbName,n=this.tableName;return new uB(function(o,a){i.checkId(e)?a(new Error("The ".concat(e," already exists."))):(i.data[r][n][e]=t,o("Save ".concat(e," to database successful.")));});}},{key:"get",value:function value(e){var t=this,i=this.dbName,r=this.tableName;return new uB(function(n,o){t.checkId(e)?n(t.data[i][r][e]):o(t.erMsg(2,e));});}},{key:"remove",value:function value(e){var t=this,i=this.dbName,r=this.tableName;return new uB(function(n,o){delete t.data[i][r][e],n("Remove ".concat(e," successful."));});}},{key:"update",value:function value(e,t){var i=this,r=this.dbName,n=this.tableName;return new uB(function(o,a){i.checkId(e)?(i.data[r][n][e]=t,o("Update ".concat(e," successful."))):a(i.erMsg(2,e));});}},{key:"checkId",value:function value(e){var t=this.dbName,i=this.tableName;return void 0!==this.data[t][i][e];}},{key:"erMsg",value:function value(e,t){var i;return uS(i="The ".concat(this.table[e]," ")).call(i,t," does not exist.");}}]);}(),pL=function(){return Yk(function e(){Xk(this,e),Wk(this,"isDestroyed",!1),Wk(this,"data",void 0),this.data={};},[{key:"destroy",value:function value(){if(!this.isDestroyed){for(var e=0,t=aB(this.data);e<t.length;e++){var i,r=Ab(t[e],2),n=r[0];r[1],null!==(i=this.data[n])&&void 0!==i&&i.destroy(),this.data[n]=null;}this.data=null,this.isDestroyed=!0;}}},{key:"set",value:function value(e,t){return!this.check(e)&&(this.data[e]=t,!0);}},{key:"get",value:function value(e){return this.data[e];}},{key:"remove",value:function value(e){return!!this.check(e)&&(delete this.data[e],!0);}},{key:"update",value:function value(e,t){return!!this.check(e)&&(this.data[e]=t,!0);}},{key:"check",value:function value(e){return void 0!==this.data[e];}}]);}(),wL=function(e){function t(e){var i;return Xk(this,t),Wk(Pw(i=IN(this,t,[e])),"name",void 0),Wk(Pw(i),"type",void 0),Wk(Pw(i),"fileType",void 0),Wk(Pw(i),"createdDate",void 0),Wk(Pw(i),"modifiedDate",void 0),Wk(Pw(i),"parent",void 0),Wk(Pw(i),"isRoot",!1),i.name=e.name,i.type=e.type,i.fileType=e.fileType,i.parent=e.parent||null,i.isRoot=e.isRoot||!1,i.createdDate=FN(),i.modifiedDate=i.createdDate,i;}return Mb(t,e),Yk(t,[{key:"updateDate",value:function value(){this.modifiedDate=FN();}},{key:"setName",value:function value(e){this.name=e;}},{key:"reorder",value:function value(e){var i=this.type;return("file"===i||"default"===i)&&EN(t,"reorder",this,3)([e]);}}]);}(vL),bL=function(){return Yk(function e(){Xk(this,e),Wk(this,"root",void 0),Wk(this,"currentNode",void 0),Wk(this,"selectedUid",void 0),Wk(this,"defaultNode",void 0),Wk(this,"hooks",{fileChanged:HO.create(),beforeRemoveFile:HO.create(),removeFile:HO.create(),afterRemoveFile:HO.create(),afterRenameFile:HO.create(),destroy:HO.create()}),this.root=new wL({uid:rO(),children:[],name:"root",type:"file",fileType:"folder",parent:void 0,isRoot:!0}),this.defaultNode=this.root,this.currentNode=this.root;},[{key:"appendChildrenToFile",value:function value(e,t,i){var r=i,n=kL(this.defaultNode,e);return n||(n=this.createFile(e),this.hooks.fileChanged.emit(this.defaultNode)),$k(t).call(t,function(e){HN(r)?n.append(e):(n.insert(e,r),r+=1);}),n;}},{key:"removeChildFromFile",value:function value(e,t){jN(t)&&(t=[t]);var i=this.getFileByUid(e);i&&$k(t).call(t,function(e){i.remove(e);});}},{key:"findChild",value:function value(e,t){var i;return CP(i=e.children).call(i,function(e){return e.name===t;});}},{key:"createFile",value:function value(e){var t=this.defaultNode;t||(t=this.root);var i=kL(t,e);return i&&"file"===i.type||(i=new wL({uid:rO(),children:[],name:e,type:"file",fileType:"file",parent:t,isRoot:!1}),this.currentNode.append(i),this.hooks.fileChanged.emit(this.currentNode.children)),i;}},{key:"removeFile",value:function value(e){for(var t=this.defaultNode.children,i=0;i<t.length;i++){var r=t[i];if(r.name===e)return this.hooks.beforeRemoveFile.emit(r),mE(t).call(t,i,1),this.hooks.afterRemoveFile.emit(r),this.hooks.fileChanged.emit(r),!0;}return!1;}},{key:"renameFile",value:function value(e,t){var i=this.findChild(this.defaultNode,e),r=this.findChild(this.defaultNode,t);return!!i&&!r&&(i.name=t,this.hooks.afterRenameFile.emit(i),this.hooks.fileChanged.emit(this.currentNode.children),!0);}},{key:"getFile",value:function value(e){return this.findChild(this.defaultNode,e);}},{key:"getFileByUid",value:function value(e){return CP(this).call(this,e,this.root);}},{key:"getCurrentFileList",value:function value(){return this.currentNode.children;}},{key:"isFileExist",value:function value(e){return!!this.findChild(this.defaultNode,e);}},{key:"createFolder",value:function value(){}},{key:"find",value:function value(e,t){for(var i=t.children,r=i.length,n=0;n<r;n++){if(i[n].uid===e)return i[n];if(i[n].children){var o=CP(this).call(this,e,i[n]);if(o)return o;}}return null;}}]);}();function kL(e,t){var i,r=yx(i=e.children).call(i,function(e){return e.name===t;});return 0===r.length?null:r[0];}var SL,xL=function(e){function t(e){var i;return Xk(this,t),Wk(Pw(i=IN(this,t,[e])),"name",void 0),Wk(Pw(i),"type","tag"),i.name=e.name,i.uid=e.uid||rO(),i.type="tag",i;}return Mb(t,e),Yk(t);}(vL),CL=function(){return Yk(function e(){Xk(this,e),Wk(this,"tags",void 0),Wk(this,"defaultName",void 0),Wk(this,"defaultUid",void 0),Wk(this,"selectedUid",void 0),Wk(this,"emptyItem",void 0),Wk(this,"hooks",{beforeRemoveTag:HO.create(),afterRenameTag:HO.create(),destroy:HO.create(),load:HO.create()}),this.tags=[],this.defaultName=null,this.defaultUid=null,this.selectedUid=null,this.emptyItem=new xL({name:"defaultTag",children:[]});},[{key:"appendChildToTag",value:function value(e,t){var i=this.createTag(e);jN(t)&&(t=[t]);var r=!1;return $k(t).call(t,function(e){i.append(e)&&(r=!0);}),r;}},{key:"removeChildFromTag",value:function value(e,t){var i=this.getTag(e);return!!i&&(jN(t)&&(t=[t]),$k(t).call(t,function(e){i.remove(e);}),!0);}},{key:"createTag",value:function value(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=this.getTag(e);return i||(i=new xL({name:e,children:t}),this.tags.push(i)),i;}},{key:"removeTag",value:function value(e){var t,i,r=this.getTag(e);if(!r)return!1;this.hooks.beforeRemoveTag.emit(r);var n=PE(t=this.tags).call(t,function(t){return t.name===e;});return e===this.defaultName&&(this.defaultName=null,this.selectedUid=null),mE(i=this.tags).call(i,n,1),!0;}},{key:"renameTag",value:function value(e,t){if(!jN(e)||!jN(t))return!1;var i=this.isTagExisted(t),r=this.getTag(e);return!(!r||i||(r.name=t,this.hooks.afterRenameTag.emit(r),0));}},{key:"getTag",value:function value(e){var t;return CP(t=this.tags).call(t,function(t){return t.name===e;});}},{key:"getTagByUid",value:function value(e){var t;return CP(t=this.tags).call(t,function(t){return t.uid===e;});}},{key:"getTagList",value:function value(){var e;return NI(e=this.tags).call(e);}},{key:"setDefaultTag",value:function value(e){if(!e)return this.defaultName=null,this.defaultUid=null,!0;var t=this.getTag(e);return!!t&&(this.defaultName=e,this.defaultUid=t.uid,!0);}},{key:"getDefaultTag",value:function value(){return this.defaultName;}},{key:"isTagExisted",value:function value(e){return!!this.getTag(e);}}]);}(),VL=function(){return Yk(function e(){Xk(this,e);},[{key:"apply",value:function value(e){var t=e.hooks,i={beforeStatus:null,afterStatus:null,operation:null,docUid:null},r=function r(e){i.beforeStatus={uids:e.uids,selectedUids:[],currentUid:"",modifiedUid:e.modifiedUid,removedUids:e.removedUids};},n=function n(t){i.afterStatus={uids:t.uids,selectedUids:[],currentUid:"",modifiedUid:t.modifiedUid,removedUids:t.removedUids},i.docUid=t.docUid,i.operation=t.operation,i.docType=t.docType,i.docName=t.docName,e.emit("bufferChanged",Fk({},i)),i={beforeStatus:null,afterStatus:null,operation:null,docUid:null};};t.beforeBufferChanged.on(r),t.afterBufferChanged.on(n),t.destroy.on(function(){t.beforeBufferChanged.off(r),t.afterBufferChanged.off(n);});}}]);}(),TL=function(){return Yk(function e(){Xk(this,e);},[{key:"apply",value:function value(e){var t=e.hooks;e.customStore=new pL();var i=function i(t){var i=t.data;$k(i).call(i,function(t){var i=t.customData;i||(i={}),e.customStore.set(t.uid,i);});},r=function r(t){var i=t.removedUids;$k(i).call(i,function(t){e.customStore.remove(t);});},n=function n(t){var i=t.data.customData;i&&e.customStore.update(t.modifiedUid,i);};t.loadSource.on(i),t.removeSource.on(r),t.updateSource.on(n),t.destroy.on(function(){t.loadSource.off(i),t.removeSource.off(r),t.updateSource.off(n);});}}]);}(),IL=function(e){function t(){var e;return Xk(this,t),Wk(e=IN(this,t,[{uid:rO(),children:[]}]),"name","dvs-default"),Wk(e,"isDestroyed",!1),Wk(e,"type",void 0),e;}return Mb(t,e),Yk(t,[{key:"destroy",value:function value(){this.isDestroyed||(this.isDestroyed=!0);}}]);}(vL),EL=function(){return Yk(function e(){Xk(this,e);},[{key:"apply",value:function value(e){e.defaultFile=new IL();var t=e.hooks,i=function i(t){var i,r,n,o=t.filename,a=t.index,s=t.data;if(HN(o)){var l=QE(s).call(s,function(e){return e.uid;});void 0===a?(i=e.defaultFile.children).push.apply(i,Ub(l)):mE(r=e.defaultFile.children).apply(r,uS(n=[a,0]).call(n,Ub(l)));var u={docUid:e.defaultFile.uid,sourceUids:l,type:"default",index:a};e.hooks.loadToDoc.emit(u);}},r=function r(t){var i=t.removedUids,r=[];$k(i).call(i,function(t){var i=e.statusStore.get(t);i&&i.ownerDefaultFile&&(e.defaultFile.remove(t),r.push(t));}),r.length&&e.hooks.removeFromDoc.emit({docUid:e.defaultFile.uid,sourceUids:i,type:"default"});};t.loadSource.on(i),t.removeSource.on(r),t.destroy.on(function(){t.loadSource.off(i),t.removeSource.off(r);});}}]);}(),PL=function(){return Yk(function e(){Xk(this,e);},[{key:"apply",value:function value(e){e.dir=new bL(),this.listenDirectoryHooks(e),this.listenSpaceHooks(e);}},{key:"listenDirectoryHooks",value:function value(e){var t=e.dir.hooks,i=function i(t){var i;$k(i=t.children).call(i,function(i){var r=e.statusStore.get(i);r&&r.ownerFiles.remove(t.uid);}),e.hooks.removeDoc.emit(t);},r=function r(t){e.hooks.renameDoc.emit(t);};t.beforeRemoveFile.on(i),t.afterRenameFile.on(r),t.destroy.on(function(){t.beforeRemoveFile.off(i),t.afterRenameFile.off(r);});}},{key:"listenSpaceHooks",value:function value(e){var t=e.hooks,i=function i(t){var i=t.data,r=t.filename,n=t.index;if(!HN(r)){var o=e.dir.getFile(r);e.hooks.beforeBufferChanged.emit({docType:"file",docUid:null==o?void 0:o.uid,uids:Ub((null==o?void 0:o.children)||[]),operation:"add"});var a=QE(i).call(i,function(e){return e.uid;}),s=e.dir.appendChildrenToFile(r,a,n),l={docUid:s.uid,sourceUids:a,type:"file",index:n};e.hooks.loadToDoc.emit(l),e.hooks.afterBufferChanged.emit({docType:"file",docName:r,docUid:null==s?void 0:s.uid,uids:Ub((null==s?void 0:s.children)||[]),operation:"add"});}},r=function r(t){var i=t.removedUids,r={};$k(i).call(i,function(t){var i,n,o=e.statusStore.get(t);o&&$k(i=NI(n=o.ownerFiles.children).call(n)).call(i,function(e){r[e]||(r[e]=[]),r[e].push(t);});});for(var n=0,o=aB(r);n<o.length;n++){var a=Ab(o[n],2),s=a[0],l=a[1],u=e.dir.getFileByUid(s);u&&(e.hooks.beforeBufferChanged.emit({docUid:s,uids:Ub(u.children),removedUids:Ub(l),operation:"remove"}),e.dir.removeChildFromFile(s,l),e.hooks.afterBufferChanged.emit({docType:"file",docName:u.name,docUid:s,uids:Ub(u.children),removedUids:Ub(l),operation:"remove"})),e.hooks.removeFromDoc.emit({docUid:s,sourceUids:l});}},n=function n(t){var i,r,n=e.statusStore.get(t.modifiedUid);n&&$k(i=NI(r=n.ownerFiles.children).call(r)).call(i,function(i){var r=e.dir.getFileByUid(i);r&&(e.hooks.beforeBufferChanged.emit({uids:Ub(r.children),modifiedUid:t.modifiedUid,operation:"modify"}),e.hooks.afterBufferChanged.emit({docType:"file",docName:r.name,docUid:i,uids:Ub(r.children),modifiedUid:t.modifiedUid,operation:"modify"}));});};t.loadSource.on(i),t.removeSource.on(r),t.updateSource.on(n),t.destroy.on(function(){t.loadSource.off(i),t.removeSource.off(r),t.updateSource.off(n);});}}]);}(),BL=function(){return Yk(function e(){Xk(this,e);},[{key:"apply",value:function value(e){var t=e.hooks;e.metadataStore=new pL();var i=function i(t){var i=t.data;$k(i).call(i,function(t){var i=t.metadata;i||(i={width:void 0,height:void 0}),e.metadataStore.set(t.uid,i);});},r=function r(t){var i=t.removedUids;$k(i).call(i,function(t){e.metadataStore.remove(t);});},n=function n(t){var i=t.data.metadata;i&&e.metadataStore.update(t.modifiedUid,i);};t.loadSource.on(i),t.removeSource.on(r),t.updateSource.on(n),t.destroy.on(function(){t.loadSource.off(i),t.removeSource.off(r),t.updateSource.off(n);});}}]);}(),DL=function(){return Yk(function e(t){Xk(this,e),Wk(this,"uid",null),Wk(this,"minData",null),Wk(this,"oriData",null),Wk(this,"customData",{}),Wk(this,"activeOri",!1),Wk(this,"activeMin",!1),Wk(this,"minTask",null),Wk(this,"oriTask",null),Wk(this,"load",!1),Wk(this,"preload",[]),Wk(this,"visible",[]),Wk(this,"overlays",[]),Wk(this,"img",null),Wk(this,"minImg",null),Wk(this,"imageScale",1),Wk(this,"owners",[]),Wk(this,"oriType",null),Wk(this,"minType",null),Wk(this,"metadata",null),Wk(this,"realTimeWidth",0),Wk(this,"realTimeHeight",0),Wk(this,"isFromFile",!1),Wk(this,"isCached",!1),Wk(this,"isDestroyed",!1),Wk(this,"isLoading",!1),Wk(this,"isMinLoading",!1),Wk(this,"isSaving",!1),Wk(this,"annotations",void 0),Wk(this,"ownerFiles",new vL({children:[]})),Wk(this,"ownerTags",new vL({children:[]})),Wk(this,"ownerDefaultFile",void 0),Wk(this,"operations",[]),Wk(this,"useFillColor",!1),this.uid=t.uid,this.metadata=Fk({},t.metadata),this.setRealTimeSize(this.metadata.width,this.metadata.height);},[{key:"setRealTimeSize",value:function value(e,t){this.realTimeWidth=e,this.realTimeHeight=t;}},{key:"destroy",value:function value(){this.isDestroyed||(this.customData=null,this.img=null,this.owners=null,this.metadata=null,this.isDestroyed=!0);}},{key:"addOwner",value:function value(e){var t=this.owners;WI(t).call(t,e)<0&&t.push(e);}},{key:"removeOwner",value:function value(e){var t=this.owners,i=WI(t).call(t,e);i>-1&&mE(t).call(t,i,1);}},{key:"removeViewer",value:function value(e){var t=this.owners,i=WI(t).call(t,e);i>-1&&mE(t).call(t,i,1);}},{key:"setVisible",value:function value(e){var t;WI(t=this.visible).call(t,e)<0&&this.visible.push(e);}},{key:"cancelVisible",value:function value(e){var t,i,r=WI(t=this.visible).call(t,e);r>-1&&mE(i=this.visible).call(i,r,1);}},{key:"setPreload",value:function value(e){var t;WI(t=this.preload).call(t,e)<0&&this.preload.push(e);}},{key:"cancelPreload",value:function value(e){var t,i,r=WI(t=this.preload).call(t,e);r>-1&&mE(i=this.preload).call(i,r,1);}},{key:"reset",value:function value(){this.minData=null,this.oriData=null,this.img=null,this.activeOri=!1,this.activeMin=!1,this.minTask=null,this.oriTask=null,this.operations=[];}}]);}(),ML=function(){return Yk(function e(){Xk(this,e);},[{key:"apply",value:function value(e){var t=e.hooks;e.statusStore=new pL();var i=function i(t){var i=t.data;t.filename,t.index,$k(i).call(i,function(t){var i=new DL(t);e.statusStore.set(t.uid,i);});},r=function r(t){var i=t.removedUids;$k(i).call(i,function(t){var i,r,n=e.statusStore.get(t);n&&(zO(n.minData),zO(n.oriData),n.ownerFiles.clear(),n.ownerTags.clear(),n.ownerDefaultFile=!1,null!==(i=n.img)&&void 0!==i&&i.src&&(n.img.src=""),null!==(r=n.minImg)&&void 0!==r&&r.src&&(n.minImg.src=""),n.img=null,n.minImg=null),e.statusStore.remove(t);});},n=function n(t){var i=t.modifiedUid,r=t.data,n=t.revoke,o=e.statusStore.get(i);if(o){o.img=null,o.minImg=null;var a=r.metadata;a&&(o.metadata=Fk({},a),o.setRealTimeSize(a.width,a.height)),n&&(zO(o.oriData),zO(o.minData)),o.reset(),e.statusStore.update(i,o);}},o=function o(t){var i;$k(i=t.children).call(i,function(i){var r=e.statusStore.get(i);r&&("file"===t.type?r.ownerFiles.remove(t.uid):"tag"===t.type&&r.ownerTags.remove(t.uid));});},a=function a(t){var i=t.docUid,r=t.sourceUids,n=t.type;$k(r).call(r,function(t){var r=e.statusStore.get(t);r&&("file"===n?r.ownerFiles.append(i):"tag"===n?r.ownerTags.append(i):"default"===n&&(r.ownerDefaultFile=!0));});},s=function s(t){var i=t.docUid,r=t.sourceUids,n=t.type;$k(r).call(r,function(t){var r=e.statusStore.get(t);r&&("file"===n?r.ownerFiles.remove(i):"tag"===n?r.ownerTags.remove(i):"default"===n&&(r.ownerDefaultFile=!0));});};t.loadSource.on(i),t.afterRemoveSource.on(r),t.updateSource.on(n),t.removeDoc.on(o),t.loadToDoc.on(a),t.removeFromDoc.on(s),t.destroy.on(function(){t.loadSource.off(i),t.afterRemoveSource.off(r),t.updateSource.off(n),t.removeDoc.off(o),t.loadToDoc.off(a),t.removeFromDoc.off(s);});}}]);}(),AL=function(){return Yk(function e(){Xk(this,e);},[{key:"apply",value:function value(e){var t=e.hooks;e.store=new yL("space_db","space_doc");var i=function i(t){var i=t.data;i&&$k(i).call(i,function(t){e.store.set(t.uid,t);});},r=function r(t){var i;$k(i=t.removedUids).call(i,function(t){e.store.remove(t);});},n=function n(t){e.store.update(t.modifiedUid,t.data);};t.loadSource.on(i),t.removeSource.on(r),t.updateSource.on(n),t.destroy.on(function(){t.loadSource.off(i),t.removeSource.off(r),t.updateSource.off(n);});}}]);}(),UL=function(){return Yk(function e(){Xk(this,e);},[{key:"apply",value:function value(e){e.tag=new CL(),this.listenSpaceHooks(e),this.listenTagHooks(e);}},{key:"listenTagHooks",value:function value(e){var t=e.tag.hooks,i=function i(t){var i;$k(i=t.children).call(i,function(i){var r=e.statusStore.get(i);r&&r.ownerFiles.remove(t.uid);}),e.hooks.removeDoc.emit(t);},r=function r(t){e.hooks.renameDoc.emit(t);};t.beforeRemoveTag.on(i),t.afterRenameTag.on(r),t.destroy.on(function(){t.beforeRemoveTag.off(i),t.afterRenameTag.off(r);});}},{key:"listenSpaceHooks",value:function value(e){var t=e.hooks,i=function i(t){var i=t.data,r=e.tag.defaultName;$k(i).call(i,function(e){var t;(e.tags||(e.tags=[]),r)&&WI(t=e.tags).call(t,r)<0&&e.tags.push(r);});},r=function r(t){var i=t.data;$k(i).call(i,function(t){var i;null!==(i=t.tags)&&void 0!==i&&$k(i).call(i,function(i){var r=e.tag.getTag(i);e.hooks.beforeBufferChanged.emit({uids:Ub((null==r?void 0:r.children)||[]),operation:"add"}),e.tag.appendChildToTag(i,t.uid);var n=e.tag.getTag(i),o={docUid:n.uid,sourceUids:[t.uid],type:"tag"};e.hooks.loadToDoc.emit(o),e.hooks.afterBufferChanged.emit({docType:"tag",docName:i,docUid:null==n?void 0:n.uid,uids:Ub((null==n?void 0:n.children)||[]),operation:"add"});}),t.tags.length=0;});},n=function n(t){var i=t.removedUids,r={};$k(i).call(i,function(t){var i,n,o=e.statusStore.get(t);o&&$k(i=NI(n=o.ownerTags.children).call(n)).call(i,function(e){r[e]||(r[e]=[]),r[e].push(t);});});for(var n=0,o=aB(r);n<o.length;n++){var a=Ab(o[n],2),s=a[0],l=a[1],u=e.tag.getTagByUid(s);u&&(e.hooks.beforeBufferChanged.emit({uids:Ub(u.children),removedUids:Ub(l),operation:"remove"}),e.tag.removeChildFromTag(u.name,l),e.hooks.afterBufferChanged.emit({docType:"tag",docName:u.name,docUid:s,uids:Ub(u.children),removedUids:Ub(l),operation:"remove"})),e.hooks.removeFromDoc.emit({docUid:s,sourceUids:l,type:"tag"});}},o=function o(e){"tag"!==e.type&&n({removedUids:e.children});},a=function a(t){var i=t.docUid,r=t.sourceUids;if("tag"===t.type){var n=e.tag.getTagByUid(i);n&&$k(r).call(r,function(){var t=Ew(VN().m(function t(i){var r,o;return VN().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,e.store.get(i);case 1:if(o=t.v,!(o&&WI(r=o.tags).call(r,n.name)<0)){t.n=2;break;}return o.tags.push(n.name),t.n=2,e.store.update(i,o);case 2:t.n=4;break;case 3:t.p=3,t.v,console.log();case 4:return t.a(2);}},t,null,[[0,3]]);}));return function(e){return t.apply(this,arguments);};}());}},s=function s(t){var i=t.docUid,r=t.sourceUids;if("tag"===t.type){var n=e.tag.getTagByUid(i);n&&$k(r).call(r,function(){var t=Ew(VN().m(function t(i){var r,o,a,s;return VN().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,e.store.get(i);case 1:if(!(r=t.v)){t.n=2;break;}return(s=WI(o=r.tags).call(o,n.name))>-1&&mE(a=r.tags).call(a,s,1),t.n=2,e.store.update(i,r);case 2:t.n=4;break;case 3:t.p=3,t.v,console.log();case 4:return t.a(2);}},t,null,[[0,3]]);}));return function(e){return t.apply(this,arguments);};}());}},l=function l(t){var i,r,n=e.statusStore.get(t.modifiedUid);n&&$k(i=NI(r=n.ownerTags.children).call(r)).call(i,function(i){var r=e.tag.getTagByUid(i);r&&(e.hooks.beforeBufferChanged.emit({uids:Ub(r.children),modifiedUid:t.modifiedUid,operation:"modify"}),e.hooks.afterBufferChanged.emit({docType:"tag",docName:r.name,docUid:i,uids:Ub(r.children),modifiedUid:t.modifiedUid,operation:"modify"}));});};t.beforeLoadSource.on(i),t.loadSource.on(r),t.removeSource.on(n),t.removeDoc.on(o),t.loadToDoc.on(a),t.removeFromDoc.on(s),t.updateSource.on(l),t.destroy.on(function(){t.beforeLoadSource.off(i),t.loadSource.off(r),t.removeSource.off(n),t.removeDoc.off(o),t.loadToDoc.off(a),t.removeFromDoc.off(s),t.updateSource.off(l);});}}]);}(),zL=function(e){function t(){var e;return Xk(this,t),Wk(Pw(e=IN(this,t)),"uid",rO()),Wk(Pw(e),"hooks",{init:HO.create(),destroy:HO.create(),beforeLoadSource:HO.create(),loadSource:HO.create(),afterLoadSource:HO.create(),beforeRemoveSource:HO.create(),removeSource:HO.create(),afterRemoveSource:HO.create(),beforeUpdateSource:HO.create(),updateSource:HO.create(),afterUpdateSource:HO.create(),beforeBufferChanged:HO.create(),afterBufferChanged:HO.create(),directoryChanged:HO.create(),tagChanged:HO.create(),openDoc:HO.create(),loadToDoc:HO.create(),removeFromDoc:HO.create(),removeDoc:HO.create(),renameDoc:HO.create(),move:HO.create(),afterMove:HO.create(),switch:HO.create(),afterSwitch:HO.create(),reorder:HO.create(),afterReorder:HO.create()}),Wk(Pw(e),"dir",void 0),Wk(Pw(e),"tag",void 0),Wk(Pw(e),"store",void 0),Wk(Pw(e),"customStore",void 0),Wk(Pw(e),"metadataStore",void 0),Wk(Pw(e),"statusStore",void 0),Wk(Pw(e),"defaultFile",void 0),Wk(Pw(e),"plugins",[]),Wk(Pw(e),"imageLoader",void 0),e.initPlugins(),e.hooks.init.emit(),e;}return Mb(t,e),Yk(t,[{key:"destroy",value:function value(){this.hooks.destroy.emit();}},{key:"initPlugins",value:function value(){new AL().apply(this),new ML().apply(this),new TL().apply(this),new BL().apply(this),new VL().apply(this),new EL().apply(this),new PL().apply(this),new UL().apply(this);}},{key:"setImageLoader",value:function value(e){this.imageLoader=e;}},{key:"getCustomData",value:function value(e){return this.customStore.get(e);}},{key:"setCustomData",value:function value(e,t){return this.customStore.set(e,t);}},{key:"getMetadata",value:function value(e){return this.metadataStore.get(e);}},{key:"setMetadata",value:function value(e,t){return this.metadataStore.set(e,t);}},{key:"createStore",value:function value(e){var t=e.type,i=void 0===t?"sync":t,r=e.tableName,n=e.dbName;return"sync"===i?new pL():n&&r?new yL(n,r):null;}},{key:"loadSource",value:function value(e,t){if(HN(e))return[];var i=e.data;if(!NN(i))return[];var r=[];return $k(i).call(i,function(e){e.uid=rO(),r.push(e.uid);}),GN(t)&&t(r),this.hooks.beforeLoadSource.emit(e),this.hooks.loadSource.emit(e),this.hooks.afterLoadSource.emit(e),r;}},{key:"removeSource",value:function value(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];jN(e)&&(e=[e]);var i={removedUids:e,docUid:"",trigger:this.uid,operation:"remove"};return this.hooks.beforeRemoveSource.emit(i),this.hooks.removeSource.emit(i),t&&this.hooks.afterRemoveSource.emit(i),!0;}},{key:"updateSource",value:function value(e,t){var i={modifiedUid:e,data:t,revoke:!(arguments.length>2&&void 0!==arguments[2])||arguments[2],operation:"modify"};return this.hooks.beforeUpdateSource.emit(i),this.hooks.updateSource.emit(i),this.hooks.afterUpdateSource.emit(i),!0;}},{key:"getSource",value:function value(e){return this.store.get(e);}},{key:"openDefault",value:function value(e){var t={node:this.defaultFile,type:"default",config:e};this.hooks.openDoc.emit(t);}},{key:"createFile",value:function value(e){return this.dir.createFile(e);}},{key:"removeFile",value:function value(e){return this.dir.removeFile(e);}},{key:"renameFile",value:function value(e,t){return this.dir.renameFile(e,t);}},{key:"openFile",value:function value(e,t){var i=this.getFile(e);if(!i)return!1;var r={node:i,type:"file",config:t};return this.hooks.openDoc.emit(r),!0;}},{key:"movePagesToFile",value:function value(e,t,i,r){var n=this,o=this.getFile(e),a=this.getFile(i);if(!o||!a)return!1;for(var s=0;s<t.length;s++)if(t[s]<0||t[s]>=o.children.length)return!1;if(r<0)return!1;var l=QE(t).call(t,function(e){return o.children[e];});$k(l).call(l,function(e){var t=n.statusStore.get(e);t&&t.ownerFiles.remove(o.uid);}),this.dir.removeChildFromFile(o.uid,l),this.hooks.removeFromDoc.emit({docUid:o.uid,sourceUids:l}),r>a.children.length&&(r=a.children.length);var u=this.dir.appendChildrenToFile(i,l,r),c={docUid:u.uid,sourceUids:l,type:"file",index:r,isSameDoc:e===i};return $k(l).call(l,function(e){var t=n.statusStore.get(e);t&&t.ownerFiles.append(u.uid);}),this.hooks.loadToDoc.emit(c),!0;}},{key:"getFile",value:function value(e){return this.dir.getFile(e);}},{key:"getFileList",value:function value(){return this.dir.getCurrentFileList();}},{key:"isFileExisted",value:function value(e){return this.dir.isFileExist(e);}},{key:"createTag",value:function value(e){return this.tag.createTag(e);}},{key:"removeTag",value:function value(e){for(var t=this.getTag(e).children||[],i=0;i<t.length;i++)this.store.get(t[i]).then(function(t){var i,r,n=WI(i=(null==t?void 0:t.tags)||[]).call(i,e);-1!==n&&mE(r=t.tags).call(r,n,1);});return this.tag.removeTag(e);}},{key:"renameTag",value:function value(e,t){var i=this.getTag(e).children||[],r=this.tag.renameTag(e,t);if(r)for(var n=0;n<i.length;n++)this.store.get(i[n]).then(function(i){var r,n,o=WI(r=(null==i?void 0:i.tags)||[]).call(r,e);-1!==o&&mE(n=i.tags).call(n,o,1,t);});return r;}},{key:"openTag",value:function value(e,t){var i=this.getTag(e);if(!i)return!1;var r={node:i,type:"tag",config:t};return this.hooks.openDoc.emit(r),!0;}},{key:"getTag",value:function value(e){return this.tag.getTag(e);}},{key:"getTagList",value:function value(){return this.tag.getTagList();}},{key:"setDefaultTag",value:function value(e){return this.tag.setDefaultTag(e);}},{key:"getDefaultTag",value:function value(){return this.tag.getDefaultTag();}},{key:"isTagExisted",value:function value(e){return this.tag.isTagExisted(e);}},{key:"addTagToSource",value:function value(e,t){if(this.statusStore.get(e)){jN(t)&&(t=[t]);for(var i=0;i<t.length;i++)if(!this.addSourceToTag(t[i],e))return!1;return!0;}return!1;}},{key:"removeTagFromSource",value:function value(e,t){if(this.statusStore.get(e)){var i;HN(t)?t=QE(i=this.tag.tags).call(i,function(e){return e.name;}):jN(t)&&(t=[t]);for(var r=0;r<t.length;r++)if(!this.removeSourceFromTag(t[r],e))return!1;return!0;}return!1;}},{key:"addSourceToTag",value:function value(e,t){var i=this.tag.getTag(e);if(i&&this.tag.appendChildToTag(e,t)){jN(t)&&(t=[t]);for(var r=0;r<t.length;r++)this.store.get(t[r]).then(function(t){var i;t&&(NN(t.tags)||(t.tags=[]),RB(i=t.tags).call(i,e)||t.tags.push(e));});var n={sourceUids:t,docUid:i.uid,type:"tag"};return this.hooks.loadToDoc.emit(n),!0;}return!1;}},{key:"removeSourceFromTag",value:function value(e,t){var i=this.tag.getTag(e);if(i){this.tag.removeChildFromTag(e,t),jN(t)&&(t=[t]);for(var r=0;r<t.length;r++)this.store.get(t[r]).then(function(t){var i,r,n=WI(i=(null==t?void 0:t.tags)||[]).call(i,e);-1!==n&&mE(r=t.tags).call(r,n,1);});var n={docUid:i.uid,sourceUids:t,type:"tag"};return this.hooks.removeFromDoc.emit(n),!0;}return!1;}},{key:"getSourceTags",value:function value(e){var t,i=this,r=this.statusStore.get(e);return r?QE(t=r.ownerTags.children).call(t,function(e){return i.tag.getTagByUid(e).name;}):[];}},{key:"switch",value:function value(e){var t=e.one,i=e.other,r=e.type,n=e.docUid,o=e.emit,a=this.getDocNode(n,r);if(a){if(a.switch(t,i),o||HN(o)){var s={one:t,other:i,docUid:n,type:a.type,trigger:this.uid,operation:"shift"};this.hooks.switch.emit(s);}return!0;}return!1;}},{key:"move",value:function value(e){var t=e.from,i=e.to,r=e.type,n=e.docUid,o=e.emit,a=this.getDocNode(n,r);if(a){if(a.move(t,i),o||HN(o)){var s={from:t,to:i,docUid:n,type:a.type,trigger:this.uid,operation:"shift"};this.hooks.move.emit(s);}return!0;}return!1;}},{key:"reorder",value:function value(e){var t=e.indexes,i=e.type,r=e.docUid,n=e.emit,o=this.getDocNode(r,i);if(o&&(o.reorder(t),n||HN(n))){var a={indexes:t,docUid:r,type:o.type,trigger:this.uid,operation:"shift"};this.hooks.move.emit(a);}}},{key:"getDocNode",value:function value(e,t){switch(t){case"default":return this.defaultFile;case"file":return this.dir.getFileByUid(e);case"tag":return this.tag.getTagByUid(e);default:return e===this.defaultFile.uid?this.defaultFile:this.tag.getTagByUid(e)||this.dir.getFileByUid(e)||null;}}}]);}(LO),RL={Successful:{errorCode:0,errorString:"Successful."},InvalidIndex:{errorCode:-1033,errorString:"Invalid index."},InvalidValue:{errorCode:-1034,errorString:"Invalid value."},NoImage:{errorCode:-1035,errorString:"There is no image."},UnBindViewer:{errorCode:-2210,errorString:"You cannot call this method on this WebTwain instance because it does not use the default viewer."},AlReadyBindViewer:{errorCode:-2211,errorString:"The element is already bound to the viewer."},ParameterCannotEmpty:{errorCode:-2314,errorString:"The parameter cannot be empty."},IndicesNotArray:{errorCode:-2358,errorString:"The type of the parameter indices must be an Array."},IndexOutOfRange:{errorCode:-2359,errorString:"The index is out of range."},InvalidTagName:{errorCode:-2394,errorString:"Invalid tag name."},InvalidLeftOrTopOrRightOrBottom:{errorCode:-2417,errorString:"The left or top or right or bottom you entered is invalid."},InvalidWidth:{errorCode:-2418,errorString:"The width you entered is invalid."},InvalidHeight:{errorCode:-2419,errorString:"The height you entered is invalid."},WidthOrHeightOutOfImageSize:{errorCode:-2420,errorString:"The width or height is out of image size."},MobileServer_InvalidIndex:{errorCode:-2423,errorString:"The index is invalid."},ImageEditorExist:{errorCode:-2500,errorString:"An ImageEditor already exists."},ThumbnailViewerExist:{errorCode:-2501,errorString:"A ThumbnailViewer already exists."},CustomElementExist:{errorCode:-2502,errorString:"A CustomElement already exists."},ImageEditorDispose:{errorCode:-2504,errorString:"The ImageEditor object has been disposed."},ThumbnailViewerNotExist:{errorCode:-2505,errorString:"This ThumbnailViewer doesn't exist."},ThumbnailViewerDispose:{errorCode:-2506,errorString:"The ThumbnailViewer object has been disposed."},CallbackNotAFunction:{errorCode:-2510,errorString:"The callback is not a function."},ElementRequired:{errorCode:-2511,errorString:"Parameter 'element' is required."},ElementNotExist:{errorCode:-2512,errorString:"Parameter 'element' doesn't instanceof HTMLDivElement."},InvalidPropertyValue:{errorCode:-2514,errorString:"Invalid property value."},CursorInvalidMode:{errorCode:-2519,errorString:"The current mode does not support setting the cursor to zoom."},OldTagNameRequired:{errorCode:-2517,errorString:"Old tag name is required."},NewTagNameRequired:{errorCode:-2518,errorString:"New tag name is required."},FileNameCannotEmpty:{errorCode:-2530,errorString:"Document name cannot be empty."},FileNameNotString:{errorCode:-2531,errorString:"Document name is not a string."},FileNotExist:{errorCode:-2540,errorString:"The document does not exist."},FileExist:{errorCode:-2541,errorString:"The document already exists."},CustomElementDispose:{errorCode:-2508,errorString:"The CustomElement object has been disposed."},CustomElementNotExist:{errorCode:-2507,errorString:"This CustomElement doesn't exist."},ParameterOutRange:{errorCode:80002,errorString:"The parameter is out of range."},TagNotExist:{errorCode:80009,errorString:"Tag does not exist."},TagExist:{errorCode:80010,errorString:"The tag already exists."},OperationError:{errorCode:80022,errorString:"The operation mode is wrong."}},NL={visibility:"hidden",width:"24px",height:"24px",background:"#ffffff",borderWidth:"1px",borderColor:"#a79898",borderRadius:"50%",opacity:1,color:"#000000",fontFamily:"sans-serif",fontSize:12,left:"",top:"",right:1,bottom:1,translateX:"",translateY:""},OL={visibility:"hidden",width:"24px",height:"24px",borderWidth:"1px",borderColor:"#000000",checkMarkColor:"#000000",checkMarkLineWidth:"2px",right:1,top:1},LL={visibility:"hidden",width:"24px",height:"24px",background:"#ffffff",borderWidth:"2px",borderColor:"#000000",checkMarkColor:"#000000",checkMarkLineWidth:"2px",borderRadius:0,opacity:1,left:1,top:1,right:"",bottom:"",translateX:"",translateY:""},WL=["topPageChanged","click","rightclick","dblclick","mousemove","pageAreaSelected","pageAreaUnselected","dragdone","onDrop","bufferChanged","removeBtnClick"];!function(e){e[e.Normal=0]="Normal",e[e.Balance=1]="Balance";}(SL||(SL={}));var HL={rows:1,columns:1,show:!1,enableDragPage:!1,enableSlide:!0,enableZoomWithCtrl:!0,enableSelectWithCtrl:!0,enableSelectWithShift:!0,scrollDirection:"vertical",displayMode:"multiple",fitType:"window",tabMode:"single",autoSelectTopPage:!1,autoScroll:!0,autoSelectLatest:!0,margin:0,gap:10,enableOptimizeImage:!0,enableDWT1x1:!0,viewerStyle:{background:"rgb(255, 255, 255)",border:""},canvasStyle:{background:"rgb(255, 255, 255)",border:"",cursor:"crosshair"},pageStyle:{border:"1px solid rgb(204, 204, 204)",background:"rgba(0,0,0,0)"},selectedPageStyle:{border:"1px solid rgb(125, 162, 206)",background:"rgb(199, 222, 252)"},hoveredPageStyle:{border:"1px solid rgb(204, 204, 204)",background:"rgb(239, 246, 253)"},placeholderStyle:{background:"rgb(251, 236, 136)"},checkboxStyle:Fk({},LL),pageNumberStyle:Fk({},NL),removeBtnStyle:Fk({},OL)},FL={size:"30%",columns:1,rows:3,show:!1,scrollDirection:"vertical",gap:10,margin:10,autoChangeIndex:!1,autoSelectTopPage:!1,autoSelectLatest:!0,autoScroll:!0,enableKeyboardControl:!0,enableDragPage:!0,enableResizing:!1,enableDWT1x1:!0,enableOptimizeImage:!0,canvasStyle:{border:"",background:""},thumbnailStyle:{border:"",background:"rgb(255, 255, 255)"},pageStyle:{border:"1px solid rgb(238, 238, 238)",background:"transparent"},selectedPageStyle:{border:"1px solid rgb(125, 162, 206)",background:"rgb(199, 222, 252)"},hoveredPageStyle:{border:"1px solid rgb(238, 238, 238)",background:"rgb(239, 246, 253)"},pageNumberStyle:Fk({},NL),checkboxStyle:Fk({},LL),removeBtnStyle:Fk({},OL),placeholderStyle:{background:"rgb(251, 236, 136)"}},jL={dlgRotateAnyAngle:["Angle :","Interpolation:","Keep size","  OK  ","Cancel"],dlgChangeImageSize:["New Height :","New Width :","Interpolation:","  OK  ","Cancel"],saveChangedImage:["You have changed the image, do you want to keep the change(s)?","  Yes  ","  No  "],selectSource:["Select Source:","Select","Cancel","There is no source available!"]},YL={background:"#434246",innerBorder:"",topMenuBorder:"",border:"1px solid rgb(204, 204, 204)",width:"100%",height:"100%",zoomOrigin:{x:"center",y:"center"},promptToSaveChange:!0,workMode:SL.Normal,selectionRectAspectRatio:1,buttons:{titles:{previous:"Previous Image",next:"Next Image",print:"Print Image",scan:"Acquire new Image(s)",load:"Load local Image(s)",rotateleft:"Rotate Left",rotate:"Rotate",rotateright:"Rotate Right",deskew:"Deskew",crop:"Crop Selected Area",cut:"Cut Selected Area",changeimagesize:"Change Image Size",flip:"Flip Image",mirror:"Mirror Image",zoomin:"Zoom In",originalsize:"Show Original Size",zoomout:"Zoom Out",stretch:"Stretch Mode",fit:"Fit Window",fitw:"Fit Horizontally",fith:"Fit Vertically",hand:"Hand Mode",rectselect:"Select Mode",zoom:"Click to Zoom In",restore:"Restore Original Image",save:"Save Changes",close:"Close the Editor",removeall:"Remove All Images",removeselected:"Remove All Selected Images"},visibility:{scan:!0,load:!0,print:!0,removeall:!0,removeselected:!0,rotateleft:!0,rotate:!0,rotateright:!0,deskew:!0,crop:!0,cut:!0,changeimagesize:!0,flip:!0,mirror:!0,zoomin:!0,originalsize:!0,zoomout:!0,stretch:!0,fit:!0,fitw:!0,fith:!0,hand:!0,rectselect:!0,zoom:!0,restore:!0,save:!0,close:!0}},dialogText:jL},XL={borderColor:"rgba(0,0,0,1)",borderWidth:1,ctrlBorderColor:"rgba(0,0,0,1)",ctrlBorderRadius:1,ctrlBorderWidth:1,ctrlWidth:9,ctrlHeight:9,ctrlSize:9,keepAspectRatio:!1,aspectRatio:1},qL=function(){return Yk(function e(){Xk(this,e),Wk(this,"errCode",void 0),Wk(this,"errorString",void 0);},[{key:"setError",value:function value(e,t){this.errCode=e,this.errorString=t;}},{key:"getError",value:function value(){return{errCode:this.errCode,errorString:this.errorString};}}]);}(),ZL=function(){return Yk(function e(t){var i=this;Xk(this,e),Wk(this,"space",void 0),Wk(this,"webViewer",void 0),Wk(this,"isActiveFile",!1),Wk(this,"isActiveTag",!1),Wk(this,"currentFileName",""),Wk(this,"currentTagName",""),Wk(this,"bufferConfig",null),Wk(this,"currentSelected",[]),Wk(this,"lastCurrentSelected",[]),this.space=new zL(),t&&(this.bufferConfig=t),this.space.on("bufferChanged",function(e,t){var r;if(!i.webViewer&&GN(null===(r=i.bufferConfig)||void 0===r?void 0:r.bufferChanged)){var n,o,a,s,l,u,c=[],h=[],d=i.getCurrentDataSet().children;$k(n=i.currentSelected).call(n,function(e){d&&d[e]&&c.push(d[e]);}),$k(o=i.lastCurrentSelected).call(o,function(e){d&&d[e]&&h.push(d[e]);});var f={afterStatus:{uids:e.afterStatus.uids,selectedUids:c,modifiedUid:(null==e||null===(a=e.afterStatus)||void 0===a?void 0:a.modifiedUid)||"",removedUids:(null==e||null===(s=e.afterStatus)||void 0===s?void 0:s.removedUids)||[],currentUid:e.afterStatus.uids[e.afterStatus.uids.length-1]||""},beforeStatus:{uids:e.beforeStatus.uids,selectedUids:h,removedUids:(null==e||null===(l=e.beforeStatus)||void 0===l?void 0:l.removedUids)||[],modifiedUid:(null==e||null===(u=e.beforeStatus)||void 0===u?void 0:u.modifiedUid)||"",currentUid:e.beforeStatus.uids[e.beforeStatus.uids.length-1]||""},operation:e.operation,docUid:e.docUid,total:e.afterStatus.uids.length,curIndex:e.afterStatus.uids.length-1};i.lastCurrentSelected=Ub(i.currentSelected),i.bufferConfig.bufferChanged(f,t);}});},[{key:"e",value:function value(){this.setError("Successful");}},{key:"IsFileNameExist",value:function value(e){var t=this.space.getFileList();if("dynamsoft-default-document"===e)return!0;if(t)for(var i=0;i<t.length;i++)if(t[i].name===e)return!0;return!1;}},{key:"getCurrentDataSet",value:function value(){if(this.webViewer){var e=this.webViewer.myViewer.getCurrentTab();if(void 0===e)return!1;var t=e.type;this.isActiveFile="file"===t,this.isActiveTag="tag"===t;}if(this.isActiveFile){var i=this.getCurrentFileName(),r=this.space.getFile(i);if(r)return r;}if(this.isActiveTag){var n=this.space.getTag(this.currentTagName);if(n)return n;}return!1;}},{key:"setError",value:function value(e){var t;if("Default"!==e){if(this.webViewer)this.webViewer.setError(e);else if(this.bufferConfig&&this.bufferConfig.viewerError){var i=RL[e],r=i.errorCode,n=i.errorString;this.bufferConfig.viewerError.setError(r,n);}}else null==this||null===(t=this.webViewer)||void 0===t||t.setDefaultError();}},{key:"emitViewerEvent",value:function value(){var e,t;this.webViewer&&0===this.getHowManyImagesInBuffer()&&(null===(e=this.webViewer)||void 0===e||null===(t=e.myViewer)||void 0===t||t.emit("pageRendered",-1));}},{key:"bindViewer",value:function value(e){this.webViewer=e;}},{key:"getCurrentTag",value:function value(){return this.currentTagName;}},{key:"getCurrentDocument",value:function value(){return this.currentFileName;}},{key:"getCurrentFileName",value:function value(){var e=this,t=this.space.getFileList(),i="";return t&&$k(t).call(t,function(t){t.name===e.currentFileName&&(i=e.currentFileName);}),i;}},{key:"getCurrentIndex",value:function value(){if(this.webViewer)return this.webViewer.getCurrentIndex();var e=this.getSelectedImagesIndices().length;if(e<=0){var t=this.getCurrentDataSet();return!!t&&t.children.length-1;}return this.getSelectedImagesIndices()[e-1];}},{key:"getHowManyImagesInBuffer",value:function value(){if(this.webViewer)return this.webViewer.getHowManyImagesInBuffer();var e=this.getCurrentDataSet();return e?e.children.length:0;}},{key:"getSelectedImagesIndices",value:function value(){return this.webViewer?this.webViewer.getSelectedImagesIndices():this.currentSelected;}},{key:"getIndexByUid",value:function value(e){if(!jN(e)||!e)return this.setError("InvalidValue"),!1;if(this.webViewer)return this.webViewer.myViewer.getIndexByUid(e);var t=this.getCurrentDataSet(),i=t.children;return!!(t&&i&&NN(i))&&WI(i).call(i,e);}},{key:"getUidByIndex",value:function value(e){if(e<0||e>=this.getHowManyImagesInBuffer())return this.setError("IndexOutOfRange"),!1;if(this.webViewer)return this.webViewer.myViewer.getUidByIndex(e);var t=this.getCurrentDataSet().children;return!(t&&t.length<e)&&t[e];}},{key:"getDataByUid",value:function value(e){return this.space.getSource(e);}},{key:"updateDataByUid",value:function value(e,t){return this.space.store.set(e,t);}},{key:"setCustomDataByUid",value:function value(e,t){return jN(e)&&""!==e?this.space.setCustomData(e,t):(this.setError("InvalidValue"),!1);}},{key:"getCustomDataByUid",value:function value(e){return this.space.getCustomData(e);}},{key:"setMetadataByUid",value:function value(e,t){return jN(e)&&""!==e?this.space.setMetadata(e,t):(this.setError("InvalidValue"),!1);}},{key:"getMetadataByUid",value:function value(e){return this.space.getMetadata(e);}},{key:"addImage",value:function value(e,t,i){var r,n,o={},a=this.currentFileName,s="";!HN(i)&&jN(i)?(this.IsFileNameExist(i)||this.createDocument(i),s=i):HN(a)||""===a?(this.space.isFileExisted("dynamsoft-default-document")||this.createDocument("dynamsoft-default-document"),this.webViewer&&(this.webViewer.bEmitBufferChanged=!1),this.openDocument("dynamsoft-default-document"),this.webViewer&&(this.webViewer.bEmitBufferChanged=!0),s="dynamsoft-default-document"):s=a,t&&(delete(n=Fk({},t)).oriBlobData,t.oriBlobData&&(r=t.oriBlobData));var l=e.imageUrl,u=e.minImageUrl,c=e.imageId,h=e.serverId,d=e.uidFromServer,f=e.index;r&&(o=Fk({},r)),c&&(o.imageId=c),h&&(o.serverId=h),d&&(o.uidFromServer=d);var v=this.getDocumentContents(s).length;!HN(f)&&ZN(f)?f>=v&&(f=v):f=v,this.isActiveFile&&(this.currentSelected=[f]);var g=this.space.loadSource({data:[{oriData:l,minData:u,metadata:n,customData:o}],filename:s,index:f},function(t){var i=Ab(t,1)[0];e.uuid=i;}),m=this.getHowManyImagesInBuffer();return this.isActiveTag&&(this.currentSelected=m>0?[m-1]:[]),g;}},{key:"insertImage",value:function value(e,t,i){var r;if(i&&i>=0)this.currentSelected=[i],r=this.space.loadSource({data:[e],filename:t,index:i});else{r=this.space.loadSource({data:[e],filename:t});var n=this.getHowManyImagesInBuffer();this.currentSelected=n>0?[n-1]:[];}return r[0];}},{key:"updateImage",value:function value(e,t){var i=e.imageUrl,r=e.minImageUrl,n=e.imageId,o=e.serverId,a=e.uidFromServer,s=e.uuid,l=Fk({},t);return s&&""!==s&&-1!==s?(this.space.updateSource(s,{oriData:i,minData:r,metadata:l,customData:{imageId:n,serverId:o,uidFromServer:a}}),s):(this.setError("IndexOutOfRange"),!1);}},{key:"removeImageByUid",value:function value(e){if(this.e(),this.webViewer){var t=this.webViewer.removePageByUid(e);return this.webViewer.resized(),this.emitViewerEvent(),t;}return this.space.removeSource(e);}},{key:"removeImageByIndex",value:function value(e){if(this.e(),e<0||e>=this.getHowManyImagesInBuffer())return this.setError("IndexOutOfRange"),!1;var t=this.getCurrentIndex(),i=!1;if(this.currentSelected=e===t&&0===e?this.getHowManyImagesInBuffer()>0?[0]:[]:e<=t?[t-1]:[t],this.webViewer)i=this.webViewer.removePageByIndexes(e),this.webViewer.resized(),this.emitViewerEvent();else{var r=this.getCurrentDataSet();if(!r)return!1;i=this.space.removeSource(r.children[e]);}return i||this.setError("Default"),i;}},{key:"removeSelectedImages",value:function value(e){this.e();var t=this.getSelectedImagesIndices();NN(e)&&e.length>0&&(t=e);var i=!1;if(this.webViewer)i=this.webViewer.removePageByIndexes(t),this.webViewer.resized(),this.emitViewerEvent();else{var r=[],n=this.getCurrentDataSet();if(!n)return!1;$k(t).call(t,function(e){n.children[e]&&n.children[e]&&r.push(n.children[e]);}),i=this.space.removeSource(r);}i||this.setError("Default");var o=this.getHowManyImagesInBuffer();return this.currentSelected=o>0?[o-1]:[],i;}},{key:"removeImageByIndexArr",value:function value(e){if(this.e(),!NN(e))return!1;var t=this.getCurrentDataSet();if(!t)return!1;var i,r=[];$k(e).call(e,function(e){var i=t.children[e];i&&r.push(i);}),(i=this.space.removeSource(r))||this.setError("Default"),this.webViewer&&(this.webViewer.resized(),this.emitViewerEvent());var n=this.getHowManyImagesInBuffer();return this.currentSelected=n>0?[n-1]:[],i;}},{key:"removeAllImages",value:function value(){this.e();var e=!1;if(this.currentSelected=[],this.webViewer)e=this.webViewer.removeAllPages(),this.webViewer.resized(),this.emitViewerEvent();else{var t=this.getCurrentDataSet();t&&(e=this.space.removeSource(Ub(t.children)));}return e||this.setError("Default"),e;}},{key:"tagImages",value:function value(e,t){this.e();var i=this.getHowManyImagesInBuffer();if(!NN(e))return this.setError("IndicesNotArray"),!1;if(!jN(t)||""===t)return this.setError("InvalidTagName"),!1;for(var r=0;r<i;r++){var n=e[r];if(fS(n)||n<0||n>=i)return this.setError("IndexOutOfRange"),!1;}this.space.createTag(t);for(var o=0;o<e.length;o++){var a=e[o];if(a>=0){var s=this.getUidByIndex(a);s&&""!==s&&-1!==$S(s,10)&&this.space.addTagToSource(s,t);}}return!0;}},{key:"removeImageTag",value:function value(e,t){if(this.e(),!ZN(e))return this.setError("InvalidValue"),!1;if(e<0||e>this.getHowManyImagesInBuffer())return this.setError("IndexOutOfRange"),!1;var i=this.getUidByIndex(e),r=!1;return i&&""!==i&&-1!==i&&(r=this.space.removeTagFromSource(i,t)),r||this.setError("Default"),r;}},{key:"getDefaultTag",value:function value(){return this.space.getDefaultTag();}},{key:"setDefaultTag",value:function value(e){if(this.e(),!jN(e))return this.setError("InvalidValue"),!1;if(""===e)return this.space.setDefaultTag(null),!0;var t;return this.space.createTag(e),(t=this.space.setDefaultTag(e))||this.setError("Default"),t;}},{key:"removeTag",value:function value(e,t){var i=this;if(this.e(),!jN(e))return this.setError("InvalidValue"),!1;if(!HN(t)&&!NN(t))return this.setError("IndicesNotArray"),!1;if(!this.space.isTagExisted(e))return this.setError("TagNotExist"),!1;var r=this.currentTagName,n=!1,o=!1;if(r&&(n=r===e),HN(t))o=this.space.removeTag(e),n&&this.clearFilter();else{var a=[];$k(t).call(t,function(e){var t=i.getUidByIndex(e);-1!==t&&a.push(t);});for(var s=0;s<(null==a?void 0:a.length);s++)if(!(o=this.space.removeTagFromSource(a[s],e)))return!1;}return o||this.webViewer.setDefaultError(),o;}},{key:"renameTag",value:function value(e,t){if(this.e(),HN(e)||""===e)return this.setError("OldTagNameRequired"),!1;if(HN(t)||""===t)return this.setError("NewTagNameRequired"),!1;if(!this.space.isTagExisted(e))return this.setError("TagNotExist"),!1;if(this.space.isTagExisted(t))return this.setError("TagExist"),!1;var i;return e===this.currentTagName&&(this.currentTagName=t),(i=this.space.renameTag(e,t))?this.space.setDefaultTag(t):this.setError("Default"),i;}},{key:"getTagContents",value:function value(e){return this.e(),e&&jN(e)&&""!==e?this.space.getTag(e).children:[];}},{key:"getTagList",value:function value(){var e=this;this.e();var t=this.space.getTagList(),i=[];return t?$k(t).call(t,function(t){var r,n=[];$k(r=t.children).call(r,function(t){var i=e.getCustomDataByUid(t);if(i){var r=i.uidFromServer;n.push(r);}}),i.push({name:t.name,imageIds:n});}):i=[],i;}},{key:"getTagListByIndex",value:function value(e){if(!ZN(e))return!1;var t=this.getUidByIndex(e);return this.space.getSourceTags(t);}},{key:"clearFilter",value:function value(){this.e(),this.currentTagName="",this.space.setDefaultTag(null);var e,t=this.getCurrentFileName();return""===t&&(t="dynamsoft-default-document"),(e=this.openDocument(t))||this.setError("Default"),e;}},{key:"filterImagesByTag",value:function value(e,t,i){this.e();var r=!1;if(HN(e)||null===e||""===e){this.currentTagName="";var n=this.getCurrentFileName();""===n&&(n="dynamsoft-default-document"),(r=this.openDocument(n))?GN(t)&&t():(this.setError("Default"),GN(i)&&i());}else{var o,a;if(!this.space.isTagExisted(e))return this.setError("TagNotExist"),GN(i)&&i(),!1;if(this.isActiveTag=!0,this.isActiveFile=!1,this.currentTagName=e,this.setDefaultTag(e),r=this.space.openTag(e,null==this||null===(o=this.webViewer)||void 0===o||null===(a=o.myViewer)||void 0===a?void 0:a.uid)){var s=this.space.getTag(e);if(s){var l,u=(null==s||null===(l=s.children)||void 0===l?void 0:l.length)||0;this.currentSelected=u>0?[u-1]:[];}GN(t)&&t();}else this.setError("Default"),GN(i)&&i();}return this.webViewer&&this.webViewer.render(),r;}},{key:"createDocument",value:function value(e){if(this.e(),!e||""===e){var t=ZN(e)?"FileNameNotString":"FileNameCannotEmpty";return this.setError(t),!1;}return jN(e)?this.space.isFileExisted(e)?(this.setError("FileExist"),!1):!!this.space.createFile(e)||(this.setError("Default"),!1):(this.setError("FileNameNotString"),!1);}},{key:"openDocument",value:function value(e,t){var i,r;if(this.e(),!e||""===e){var n=ZN(e)?"FileNameNotString":"FileNameCannotEmpty";return this.setError(n),!1;}if(!jN(e))return this.setError("FileNameNotString"),!1;if(!this.space.isFileExisted(e))return this.setError("FileNotExist"),!1;var o=t&&""!==t?t:null==this||null===(i=this.webViewer)||void 0===i||null===(r=i.myViewer)||void 0===r?void 0:r.uid,a=this.space.getFile(e);if(a){var s,l=null==a||null===(s=a.children)||void 0===s?void 0:s.length;this.currentSelected=l>0?[l-1]:[];}return this.space.openFile(e,{viewerUid:o})?(this.currentFileName=e,this.isActiveFile=!0,this.isActiveTag=!1,!0):(this.setError("Default"),!1);}},{key:"getDocumentContents",value:function value(e){return this.e(),e&&jN(e)&&""!==e?this.space.getFile(e).children:[];}},{key:"renameDocument",value:function value(e,t){return this.e(),jN(e)&&jN(t)?(e&&""!==e&&t&&""!==t||this.setError("FileNameCannotEmpty"),this.space.isFileExisted(e)?this.space.isFileExisted(t)?(this.setError("FileExist"),!1):this.space.renameFile(e,t)?(this.currentFileName===e&&(this.currentFileName=t),!0):(this.setError("Default"),!1):(this.setError("FileNotExist"),!1)):(this.setError("FileNameNotString"),!1);}},{key:"removeDocument",value:function value(e){if(this.e(),!e||!jN(e))return this.setError("FileNameNotString"),!1;if(!this.space.isFileExisted(e))return this.setError("FileNotExist"),!1;var t=this.space.removeFile(e);return t?(t&&this.webViewer&&this.webViewer.resized(),this.currentFileName===e&&(this.currentFileName=""),!0):(this.setError("Default"),!1);}},{key:"getDocumentInfoList",value:function value(){var e=this;this.e();var t=this.space.getFileList(),i=[];return t?($k(t).call(t,function(t){if(t.children){for(var r=[],n=0;n<t.children.length;n++){var o=t.children[n],a=e.getCustomDataByUid(o);if(a){var s=a.uidFromServer;r.push(s);}}i.push({imageIds:r,name:t.name});}}),i):[];}},{key:"getDocumentInfo",value:function value(e){this.e();var t=this.space.getFile(e);if(!t)return{imageIds:[],length:0};for(var i=[],r=0;r<t.children.length;r++){var n=t.children[r],o=this.getCustomDataByUid(n);if(o){var a=o.uidFromServer;i.push(a);}}return{imageIds:i,length:i.length};}},{key:"selectImages",value:function value(e){this.e();var t=!0;if(!e||!NN(e))return!1;if(this.webViewer){var i=this.webViewer.getIfAutoScroll();!1===i&&this.webViewer.setIfAutoScroll(!0),t=this.webViewer.selectPages(e),!1===i&&this.webViewer.setIfAutoScroll(!1);}else{for(var r=this.getHowManyImagesInBuffer(),n=0;n<e.length;n++)if(!ZN(e[n])||e[n]<0||e[n]>=r)return this.setError("ParameterOutRange"),!1;t=!0;}return t?this.currentSelected=e:this.setError("Default"),t;}},{key:"selectAllImages",value:function value(){this.e();var e=!0;if(this.webViewer)e=this.webViewer.myViewer.selectAll(),this.currentSelected=this.webViewer.getSelectedImagesIndices();else{var t,i=this.getCurrentDataSet();this.currentSelected=LB(KB(t=new Array(i.children.length)).call(t));}return e||this.setError("Default"),e;}},{key:"moveImage",value:function value(e,t){this.e();var i=$S(e,10),r=$S(t,10);if(fS(e)||fS(t))return this.setError("InvalidIndex"),!1;var n=this.getHowManyImagesInBuffer();if(i<0||i>=n||r<0||r>n)return this.setError("IndexOutOfRange"),!1;var o=!1;if(this.webViewer)o=this.webViewer.myViewer.movePage(e,t);else{var a=this.getCurrentDataSet();if(!a)return!1;a.children.length>t&&(this.currentSelected=[t]),o=this.space.move({docUid:a.uid,type:a.type,from:e,to:t});}return o||this.setError("Default"),o;}},{key:"switchImage",value:function value(e,t){this.e();var i=$S(e,10),r=$S(t,10);if(fS(e)||fS(t))return this.setError("InvalidIndex"),!1;var n=this.getHowManyImagesInBuffer(),o=this.getCurrentIndex();if(i<0||i>=n||r<0||r>n)return this.setError("IndexOutOfRange"),!1;var a=!1;if(this.webViewer)a=this.webViewer.myViewer.switchPage(e,t);else{var s=this.getCurrentDataSet();if(!s)return!1;a=this.space.switch({docUid:s.uid,type:s.type,one:e,other:t});}a||this.setError("Default");var l=o;return i===o?l=r:r===o&&(l=i),this.currentSelected=[l],a;}},{key:"moveImageToFile",value:function value(e,t,i,r){if(!this.space.isFileExisted(e)||!this.space.isFileExisted(i))return this.setError("FileNotExist"),!1;t=Ub(new UA(t));var n=this.getDocumentInfo(e).length;if(!NN(t)||t.length>n)return this.setError("ParameterOutRange"),!1;var o=this.getDocumentInfo(i).length,a=this.space.movePagesToFile(e,t,i,r);if(!this.webViewer&&this.isActiveFile){var s=this.getHowManyImagesInBuffer();e===this.currentFileName&&(this.currentSelected=s>0?[s-1]:[]),i===this.currentFileName&&(ZN(r)&&r<o&&r>=0?this.currentSelected=[r+t.length-1]:this.currentSelected=s>0?[s-1]:[]);}return a;}}]);}(),_L=function(){return Yk(function e(t){var i,r,n,o,a=this;Xk(this,e),Wk(this,"uid",null),Wk(this,"mode","default"),Wk(this,"vertexes",[]),Wk(this,"midpoints",[]),Wk(this,"probePoints",[]),Wk(this,"slopeRatio",[]),Wk(this,"sensorRadius",4),Wk(this,"isPointSelected",!1),Wk(this,"activeProbePoint",null),Wk(this,"isConvex",!0),Wk(this,"isMoveBox",!1),Wk(this,"width",0),Wk(this,"height",0),Wk(this,"zoom",1),Wk(this,"keepAspectRatio",!1),Wk(this,"aspectRatio",0),Wk(this,"startX",null),Wk(this,"startY",null),Wk(this,"lastX",null),Wk(this,"lastY",null),Wk(this,"lastWhr",1),Wk(this,"b1",void 0),Wk(this,"b2",void 0),Wk(this,"k1",void 0),Wk(this,"k2",void 0),this.uid=rO(),$k(i=eS(t)).call(i,function(e){a[e]=t[e];}),this.midpoints=GL(this.vertexes),this.probePoints=uS(r=NI(n=this.vertexes).call(n)).call(r,NI(o=this.midpoints).call(o)),this.slopeRatio=KL(this.vertexes);},[{key:"getRect",value:function value(){if("free"===this.mode)return null;var e=this.getBounds(),t=e.minX,i=e.maxX,r=e.minY;return{x:t,y:r,width:i-t||1,height:e.maxY-r||1};}},{key:"isBoxSelected",value:function value(e,t){var i=this.isPointOnBox(e,t),r=this.isCtrlPointSelected(e,t);return null!==r?r:i?8:-1;}},{key:"isCtrlPointSelected",value:function value(e,t){for(var i=UO(),r=this.sensorRadius,n=this.zoom,o=this.probePoints,a=this.width,s=this.height,l=r/n,u=nO(l,0,3*l)*i,c=nO(l,0,3*l)*i,h=0;h<8;h++){var d=o[2*h],f=o[2*h+1];if(e<=d+u&&e>=d-u&&t<=f+c&&t>=f-c&&e>=0-u&&e<=a+u&&t>=0-c&&t<=s+c)return h;}return null;}},{key:"checkOrientation",value:function value(e){if(e<0||e>7)return null;var t=this.getBounds(),i=t.minX,r=t.maxX,n=t.minY,o=t.maxY,a=this.probePoints,s=a[2*e],l=a[2*e+1],u=null,c=null;return s===r?u="e":s===i&&(u="w"),l===o?c="s":l===n&&(c="n"),e<4?c+u:c||u;}},{key:"onStartHandler",value:function value(e,t,i){if(void 0===i&&(i=this.isBoxSelected(e,t)),!(i<0)){this.startX=e,this.startY=t,this.lastX=e,this.lastY=t,8===i?(this.isPointSelected=!1,this.activeProbePoint=null,this.isMoveBox=!0):(this.isPointSelected=!0,this.activeProbePoint=i,this.isMoveBox=!1);var r=this.mode,n=this.probePoints,o=this.slopeRatio;if("free"===r&&i>3&&i<8){var a=i-4;this.k1=o[(a+1)%4],this.b1=n[(2*a+3)%8]-this.k1*n[(2*a+2)%8],this.k2=o[(a+3)%4],this.b2=n[(2*a+1)%8]-this.k2*n[(2*a+0)%8];}}}},{key:"onMoveHandler",value:function value(e,t,i){var r,n,o=this.isPointSelected,a=this.isMoveBox,s=this.probePoints,l=this.activeProbePoint,u=this.lastX,c=this.lastY,h=this.mode;if(o||a){var d=e-u,f=t-c;if(0!==d||0!==f){var v=NI(s).call(s);o?(void 0===i&&(i=l),"default"===h?v=this.movePointNormal(v,i,e,t):(v=this.movePointFree(v,i,e,t),this.slopeRatio=NI(r=KL(s)).call(r,0,4),this.isConvex=this.checkConvexity(v))):a&&(v=this.moveBox(v,d,f));var g=GL(v);this.probePoints=uS(n=NI(v).call(v,0,8)).call(n,g),this.midpoints=g,this.lastX=e,this.lastY=t;}}}},{key:"onEndHandler",value:function value(){var e,t,i,r,n=this.isPointSelected,o=this.isMoveBox,a=this.startX,s=this.startY,l=this.vertexes,u=this.midpoints,c=this.lastX,h=this.lastY;if(this.startX=0,this.startY=0,n||o){this.isPointSelected=!1,this.isMoveBox=!1,this.activeProbePoint=null;var d=NI(e=this.probePoints).call(e),f=this.checkConvexity(d);(a===c&&s===h||!f)&&(d=uS(t=NI(l).call(l)).call(t,u)),this.isConvex=!0,this.vertexes=NI(d).call(d,0,8),this.midpoints=GL(d),this.probePoints=uS(i=NI(d).call(d,0,8)).call(i,this.midpoints),this.slopeRatio=NI(r=KL(d)).call(r,0,4);}}},{key:"getBounds",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.probePoints;return{minX:Math.min(e[0],e[2],e[4],e[6]),maxX:Math.max(e[0],e[2],e[4],e[6]),minY:Math.min(e[1],e[3],e[5],e[7]),maxY:Math.max(e[1],e[3],e[5],e[7])};}},{key:"movePointNormal",value:function value(e,t,i,r){i=Math.max(0,Math.min(this.width,i)),r=Math.max(0,Math.min(this.height,r));var n=0,o=0;if(this.keepAspectRatio){var a=this.getBounds(),s=a.minX,l=a.maxX,u=a.minY,c=a.maxY,h=this.checkOrientation(t),d=(l-s)/(c-u);0===d||d===1/0||d===-1/0||fS(d)?d=this.lastWhr:this.lastWhr=d,n=0,o=0;var f="w";if(t<4){if(n=i-e[2*t],o=r-e[2*t+1],0===n||0===o)return e;f="w";}else{var v=t-4;if("e"===h?(t=(v+1)%4,f="w"):"s"===h?(t=v,f="h"):"w"===h?(t=v,f="w"):"n"===h&&(t=(v+1)%4,f="h"),n=i-e[2*v],o=r-e[2*v+1],0===n||0===o)return e;}"h"===f?(n=o*d,"ne"!==h&&"sw"!==h&&"n"!==h&&"w"!==h||(n=-n)):(o=n/d,"ne"!==h&&"sw"!==h&&"n"!==h&&"w"!==h||(o=-o));var g=e[2*t]+n,m=e[2*t+1]+o,y=this.width,p=this.height;g<0?(n=0-e[2*t],o=0):g>y?(n=y-e[2*t],o=0):m<0?(o=0-e[2*t+1],n=0):m>p&&(o=p-e[2*t+1],n=0),e[2*t]+=n,e[2*t+1]+=o;var w=(t+1)%4,b=(t+3)%4;t%2?(e[2*w]+=n,e[2*b+1]+=o):(e[2*w+1]+=o,e[2*b]+=n);}else if(t<4){if(n=i-e[2*t],o=r-e[2*t+1],0===n&&0===o)return e;e[2*t]=i,e[2*t+1]=r;var k=(t+1)%4,S=(t+3)%4;t%2?(e[2*k]=i,e[2*S+1]=r):(e[2*k+1]=r,e[2*S]=i);}else{var x=t-4,C=this.slopeRatio[x%4];0===C?(e[(2*x+3)%8]=r,e[(2*x+1)%8]=r):C!==1/0&&C!==-1/0||(e[(2*x+2)%8]=i,e[(2*x+0)%8]=i);}return e;}},{key:"movePointFree",value:function value(e,t,i,r){i=Math.max(0,Math.min(this.width,i)),r=Math.max(0,Math.min(this.height,r));var n=NI(e).call(e);if(t<4){var o=i-e[2*t],a=r-e[2*t+1];if(0===o&&0===a)return e;e[2*t]=i,e[2*t+1]=r;}else{var s=t-4,l=this.slopeRatio[s%4],u=r-l*i,c=-u/l,h=u,d=e[(2*s+9)%8]-l*e[(2*s+8)%8],f=-d/l,v=this.k1,g=this.b1,m=this.k2,y=this.b2;0===l?(e[(2*s+3)%8]=r,v!==1/0&&v!==-1/0&&(e[(2*s+2)%8]=(r-g)/v),e[(2*s+1)%8]=r,m!==1/0&&m!==-1/0&&(e[(2*s+0)%8]=(r-y)/m)):l===1/0||l===-1/0?(e[(2*s+2)%8]=i,e[(2*s+3)%8]=v*i+g,e[(2*s+0)%8]=i,e[(2*s+1)%8]=m*i+y):(0===v?e[(2*s+2)%8]+=c-f:v===1/0||v===-1/0?e[(2*s+3)%8]+=h-d:(e[(2*s+2)%8]=(g-u)/(l-v),e[(2*s+3)%8]=(l*g-v*u)/(l-v)),0===m?e[(2*s+0)%8]+=c-f:m===1/0||m===-1/0?e[(2*s+1)%8]+=h-d:(e[(2*s+0)%8]=(y-u)/(l-m),e[(2*s+1)%8]=(l*y-m*u)/(l-m)));for(var p=0;p<4;p++){var w=e[2*p],b=e[2*p+1];if(w<0||w>this.width||b<0||b>this.height)return n;}}return e;}},{key:"moveBox",value:function value(e,t,i){var r=this.getBounds(e),n=r.minX,o=r.maxX,a=r.minY,s=r.maxY,l=this.width,u=this.height;n+t<0&&(t=0-n),o+t>l&&(t=l-o),a+i<0&&(i=0-a),s+i>u&&(i=u-s);for(var c=0;c<4;c++)e[2*c]+=t,e[2*c+1]+=i;return e;}},{key:"isPointOnBox",value:function value(e,t){var i=this.getBounds(),r=i.minX,n=i.maxX,o=i.minY,a=i.maxY;if(e<r||e>n||t<o||t>a)return!1;if("free"===this.mode){for(var s=Ub(this.vertexes),l=Ub(this.midpoints),u=[],c=0;c<4;c++)u.push(mE(s).call(s,0,2)),u.push(mE(l).call(l,0,2));var h=function(e,t){var i,r,n,o,a=0,s=t.length;for(n=Ab(t,1)[0],i=1;i<=s;i++){o=t[i%s],e[0]>Math.min(n[0],o[0])&&e[0]<=Math.max(n[0],o[0])&&e[1]<=Math.max(n[1],o[1])&&n[0]!==o[0]&&(r=(e[0]-n[0])*(o[1]-n[1])/(o[0]-n[0])+n[1],(n[1]===o[1]||e[1]<=r)&&(a+=1)),n=o;}return a%2!=0;}([e,t],u);return h;}return!0;}},{key:"checkConvexity",value:function value(e){var t,i=Ab(e,8),r=i[0],n=i[1],o=i[2],a=i[3],s=i[4],l=i[5],u=i[6],c=i[7],h=(u-r)*(a-n)-(c-n)*(o-r),d=(r-o)*(l-a)-(n-a)*(s-o),f=(o-s)*(c-l)-(a-l)*(u-s),v=(s-u)*(n-c)-(l-c)*(r-u);if(h*d*f*v<0)return!1;var g=uS(t=NI(e).call(e)).call(t,NI(e).call(e,0,2)),m=this.slopeRatio;if(m.length)for(var y=0;y<2;y++)if(m[y]!==m[y+2]&&$L(NI(g).call(g,2*y,2*y+2),NI(g).call(g,2*y+2,2*y+4),NI(g).call(g,2*y+4,2*y+6),NI(g).call(g,2*y+6,2*y+8)))return!1;return h*d*f*v>0;}}]);}();function GL(e){for(var t,i=uS(t=NI(e).call(e,0,8)).call(t,e[0],e[1]),r=[],n=0;n<4;n++){var o=(i[2*n]+i[2*n+2])/2,a=(i[2*n+1]+i[2*n+3])/2;r.push(o,a);}return r;}function KL(e){for(var t,i=[],r=null,n=uS(t=NI(e).call(e,0,8)).call(t,e[0],e[1]),o=0;o<4;o++)r=n[2*o+3]-n[2*o+1]===0&&n[2*o+2]-n[2*o]===0?0:(n[2*o+3]-n[2*o+1])/(n[2*o+2]-n[2*o]),i.push(r);return i;}function $L(e,t,i,r){if(function(e,t,i,r){var n=Math.min,o=Math.max;return n(e[0],t[0])<=o(i[0],r[0])&&n(i[0],r[0])<=o(e[0],t[0])&&n(e[1],t[1])<=o(i[1],r[1])&&n(i[1],r[1])<=o(e[1],t[1]);}(e,t,i,r)&&function(e,t,i,r){var n=e[0]*(i[1]-t[1])+t[0]*(e[1]-i[1])+i[0]*(t[1]-e[1]),o=e[0]*(r[1]-t[1])+t[0]*(e[1]-r[1])+r[0]*(t[1]-e[1]);return!((n^o)>=0&&0!==n&&0!==o||(n=i[0]*(e[1]-r[1])+r[0]*(i[1]-e[1])+e[0]*(r[1]-i[1]),o=i[0]*(t[1]-r[1])+r[0]*(i[1]-t[1])+t[0]*(r[1]-i[1]),(n^o)>=0&&0!==n&&0!==o));}(e,t,i,r)){var n=(r[0]-i[0])*(e[1]-t[1])-(t[0]-e[0])*(i[1]-r[1]),o=(e[1]-i[1])*(t[0]-e[0])*(r[0]-i[0])+i[0]*(r[1]-i[1])*(t[0]-e[0])-e[0]*(t[1]-e[1])*(r[0]-i[0]);if(0===n||0===o){var a=QL(e,t),s=QL(i,r),l=a[0],u=a[1],c=s[0],h=s[1];if(u[0]===c[0]&&u[1]===c[1])return u;if(l[0]===h[0]&&l[1]===h[1])return l;if(JL(u,s)&&JL(c,a))return[c,u];if(JL(l,s)&&JL(h,a))return[l,h];if(JL(l,s)&&JL(u,s))return[l,u];if(JL(c,s)&&JL(h,s))return[c,h];}var d=o/n;return n=(e[0]-t[0])*(r[1]-i[1])-(t[1]-e[1])*(i[0]-r[0]),[d,(o=t[1]*(e[0]-t[0])*(r[1]-i[1])+(r[0]-t[0])*(r[1]-i[1])*(e[1]-t[1])-r[1]*(i[0]-r[0])*(t[1]-e[1]))/n];}return!1;}function QL(e,t){return e[0]===t[0]?e[1]<t[1]?[e,t]:[t,e]:e[0]<t[0]?[e,t]:[t,e];}function JL(e,t){return t[0][0]===t[1][0]?e[1]>=t[0][1]&&e[1]<=t[1][1]:e[0]>=t[0][0]&&e[0]<=t[1][0];}var eW={aspectRatio:1,keepAspectRatio:!1,keepAspectRatioEdit:!1,keepAspectRatioWithShift:!0,multipleCropping:!0,enableCreateBoxByPointer:!0,enableCursor:!0,enableMagnifier:!0,borderColor:"orange",borderWidth:2,background:"rgba(255,255,255,0)",dashLine:[5,2],ctrlSize:16,ctrlBorderWidth:2,ctrlBorderRadius:4,ctrlBorderColor:"orange",ctrlBackground:"rgba(255,0,0,0)",invalidCtrlBorderColor:"red",invalidBorderColor:"red",magnifier:{fixed:!1,fixedTop:0,fixedLeft:0,size:50,magnification:2}},tW=function(){return Yk(function e(t,i){Xk(this,e),Wk(this,"activeBoxId",null),Wk(this,"startX",null),Wk(this,"startY",null),Wk(this,"addNewFlag",null),Wk(this,"drawingFlag",!1),Wk(this,"lastKeepAspectRatio",!1),Wk(this,"area",null),Wk(this,"canvasItem",null),Wk(this,"cropBoxes",[]),Wk(this,"width",0),Wk(this,"height",0),Wk(this,"scrollTop",0),Wk(this,"scrollLeft",0),Wk(this,"zoom",1),Wk(this,"aspectRatio",0),Wk(this,"keepAspectRatio",!1),Wk(this,"keepAspectRatioEdit",!1),Wk(this,"mouseDown",!1),Wk(this,"cropSetting",{}),Wk(this,"currentBoxId",void 0),Wk(this,"unselectedCallback",null),Wk(this,"selectedCallback",null),this.width=t,this.height=i,this.cropSetting=_LN(eW);},[{key:"count",value:function value(){return this.cropBoxes.length;}},{key:"setCanvas",value:function value(e){this.canvasItem=e;}},{key:"setCanvasSize",value:function value(e,t){this.width=e,this.height=t,this.area||this.setArea(0,0,e,t);}},{key:"setKeepAspectRatio",value:function value(e){var t;this.keepAspectRatio=e,this.drawingFlag||$k(t=this.cropBoxes).call(t,function(t){t.keepAspectRatio=e;});}},{key:"setAspectRatio",value:function value(e){this.aspectRatio=e;}},{key:"setZoom",value:function value(e){var t;this.zoom=e,$k(t=this.cropBoxes).call(t,function(t){t.zoom=e;});}},{key:"setScrollTop",value:function value(e){this.scrollTop=e;}},{key:"setScrollLeft",value:function value(e){this.scrollLeft=e;}},{key:"setCropSetting",value:function value(){var e=tO(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},_LN(this.cropSetting));this.cropSetting=e;var t=this.cropSetting,i=t.keepAspectRatioEdit,r=t.keepAspectRatio;return this.keepAspectRatioEdit=i,r?(this.setKeepAspectRatio(!0),this.setAspectRatio(this.cropSetting.aspectRatio)):this.setKeepAspectRatio(!1),!0;}},{key:"getCropBoxes",value:function value(){var e,t=[];return $k(e=this.cropBoxes).call(e,function(e,i){var r=e.getRect();null!==r&&t.push({index:i,left:r.x,top:r.y,width:r.width,height:r.height});}),t;}},{key:"getRectArr",value:function value(){var e;return QE(e=this.cropBoxes).call(e,function(e,t){return Fk({index:t},e.getRect());});}},{key:"clear",value:function value(){var e;this.cropBoxes.length>0&&null!==(e=this.unselectedCallback)&&void 0!==e&&e.call(this),this.cropBoxes=[];}},{key:"addFreeBox",value:function value(e){var t=this.cropSetting,i=t.ctrlSize,r=t.ctrlHeight,n=t.ctrlWidth,o=i;(n||r)&&(o=Math.max(n,r));var a=new _L({vertexes:NI(e).call(e),width:this.area.width,height:this.area.height,sensorRadius:o/2,mode:"free"});return this.cropBoxes.push(a),a;}},{key:"addBox",value:function value(e){var t=this.cropSetting,i=t.ctrlSize,r=t.ctrlHeight,n=t.ctrlWidth,o=i;(n||r)&&(o=Math.max(n,r));var a=new _L({vertexes:NI(e).call(e),width:this.area.width,height:this.area.height,mode:"default",aspectRatio:this.aspectRatio,keepAspectRatio:this.keepAspectRatio,sensorRadius:o/2,zoom:this.zoom});return a.isScaled=!1,this.cropBoxes.push(a),a;}},{key:"removeBox",value:function value(e){var t=this.cropBoxes;return HN(e)?(this.clear(),!0):!(e<0||e>=t.length||(mE(t).call(t,e,1),0));}},{key:"getBoxByUid",value:function value(e){var t;return CP(t=this.cropBoxes).call(t,function(t){return t.uid===e;});}},{key:"setArea",value:function value(e,t,i,r){var n;this.area={left:e,top:t,width:i,height:r},$k(n=this.cropBoxes).call(n,function(e){e.width=i,e.height=r;});}},{key:"isInArea",value:function value(e,t){var i=this.area,r=i.width,n=i.height;return!(e<0||e>r||t<0||t>n);}},{key:"checkSelect",value:function value(e,t){var i;return PE(i=this.cropBoxes).call(i,function(i){return i.isBoxSelected(e,t)>-1;});}},{key:"checkSelectForCursor",value:function value(e,t){for(var i=this.cropBoxes.length-1;i>=0;i--){var r=this.cropBoxes[i],n=r.isBoxSelected(e,t);if(n>-1){var o="move";return n<8&&(o=r.checkOrientation(n)),{part:n,position:o,mode:r.mode};}}return null;}},{key:"checkSelectVertex",value:function value(e,t){for(var i=this.cropBoxes.length-1;i>=0;i--){var r=this.cropBoxes[i].isBoxSelected(e,t);if(r>-1&&r<4)return!0;}return!1;}},{key:"onStartHandler",value:function value(e,t,i){var r=this.area,n=r.width,o=r.height,a=this.checkSelect(e,t);if(e=nO(e,0,n),t=nO(t,0,o),this.startX=e,this.startY=t,this.mouseDown=!0,a<0)return i||this.clear(),this.activeBoxId=null,void(this.lastKeepAspectRatio&&!this.keepAspectRatio&&this.setKeepAspectRatio(!0));var s=this.cropBoxes[a].uid;this.currentBoxId=s,this.activeBoxId=s,this.getBoxByUid(s).onStartHandler(e,t),!this.keepAspectRatioEdit&&this.keepAspectRatio&&(this.lastKeepAspectRatio=this.keepAspectRatio,this.setKeepAspectRatio(!1));}},{key:"onMoveHandler",value:function value(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.mouseDown){var r=null,n=this.activeBoxId,o=this.startX,a=this.startY,s=this.aspectRatio,l=this.area,u=l.width,c=l.height;e=nO(e,0,u);var h=(t=nO(t,0,c))-a,d=e-o,f=2/this.zoom,v=null;if(n||(d<-f&&h<-f?v=0:d>f&&h<-f?v=1:d>f&&h>f?v=2:d<-f&&h>f&&(v=3),null!==v&&s>0&&(h=d/s,v%2&&(h=-d/s))),null!==v&&i){for(var g=[],m=v%2?[o,a,o,a+h,e,a+h,e,a]:[e,a+h,o,a+h,o,a,e,a],y=0;y<4;y++)g.push(m[2*(v+y)%8]),g.push(m[(2*(v+y)+1)%8]);return(r=this.addBox(g)).keepAspectRatio=this.keepAspectRatio&&s>0,this.drawingFlag=!0,this.addNewFlag=this.keepAspectRatio,this.currentBoxId=r.uid,this.activeBoxId=r.uid,r.onStartHandler(this.startX,this.startY,v),r.onMoveHandler(e,t,v),void(v=null);}this.activeBoxId&&(r=this.getBoxByUid(this.activeBoxId)),r&&r.onMoveHandler(e,t);}}},{key:"onEndHandler",value:function value(){var e;if(this.mouseDown&&this.activeBoxId){this.mouseDown=!1,this.drawingFlag=!1;var t=this.getBoxByUid(this.activeBoxId);t&&(null!==this.addNewFlag&&(t.keepAspectRatio=this.addNewFlag,this.addNewFlag=null),t.onEndHandler(),this.cropBoxes.length>0&&null!==(e=this.selectedCallback)&&void 0!==e&&e.call(this,this.getRectArr()),this.activeBoxId=null);}}}]);}(),iW=function(){return Yk(function e(){Xk(this,e),Wk(this,"cropMng",void 0),Wk(this,"originalBoxes",[]),Wk(this,"mouseDown",!1),Wk(this,"imgData",null),this.cropMng=new tW(0,0);},[{key:"getBoxesData",value:function value(e,t){for(var i=e.length,r=[],n=[],o=0;o<i;o++){var a=e[o];if(ZN(a.left)&&ZN(a.top)&&ZN(a.width)&&ZN(a.height)){var s=a.left,l=a.top,u=a.width,c=a.height;r.push(Fk({},a)),t.width>0&&t.height>0&&(s=s<0||s>t.width?0:s,l=l<0||l>t.height?0:l,c=c<=0?1:c,(u=u<=0?1:u)+s>t.width&&(u=t.width-s),c+l>t.height&&(c=t.height-l));var h={left:s,top:l,width:u,height:c};n.push(h);}}return{oriBoxes:r,newBoxes:n};}},{key:"resetBoxes",value:function value(){if(this.originalBoxes.length<1)return!1;var e=this.cropMng;e.removeBox();for(var t=this.getBoxesData(this.originalBoxes,e.area).newBoxes,i=t.length,r=0;r<i;r++){var n=t[r],o=n.left,a=n.top,s=n.width,l=n.height;this.cropMng.addBox([o,a,o+s,a,o+s,a+l,o,a+l]);}return!0;}},{key:"initCrop",value:function value(e,t,i,r){this.cropMng.setCanvas(i),this.cropMng.setCanvasSize(e,t),this.cropMng.setCropSetting(r);}},{key:"setCropArea",value:function value(e,t,i,r){this.cropMng.setArea(e,t,i,r);}},{key:"setCropConfig",value:function value(e){var t=e.zoom,i=e.scrollTop,r=e.scrollLeft;t&&this.cropMng.setZoom(t),HN(i)||this.cropMng.setScrollTop(i),HN(r)||this.cropMng.setScrollLeft(r);}},{key:"updateCropSetting",value:function value(e){return this.cropMng.setCropSetting(e),!0;}},{key:"setFreeBox",value:function value(e){var t,i;if(!this.cropMng.canvasItem)return!1;if(!e){var r=this.cropMng.area,n=r.width,o=r.height;e=[0,0,n,0,n,o,0,o];}return this.cropMng.addFreeBox(e),null!==(t=(i=this.cropMng).selectedCallback)&&void 0!==t&&t.call(i,this.cropMng.getRectArr()),!0;}},{key:"setNormalBoxes",value:function value(e){var t,i,r,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=this.cropMng,s=a.canvasItem,l=a.area;if(!s)return!1;var u=null;if(NN(e)){if(0===(u=e).length)return!1;}else{if(!ON(e))return!1;u=[e];}var c=this.getBoxesData(u,l),h=c.oriBoxes,d=c.newBoxes,f=d.length;n||this.cropMng.count()>0&&this.clearBox();for(var v=0;v<f;v++){var g=d[v],m=g.left,y=g.top,p=g.width,w=g.height;this.cropMng.addBox([m,y,m+p,y,m+p,y+w,m,y+w],o);}return(t=this.originalBoxes).push.apply(t,Ub(h)),null!==(i=(r=this.cropMng).selectedCallback)&&void 0!==i&&i.call(r,this.cropMng.getRectArr()),!0;}},{key:"clearSelectedBoxes",value:function value(e){var t,i=this.cropMng;return!!i.canvasItem&&(mE(t=this.originalBoxes).call(t,e,1),i.removeBox(e),this.render(),!0);}},{key:"clearBox",value:function value(){var e=this.cropMng;return!(!e.canvasItem||e.cropBoxes.length&&0!==e.cropBoxes.length&&(this.originalBoxes=[],e.canvasItem.style.cursor="crosshair",e.removeBox(),this.render(),0));}},{key:"getCropBoxes",value:function value(){return this.cropMng.getCropBoxes();}},{key:"getBoxCount",value:function value(){var e=this.cropMng;return e.cropBoxes.length?e.cropBoxes.length:0;}},{key:"getCropCoordinate",value:function value(e){var t=this.cropMng;return!(!t.canvasItem||0===t.cropBoxes.length)&&(void 0!==e?!!(ZN(e)&&e<t.cropBoxes.length)&&t.cropBoxes[e].probePoints:t.getBoxByUid(t.currentBoxId).probePoints);}},{key:"setMagnifier",value:function value(e){this.imgData=e;}},{key:"render",value:function value(){var e,t=this,i=this.cropMng,r=i.canvasItem,n=i.zoom,o=i.area,a=i.scrollTop,s=i.scrollLeft,l=i.cropSetting;if(r&&i.cropBoxes.length){var u=r.getContext("2d"),c=l.dashLine,h=l.borderColor,d=l.borderWidth,f=l.ctrlBorderColor,v=l.ctrlBackground,g=l.ctrlBorderWidth,m=l.ctrlBorderRadius,y=l.background,p=l.invalidBorderColor,w=l.invalidCtrlBorderColor,b=l.ctrlSize,k=l.ctrlWidth,S=l.ctrlHeight;u.setTransform(1,0,0,1,0,0),$k(e=i.cropBoxes).call(e,function(e){for(var i,r,l=NI(i=e.probePoints).call(i,0,8),x=NI(r=e.midpoints).call(r,0,8),C=0;C<4;C++)l[2*C]=l[2*C]*n+o.left-s,l[2*C+1]=l[2*C+1]*n+o.top-a,x[2*C]=x[2*C]*n+o.left-s,x[2*C+1]=x[2*C+1]*n+o.top-a;u.save();var V=UO();try{u.setLineDash([c[0]*V,c[1]*V]);}catch(e){console.error("your browser does not support setLineDash().");}u.strokeStyle=e.isConvex?h:p,u.fillStyle=y,u.lineWidth=d*V,u.beginPath(),u.moveTo(l[0]*V,l[1]*V);for(var T=1;T<4;T++)u.lineTo(l[2*T]*V,l[2*T+1]*V);u.closePath(),hP(u).call(u),u.stroke(),u.strokeStyle=e.isConvex?f:w,u.fillStyle=v,u.lineWidth=g*V;var I=b,E=b;I=ZN(k)?k*V:ZN(S)?S*V:b*V,ZN(S)?E=S*V:I=ZN(k)?k*V:b*V;for(var P=0;P<4;P++){u.setLineDash([0,0]),u.beginPath();for(var B=l[2*P],D=l[2*P+1],M=0;M<4;M++)t.drawRoundedRectangle(u,{x:B*V,y:D*V,width:I,height:E,radius:Math.min(m*V,b*V/2)});u.closePath(),hP(u).call(u),u.stroke();}for(var A=0;A<4;A++){u.beginPath();for(var U=x[2*A],z=x[2*A+1],R=0;R<4;R++)t.drawRoundedRectangle(u,{x:U*V,y:z*V,width:I,height:E,radius:Math.min(m*V,b*V/2)});u.closePath(),hP(u).call(u),u.stroke();}u.restore();});}}},{key:"drawRoundedRectangle",value:function value(e,t){var i=t.width,r=t.height,n=t.radius,o=t.x,a=t.y,s=[{x:o-i/2+n,y:a-r/2+n,start:Math.PI,end:3*Math.PI/2},{x:o+i/2-n,y:a-r/2+n,start:3*Math.PI/2,end:2*Math.PI},{x:o+i/2-n,y:a+r/2-n,start:0,end:Math.PI/2},{x:o-i/2+n,y:a+r/2-n,start:Math.PI/2,end:Math.PI}];if(e.beginPath(),e.arc)for(var l=0;l<4;l++){var u=s[l];e.arc(u.x,u.y,n,u.start,u.end);}else e.rect(o-i/2,a-r/2,i,r);e.closePath();}},{key:"toCanvas",value:function value(e){var t=window.TouchEvent&&e instanceof window.TouchEvent?e.targetTouches[0]:e,i=this.cropMng.canvasItem.getBoundingClientRect(),r=RO(),n=r.scrollX,o=r.scrollY;return{offsetX:t.pageX-n-i.left,offsetY:t.pageY-o-i.top};}},{key:"onStartHandler",value:function value(e){var t=this.cropMng.cropSetting.multipleCropping,i=this.toCanvas(e),r=this.toAreaCoordinate(i.offsetX,i.offsetY);this.mouseDown=!0,this.cropMng.onStartHandler(r.x,r.y,e.ctrlKey&&t);}},{key:"onMoveHandler",value:function value(e){var t=this.cropMng,i=t.canvasItem,r=t.cropSetting,n=t.cropBoxes;if(this.mouseDown||0!==n.length){var o=r.enableCreateBoxByPointer,a=r.keepAspectRatioWithShift,s=r.keepAspectRatio,l=r.enableCursor,u=r.enableMagnifier,c=this.toCanvas(e),h=this.toAreaCoordinate(c.offsetX,c.offsetY);if(!this.mouseDown&&l){var d=this.cropMng.checkSelectForCursor(h.x,h.y);if(null===d)return void(i.style.cursor="crosshair");"default"===d.mode?i.style.cursor="move"===d.position?"move":"".concat(d.position,"-resize"):i.style.cursor=["move","nw-resize","ne-resize","se-resize","sw-resize","sw-resize","n-resize","e-resize","s-resize","w-resize"][d.part+1];}if(this.mouseDown){this.cropMng.onMoveHandler(h.x,h.y,o),e.shiftKey&&a?this.cropMng.setKeepAspectRatio(!0):s||this.cropMng.setKeepAspectRatio(!1);var f=this.cropMng.isInArea(h.x,h.y),v=this.cropMng.checkSelectVertex(h.x,h.y);this.mouseDown&&u&&f&&v&&this.renderMagnifier(e,h.x,h.y);}}else"crosshair"!==i.style.cursor&&(i.style.cursor="crosshair");}},{key:"onEndHandler",value:function value(e){this.mouseDown=!1,this.cropMng.onEndHandler();}},{key:"renderMagnifier",value:function value(e,t,i){var r=this.cropMng;if(this.imgData&&r.canvasItem){var n=r.cropSetting,o=n.dashLine,a=n.borderColor,s=n.borderWidth,l=n.magnifier,u=l.fixed,c=l.fixedLeft,h=l.fixedTop,d=l.size,f=l.magnification,v=this.cropMng.canvasItem.getContext("2d"),g=this.toCanvas(e),m=2*d*f,y=g.offsetX,p=g.offsetY,w=f*d,b=g.offsetX-w,k=g.offsetY-w;u&&(y=h+d,p=c+d,b=h-(w=(f-1)*d),k=c-w),v.save(),v.beginPath(),v.arc(y,p,d,0,2*Math.PI),v.closePath(),v.clip(),v.drawImage(this.imgData,t-d,i-d,2*d,2*d,b,k,m,m),v.lineWidth=s,v.strokeStyle=a,v.setLineDash([o[0],o[1]]);var S=u?h+d:g.offsetX,x=u?c+d:g.offsetY;v.beginPath(),v.moveTo(S,x-d),v.lineTo(S,x+d),v.moveTo(S-d,x),v.lineTo(S+d,x),v.stroke(),v.restore();}}},{key:"toAreaCoordinate",value:function value(e,t){var i=this.cropMng,r=i.area,n=i.scrollLeft,o=i.scrollTop,a=i.zoom;return{x:e=(e-r.left+n)/a,y:t=(t-r.top+o)/a};}}]);}(),rW=function(){return Yk(function e(){Xk(this,e);},[{key:"init",value:function value(e){var t=e.rendererService.canvasDom,i=new iW();e.boxRenderer=i,i.cropMng.selectedCallback=function(){var t=e.getCurrentTab(),r=i.cropMng.getRectArr(),n=e.getStatus(t.currentPage.uid).imageScale;"single"===e.config.displayMode&&(n=1);var o=[];$k(r).call(r,function(e){var i={index:t.current,x:Math.floor(e.x*n),y:Math.floor(e.y*n),width:Math.floor(e.width*n),height:Math.floor(e.height*n)};o.push(i);}),e.emit("pageAreaSelected",t.current,o);},i.cropMng.unselectedCallback=function(){var t=e.getCurrentTab();e.emit("pageAreaUnselected",t.current);},i.initCrop(t.width,t.height,t,{}),this.listenNativeEvents(e),this.listenViewerHooks(e);}},{key:"listenNativeEvents",value:function value(e){var t=e.rendererService.canvasDom,i=!1,r=function r(t){var r=Ab(e.formatTouches(t),1)[0];if("crop"===e.config.toolType){e.getPointerOverPageInfo(r.pageX,r.pageY).pageInfo.obj;var n=e.getCurrentTab();n&&n.currentPage&&(i=!0,e.boxRenderer.onStartHandler(t));}},n=function n(t){if("crop"===e.config.toolType&&(e.boxRenderer.onMoveHandler(t),i)){var r=e.getCurrentTab();e.rendererService.render(r);}},o=function o(t){if("crop"===e.config.toolType&&(e.boxRenderer.onEndHandler(t),i)){i=!1;var r=e.getCurrentTab();e.rendererService.render(r);}},a=function a(e){e.cancelable&&e.preventDefault();};t.addEventListener("touchmove",a,{passive:!1}),window.PointerEvent?(t.addEventListener("pointerdown",r),document.addEventListener("pointermove",n),document.addEventListener("pointerup",o)):window.MSPointerEvent&&(t.addEventListener("MSPointerDown",r),document.addEventListener("MSPointerMove",n),document.addEventListener("MSPointerUp",o)),e.hooksService.hooks.destroy.on(function(){t.removeEventListener("touchmove",a),window.PointerEvent?(t.removeEventListener("pointerdown",r),document.removeEventListener("pointermove",n),document.removeEventListener("pointerup",o)):window.MSPointerEvent&&(t.removeEventListener("MSPointerDown",r),document.removeEventListener("MSPointerMove",n),document.removeEventListener("MSPointerUp",o));});}},{key:"listenViewerHooks",value:function value(e){var t=function t(_t3,i){if("min"===i&&"multiple"===e.config.displayMode){var r=e.getCurrentTab();if(r){var n=r.currentPage;if(n&&n.uid===_t3){var o=e.getStatus(n.uid).imageScale,a=e.boxRenderer.cropMng.cropBoxes;e.boxRenderer.clearBox(),$k(a).call(a,function(t){var i=t.getRect();if(!t.isScaled){var r=i.x,n=i.y,a=i.width,s=i.height,l=r/o,u=n/o;a/=o,s/=o,e.boxRenderer.cropMng.addBox([l,u,l+a,u,l+a,u+s,l,u+s]).isScaled=!0;}}),e.renderOnly();}}}},i=e.hooksService.hooks,r=function r(){if("crop"===e.config.toolType){var t=e.getCurrentTab();t&&t.isTopPageChanged&&!t.isLoadPage&&e.config.autoSelectTopPage&&e.boxRenderer.clearBox();}},n=function n(){if("crop"===e.config.toolType){var t=e.getCurrentTab();if(t){var i=t.currentPage;if(i){var r,n,o,a=i.imageContainer.getPosition(),s=i.imageContainer.parsedStyle,l=s.width,u=s.height;null!==(r=e.boxRenderer)&&void 0!==r&&r.setCropArea(a.x,a.y,l.value,u.value),null!==(n=e.boxRenderer)&&void 0!==n&&n.setCropConfig({zoom:(null==i?void 0:i.zoom)||1}),null===(o=e.boxRenderer)||void 0===o||o.render();}}}},o=function o(){e.viewer.clearCropBox();};e.rendererService.hooks.beforeRender.on(r),e.rendererService.hooks.afterRender.on(n),i.afterBufferChanged.on(o),e.dvsContext.hooksService.hooks.afterLoadImage.on(t),e.hooksService.hooks.destroy.on(function(){e.rendererService.hooks.beforeRender.off(r),e.rendererService.hooks.afterRender.off(n),i.afterBufferChanged.off(o),e.dvsContext.hooksService.hooks.afterLoadImage.off(t);});}}]);}(),nW={name:"dvsBoxRenderer",install:function install(e){var t=e.getClassStore(),i=t.Viewer;if(i){var r=function(e,t){return t=function(e){function t(e){var i;return Xk(this,t),Wk(Pw(i=IN(this,t,[e])),"boxRenderer",void 0),i.context.config.pure||new rW().init(i.context),i.context.configService.registerHandler("cropBoxConfig",function(e,t){ON(t)&&(i.context.boxRenderer.updateCropSetting(t),i.context.renderOnly());}),i.context.config.cropBoxConfig||(i.context.config.cropBoxConfig=i.cropBoxConfig),i;}return Mb(t,e),Yk(t,[{key:"cropBoxConfig",get:function get(){return this.context.boxRenderer.cropMng.cropSetting;},set:function set(e){ON(e)&&(this.context.boxRenderer.updateCropSetting(e),this.context.renderOnly());}},{key:"setFreeCropBox",value:function value(e){var t=this.getCurrentTab();if(t){var i=t.currentPage;if(i){var r=this.context.getStatus(i.uid);r&&this.context.boxRenderer.setCropArea(0,0,r.realTimeWidth||0,r.realTimeHeight||0);}}var n=this.context.boxRenderer.setFreeBox(JA(e).call(e));return n&&this.context.renderOnly(),n;}},{key:"setCropBox",value:function value(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.getCurrentTab(),r=!1;if(i){var n=i.currentPage;if(n){var o=this.context.getStatus(n.uid);if(o&&(this.context.boxRenderer.setCropArea(0,0,n.realTimeWidth||0,n.realTimeHeight||0),"multiple"===this.context.config.displayMode&&this.context.config.useMinImage)){var a=o.imageScale;NN(e)||(e=[e]);var s=[];$k(e).call(e,function(e){var t={left:e.left/a,top:e.top/a,width:e.width/a,height:e.height/a};s.push(t);}),e=s,r=!0;}}}var l=this.context.boxRenderer.setNormalBoxes(e,t,r);return l&&this.context.renderOnly(),l;}},{key:"clearCropBox",value:function value(){var e=this.context.boxRenderer.clearBox();return e&&this.context.boxRenderer.getBoxCount()>0&&this.context.renderOnly(),e;}},{key:"getCropBoxes",value:function value(){var e=this.context.boxRenderer.getCropBoxes(),t=this.getCurrentTab();if(t){var i=t.currentPage;if(i){var r=this.context.getStatus(i.uid);if(r&&"multiple"===this.context.config.displayMode&&this.context.config.useMinImage){var n=r.imageScale;e=QE(e).call(e,function(e){return{left:e.left*n,top:e.top*n,width:e.width*n,height:e.height*n};});}}}return e;}}]);}(e),Wk(t,"use",e.use),t;}(i);t.Viewer=r;}}};function oW(e,t){if(fS(t))return{unit:"px",value:0};if(QN(t))return{unit:"px",value:0};if(ZN(t))return{unit:"px",value:t};if(t=zS(t).call(t).toLowerCase(),oU(Number(t))&&"px".search(e)>=0)return{unit:"px",value:Number(t)};var i=[];t=t.replace(e,function(e){return i.push(e),"U".concat(e);});var r="U(".concat(e.source,")");return QE(i).call(i,function(e){return{unit:e,value:Number(t.replace(new RegExp("U".concat(e),"g"),"").replace(new RegExp(r,"g"),"*0"))};})[0];}var aW=function aW(e){return oW(/px/g,e);},sW=function sW(e){return oW(/px|%|em/g,e);},lW=function lW(e){return oW(/deg|rad|grad|turn/g,e);},uW=function(){function e(t,i,r){var n,o,a,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,l=arguments.length>4&&void 0!==arguments[4]&&arguments[4];Xk(this,e),Wk(this,"r",void 0),Wk(this,"g",void 0),Wk(this,"b",void 0),Wk(this,"alpha",void 0),Wk(this,"isNone",void 0),Wk(this,"formatted",""),this.r=t,this.g=i,this.b=r,this.alpha=s,this.isNone=l,this.formatted=uS(n=uS(o=uS(a="rgba(".concat(t,", ")).call(a,i,", ")).call(o,r,", ")).call(n,s,")");}return Yk(e,[{key:"clone",value:function value(){return new e(this.r,this.g,this.b,this.alpha);}}]);}(),cW=function(){function e(t,i){Xk(this,e),Wk(this,"type",void 0),Wk(this,"value",void 0),this.type=t,this.value=i;}return Yk(e,[{key:"clone",value:function value(){return new e(this.type,this.value);}}]);}(),hW={left:180,top:-90,bottom:90,right:0,"left top":225,"top left":225,"left bottom":135,"bottom left":135,"right top":-45,"top right":-45,"right bottom":45,"bottom right":45},dW=function dW(e){return{value:"angular"===e.type?Number(e.value):hW[e.value]||0,unit:"deg"};};function fW(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(QN(e))return null;if("currentColor"===e&&(e="black"),"transparent"===e)return new uW(0,0,0,0);var t=function(e){var t;if(WI(e).call(e,"linear")>-1||WI(e).call(e,"radial")>-1)return QE(t=qN(e)).call(t,function(e){var t=e.type,i=e.orientation,r=e.colorStops;!function(e,t,i){var r=e.length;e[r-1].length=null!==(t=e[r-1].length)&&void 0!==t?t:{type:"%",value:"100"},r>1&&(e[0].length=null!==(i=e[0].length)&&void 0!==i?i:{type:"%",value:"0"});for(var n=0,o=Number(e[0].length.value),a=1;a<r;a++){var s,l=null===(s=e[a].length)||void 0===s?void 0:s.value;if(!QN(l)&&!QN(o)){for(var u=1;u<a-n;u++)e[n+u].length={type:"%",value:"".concat(o+(Number(l)-o)*u/(a-n))};n=a,o=Number(l);}}}(r);var n=QE(r).call(r,function(e){return{offset:{value:e.length.value,unit:"%"},color:XN(e)};});if("linear-gradient"===t)return new cW(1,{angle:i?dW(i):{value:0,unit:"deg"},steps:n});if("radial-gradient"===t&&(i||(i=[{type:"shape",value:"circle"}]),"shape"===i[0].type&&"circle"===i[0].value)){var o,a=function(e){var t=50,i=50,r="%",n="%";if("position"===(null==e?void 0:e.type)){var o=e.value,a=o.x,s=o.y;"position-keyword"===(null==a?void 0:a.type)&&("left"===a.value?t=0:"center"===a.value?t=50:"right"===a.value?t=100:"top"===a.value?i=0:"bottom"===a.value&&(i=100)),"position-keyword"===(null==s?void 0:s.type)&&("left"===s.value?t=0:"center"===s.value?i=50:"right"===s.value?t=100:"top"===s.value?i=0:"bottom"===s.value&&(i=100)),"px"!==(null==a?void 0:a.type)&&"%"!==(null==a?void 0:a.type)&&"em"!==(null==a?void 0:a.type)||(r=null==a?void 0:a.type,t=Number(a.value)),"px"!==(null==s?void 0:s.type)&&"%"!==(null==s?void 0:s.type)&&"em"!==(null==s?void 0:s.type)||(n=null==s?void 0:s.type,i=Number(s.value));}return{cx:{value:t,unit:r},cy:{value:i,unit:n}};}(i[0].at),s=a.cx,l=a.cy;if(i[0].style){var u=i[0].style,c=u.type,h=u.value;o="extent-keyword"===c?h:{value:h,unit:c};}return new cW(2,{cx:s,cy:l,size:o,steps:n});}});}(e);if(t)return t;var i=function(e){var t,i,r;if(e=zS(t="".concat(e)).call(t).toLowerCase(),lO.exec(e))switch(i=lO.exec(e),r=i[1].length,i=$S(i[1],16),r){case 6:return yO(i);case 3:return new mO(i>>8&15|i>>4&240,i>>4&15|240&i,(15&i)<<4|15&i,1);case 8:return pO(i>>24&255,i>>16&255,i>>8&255,(255&i)/255);case 4:return pO(i>>12&15|i>>8&240,i>>8&15|i>>4&240,i>>4&15|240&i,((15&i)<<4|15&i)/255);default:return null;}return uO.exec(e)?(i=uO.exec(e),new mO(i[1],i[2],i[3],1)):cO.exec(e)?(i=cO.exec(e),new mO(255*i[1]/100,255*i[2]/100,255*i[3]/100,1)):hO.exec(e)?pO((i=hO.exec(e))[1],i[2],i[3],i[4]):dO.exec(e)?pO(255*(i=dO.exec(e))[1]/100,255*i[2]/100,255*i[3]/100,i[4]):fO.exec(e)?kO(wO((i=fO.exec(e))[1],i[2]/100,i[3]/100,1)):vO.exec(e)?kO(wO((i=vO.exec(e))[1],i[2]/100,i[3]/100,i[4])):gO.hasOwnProperty(e)?yO(gO[e]):"transparent"===e?new mO(NaN,NaN,NaN,0):null;}(e),r=[0,0,0,0];return null!==i&&(r[0]=$S(i.r,10)||0,r[1]=$S(i.g,10)||0,r[2]=$S(i.b,10)||0,r[3]=wU(i.opacity)),Iv(uW,r);}function vW(e){var t=null;NN(e)&&(t=e),jN(e)&&(t=e.split(" "));for(var i=0;i<3;i++)t[i]?t[i]=aW(t[i]).value:t[i]=0;var r=fW(t[3]);return t[3]=r?r.formatted:"black",NI(t).call(t,0,4);}function gW(e){var t,i=[];return jN(e)?$k(t=e.split(" ")).call(t,function(e){var t=aW(e);t&&i.push(t.value);}):i.push.apply(i,Ub(e)),1===i.length?[i[0],i[0]]:i;}var mW=function mW(e){var t=e;if(jN(e)){var i=sW(e);"%"===i.unit&&(t=i.value/100),"px"===i.unit&&(t=i.value);}return t>1&&(t=1),t;};function yW(e,t,i){var r=i.parsedStyle,n=r.x,o=void 0===n?0:n,a=r.y,s=void 0===a?0:a;r.z,e!==t&&i.setLocalPosition(o,s);}var pW=function(){return Yk(function e(t){Xk(this,e),Wk(this,"bubbles",!0),Wk(this,"cancelBubble",!0),Wk(this,"cancelable",!1),Wk(this,"composed",!1),Wk(this,"currentTarget",void 0),Wk(this,"defaultPrevented",!1),Wk(this,"eventPhase",e.prototype.NONE),Wk(this,"isTrusted",void 0),Wk(this,"returnValue",void 0),Wk(this,"srcElement",void 0),Wk(this,"target",void 0),Wk(this,"timeStamp",void 0),Wk(this,"type",void 0),Wk(this,"detail",void 0),Wk(this,"view",void 0),Wk(this,"which",void 0),Wk(this,"path",void 0),Wk(this,"immediatePropagationStopped",!1),Wk(this,"propagationStopped",!1),Wk(this,"nativeEvent",void 0),Wk(this,"originalEvent",void 0),Wk(this,"eventService",void 0),Wk(this,"AT_TARGET",1),Wk(this,"BUBBLING_PHASE",2),Wk(this,"CAPTURING_PHASE",3),Wk(this,"NONE",0),this.eventService=t;},[{key:"initUIEvent",value:function value(e,t,i,r,n){}},{key:"composedPath",value:function value(){var e=this.path,t=this.eventService,i=this.target;return!t||e&&e[this.path.length-1]===i||(this.path=i?t.getPropagationPath(i):[]),this.path;}},{key:"initEvent",value:function value(e,t,i){}},{key:"preventDefault",value:function value(){var e=this.nativeEvent;e instanceof Event&&e.cancelable&&e.preventDefault(),this.defaultPrevented=!0;}},{key:"stopImmediatePropagation",value:function value(){this.immediatePropagationStopped=!0;}},{key:"stopPropagation",value:function value(){this.propagationStopped=!0;}}]);}(),wW=function(e){function t(e,i){var r;return Xk(this,t),(r=IN(this,t,[null])).type=e,r.detail=i,r;}return Mb(t,e),Yk(t);}(pW),bW=function(){return Yk(function e(){Xk(this,e),Wk(this,"pubsub",LO.create());},[{key:"addEventListener",value:function value(e,t,i){var r,n=_N(i)&&i;ON(i)&&(n=i.capture,r=i.once),e=n?"".concat(e,":capture"):e,t=GN(t)?t:t.handleEvent,this.pubsub.on(e,t,this,r);}},{key:"dispatchEvent",value:function value(e){var t,i=this.ownerDocument||this.document;return i&&(e.eventService=(null===(t=i.defaultView)||void 0===t?void 0:t.eventService)||null,e.defaultPrevented=!1,e.path=[],e.target=this,function(e,t,i){if(t=null!==(i=t)&&void 0!==i?i:e.type,e.propagationStopped=!1,e.immediatePropagationStopped=!1,e.target){var r=e.composedPath(),n=r.length;e.eventPhase=e.CAPTURING_PHASE;for(var o=0;o<n-1;o++)if(e.currentTarget=r[o],kW(e,"".concat(t,":capture")),SW(e))return;if(e.eventPhase=e.AT_TARGET,e.currentTarget=e.target,kW(e,t),!SW(e)){e.eventPhase=e.BUBBLING_PHASE;for(var a=n-2;a>=0;a--)if(e.currentTarget=r[a],kW(e,t),SW(e))return;}}}(e)),!e.defaultPrevented;}},{key:"removeEventListener",value:function value(e,t,i){var r=_N(i)&&i;ON(i)&&(r=i.capture),e=r?"".concat(e,":capture"):e,t=GN(t)?t:t.handleEvent,this.pubsub.off(e,t,context);}},{key:"removeAllEventListeners",value:function value(){this.pubsub.removeAllEventListeners();}},{key:"getAllEvents",value:function value(){return this.pubsub.getAllEvents();}}]);}();function kW(e,t){for(var i=e.currentTarget.getAllEvents()[t]||[],r=0,n=i.length;r<n;r++){if(e.immediatePropagationStopped)return;var o=i[r],a=o.context;o.fn.call(a,e);}}function SW(e){return e.propagationStopped||e.immediatePropagationStopped;}var xW=function(e){function t(e,i,r,n,o,a,s,l){var u;return Xk(this,t),Wk(Pw(u=IN(this,t,[null])),"relatedNode",void 0),Wk(Pw(u),"prevValue",void 0),Wk(Pw(u),"newValue",void 0),Wk(Pw(u),"attrName",void 0),Wk(Pw(u),"attrChange",void 0),Wk(Pw(u),"prevParsedValue",void 0),Wk(Pw(u),"newParsedValue",void 0),u.type=e,u.relatedNode=i,u.prevValue=r,u.newValue=n,u.attrName=o,u.attrChange=a,u.prevParsedValue=s,u.newParsedValue=l,u;}return Mb(t,e),Yk(t);}(pW);Wk(xW,"ADDITION",2),Wk(xW,"MODIFICATION",1),Wk(xW,"REMOVAL",3);var CW=new(function(){return Yk(function e(){Xk(this,e);},[{key:"querySelector",value:function value(e,t){return NU(e).call(e,"#")?CP(t).call(t,function(t){return t.id===e.substring(1);}):null;}},{key:"querySelectorAll",value:function value(e,t){return[];}}]);}())(),VW=new(function(){return Yk(function e(t){Xk(this,e),Wk(this,"selector",void 0),this.selector=t;},[{key:"recursiveUpdateHierarchy",value:function value(e){var t=this,i=e.transform,r=e.childNodes;i.frozen||(i.frozen=!0,(i.localDirty||i.worldDirty)&&this.updateHierarchy(e),$k(r).call(r,function(e){t.recursiveUpdateHierarchy(e);}));}},{key:"querySelector",value:function value(e,t){return this.selector.querySelector(e,t);}},{key:"querySelectorAll",value:function value(e,t){return this.selector.querySelectorAll(e,t);}},{key:"append",value:function value(e,t,i){e.parentNode&&this.remove(e),e.parentNode=t;var r=t.childNodes,n=t.sortable;void 0!==i?mE(r).call(r,i,0,e):r.push(e),n&&(n.dirty=!0);var o=e.transform;o&&this.dirtyWorld(e,o),o.frozen&&this.unfreezeParentToRoot(e);}},{key:"remove",value:function value(e){var t=e.parentNode,i=!0;if(!t)return i=!1;var r=t.sortable;r&&(r.dirty=!0);var n=t.childNodes,o=WI(n).call(n,e);o>-1?(i=!0,mE(n).call(n,o,1)):i=!1;var a=e.transform;return a&&this.dirtyWorld(e,a),e.parentNode=null,i;}},{key:"isChildExist",value:function value(e){var t=e.parentNode;if(!t)return!1;var i=t.childNodes;return!(WI(i).call(i,e)<0);}},{key:"setOrigin",value:function value(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;ZN(t)&&(t=jO.fromValue(t,i));var r=e.transform;r.origin.equals(t)||(r.origin.setFromVector(t),this.dirtyLocal(e,r));}},{key:"getOrigin",value:function value(e){return e.transform.origin;}},{key:"setPosition",value:function value(e,t){var i=e.transform;t=jO.fromValue(t.x,t.y,t.z||0);var r=this.getPosition(e);if(!t.equals(r)){var n=this.getWorldTransform(e),o=this.getPosition(e),a=t.x-o.x,s=t.y-o.y,l=t.z-o.z;if(i.position=t,e.hasParentTransform()){n=new tL().translateSelf(a,s,l).multiply(n);var u=e.parentNode.transform.worldTransform,c=this.getWorldTransform(e);c.m41=t.x,c.m42=t.y,c.m43=t.z;var h=u.inverse().multiply(n),d=this.getOrigin(e),f=h.getScaling(),v=this.createScaleMatrix(f.x,f.y,f.z),g=tL.fromMatrix(v).inverse(),m=h.translate(d.x,d.y,d.z).multiply(g),y=m.getRotation(),p=tL.fromQuat(y).inverse(),w=m.multiply(p).getTranslation();w.x-=d.x,w.y-=d.y,w.z-=d.z,i.localPosition.setFromVector(w);}else i.localPosition=t;this.dirtyLocal(e,i);}}},{key:"setLocalPosition",value:function value(e,t){var i=e.transform;(t=jO.fromValue(t.x,t.y,t.z||0)).equals(i.localPosition)||(i.localPosition=t,this.dirtyLocal(e,i));}},{key:"getPosition",value:function value(e){var t=this.getWorldTransform(e),i=e.transform,r=t.getTranslation();return i.position.setFromVector(r),e.transform.position;}},{key:"getLocalPosition",value:function value(e){return e.transform.localPosition;}},{key:"translate",value:function value(e,t){if(!t.equals(new jO())){var i=this.getPosition(e),r=this.getWorldTransform(e),n=r.getScaling(),o=this.createScaleMatrix(n.x,n.y,n.z),a=r.multiply(tL.fromMatrix(o).inverse()).getRotation(),s=tL.fromQuat(a).transformPoint(t);i.add(s),this.setPosition(e,i);}}},{key:"translateLocal",value:function value(e,t){var i=e.transform;if(!t.equals(new jO())){t.multiply(i.localScale);var r=tL.fromQuat(i.localRotation).transformPoint(t);i.localPosition.add(r),this.dirtyLocal(e,i);}}},{key:"scaleLocal",value:function value(e,t){var i=e.transform;i.localScale.multiply(t),this.dirtyLocal(e,i);}},{key:"setLocalScale",value:function value(e,t){var i=e.transform,r=jO.fromValue(t.x,t.y,t.z||i.localScale.z);r.equals(i.localScale)||(i.localScale=r,this.dirtyLocal(e,i));}},{key:"getScale",value:function value(e){var t=e.transform,i=this.getWorldTransform(e).getScaling();return t.scale.setFromVector(i),t.scale;}},{key:"getLocalScale",value:function value(e){return e.transform.localScale;}},{key:"getRotation",value:function value(e){var t=e.transform,i=this.getWorldTransform(e),r=i.getScaling(),n=this.createScaleMatrix(r.x,r.y,r.z),o=i.multiply(tL.fromMatrix(n).inverse()).getRotation();return t.rotation.setFromQuat(o),t.rotation;}},{key:"getLocalRotation",value:function value(e){return e.transform.localRotation;}},{key:"rotate",value:function value(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=e.transform;if(ZN(t)&&(t=YO(t,i,r)),e.hasParentTransform()){var o=$O(t.x,t.y,t.z),a=this.getRotation(e),s=this.getRotation(e.parentNode).clone().invert().multiply(o).multiply(a).normalize();n.localRotation.setFromQuat(s),this.dirtyLocal(e,n);}else this.rotateLocal(e,t);}},{key:"rotateLocal",value:function value(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;ZN(t)&&(t=YO(t,i,r));var n=e.transform,o=$O(t.x,t.y,t.z);n.localRotation.multiply(o),this.dirtyLocal(e,n);}},{key:"setAngle",value:function value(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;ZN(t)&&(t=YO(t,i,r));var n=e.transform;if(e.hasParentTransform()){var o=$O(t.x,t.y,t.z);n.localRotation.setFromQuat(o);var a=this.getRotation(e.parentNode);a.invert(),n.localRotation.setFromQuat(a.multiply(n.localRotation)),this.dirtyLocal(e,n);}else this.setLocalAngle(e,t);}},{key:"setLocalAngle",value:function value(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;ZN(t)&&(t=YO(t,i,r));var n=e.transform,o=$O(t.x,t.y,t.z);n.localRotation.setFromQuat(o),this.dirtyLocal(e,n);}},{key:"setRotation",value:function value(e,t){var i=e.transform;if(e.hasParentTransform()){var r=this.getRotation(e.parentNode);r=r.clone().invert().multiply(t).normalize(),i.localRotation.setFromQuat(r),this.dirtyLocal(e,i);}else this.setLocalRotation(e,t);}},{key:"setLocalRotation",value:function value(e,t){var i=e.transform;i.localRotation.setFromQuat(t),this.dirtyLocal(e,i);}},{key:"getAngle",value:function value(e){var t=this.getWorldTransform(e);return GO.fromQuat(t.decompose().quaternion).toEuler();}},{key:"getLocalAngle",value:function value(e){return this.getLocalTransform(e),this.getLocalRotation(e).toEuler();}},{key:"setLocalTransform",value:function value(e,t){var i=this.getOrigin(e),r=t.decompose();r.quaternion;var n=r.rotation,o=r.scale,a=this.createScaleMatrix(o.x,o.y,o.z),s=tL.fromMatrix(a).inverse(),l=t.translate(i.x,i.y,i.z).multiply(s).getTranslation();l.x-=i.x,l.y-=i.y,l.z-=i.z,this.setLocalPosition(e,l),this.setLocalAngle(e,n.x,n.y,n.z),this.setLocalScale(e,o);}},{key:"createScaleMatrix",value:function value(){return{m11:arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,m21:0,m31:0,m41:0,m12:0,m22:arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,m32:0,m42:0,m13:0,m23:0,m33:arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,m43:0,m14:0,m24:0,m34:0,m44:1};}},{key:"resetLocalTransform",value:function value(e){this.setLocalScale(e,new jO(1,1,1)),this.setLocalPosition(e,new jO(0,0,0)),this.setLocalAngle(e,0);}},{key:"getWorldTransform",value:function value(e){var t=e.transform;if(!t.worldDirty&&!t.localDirty)return t.worldTransform;var i=e.parentNode;return i&&i.transform&&this.getWorldTransform(i),this.updateHierarchy(e),t.worldTransform;}},{key:"getLocalTransform",value:function value(e){var t=e.transform;return t.localDirty&&t.updateLocalTransform(),t.localTransform;}},{key:"getBounds",value:function value(e,t){var i=this,r=e.renderable,n=e.childNodes;if(t&&!r.renderBoundsDirty&&r)return r.renderBounds;if(!t&&!r.boundsDirty&&r.bounds)return r.bounds;var o=this.getTransformedGeometryBounds(e,t);$k(n).call(n,function(e){var r=i.getBounds(e,t);r&&(o?o.addBounds(r):o=hH.fromBounds(r));});var a=e.style.clipPath;if(a){var s=this.getTransformedGeometryBounds(a,!0),l=null;s&&(l=hH.create()).setFromTransformedBounds(this.getWorldTransform(e),s),o?l&&(o=l.intersection(o)):o=l;}return t?(r.renderBoundsDirty=!1,o&&(r.renderBounds=o)):(r.boundsDirty=!1,o&&(r.bounds=o)),o||hH.create();}},{key:"getLocalBounds",value:function value(e){var t=e.parentNode;if(t){var i=new tL();t.transform&&(i=this.getWorldTransform(t).inverse());var r=this.getBounds(e);if(!hH.isEmpty(r)){var n=hH.create();return n.setFromTransformedBounds(i,r),n;}}return this.getBounds(e);}},{key:"getGeometryBounds",value:function value(e,t){var i=e.geometry;return(t?i.renderBounds:i.contentBounds)||hH.create();}},{key:"getBoundingClientRect",value:function value(e){var t,i,r=this.getGeometryBounds(e);hH.isEmpty(r)||(i=hH.create()).setFromTransformedBounds(this.getWorldTransform(e),r);var n=null===(t=e.ownerDocument)||void 0===t?void 0:t.defaultView.getContextService().getBoundingClientRect();return i?{x:i.minX+((null==n?void 0:n.left)||0),y:i.minY+((null==n?void 0:n.top)||0),width:i.maxX-i.minX,height:i.maxY-i.minY}:{x:(null==n?void 0:n.left)||0,y:(null==n?void 0:n.top)||0,width:0,height:0};}},{key:"updateHierarchy",value:function value(e){var t=e.transform;if(t.localDirty&&t.updateLocalTransform(),t.worldDirty){var i,r=null==e||null===(i=e.parentNode)||void 0===i?void 0:i.transform;e.parentNode&&r||(r=new BW()),t.updateWorldTransform(r);}}},{key:"getTransformedGeometryBounds",value:function value(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.getGeometryBounds(e,t);if(!hH.isEmpty(i)){var r=hH.create();return this.getWorldTransform(e),r.setFromTransformedBounds(this.getWorldTransform(e),i),r;}return null;}},{key:"dirtyLocal",value:function value(e,t){t.localDirty||(t.localDirty=!0,t.worldDirty||this.dirtyWorld(e,t));}},{key:"dirtyWorld",value:function value(e,t){t.worldDirty||this.unfreezeParentToRoot(e),this.recursiveDirtyWorld(e,t),function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=e;i;){var r=i.renderable;r&&(r.boundsDirty=!0,r.renderBoundsDirty=!0),i=i.parentNode;}e.dispatchEvent(new wW("bounds-changed",{affectChildren:t}));}(e,!0);}},{key:"recursiveDirtyWorld",value:function value(e,t){var i,r=this;if(!t.worldDirty){t.worldDirty=!0,t.frozen=!1,$k(i=e.childNodes).call(i,function(e){var t=e.transform;t.worldDirty||r.recursiveDirtyWorld(e,t);});var n=e.renderable;n&&(n.boundsDirty=!0,n.renderBoundsDirty=!0);var o=new xW("DOMAttrModified",e,null,null,"modelMatrix",xW.MODIFICATION,null,null);e.dispatchEvent(o);}}},{key:"unfreezeParentToRoot",value:function value(e){for(var t=e;t;){var i=t.transform;i&&(i.frozen=!1),t=t.parentNode;}}}]);}())(CW),TW=function(e){function t(){var e,i;Xk(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return Wk(i=IN(this,t,uS(e=[]).call(e,n)),"baseURI",""),Wk(i,"childNodes",[]),Wk(i,"nodeName",""),Wk(i,"nodeType",0),Wk(i,"nodeValue",null),Wk(i,"ownerDocument",null),Wk(i,"parentNode",null),Wk(i,"isConnected",!1),Wk(i,"textContent",void 0),i;}return Mb(t,e),Yk(t,[{key:"firstChild",get:function get(){return this.childNodes.length>0?this.childNodes[0]:null;}},{key:"lastChild",get:function get(){var e=this.childNodes;return e.length>0?e[e.length-1]:null;}},{key:"nextSibling",get:function get(){var e=this.parentNode;if(e){var t,i=WI(t=e.childNodes).call(t,this);return e.childNodes[i+1];}return null;}},{key:"parentElement",get:function get(){return this.parentNode;}},{key:"previousSibling",get:function get(){var e=this.parentNode;if(e){var t,i=WI(t=e.childNodes).call(t,this);return e.childNodes[i-1];}return null;}},{key:"contains",value:function value(e){for(var t=e;t&&this!==t;)t=t.parentNode;return!!t;}},{key:"getRootNode",value:function value(e){return this.parentNode?this.parentNode.getRootNode(e):this;}},{key:"hasChildNodes",value:function value(){return this.childNodes.length>0;}},{key:"isEqualNode",value:function value(e){return this===e;}},{key:"isSameNode",value:function value(e){return this.isEqualNode(e);}},{key:"compareDocumentPosition",value:function value(e){throw new Error("Method to be implemented");}},{key:"isDefaultNamespace",value:function value(e){throw new Error("Method to be implemented");}},{key:"lookupNamespaceURI",value:function value(e){throw new Error("Method to be implemented");}},{key:"lookupPrefix",value:function value(e){throw new Error("Method to be implemented");}},{key:"normalize",value:function value(){throw new Error("Method to be implemented");}},{key:"recursiveCall",value:function value(e){var t;e(this)||$k(t=this.childNodes).call(t,function(t){t.recursiveCall(e);});}},{key:"hasParentTransform",value:function value(){return!(!this.parentNode||!this.parentNode.transform);}}],[{key:"isNode",value:function value(e){return!!e.childNodes;}}]);}(bW);Wk(TW,"ELEMENT_NODE",1),Wk(TW,"ATTRIBUTE_NODE",2),Wk(TW,"TEXT_NODE",3),Wk(TW,"CDATA_SECTION_NODE",4),Wk(TW,"ENTITY_REFERENCE_NODE",5),Wk(TW,"ENTITY_NODE",6),Wk(TW,"PROCESSING_INSTRUCTION_NODE",7),Wk(TW,"COMMENT_NODE",8),Wk(TW,"DOCUMENT_NODE",9),Wk(TW,"DOCUMENT_TYPE_NODE",10),Wk(TW,"DOCUMENT_FRAGMENT_NODE",11),Wk(TW,"NOTATION_NODE",12),Wk(TW,"DOCUMENT_POSITION_DISCONNECTED",1),Wk(TW,"DOCUMENT_POSITION_PRECEDING",2),Wk(TW,"DOCUMENT_POSITION_FOLLOWING",4),Wk(TW,"DOCUMENT_POSITION_CONTAINS",8),Wk(TW,"DOCUMENT_POSITION_CONTAINED_BY",16),Wk(TW,"DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC",32);var IW=Yk(function e(){Xk(this,e),Wk(this,"contentBounds",void 0),Wk(this,"renderBounds",void 0);}),EW=function(){return Yk(function e(){Xk(this,e),Wk(this,"boundsDirty",!0),Wk(this,"bounds",void 0),Wk(this,"renderBoundsDirty",!0),Wk(this,"renderBounds",void 0);},[{key:"isRenderable",value:function value(){return this.boundsDirty||this.renderBoundsDirty;}},{key:"toRenderable",value:function value(){this.boundsDirty=!0,this.renderBoundsDirty=!0;}}]);}(),PW=Yk(function e(){Xk(this,e),Wk(this,"renderOrder",0),Wk(this,"lastSortedIndex",void 0),Wk(this,"sorted",void 0),Wk(this,"dirty",!1);}),BW=function(){return Yk(function e(){Xk(this,e),Wk(this,"frozen",!0),Wk(this,"worldDirty",!1),Wk(this,"localDirty",!1),Wk(this,"localRotation",KO(0,0,0,1)),Wk(this,"rotation",KO(0,0,0,1)),Wk(this,"localScale",YO(1,1,1)),Wk(this,"scale",YO(1,1,1)),Wk(this,"localPosition",YO(0,0,0)),Wk(this,"position",YO(0,0,0)),Wk(this,"localSkew",YO(0,0,0)),Wk(this,"skew",YO(0,0,0)),Wk(this,"origin",YO(0,0,0)),Wk(this,"worldTransform",new tL()),Wk(this,"localTransform",new tL());},[{key:"updateLocalTransform",value:function value(){var e=this.origin,t=this.localScale,i=this.localPosition,r=this.localRotation,n=this.localSkew,o=new tL();o.translateSelf(e.x,e.y,e.z);var a=JO(0,0,0,1),s=this.compose(a,i,r,n,t);o.multiplySelf(s),o.translateSelf(-e.x,-e.y,-e.z),this.localTransform.setFromMatrix(o),this.localDirty=!1;}},{key:"updateWorldTransform",value:function value(e){var t=e.worldTransform.clone();t.multiplySelf(this.localTransform),this.worldTransform.setFromMatrix(t),this.worldDirty=!1;}},{key:"compose",value:function value(e,t,i,r,n){var o=new tL();o.m14=e.x,o.m24=e.y,o.m34=e.z,o.m44=e.w,o.translateSelf(t.x,t.y,t.z);var a=tL.fromQuat(i);o.multiplySelf(a);var s=new tL();return r.z&&(s.m32=r.z,o.multiplySelf(s)),r.y&&(s.m32=0,s.m31=r.y,o.multiplySelf(s)),r.x&&(s.m31=0,s.m21=r.x,o.multiplySelf(s)),o.scaleSelf(n.x,n.y,n.z),o;}}]);}(),DW=function(e){function t(){var e,i;Xk(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return Wk(i=IN(this,t,uS(e=[]).call(e,n)),"attributes",{}),Wk(i,"id",void 0),Wk(i,"pageUid",void 0),Wk(i,"index",void 0),Wk(i,"name",void 0),Wk(i,"scrollLeft",void 0),Wk(i,"scrollTop",void 0),Wk(i,"scrollWidth",void 0),Wk(i,"scrollHeight",void 0),Wk(i,"renderable",new EW()),Wk(i,"sortable",new PW()),Wk(i,"geometry",new IW()),Wk(i,"transform",new BW()),Wk(i,"parsedStyle",{}),Wk(i,"style",void 0),Wk(i,"isDestroyed",!1),i;}return Mb(t,e),Yk(t,[{key:"className",get:function get(){return this.getAttribute("class")||"";},set:function set(e){this.setAttribute("class",e);}},{key:"classList",get:function get(){var e;return yx(e=this.className.split(" ")).call(e,function(e){return""!==e;});}},{key:"tagName",get:function get(){return this.nodeName;}},{key:"children",get:function get(){return this.childNodes;}},{key:"childElementCount",get:function get(){return this.childNodes.length;}},{key:"firstElementChild",get:function get(){return this.firstChild;}},{key:"lastElementChild",get:function get(){return this.lastChild;}},{key:"getAttribute",value:function value(e){var t=this.attributes[e];return null==t?null:t;}},{key:"getElementsByName",value:function value(e){return VW.querySelectorAll('[name="'.concat(e,'"]'),this);}},{key:"getElementsByClassName",value:function value(e){return VW.querySelectorAll(".".concat(e),this);}},{key:"getElementsByTagName",value:function value(e){return VW.querySelectorAll(e,this);}},{key:"hasAttribute",value:function value(e){var t;return WI(t=eS(this.attributes)).call(t,e)>-1;}},{key:"removeAttribute",value:function value(e){this.setAttribute(e,null),delete this.attributes[e];}},{key:"setAttribute",value:function value(e,t){this.attributes[e]=t;}},{key:"appendChild",value:function value(e,t){VW.append(e,this,t);var i=new wW("child-inserted",{child:e});this.dispatchEvent(i);var r=new xW("DOMNodeInserted",this,"","","",0,"","");return e.dispatchEvent(r),e;}},{key:"cloneNode",value:function value(e){return null;}},{key:"insertBefore",value:function value(e,t){if(t){var i,r=WI(i=this.childNodes).call(i,t);this.appendChild(e,r-1);}else this.appendChild(e);return e;}},{key:"removeChild",value:function value(e){var t=new xW("removed",this,"","","",0,"","");e.dispatchEvent(t);var i=new wW("child-removed",{child:e});return this.dispatchEvent(i),VW.remove(e),e;}},{key:"isChildExist",value:function value(e){return VW.isChildExist(e);}},{key:"replaceChild",value:function value(e,t){var i,r=WI(i=this.childNodes).call(i,t);return this.removeChild(t),this.appendChild(e,r),t;}},{key:"destroy",value:function value(){var e=new wW("destroy",{});this.dispatchEvent(e),this.remove(),this.removeAllEventListeners(),this.isDestroyed=!0;}},{key:"after",value:function value(){var e=this.parentNode;if(e){for(var t,i=WI(t=e.childNodes).call(t,this),r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];$k(n).call(n,function(t,r){null==e||e.appendChild(t,i+r+1);});}}},{key:"before",value:function value(){var e=this.parentNode;if(e){for(var t,i=WI(t=e.childNodes).call(t,this),r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];$k(n).call(n,function(t,r){null==e||e.appendChild(t,i+r);});}}},{key:"remove",value:function value(){this.parentNode&&this.parentNode.removeChild(this);}},{key:"replaceWith",value:function value(){this.after.apply(this,arguments),this.remove();}},{key:"append",value:function value(){for(var e=this,t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];$k(i).call(i,function(t){e.appendChild(t);});}},{key:"prepend",value:function value(){for(var e=this,t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];$k(i).call(i,function(t,i){e.appendChild(t,i);});}},{key:"querySelector",value:function value(e){return VW.querySelector(e,this);}},{key:"querySelectorAll",value:function value(e){return VW.querySelectorAll(e,this);}},{key:"find",value:function value(e){var t=this,i=null;return this.recursiveCall(function(r){return!(r!==t||!e(r)||(i=r,0));}),i;}},{key:"findAll",value:function value(e){var t=this,i=[];return this.recursiveCall(function(r){r===t&&e(r)&&i.push(r);}),i;}},{key:"getGeometryBounds",value:function value(){return VW.getGeometryBounds(this);}},{key:"getRenderBounds",value:function value(){return VW.getBounds(this,!0);}},{key:"getBounds",value:function value(){return VW.getBounds(this);}},{key:"getLocalBounds",value:function value(){return VW.getLocalBounds(this);}},{key:"getBoundingClientRect",value:function value(){return VW.getBoundingClientRect(this);}}]);}(TW),MW=function(){return Yk(function e(t){Xk(this,e),Wk(this,"lineAlign",void 0),Wk(this,"owner",void 0),this.owner=t,this.reset();},[{key:"reset",value:function value(){this.lineAlign=.5;}},{key:"x",get:function get(){return this.owner.getAttribute("x");},set:function set(e){this.owner.setAttribute("x",e);}},{key:"y",get:function get(){return this.owner.getAttribute("y");},set:function set(e){this.owner.setAttribute("y",e);}},{key:"r",get:function get(){return this.owner.getAttribute("r");},set:function set(e){this.owner.setAttribute("r",e);}},{key:"width",get:function get(){return this.owner.getAttribute("width");},set:function set(e){this.owner.setAttribute("width",e);}},{key:"height",get:function get(){return this.owner.getAttribute("height");},set:function set(e){this.owner.setAttribute("height",e);}},{key:"points",get:function get(){return this.owner.getAttribute("points");},set:function set(e){this.owner.setAttribute("points",e);}},{key:"selectable",get:function get(){return this.owner.getAttribute("selectable");},set:function set(e){this.owner.setAttribute("selectable",e);}},{key:"origin",get:function get(){return this.owner.getAttribute("origin");},set:function set(e){this.owner.setAttribute("origin",e);}},{key:"anchor",get:function get(){return this.owner.getAttribute("anchor");},set:function set(e){this.owner.setAttribute("anchor",e);}},{key:"visibility",get:function get(){return this.owner.getAttribute("visibility");},set:function set(e){this.owner.setAttribute("visibility",e);}},{key:"zIndex",get:function get(){return this.owner.getAttribute("zIndex");},set:function set(e){this.owner.setAttribute("zIndex",e);}},{key:"transformOrigin",get:function get(){return this.owner.getAttribute("transformOrigin");},set:function set(e){this.owner.setAttribute("transformOrigin",e);}},{key:"borderWidth",get:function get(){return this.owner.getAttribute("borderWidth");},set:function set(e){this.owner.setAttribute("borderWidth",e);}},{key:"borderColor",get:function get(){return this.owner.getAttribute("borderColor");},set:function set(e){this.owner.setAttribute("borderColor",e);}},{key:"opacity",get:function get(){return this.owner.getAttribute("opacity");},set:function set(e){this.owner.setAttribute("opacity",e);}},{key:"fillOpacity",get:function get(){return this.owner.getAttribute("fillOpacity");},set:function set(e){this.owner.setAttribute("fillOpacity",e);}},{key:"borderOpacity",get:function get(){return this.owner.getAttribute("borderOpacity");},set:function set(e){this.owner.setAttribute("borderOpacity",e);}},{key:"background",get:function get(){return this.owner.getAttribute("background");},set:function set(e){this.owner.setAttribute("background",e);}},{key:"clipPath",get:function get(){return this.owner.getAttribute("clipPath");},set:function set(e){this.owner.setAttribute("clipPath",e);}},{key:"cursor",get:function get(){return this.owner.getAttribute("cursor");},set:function set(e){this.owner.setAttribute("cursor",e);}},{key:"hitArea",get:function get(){return this.owner.getAttribute("hitArea");},set:function set(e){this.owner.setAttribute("hitArea",e);}},{key:"pointerEvents",get:function get(){return this.owner.getAttribute("pointerEvents");},set:function set(e){this.owner.setAttribute("pointerEvents",e);}},{key:"miterLimit",get:function get(){return this.owner.getAttribute("miterLimit");},set:function set(e){this.owner.setAttribute("miterLimit",e);}},{key:"lineCap",get:function get(){return this.owner.getAttribute("lineCap");},set:function set(e){this.owner.setAttribute("lineCap",e);}},{key:"lineJoin",get:function get(){return this.owner.getAttribute("lineJoin");},set:function set(e){this.owner.setAttribute("lineJoin",e);}},{key:"lineDash",get:function get(){return this.owner.getAttribute("lineDash");},set:function set(e){this.owner.setAttribute("lineDash",e);}},{key:"lineDashOffset",get:function get(){return this.owner.getAttribute("lineDashOffset");},set:function set(e){this.owner.setAttribute("lineDashOffset",e);}},{key:"shadow",get:function get(){return this.owner.getAttribute("shadow");},set:function set(e){this.owner.setAttribute("shadow",e);}},{key:"shadowOffsetX",get:function get(){return this.owner.getAttribute("shadowOffsetX");},set:function set(e){this.owner.setAttribute("shadowOffsetX",e);}},{key:"shadowOffsetY",get:function get(){return this.owner.getAttribute("shadowOffsetY");},set:function set(e){this.owner.setAttribute("shadowOffsetY",e);}},{key:"shadowBlur",get:function get(){return this.owner.getAttribute("shadowBlur");},set:function set(e){this.owner.setAttribute("shadowBlur",e);}},{key:"shadowColor",get:function get(){return this.owner.getAttribute("shadowColor");},set:function set(e){this.owner.setAttribute("shadowColor",e);}},{key:"startAngle",get:function get(){return this.owner.getAttribute("startAngle");},set:function set(e){this.owner.setAttribute("startAngle",e);}},{key:"endAngle",get:function get(){return this.owner.getAttribute("endAngle");},set:function set(e){this.owner.setAttribute("endAngle",e);}},{key:"rx",get:function get(){return this.owner.getAttribute("rx");},set:function set(e){this.owner.setAttribute("rx",e);}},{key:"ry",get:function get(){return this.owner.getAttribute("ry");},set:function set(e){this.owner.setAttribute("ry",e);}},{key:"img",get:function get(){return this.owner.getAttribute("img");},set:function set(e){this.owner.setAttribute("img",e);}},{key:"src",get:function get(){return this.owner.getAttribute("src");},set:function set(e){this.owner.setAttribute("src",e);}},{key:"x1",get:function get(){return this.owner.getAttribute("x1");},set:function set(e){this.owner.setAttribute("x1",e);}},{key:"y1",get:function get(){return this.owner.getAttribute("y1");},set:function set(e){this.owner.setAttribute("y1",e);}},{key:"x2",get:function get(){return this.owner.getAttribute("x2");},set:function set(e){this.owner.setAttribute("x2",e);}},{key:"y2",get:function get(){return this.owner.getAttribute("y2");},set:function set(e){this.owner.setAttribute("y2",e);}},{key:"text",get:function get(){return this.owner.getAttribute("text");},set:function set(e){this.owner.setAttribute("text",e);}},{key:"wordWarp",get:function get(){return this.owner.getAttribute("wordWarp");},set:function set(e){this.owner.setAttribute("wordWarp",e);}},{key:"wordBreak",get:function get(){return this.owner.getAttribute("wordBreak");},set:function set(e){this.owner.setAttribute("wordBreak",e);}},{key:"underline",get:function get(){return this.owner.getAttribute("underline");},set:function set(e){this.owner.setAttribute("underline",e);}},{key:"strikeout",get:function get(){return this.owner.getAttribute("strikeout");},set:function set(e){this.owner.setAttribute("strikeout",e);}},{key:"textMaxWidth",get:function get(){return this.owner.getAttribute("textMaxWidth");},set:function set(e){this.owner.setAttribute("textMaxWidth",e);}},{key:"letterSpacing",get:function get(){return this.owner.getAttribute("letterSpacing");},set:function set(e){this.owner.setAttribute("letterSpacing",e);}},{key:"textAlign",get:function get(){return this.owner.getAttribute("textAlign");},set:function set(e){this.owner.setAttribute("textAlign",e);}},{key:"textBaseLine",get:function get(){return this.owner.getAttribute("textBaseLine");},set:function set(e){this.owner.setAttribute("textBaseLine",e);}},{key:"textTransform",get:function get(){return this.owner.getAttribute("textTransform");},set:function set(e){this.owner.setAttribute("textTransform",e);}},{key:"color",get:function get(){return this.owner.getAttribute("color");},set:function set(e){this.owner.setAttribute("color",e);}},{key:"fontStyle",get:function get(){return this.owner.getAttribute("fontStyle");},set:function set(e){this.owner.setAttribute("fontStyle",e);}},{key:"fontVariant",get:function get(){return this.owner.getAttribute("fontVariant");},set:function set(e){this.owner.setAttribute("fontVariant",e);}},{key:"fontWeight",get:function get(){return this.owner.getAttribute("fontWeight");},set:function set(e){this.owner.setAttribute("fontWeight",e);}},{key:"fontSize",get:function get(){return this.owner.getAttribute("fontSize");},set:function set(e){this.owner.setAttribute("fontSize",e);}},{key:"lineHeight",get:function get(){return this.owner.getAttribute("lineHeight");},set:function set(e){this.owner.setAttribute("lineHeight",e);}},{key:"fontFamily",get:function get(){return this.owner.getAttribute("fontFamily");},set:function set(e){this.owner.setAttribute("fontFamily",e);}},{key:"startPoint",get:function get(){return this.owner.getAttribute("startPoint");},set:function set(e){this.owner.setAttribute("startPoint",e);}},{key:"endPoint",get:function get(){return this.owner.getAttribute("endPoint");},set:function set(e){this.owner.setAttribute("endPoint",e);}},{key:"lineEnding",get:function get(){return this.owner.getAttribute("lineEnding");},set:function set(e){this.owner.setAttribute("lineEnding",e);}},{key:"stampPoints",get:function get(){return this.owner.getAttribute("stampPoints");},set:function set(e){this.owner.setAttribute("stampPoints",e);}}]);}(),AW={},UW={},zW=function(e){function t(e){var i;return Xk(this,t),Wk(Pw(i=IN(this,t)),"shapeType",void 0),Wk(Pw(i),"config",void 0),Wk(Pw(i),"path",void 0),Wk(Pw(i),"steps",void 0),Wk(Pw(i),"externalMatrixes",[]),Wk(Pw(i),"clippable",!1),Wk(Pw(i),"imageData",null),i.config=e,i.id=e.id||e.uid||"",i.name=e.name||"",i.index=e.index,i.nodeName=e.type||"container",i.pageUid=e.pageUid||"",(e.className||e.class)&&(i.className=e.className||e.class),i.style=new MW(Pw(i)),i.initAttributes(e),i;}return Mb(t,e),Yk(t,[{key:"isVisible",get:function get(){return"visible"===this.parsedStyle.visibility;}},{key:"isInteractive",get:function get(){return"none"!==this.parsedStyle.pointerEvents;}},{key:"width",get:function get(){return this.parsedStyle.width.value*Math.abs(this.getScale().x);}},{key:"height",get:function get(){return this.parsedStyle.height.value*Math.abs(this.getScale().y);}},{key:"initAttributes",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var t in e)if(JN(t,e)){if("style"===t)continue;this.attributes[t]=e[t];}for(var i in e.style)JN(i,e.style)&&(this.parseStyleProperty(i,e.style[i]),this.attributes[i]=e.style[i]);this.renderable.toRenderable();}},{key:"setAttribute",value:function value(e,i){if(!HN(i)&&i!==this.attributes[e]){var r=this.attributes[e];EN(t,"setAttribute",this,3)([e,i]),this.config.hasOwnProperty(e)||(this.parseStyleProperty(e,i),this.updateStyleProperty(e,r,i));}}},{key:"parseStyleProperty",value:function value(e,t){var i=AW[e];this.parsedStyle[e]=i?i(t,this,e):t;}},{key:"updateStyleProperty",value:function value(e,t,i){var r=this,n=UW[e];n&&$k(n).call(n,function(n){n(t,i,r,e);});}},{key:"toFront",value:function value(){var e=this.parentNode;if(e){var t,i=Math.max.apply(Math,Ub(QE(t=e.children).call(t,function(e){return e.style.zIndex;})));this.style.zIndex=i+1;}return this;}},{key:"toBack",value:function value(){var e=this.parentNode;if(e){var t,i=Math.min.apply(Math,Ub(QE(t=e.children).call(t,function(e){return e.style.zIndex;})));this.style.zIndex=i-1;}return this;}},{key:"setOrigin",value:function value(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return VW.setOrigin(this,e,t),this;}},{key:"getOrigin",value:function value(){return VW.getOrigin(this);}},{key:"setPosition",value:function value(e){return VW.setPosition(this,e),this;}},{key:"setLocalPosition",value:function value(e){var t=YO(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0);return VW.setLocalPosition(this,t),this;}},{key:"getPosition",value:function value(){return VW.getPosition(this);}},{key:"getLocalPosition",value:function value(){return VW.getLocalPosition(this);}},{key:"translate",value:function value(e){var t=YO(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0);return VW.translate(this,t),this;}},{key:"translateLocal",value:function value(e){var t=YO(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0);return VW.translateLocal(this,t),this;}},{key:"scale",value:function value(e,t,i){return this.scaleLocal(e,t,i);}},{key:"scaleLocal",value:function value(e,t,i){return ZN(e)&&(e=YO(e,t=t||e,i=i||e)),VW.scaleLocal(this,e),this;}},{key:"setLocalScale",value:function value(e,t,i){return ZN(e)&&(e=YO(e,t=t||e,i=i||e)),VW.setLocalScale(this,e),this;}},{key:"getScale",value:function value(){return VW.getScale(this);}},{key:"getLocalScale",value:function value(){return VW.getLocalScale(this);}},{key:"rotate",value:function value(e,t,i){return HN(t)&&HN(i)?VW.rotate(this,0,0,e):VW.rotate(this,e,t,i),this;}},{key:"rotateLocal",value:function value(e,t,i){return HN(t)&&HN(i)?VW.rotateLocal(this,0,0,e):VW.rotateLocal(this,e,t,i),this;}},{key:"setAngle",value:function value(e){return VW.setAngle(this,0,0,e),this;}},{key:"setLocalAngle",value:function value(e){return VW.setLocalAngle(this,0,0,e),this;}},{key:"getAngle",value:function value(){return VW.getAngle(this).z;}},{key:"getLocalAngle",value:function value(){return VW.getLocalAngle(this).z;}},{key:"getLocalTransform",value:function value(){return VW.getLocalTransform(this);}},{key:"getWorldTransform",value:function value(){return VW.getWorldTransform(this);}},{key:"setLocalTransform",value:function value(e){return VW.setLocalTransform(this,e),this;}},{key:"resetLocalTransform",value:function value(){VW.resetLocalTransform(this);}},{key:"getPath",value:function value(){}},{key:"getConfig",value:function value(){}},{key:"getBoundingRect",value:function value(){}},{key:"getBoundingRectObject",value:function value(){}},{key:"updateStyle",value:function value(e){}},{key:"isPointInPath",value:function value(e){}}]);}(DW);function RW(e,t){return{type:e,data:t};}function NW(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=[],r=Ab(e,1)[0];i.push(RW("moveTo",[r]));for(var n=1;n<e.length;n++)r=e[n],i.push(RW("lineTo",[r]));return t&&e.length>2&&(r=Ab(e,1)[0],i.push(RW("lineTo",[r]))),i;}function OW(e,t){var i=t.data,r=t.type,n=Ab(i,3),o=n[0],a=n[1],s=n[2];switch(r){case"moveTo":e.moveTo(o.x,o.y);break;case"lineTo":e.lineTo(o.x,o.y);break;case"bezierCurveTo":e.bezierCurveTo(o.x,o.y,a.x,a.y,s.x,s.y);break;case"quadraticCurveTo":e.quadraticCurveTo(o.x,o.y,a.x,a.y);}}function LW(e){for(var t=Math.min,i=Math.max,r=e[0],n=r.x,o=r.y,a=n,s=o,l=n,u=o,c=1;c<e.length;c++){var h=e[c];a=t(a,h.x),l=i(l,h.x),s=t(s,h.y),u=i(u,h.y);}return{left:a,top:s,right:l,bottom:u,width:l-a,height:u-s};}var WW={opacity:1,fillOpacity:1,borderOpacity:1,lineJoin:"miter",lineCap:"butt",zIndex:0,visibility:"visible",anchor:[0,0],borderColor:"black",miterLimit:10,lineDash:[0,0],lineDashOffset:0};function HW(e){if(e.length<1)return[];for(var t=[],i=[],r=0;r<e.length;r++){var n=e[r];if(0===n.step)r>0&&t.push({step:i,close:e[r-1].close}),(i=[]).push(RW("moveTo",[{x:n.x,y:n.y}]));else if(1===n.step)i.push(RW("lineTo",[{x:n.x,y:n.y}]));else if(2===n.step&&r+2<e.length&&2===e[r+1].step&&2===e[r+2].step){var o=e[r+1],a=e[r+2];i.push(RW("bezierCurveTo",[n,o,a])),r+=2;}}return t.push({step:i,close:e[e.length-1].close}),t;}function FW(e,t,i,r){var n=0,o=0,a=0,s=0,l=[e,t],u=LW(l),c=function(e,t,i,r){var n=r/2,o=r/2,a=t.y-e.y,s=t.x-e.x;if(0===a||0===s)return[s,a];var l=-1/((t.y-e.y)/(t.x-e.x)),u=Math.atan(l);return"square"===i?(n=Math.sqrt(2)*r/2,o=Math.sqrt(2)*r/2):"round"===i?(n=r/2,o=r/2):(n=Math.abs(Math.cos(u)*r)/2,o=Math.abs(Math.sin(u)*r)/2),[n,o];}(l[0],l[1],r,i||0);return 0===c[1]?(n=u.left,o=u.top-i/2,a=u.width,s=u.height+i,"square"!==r&&"round"!==r||(n-=i/2,a+=i)):0===c[0]?(n=u.left-i/2,o=u.top,a=u.width+i,s=u.height,"square"!==r&&"round"!==r||(o-=i/2,s+=i)):(n=u.left-c[0],o=u.top-c[1],a=u.width+2*c[0],s=u.height+2*c[1]),{x:n,y:o,width:a,height:s};}function jW(e){return Math.abs(e)<1e-6?0:e<0?-1:1;}function YW(e,t,i,r){var n=e.x,o=e.y,a=t.x,s=t.y,l=r.x,u=r.y,c=Math.min(n,a),h=Math.max(n,a),d=Math.min(o,s),f=Math.max(o,s),v=i/2;return l>=c-v&&l<=h+v&&u>=d-v&&u<=f+v&&function(e,t,i,r,n,o){var a=[i-e,r-t];if(new jO(a[0],a[1]).equals({x:0,y:0}))return Math.sqrt((n-e)*(n-e)+(o-t)*(o-t));var s=[-a[1],a[0]],l=new jO(s[0],s[1]);l.normalize();var u=[n-e,o-t],c=new jO(u[0],u[1]);return Math.abs(c.dot(l));}(n,o,a,s,l,u)<=i/2;}function XW(e,t,i,r,n){var o=e.length;if(o<2)return!1;for(var a=0;a<o-1;a++)if(YW(e[a],e[a+1],t,{x:i,y:r}))return!0;return!(!n||!YW(e[0],e[o-1],t,{x:i,y:r}));}function qW(e,t,i,r,n,o){return n>=e&&n<=e+i&&o>=t&&o<=t+r;}function ZW(e,t,i,r,n,o){var a=o,s=r.x,l=r.y,u=n.x,c=n.y;0===t&&(s=n.x,l=n.y,u=r.x,c=r.y);var h=Math.PI/2,d=u-s>=0?1:-1,f=c-l>=0?1:-1;s!==u&&(h=Math.atan(Math.abs(c-l)/Math.abs(u-s)));var v=Math.cos(h),g=Math.sin(h),m=i?1:-1,y={x:u+9*m*a*v*d-4.5*a*g*d,y:c+9*m*a*g*f+4.5*a*v*f,step:0,close:!1},p={x:u+m*a*v*d,y:c+m*a*g*f,step:1,close:!1},w={x:u+9*m*a*v*d+4.5*a*g*d,y:c+9*m*a*g*f-4.5*a*v*f,step:1,close:!1};e.push(y,p,w);}function _W(e,t,i,r,n,o){var a=o,s=r.x,l=r.y,u=n.x,c=n.y;0===t&&(s=n.x,l=n.y,u=r.x,c=r.y);var h=Math.PI/2,d=u-s>=0?1:-1,f=c-l>=0?1:-1;s!==u&&(h=Math.atan(Math.abs(c-l)/Math.abs(u-s)));var v=Math.cos(h),g=Math.sin(h),m=i?1:-1,y={x:u+9*m*a*v*d-4.5*a*g*d,y:c+9*m*a*g*f+4.5*a*v*f,step:0,close:!1},p={x:u+m*a*v*d,y:c+m*a*g*f,step:1,close:!1},w={x:u+9*m*a*v*d+4.5*a*g*d,y:c+9*m*a*g*f-4.5*a*v*f,step:1,close:!0};e.push(y,p,w);}function GW(e,t,i,r,n){var o=n,a=i.x,s=i.y,l=r.x,u=r.y;0===t&&(a=r.x,s=r.y,l=i.x,u=i.y);var c=Math.PI/2,h=l-a>=0?1:-1,d=u-s>=0?1:-1;a!==l&&(c=Math.atan(Math.abs(u-s)/Math.abs(l-a)));var f=Math.cos(c),v=Math.sin(c),g={x:l-3*o*v*h,y:u+3*o*f*d,step:0,close:!1},m={x:l+3*o*v*h,y:u-3*o*f*d,step:1,close:!1};e.push(g,m);}function KW(e,t,i,r,n){var o=n,a=i.x,s=i.y,l=r.x,u=r.y;0===t&&(a=r.x,s=r.y,l=i.x,u=i.y);var c=Math.PI/2,h=l-a>=0?1:-1,d=u-s>=0?1:-1,f=u>=s&&l>=a||u<=s&&l<=a?-1:1;a!==l&&(c=Math.atan(Math.abs(u-s)/Math.abs(l-a)));var v=Math.cos(c),g=Math.sin(c),m=4.5*Math.sqrt(3)*o,y={x:l+4.5*o*v*h-m*g*h*f,y:u+4.5*o*g*d+m*v*d*f,step:0,close:!1},p={x:l-4.5*o*v*h+m*g*h*f,y:u-4.5*o*g*d-m*v*d*f,step:1,close:!1};e.push(y,p);}function $W(e,t,i,r,n){var o=n,a=r.x,s=r.y;0===t&&(a=i.x,s=i.y);var l={x:a-3*o,y:s,step:0,close:!1},u={x:a,y:s-3*o,step:1,close:!1},c={x:a+3*o,y:s,step:1,close:!1},h={x:a,y:s+3*o,step:1,close:!0};e.push(l,u,c,h);}function QW(e,t,i,r,n){var o=n,a=r.x,s=r.y;0===t&&(a=i.x,s=i.y);var l=3*o-0*o,u=function(e,t,i,r){var n=e-i,o=e+i,a=t-r,s=t+r,l=.551915024494,u=l*i,c=l*r,h=[];return h.push({x:o,y:t}),h.push({x:o,y:t+c},{x:e+u,y:s},{x:e,y:s}),h.push({x:e-u,y:s},{x:n,y:t+c},{x:n,y:t}),h.push({x:n,y:t-c},{x:e-u,y:a},{x:e,y:a}),h.push({x:e+u,y:a},{x:o,y:t-c},{x:o,y:t}),h;}(a,s,l,l);$k(u).call(u,function(t,i){var r=0===i?0:2,n=i===u.length-1,o={x:t.x,y:t.y,step:r,close:n};e.push(o);});}function JW(e,t){if(HN(e)||""===e)return null;var i=sW(e);return"%"===i.unit?.01*t*i.value:i.value;}var eH=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=i.style,n=Jf(i,yN);Xk(this,t),Wk(e=IN(this,t,[Fk({type:"rect",style:Fk(Fk({},WW),{},{x:0,y:0,width:0,height:0},r)},n)]),"shapeType","rect");var o=e.parsedStyle,a=o.x,s=o.y;return e.setLocalPosition(a,s),e.updateOrigin(),e;}return Mb(t,e),Yk(t,[{key:"updateStyle",value:function value(e){var t,i=this;$k(t=eS(e)).call(t,function(t){JN(t,e)&&(i.style[t]=e[t]);});}},{key:"updateOrigin",value:function value(){var e=this.parsedStyle,t=e.width,i=e.height;this.setOrigin(t.value/2,i.value/2);}},{key:"updatePosition",value:function value(e,t){this.style.x=e,this.style.y=t;}},{key:"getPath",value:function value(){var e=this.parsedStyle,t=e.width,i=e.height,r=e.borderWidth,n=.5*((null==r?void 0:r.value)||0),o=0,a=0;o+=n,a+=n;var s=t.value-2*n,l=i.value-2*n;return this.path=[{x:o,y:a},{x:o+s,y:a},{x:o+s,y:a+l},{x:o,y:a+l}],this.steps=NW(this.path),this.path;}},{key:"getBoundingRect",value:function value(){var e=this.parsedStyle,t=e.x,i=e.y,r=e.width,n=e.height;return e.borderWidth,{x:t,y:i,width:r.value,height:n.value};}},{key:"getBoundingRectObject",value:function value(){var e=this.getBoundingRect();return new t({style:{x:e.x,y:e.y,width:e.width,height:e.height,borderWidth:1,background:"rgba(0,0,0,0)"}});}},{key:"isPointInPath",value:function value(e){var t=this.parsedStyle,i=t.x,r=t.y,n=t.background,o=t.borderWidth,a=t.width,s=t.height,l=o&&o.value,u=((null==o?void 0:o.value)||0)/2;return n&&l?qW(i-u,r-u,a.value+u,s.value+u,e.x,e.y):n?qW(i,r,a.value,s.value,e.x,e.y):!!l&&function(e,t,i,r,n,o,a){var s=n/2;return qW(e-s,t-s,i,n,o,a)||qW(e+i-s,t-s,n,r,o,a)||qW(e+s,t+r-s,i,n,o,a)||qW(e-s,t+s,n,r,o,a);}(i-u,r-u,a.value,s.value,o.value,e.x,e.y);}}]);}(zW);function tH(e,t,i,r,n){for(var o=n||[],a=e[t],s=e[i-1],l=0,u=1,c=t+1;c<i-1;c++){var h=cL(uL(a,s,e[c]),e[c]);h>l&&(l=h,u=c);}return l>=r?(tH(e,t,u,r,o),tH(e,u,i,r,o)):(o.length||o.push(a),o.push(s)),o;}var iH=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=i.style,n=Jf(i,pN);Xk(this,t),Wk(Pw(e=IN(this,t,[Fk({type:"image",style:Fk(Fk({},WW),{},{x:0,y:0,width:0,height:0,img:""},r)},n)])),"shapeType","image"),Wk(Pw(e),"meteData",void 0),e.meteData=(null==n?void 0:n.meteData)||null;var o=e.parsedStyle,a=o.x,s=o.y;return e.setLocalPosition(a,s),e.updateOrigin(),e;}return Mb(t,e),Yk(t,[{key:"updateStyle",value:function value(e){var t,i=this;$k(t=eS(e)).call(t,function(t){JN(t,e)&&(i.style[t]=e[t]);});}},{key:"updateOrigin",value:function value(){var e=this.parsedStyle,t=e.width,i=e.height;this.setOrigin(t.value/2,i.value/2);}},{key:"updatePosition",value:function value(e,t){this.style.x=e,this.style.y=t;}},{key:"getBoundingRect",value:function value(){var e=this.parsedStyle,t=e.x,i=e.y,r=e.width,n=e.height;return{x:t,y:i,width:r.value,height:n.value};}},{key:"getBoundingRectObject",value:function value(){var e=this.getBoundingRect(),t=e.x,i=e.y,r=e.width,n=e.height;return new eH({style:{x:t,y:i,width:r,height:n,borderWidth:1,background:"rgba(0,0,0,0)"}});}},{key:"isPointInPath",value:function value(e){return this.getBoundingRectObject().isPointInPath(e);}}]);}(zW),rH=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=i.style,n=Jf(i,wN);Xk(this,t),Wk(e=IN(this,t,[Fk({type:"line",style:Fk(Fk({},WW),{},{x1:0,y1:0,x2:0,y2:0,borderWidth:2},r)},n)]),"shapeType","line"),Wk(e,"renderPath",void 0);var o=e.getBoundingRect(),a=o.x,s=o.y;return e.updatePosition(a,s),e.updateOrigin(),e;}return Mb(t,e),Yk(t,[{key:"updateOrigin",value:function value(){var e=this.getBoundingRect(),t=e.width,i=e.height;this.setOrigin(t/2,i/2);}},{key:"updatePoints",value:function value(){var e=this.renderPath,t=this.getLocalPosition(),i=[];$k(e).call(e,function(e){i.push({x:e.x+t.x,y:e.y+t.y});}),this.updateStyle({x1:i[0].x||0,y1:i[0].y||0,x2:i[1].x||0,y2:i[1].y||0});}},{key:"updateStyle",value:function value(e){var t,i=this;$k(t=eS(e)).call(t,function(t){JN(t,e)&&(i.style[t]=e[t]);});}},{key:"updatePosition",value:function value(e,t){this.style.x=e,this.style.y=t;}},{key:"getPath",value:function value(){var e=this.renderable,t=this.parsedStyle,i=t.x1,r=t.x2,n=t.y1,o=t.y2,a=this.getBoundingRect(),s=a.x,l=a.y;return this.path&&!e.isRenderable()||(this.renderPath=[{x:i-s,y:n-l},{x:r-s,y:o-l}],this.path=[{x:i,y:n},{x:r,y:o}],this.steps=NW(this.renderPath,!1),e.toRenderable()),this.path;}},{key:"getBoundingRect",value:function value(){var e=this.parsedStyle,t=e.x1,i=e.x2,r=e.y1,n=e.y2,o=e.borderWidth,a=e.lineCap;return FW({x:t,y:r},{x:i,y:n},o.value,a);}},{key:"getBoundingRectObject",value:function value(){var e=this.getBoundingRect(),t=e.x,i=e.y,r=e.width,n=e.height;return new eH({style:{x:t,y:i,width:r,height:n,borderWidth:1,background:"rgba(0,0,0,0)"}});}},{key:"isPointInPath",value:function value(e){if(!this.getBoundingRectObject().isPointInPath(e))return!1;var t=this.parsedStyle,i=t.x1,r=t.x2,n=t.y1,o=t.y2,a=t.borderWidth;return YW({x:i,y:n},{x:r,y:o},a.value<20?10:a.value/2,e);}}]);}(zW),nH=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=i.style,n=Jf(i,bN);return Xk(this,t),Wk(Pw(e=IN(this,t,[Fk({type:"path",style:Fk(Fk({},WW),{},{points:[],lineJoin:"miter",lineCap:"butt",borderWidth:2,miterLimit:4},r)},n)])),"shapeType","path"),Wk(Pw(e),"renderPath",void 0),Wk(Pw(e),"pointArray",[]),Wk(Pw(e),"pointLength",0),Wk(Pw(e),"initialRect",void 0),e.getPath(),e.initialRect=e.getBoundingRect(),e.updatePosition(e.initialRect.x,e.initialRect.y),e.setOrigin(e.initialRect.width,e.initialRect.height),e;}return Mb(t,e),Yk(t,[{key:"addPoint",value:function value(e){var t=Ub(this.style.points);t.push(e),this.style.points=t;}},{key:"updateStyle",value:function value(e){var t,i=this;$k(t=eS(e)).call(t,function(t){JN(t,e)&&(i.style[t]=e[t]);});}},{key:"updateOrigin",value:function value(){var e=this.getBoundingRect(),t=e.width,i=e.height;this.setOrigin(t/2,i/2);}},{key:"updatePosition",value:function value(e,t){this.style.x=e,this.style.y=t;}},{key:"getPath",value:function value(){var e,t,i=QE(e=this.parsedStyle.points).call(e,function(e){return new qO(e.x,e.y);});return i=uS(t=this.pointArray).call(t,tH(i,this.pointLength,i.length,2)),this.parsedStyle.points.length-this.pointLength===30&&(this.pointArray=_LN(i),this.pointLength=this.parsedStyle.points.length),i.length<=3&&i.push(i[i.length-1].clone()),i=function(e){var t=e.length;if(t<3)return e;var i=[];if(3===t)i.push(e[0].clone(),e[1].clone(),e[2].clone(),e[2].clone());else{var r=NI(e).call(e);i.push(r[0]);for(var n=0;n+2<r.length;n++){var o=r[n+1],a=r[n+2],s=o,l=new qO(((null==o?void 0:o.x)+(null==a?void 0:a.x))/2,((null==o?void 0:o.y)+(null==a?void 0:a.y))/2);i.push(s),n+3===r.length?i.push(a):i.push(l);}}return i;}(i),this.path=i,this.renderPath=this.getRenderPath(this.path),this.steps=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=e.length;if(i<=1)return[];var r=[],n=Ab(e,1)[0];r.push(RW("moveTo",[n]));for(var o=0;o+2<i;o+=2){var a=e[o+1],s=e[o+2];r.push(RW("quadraticCurveTo",[a,s]));}return t&&e.length>2&&r.push(RW("lineTo",[n])),r;}(this.renderPath),this.path;}},{key:"getRenderPath",value:function value(e){var t=this.getBoundingRect(),i=t.x,r=t.y,n=[];return $k(e).call(e,function(e){!e||fS(e.x)||fS(e.y)||n.push({x:e.x-i,y:e.y-r});}),n;}},{key:"getBoundingRect",value:function value(){var e=this.parsedStyle,t=e.borderWidth,i=e.points,r=e.lineCap,n=QE(i).call(i,function(e){return new qO(e.x,e.y);}),o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=e.length;if(i<3)return e;var r=[];if(3===i)r.push(e[0].clone(),e[1].clone(),e[2].clone(),e[2].clone());else{var n=NI(e).call(e);n.unshift(e[0]),n.push(e[e.length-1]);var o=[],a=1-t;r.push(_LN(n[0]));for(var s=1;s+2<n.length;s++){var l=n[s],u=n[s-1],c=n[s+1],h=n[s+2];o[0]=_LN(l),o[1]=new qO(l.x+a*(c.x-u.x)/8,l.y+a*(c.y-u.y)/8),o[2]=new qO(c.x-a*(h.x-l.x)/8,c.y-a*(h.y-l.y)/8),o[3]=_LN(c),r.push(o[1],o[2],o[3]);}}return r;}(tH(n,0,n.length,1)),a=LW(o);if(2===i.length)return FW(i[0],i[1],t.value,r);var s=t.value/2;return{x:a.left-s,y:a.top-s,width:a.width+2*s,height:a.height+2*s};}},{key:"getBoundingRectObject",value:function value(){var e=this.getBoundingRect(),t=e.x,i=e.y,r=e.width,n=e.height;return new eH({style:{x:t,y:i,width:r,height:n,borderWidth:1,background:"rgba(0,0,0,0)"}});}},{key:"isPointInPath",value:function value(e){if(!this.getBoundingRectObject().isPointInPath(e))return!1;var t=this.parsedStyle.borderWidth,i=t.value<20?10:t.value/2;return function(e,t){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,r=0;r<t.length;r++)if(cL(e,t[r])<=i)return!0;return!1;}(e,this.style.points,i);}}]);}(zW),oH=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=i.style,n=Jf(i,kN);Xk(this,t),Wk(Pw(e=IN(this,t,[Fk({type:"polygon",style:Fk(Fk({},WW),{},{points:[{x:0,y:0},{x:10,y:10}],miterLimit:4,borderWidth:2},r)},n)])),"shapeType","polygon"),Wk(Pw(e),"renderPath",void 0),0===e.parsedStyle.points.length&&(e.style.points=[{x:0,y:0},{x:10,y:10}]);var o=e.getBoundingRect(),a=o.x,s=o.y,l=o.width,u=o.height;return e.updatePosition(a,s),e.setOrigin(l/2,u/2),e;}return Mb(t,e),Yk(t,[{key:"addPoint",value:function value(e){var t=Ub(this.style.points);t.push(e),this.style.points=t;}},{key:"updatePoints",value:function value(){var e=this.renderPath,t=this.getLocalPosition(),i=[];$k(e).call(e,function(e){i.push({x:e.x+t.x,y:e.y+t.y});}),this.style.points=i;}},{key:"updateStyle",value:function value(e){var t,i=this;$k(t=eS(e)).call(t,function(t){JN(t,e)&&(i.style[t]=e[t]);});}},{key:"updateOrigin",value:function value(){var e=this.getBoundingRect(),t=e.width,i=e.height;this.setOrigin(t/2,i/2);}},{key:"updatePosition",value:function value(e,t){this.style.x=e,this.style.y=t;}},{key:"getPath",value:function value(){var e,t=this.getBoundingRect(),i=t.x,r=t.y;return this.path=this.parsedStyle.points,this.renderPath=QE(e=this.parsedStyle.points).call(e,function(e){return{x:e.x-i,y:e.y-r};}),this.steps=NW(this.renderPath,!0),this.path;}},{key:"getBoundingRect",value:function value(){var e=this.parsedStyle,t=e.borderWidth,i=e.points,r=e.lineCap;if(2===i.length)return FW(i[0],i[1],t.value,r);var n=LW(i),o=t.value/2||0;return{x:n.left-o,y:n.top-o,width:n.width+2*o,height:n.height+2*o};}},{key:"getBoundingRectObject",value:function value(){var e=this.getBoundingRect(),t=e.x,i=e.y,r=e.width,n=e.height;return new eH({style:{x:t,y:i,width:r,height:n,borderWidth:1,background:"rgba(0,0,0,0)"}});}},{key:"isPointInPath",value:function value(e){if(!this.getBoundingRectObject().isPointInPath(e))return!1;var t=this.parsedStyle,i=t.borderWidth,r=t.background,n=t.points,o=i&&i.value,a=i.value<20?10:i.value/2,s=!1;return o&&(s=XW(n,a,e.x,e.y,!0)),!s&&r&&(s=function(e,t,i){var r=!1,n=e.length;if(n<=2)return!1;for(var o=0;o<n;o++){var a=e[o],s=e[(o+1)%n];if(hL(a,s,{x:t,y:i}))return!0;jW(a.y-i)>0!=jW(s.y-i)>0&&jW(t-(i-a.y)*(a.x-s.x)/(a.y-s.y)-a.x)<0&&(r=!r);}return r;}(n,e.x,e.y)),s;}}]);}(zW),aH=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=i.style,n=Jf(i,SN);Xk(this,t),Wk(Pw(e=IN(this,t,[Fk({type:"polyline",style:Fk(Fk({},WW),{},{points:[{x:0,y:0},{x:0,y:0}],lineEnding:null,borderWidth:2,miterLimit:4},r)},n)])),"shapeType","polyline"),Wk(Pw(e),"renderPath",void 0),e.getPath();var o=e.getBoundingRect(),a=o.x,s=o.y;return e.updatePosition(a,s),e.updateOrigin(),e;}return Mb(t,e),Yk(t,[{key:"initPath",value:function value(){var e=this.parsedStyle,t=e.points,i=e.lineEnding;t.length;var r=[];if($k(t).call(t,function(e,t){0===t?r.push({x:e.x,y:e.y,step:0,close:!1}):r.push({x:e.x,y:e.y,step:1,close:!1});}),i)for(var n=0;n<i.length;n++)switch(i[n]){case"OpenArrow":this.addOpenArrow(r,n,!1);break;case"ROpenArrow":this.addOpenArrow(r,n,!0);break;case"ClosedArrow":this.addCloseArrow(r,n,!1);break;case"RClosedArrow":this.addCloseArrow(r,n,!0);break;case"Butt":this.addButt(r,n);break;case"Slash":this.addSlash(r,n);break;case"Square":this.addSquare(r,n);break;case"Diamond":this.addDiamond(r,n);break;case"Circle":this.addCircle(r,n);}return r;}},{key:"getRenderPath",value:function value(e){var t=this.getBoundingRect(),i=t.x,r=t.y,n=[];return $k(e).call(e,function(e){!e||fS(e.x)||fS(e.y)||n.push({x:e.x-i,y:e.y-r,step:e.step,close:e.close});}),n;}},{key:"addPoint",value:function value(e){var t=Ub(this.style.points);t.push(e),this.style.points=t;}},{key:"updatePoints",value:function value(){var e,t,i=this.parsedStyle.points.length,r=this.getLocalPosition(),n=[];$k(e=NI(t=this.renderPath).call(t,0,i)).call(e,function(e){n.push({x:e.x+r.x,y:e.y+r.y});}),this.style.points=n;}},{key:"updateStyle",value:function value(e){var t,i=this;$k(t=eS(e)).call(t,function(t){JN(t,e)&&(i.style[t]=e[t]);});}},{key:"updateOrigin",value:function value(){var e=this.getBoundingRect(),t=e.width,i=e.height;this.setOrigin(t/2,i/2);}},{key:"updatePosition",value:function value(e,t){this.style.x=e,this.style.y=t;}},{key:"updatePoint",value:function value(){for(var e=this.getLocalPosition(),t=this.parsedStyle.points.length,i=[],r=0;r<t;r++)i.push({x:this.renderPath[r].x+e.x,y:this.renderPath[r].y+e.y});this.updateStyle({points:i});}},{key:"getPath",value:function value(){this.path=this.initPath(),this.renderPath=this.getRenderPath(this.path),this.steps=HW(this.renderPath);}},{key:"getBoundingRect",value:function value(){var e=this.parsedStyle,t=e.borderWidth,i=e.lineCap;if(2===this.path.length)return FW(this.path[0],this.path[1],t.value,i);var r=LW(this.path),n=t.value/2;return{x:r.left-n,y:r.top-n,width:r.width+2*n,height:r.height+2*n};}},{key:"getBoundingRectObject",value:function value(){var e=this.getBoundingRect(),t=e.x,i=e.y,r=e.width,n=e.height;return new eH({style:{x:t,y:i,width:r,height:n,borderWidth:1,background:"rgba(0,0,0,0)"}});}},{key:"isPointInPath",value:function value(e){if(!this.getBoundingRectObject().isPointInPath(e))return!1;var t=this.parsedStyle,i=t.borderWidth;return XW(t.points,i.value<20?10:i.value/2,e.x,e.y,!1);}},{key:"isLineArrow",value:function value(){var e=this.parsedStyle.lineEnding;return!!e&&("None"!==e[0]||"None"!==e[1]);}},{key:"addOpenArrow",value:function value(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.parsedStyle,n=r.points,o=r.borderWidth,a=n.length,s=n[a-2],l=n[a-1];0===t&&(s=Fk({},n[1]),l=Fk({},n[0])),ZW(e,t,i,s,l,o.value);}},{key:"addCloseArrow",value:function value(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.parsedStyle,n=r.points,o=r.borderWidth,a=n.length,s=n[a-2],l=n[a-1];0===t&&(s=Fk({},n[1]),l=Fk({},n[0])),_W(e,t,i,s,l,o.value);}},{key:"addCircle",value:function value(e,t){var i=this.parsedStyle,r=i.points,n=i.borderWidth,o=r.length;QW(e,t,r[0],r[o-1],n.value);}},{key:"addDiamond",value:function value(e,t){var i=this.parsedStyle,r=i.points,n=i.borderWidth,o=r.length;$W(e,t,r[0],r[o-1],n.value);}},{key:"addSquare",value:function value(e,t){var i=this.parsedStyle,r=i.points,n=i.borderWidth,o=r.length;KW(e,t,r[0],r[o-1],n.value);}},{key:"addSlash",value:function value(e,t){var i=this.parsedStyle,r=i.points,n=i.borderWidth,o=r.length,a=r[o-2],s=r[o-1];0===t&&(a=Fk({},r[1]),s=Fk({},r[0])),KW(e,t,a,s,n.value);}},{key:"addButt",value:function value(e,t){var i=this.parsedStyle,r=i.points,n=i.borderWidth,o=r.length,a=r[o-2],s=r[o-1];0===t&&(a=Fk({},r[1]),s=Fk({},r[0])),GW(e,t,a,s,n.value);}}]);}(zW),sH=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=i.style,n=Jf(i,xN);Xk(this,t),Wk(e=IN(this,t,[Fk({type:"text",style:Fk(Fk({},WW),{},{x:0,y:0,text:"",width:300,wordWarp:!0,wordBreak:!0,underline:!1,strikeout:!1,textAlign:"left",textBaseLine:"top",textTransform:"none",letterSpacing:0,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",fontFamily:"Microsoft YaHei",color:"white",fontSize:12,lineHeight:12},r)},n)]),"shapeType","text"),Wk(e,"lines",[]),Wk(e,"chars",[]),Wk(e,"totalHeight",void 0),Wk(e,"textX",void 0),Wk(e,"textY",void 0),Wk(e,"rowWidth",void 0),Wk(e,"realWidth",void 0),Wk(e,"cacheWidth",void 0),Wk(e,"font",void 0);var o=e.parsedStyle,a=o.x,s=o.y;return e.setFont(),e.calculateTextPosition(),e.lineWrap(),e.saveCharPosition(),e.setLocalPosition(a,s),e.updateOrigin(),e;}return Mb(t,e),Yk(t,[{key:"setFont",value:function value(){var e,t,i,r,n,o=this.parsedStyle,a=o.fontStyle,s=o.fontVariant,l=o.fontWeight,u=o.fontFamily,c=o.fontSize;this.font=uS(e=uS(t=uS(i=uS(r=uS(n="".concat(a," ")).call(n,s," ")).call(r,l," ")).call(i,c.value)).call(t,c.unit," ")).call(e,u);}},{key:"updateStyle",value:function value(e){var t,i=this;$k(t=eS(e)).call(t,function(t){JN(t,e)&&(i.style[t]=e[t]);});}},{key:"updateOrigin",value:function value(){if(this.chars[0]){var e=this.getBoundingRect(),t=e.width,i=e.height,r=this.chars[0].height/10||0,n=this.chars[0].height/2||0,o=0;switch(this.parsedStyle.textBaseLine){case"top":o=i/2-r;break;case"hanging":o=i/2;break;case"middle":o=-r+n*(this.lines.length-1);break;case"ideographic":o=1.5*-r+n*(this.lines.length-2);break;case"bottom":o=-r+n*(this.lines.length-2);break;default:o=r+n*(this.lines.length-2);}this.setOrigin(t/2-r,o);}}},{key:"updatePosition",value:function value(e,t){this.style.x=e,this.style.y=t;}},{key:"calculateTextPosition",value:function value(){var e=this.parsedStyle,t=e.x,i=e.y,r=e.width,n=e.letterSpacing,o=e.borderWidth,a=((null==o?void 0:o.value)||0)/2;this.textX=t+a+n.value,this.textY=i+a+n.value,this.rowWidth=r.value-2*a-2*n.value;}},{key:"lineWrap",value:function value(){this.totalHeight=0,this.realWidth=0;var e=this.textX,t=this.rowWidth,i=this.parsedStyle,r=i.lineHeight,n=i.wordWarp,o=i.fontSize,a=i.borderWidth,s=document.createElement("canvas").getContext("2d"),l=0;s.font=this.font;var u=o.value>r?o.value:r,c=this.transformText(this.parsedStyle.text);if(c.length||(this.lines=[],this.totalHeight=0),c.length){for(var h=[],d=this.textY,f="",v=0;v<c.length;v++){var g=c.charAt(v);if("\n"!==g&&"\r"!==g){if(f+=g,s.measureText(f).width>=t&&n){if(""===(f=f.substring(0,f.length-1))){f=g;continue;}l+=f.length;var m=s.measureText(f).width;m>this.realWidth&&(this.realWidth=s.measureText(f).width),h.push({text:f,x:e,y:d,lineWidth:m,length:f.length,sum:l}),f=g,d+=u,this.totalHeight+=u;}}else{var y=s.measureText(f).width;y>this.realWidth&&(this.realWidth=s.measureText(f).width),l+=(f+=g).length,h.push({text:f,x:e,y:d,lineWidth:y,length:f.length,sum:l}),f="",d+=u,this.totalHeight+=u;}}if(""!==f){l+=f.length;var p=s.measureText(f).width;p>this.realWidth&&(this.realWidth=s.measureText(f).width),h.push({text:f,x:e,y:d,lineWidth:p,length:f.length,sum:l});}this.totalHeight+=u,this.lines=h;}1===this.lines.length&&(this.realWidth=s.measureText(this.lines[0].text).width),a&&a.value&&(this.realWidth+=a.value);}},{key:"getBoundingRect",value:function value(){var e=this.parsedStyle,t=e.x,i=e.y,r=e.textBaseLine,n=e.fontSize,o=e.lineHeight,a=n.value>o?n.value:o,s=a/10;return{x:t-s,y:lH(r,i,a)-s,width:this.realWidth+2*s,height:this.totalHeight};}},{key:"getBoundingRectObject",value:function value(){var e=this.getBoundingRect(),t=e.x,i=e.y,r=e.width,n=e.height;return new eH({style:{x:t,y:i,width:r,height:n,borderWidth:1,background:"rgba(0,0,0,0)"}});}},{key:"isPointInPath",value:function value(e){return this.getBoundingRectObject().isPointInPath(e);}},{key:"saveCharPosition",value:function value(){var e=this;this.chars=[];var t=this.lines,i=this.parsedStyle,r=i.fontSize,n=i.textBaseLine,o=document.createElement("canvas").getContext("2d"),a=r.value;o.font=this.font;var s=0;$k(t).call(t,function(t,i){for(var r=t.x,l=0;l<t.text.length;l++){var u=t.text.charAt(l),c=o.measureText(u).width;"\n"!==u&&"\r"!==u||(c=.1),e.chars.push({char:u,index:s+l+1,charIndex:l+1,lineIndex:i,x:r,y:lH(n,t.y,a),width:c,height:a}),r+=1*o.measureText(u).width,l===t.text.length-1&&(s+=t.text.length);}});}},{key:"getCharByPosition",value:function value(e,t){for(var i={x:e,y:t},r=0;r<this.chars.length;r++)if(this.getCharBounding(r).isPointInPath(i))return this.chars[r];return!1;}},{key:"getCharBounding",value:function value(e){var t=this.chars[e],i=t.x,r=t.y,n=t.width,o=t.height;return new eH({style:{x:i,y:r-o/10,width:n,height:o,borderWidth:1,background:"rgba(0,0,0,0)"}});}},{key:"transformText",value:function value(e){var t=this.parsedStyle.textTransform;return"capitalize"===t?e=e[0].toUpperCase()+e.substring(1):"lowercase"===t?e.toLowerCase():"uppercase"===t?e.toUpperCase():e;}}]);}(zW);function lH(e,t,i){var r,n=i/10;switch(e){case"top":r=t-.5*n;break;case"hanging":r=t+.5*n;break;case"middle":r=t-i/2-.5*n;break;case"ideographic":r=t-i-.5*n;break;case"bottom":r=t-i;break;default:r=t+2*n-i;}return r;}var uH=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=i.style,n=Jf(i,CN);Xk(this,t),Wk(Pw(e=IN(this,t,[Fk({type:"freeline",style:Fk(Fk({},WW),{},{startPoint:{x:0,y:0},endPoint:{x:0,y:0},lineEnding:null,borderWidth:2},r)},n)])),"shapeType","freeline"),Wk(Pw(e),"renderPath",void 0),e.getPath();var o=e.getBoundingRect(),a=o.x,s=o.y;return e.updatePosition(a,s),e.updateOrigin(),e;}return Mb(t,e),Yk(t,[{key:"initPath",value:function value(){var e=this.parsedStyle,t=e.startPoint,i=e.endPoint,r=e.lineEnding,n=[Fk(Fk({},t),{},{step:0,close:!1}),Fk(Fk({},i),{},{step:1,close:!0})];if(r)for(var o=0;o<r.length;o++)switch(r[o]){case"OpenArrow":this.addOpenArrow(n,o,!1);break;case"ROpenArrow":this.addOpenArrow(n,o,!0);break;case"ClosedArrow":this.addCloseArrow(n,o,!1);break;case"RClosedArrow":this.addCloseArrow(n,o,!0);break;case"Butt":this.addButt(n,o);break;case"Slash":this.addSlash(n,o);break;case"Square":this.addSquare(n,o);break;case"Diamond":this.addDiamond(n,o);break;case"Circle":this.addCircle(n,o);}return n;}},{key:"getRenderPath",value:function value(e){var t=this.getBoundingRect(),i=t.x,r=t.y,n=[];return $k(e).call(e,function(e){!e||fS(e.x)||fS(e.y)||n.push({x:e.x-i,y:e.y-r,step:e.step,close:e.close});}),n;}},{key:"updatePoints",value:function value(){var e=this.getLocalPosition();this.updateStyle({startPoint:{x:this.renderPath[0].x+e.x,y:this.renderPath[0].y+e.y},endPoint:{x:this.renderPath[1].x+e.x,y:this.renderPath[1].y+e.y}});}},{key:"updateOrigin",value:function value(){var e=this.getBoundingRect(),t=e.width,i=e.height;this.setOrigin(t/2,i/2);}},{key:"updateStyle",value:function value(e){var t,i=this;$k(t=eS(e)).call(t,function(t){JN(t,e)&&(i.style[t]=e[t]);});}},{key:"updatePosition",value:function value(e,t){this.style.x=e,this.style.y=t;}},{key:"getPath",value:function value(){this.path=this.initPath(),this.renderPath=this.getRenderPath(this.path),this.steps=HW(this.renderPath);}},{key:"getBoundingRect",value:function value(){var e=this.parsedStyle,t=e.borderWidth,i=e.lineCap,r=LW(this.path);if(2===this.path.length)return FW(this.path[0],this.path[1],t.value,i);var n=t.value/2||0;return{x:r.left-n,y:r.top-n,width:r.width+2*n,height:r.height+2*n};}},{key:"getBoundingRectObject",value:function value(){var e=this.getBoundingRect(),t=e.x,i=e.y,r=e.width,n=e.height;return new eH({style:{x:t,y:i,width:r,height:n,borderWidth:1,background:"rgba(0,0,0,0)"}});}},{key:"isPointInPath",value:function value(e){if(!this.getBoundingRectObject().isPointInPath(e))return!1;var t=this.parsedStyle,i=t.startPoint,r=t.endPoint,n=t.borderWidth;return YW(i,r,n.value<20?10:n.value,e);}},{key:"isLineArrow",value:function value(){var e=this.parsedStyle.lineEnding;return!!e&&("None"!==e[0]||"None"!==e[1]);}},{key:"addCircle",value:function value(e,t){var i=this.parsedStyle;QW(e,t,i.startPoint,i.endPoint,i.borderWidth.value);}},{key:"addDiamond",value:function value(e,t){var i=this.parsedStyle;$W(e,t,i.startPoint,i.endPoint,i.borderWidth.value);}},{key:"addSquare",value:function value(e,t){var i=this.parsedStyle;!function(e,t,i,r,n){var o=n,a=r.x,s=r.y;0===t&&(a=i.x,s=i.y);var l={x:a-3*o,y:s-3*o,step:0,close:!1},u={x:a+3*o,y:s-3*o,step:1,close:!1},c={x:a+3*o,y:s+3*o,step:1,close:!1},h={x:a-3*o,y:s+3*o,step:1,close:!0};e.push(l,u,c,h);}(e,t,i.startPoint,i.endPoint,i.borderWidth.value);}},{key:"addSlash",value:function value(e,t){var i=this.parsedStyle;KW(e,t,i.startPoint,i.endPoint,i.borderWidth.value);}},{key:"addButt",value:function value(e,t){var i=this.parsedStyle;GW(e,t,i.startPoint,i.endPoint,i.borderWidth.value);}},{key:"addOpenArrow",value:function value(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.parsedStyle;ZW(e,t,i,r.startPoint,r.endPoint,r.borderWidth.value);}},{key:"addCloseArrow",value:function value(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.parsedStyle;_W(e,t,i,r.startPoint,r.endPoint,r.borderWidth.value);}}]);}(zW),cH=1/0,hH=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1/0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1/0;Xk(this,e),Wk(this,"minX",void 0),Wk(this,"maxX",void 0),Wk(this,"minY",void 0),Wk(this,"maxY",void 0),Wk(this,"rect",void 0),Wk(this,"updateId",void 0),this.minX=t,this.maxX=i,this.minY=r,this.maxY=n,this.rect=null,this.updateId=-1;}return Yk(e,[{key:"setFromBounds",value:function value(e){return this.minX=e.minX,this.minY=e.minY,this.maxX=e.maxX,this.maxY=e.maxY,this;}},{key:"clear",value:function value(){return this.minX=cH,this.maxX=-1/0,this.minY=cH,this.maxY=-1/0,this;}},{key:"getRect",value:function value(e){var t=this.minX,i=this.minY,r=this.maxX,n=this.maxY;if(t>r||i>n)return new dL(0,0,0,0);var o=e||new dL();return o.update(t,i,r-t,n-i),o;}},{key:"addPoint",value:function value(e){return this.addBounds({minX:e.x,maxX:e.x,minY:e.y,maxY:e.y});}},{key:"addBounds",value:function value(e){var t=fH(this,e);return this.setFromBounds(t);}},{key:"addBoundsMask",value:function value(e,t){var i=dH(e,t);if(i.minX<=i.maxX&&i.minY<=i.maxY){var r=fH(i,this);this.setFromBounds(r);}return this;}},{key:"intersection",value:function value(t){if(r=t,!((i=this).minX<=r.maxX&&i.maxX>=r.minX&&i.minY<=r.maxY&&i.maxY>=r.minY))return null;var i,r,n=dH(this,t);return e.fromBounds(n);}},{key:"union",value:function value(t){var i=fH(this,t);return e.fromBounds(i);}},{key:"addBoundsArea",value:function value(e,t){var i=t.x,r=t.y,n={minX:i,minY:r,maxX:i+t.width,maxY:r+t.height};return this.addBoundsMask(e,n);}},{key:"addFrame",value:function value(e,t){return this.setFromTransformedBounds(e.worldTransform,t);}},{key:"setFromTransformedBounds",value:function value(e,t){for(var i=0;i<2;i++){var r=e.transformPoint({x:i?t.maxX:t.minX,y:i?t.maxY:t.minY});this.addPoint(r);}return this;}},{key:"addQuad",value:function value(e){for(var t=0;t<4;t++)this.addPoint({x:e[2*t],y:e[2*t+1]});}}],[{key:"isEmpty",value:function value(e){return e.minX===e.maxX&&e.minY===e.maxY;}},{key:"fromBounds",value:function value(t){return new e().setFromBounds(t);}},{key:"create",value:function value(){return new e();}}]);}();function dH(e,t){return{minX:e.minX>t.minX?e.minX:t.minX,minY:e.minY>t.minY?e.minY:t.minY,maxX:e.maxX<t.maxX?e.maxX:t.maxX,maxY:e.maxY<t.maxY?e.maxY:t.maxY};}function fH(e,t){return{minX:e.minX<t.minX?e.minX:t.minX,minY:e.minY<t.minY?e.minY:t.minY,maxX:e.maxX>t.maxX?e.maxX:t.maxX,maxY:e.maxY>t.maxY?e.maxY:t.maxY};}var vH=function(e){function t(){var e;return Xk(this,t),Wk(Pw(e=IN(this,t)),"defaultView",void 0),Wk(Pw(e),"documentElement",void 0),Wk(Pw(e),"timeLine",void 0),e.nodeName="document",e.documentElement=new zW({id:"root",style:{visibility:"visible"}}),e.documentElement.ownerDocument=Pw(e),e.documentElement.parentNode=Pw(e),e.childNodes=[e.documentElement],e;}return Mb(t,e),Yk(t,[{key:"children",get:function get(){return this.childNodes;}},{key:"childElementCount",get:function get(){return this.childNodes.length;}},{key:"firstElementChild",get:function get(){return this.firstChild;}},{key:"lastElementChild",get:function get(){return this.lastChild;}},{key:"createElement",value:function value(e,t){var i=this.defaultView.customElements.get(e);return i||console.warn("Unsupported tagName: ",e),new i(t);}},{key:"getElementById",value:function value(e){return null;}},{key:"getElementsByName",value:function value(e){return this.documentElement.getElementsByTagName(e);}},{key:"getElementsByTagName",value:function value(e){return this.documentElement.getElementsByTagName(e);}},{key:"getElementsByClassName",value:function value(e){return this.documentElement.getElementsByClassName(e);}},{key:"append",value:function value(){var e;return(e=this.documentElement).append.apply(e,arguments);}},{key:"prepend",value:function value(){var e;return(e=this.documentElement).prepend.apply(e,arguments);}},{key:"querySelector",value:function value(e){return this.documentElement.querySelector(e);}},{key:"querySelectorAll",value:function value(e){return this.documentElement.querySelectorAll(e);}},{key:"find",value:function value(e){var t;return CP(t=this.documentElement).call(t,e);}},{key:"findAll",value:function value(e){return this.documentElement.findAll(e);}},{key:"appendChild",value:function value(e){return this.documentElement.appendChild(e);}},{key:"cloneNode",value:function value(e){return this.documentElement.cloneNode(e);}},{key:"insertBefore",value:function value(e,t){return this.documentElement.insertBefore(e,t);}},{key:"removeChild",value:function value(e){return this.documentElement.removeChild(e);}},{key:"replaceChild",value:function value(e,t){return this.documentElement.replaceChild(e,t);}},{key:"destroy",value:function value(){}}]);}(TW);function gH(e,t,i){i instanceof sH!=0&&e!==t&&(i.calculateTextPosition(),i.lineWrap(),i.saveCharPosition(),i.updateOrigin());}function mH(e,t,i){if(i instanceof rH!=0&&e!==t){var r=i.getBoundingRect(),n=r.x,o=r.y;i.updatePosition(n,o);}}function yH(e,t,i){if((i instanceof oH||i instanceof aH||i instanceof nH)&&e!==t){i.getPath();var r=i.getBoundingRect(),n=r.x,o=r.y;i.updatePosition(n,o),i.updateOrigin();}}function pH(e,t,i){i instanceof sH!=0&&e!==t&&(i.setFont(),i.calculateTextPosition(),i.lineWrap(),i.saveCharPosition(),i.updateOrigin());}function wH(e,t,i){(i instanceof eH||i instanceof iH)&&e!==t&&i.updateOrigin();}function bH(e,t,i){if(i instanceof uH!=0&&e!==t){i.getPath();var r=i.getBoundingRect(),n=r.x,o=r.y;i.updatePosition(n,o),i.updateOrigin();}}function kH(e,t,i){i instanceof uH==0&&i instanceof aH==0||e!==t&&(i.getPath(),i.updateOrigin());}function SH(e,t,i){t&&(AW[e]=t),i&&(UW[e]||(UW[e]=[]),UW[e].push(i));}function xH(e,t,i){for(var r=0;r<e.length;r++)SH(e[r],t,i);}var CH=function(){return Yk(function e(t){Xk(this,e),Wk(this,"contextService",void 0),Wk(this,"renderingPlugins",[]),Wk(this,"config",{autoRendering:!0}),FU(this.config,t);},[{key:"use",value:function value(e){var t;WI(t=this.renderingPlugins).call(t,e)<0&&this.renderingPlugins.push(e);}},{key:"initPlugins",value:function value(e){var t;$k(t=this.renderingPlugins).call(t,function(t){t.init(e);});}},{key:"destroyPlugins",value:function value(){var e;$k(e=this.renderingPlugins).call(e,function(e){e.destroy();});}},{key:"getPlugins",value:function value(){return this.renderingPlugins;}},{key:"getConfig",value:function value(){return this.config;}}]);}(),VH=function(){return Yk(function e(t){Xk(this,e),Wk(this,"hooks",{init:HO.create(),beginFrame:HO.create(),beforeRender:HO.create(),render:HO.create(),afterRender:HO.create(),putImageData:HO.create(),endFrame:HO.create(),destroy:HO.create(),pointerdown:HO.create(),pointerup:HO.create(),pointermove:HO.create(),pointerout:HO.create(),pointerover:HO.create(),pointerCancel:HO.create(),wheel:HO.create()}),Wk(this,"isInited",!1),Wk(this,"zIndexCounter",0),Wk(this,"renderingContext",void 0),this.renderingContext=t;},[{key:"init",value:function value(){this.hooks.init.emit(),this.isInited=!0;}},{key:"destroy",value:function value(){this.isInited=!1,this.hooks.destroy.emit();}},{key:"render",value:function value(){var e=this.renderingContext.root;this.zIndexCounter=0,VW.recursiveUpdateHierarchy(e),this.isInited&&(this.renderDisplayObject(e),this.renderingContext.dirty&&(this.hooks.endFrame.emit(),this.renderingContext.dirty=!1),this.renderingContext.renderCondition.clear());}},{key:"renderDisplayObject",value:function value(e){var t,i,r=this;if(e.isVisible){var n=e.sortable;if(n.renderOrder=this.zIndexCounter,this.zIndexCounter+=1,this.renderingContext.dirty||(this.renderingContext.dirty=!0,this.hooks.beginFrame.emit()),e.imageData)this.hooks.putImageData.emit(e);else{this.hooks.beforeRender.emit(e),this.hooks.render.emit(e),this.hooks.afterRender.emit(e);var o=!1;n.dirty&&(n.sorted=xz(t=NI(i=e.childNodes).call(i)).call(t,TH),n.dirty=!1,o=!0);var a=n.sorted||e.childNodes;a.length>1&&xz(a).call(a,function(e,t){return e.style.zIndex-t.style.zIndex;}),$k(a).call(a,function(e){r.renderDisplayObject(e);}),xz(a).call(a,function(e,t){return e.index-t.index;}),o&&e.recursiveCall(function(e){var t=new wW("renderOrderChanged",{renderOrder:e.sortable.renderOrder});e.dispatchEvent(t);});}}}},{key:"dirty",value:function value(){this.renderingContext.renderCondition.add(0);}}]);}();function TH(e,t){var i=Number(e.style.zIndex),r=Number(t.style.zIndex);if(i===r&&e.parentNode){var n=e.parentNode.childNodes,o=void 0===n?[]:n;return WI(o).call(o,e)-WI(o).call(o,t);}return i-r;}var IH=function(e){function t(e){var i;Xk(this,t),Wk(i=IN(this,t),"document",void 0),Wk(i,"customElements",void 0),Wk(i,"devicePixelRatio",void 0),Wk(i,"eventService",void 0),Wk(i,"renderingService",void 0),Wk(i,"renderingContext",void 0),Wk(i,"canvasConfig",void 0),Wk(i,"renderer",void 0),Wk(i,"supportTouchEvent",void 0),Wk(i,"supportPointerEvent",void 0),Wk(i,"contextService",void 0);var r=e.renderer,n=e.dpr,o=e.width,a=e.height,s=e.canvas,l=e.supportPointerEvent,u=e.supportTouchEvent;i.supportPointerEvent=null!=l?l:!!Mz.PointerEvent,i.supportTouchEvent=null!=u?u:"touchstart"in window;var c=o,h=a,d=n;return s&&(d=n||window.devicePixelRatio||1,c=o||s.width/d,h=a||s.height/d),i.canvasConfig=Fk(Fk({},e),{},{width:c,height:h,dpr:d}),i.canvasConfig=e,i.renderer=r,i.document=new vH(),i.document.defaultView=i,i.initRenderingContext(),i.renderingService=new VH(i.renderingContext),i.initRenderer(r),i;}return Mb(t,e),Yk(t,[{key:"initRenderingContext",value:function value(){var e=this;this.renderingContext={root:this.document.documentElement,force:!1,dirty:!1,renderCondition:new UA()},this.document.documentElement.addEventListener("child-inserted",function(t){e.mountChildren(t.detail.child);}),this.document.documentElement.addEventListener("child-removed",function(t){e.unmountChildren(t.detail.child);});}},{key:"initRenderer",value:function value(e){this.renderingService.init(),e.initPlugins(this),this.contextService.init(),e.getConfig().autoRendering&&this.render(),this.document.documentElement.recursiveCall(function(e){var t=e.renderable;t&&(t.boundsDirty=!0,t.renderBoundsDirty=!0);}),this.mountChildren(this.document.documentElement);}},{key:"render",value:function value(){var e=new wW("beforeRender",{});this.dispatchEvent(e),this.contextService.clearCanvas(),this.renderingService.render();}},{key:"setDPR",value:function value(e){this.canvasConfig.dpr=e,this.contextService.setDPR(e);}},{key:"resize",value:function value(e,t){this.canvasConfig.width=e,this.canvasConfig.height=t,this.contextService.resize(e,t);}},{key:"getContextService",value:function value(){return this.contextService;}},{key:"getEventService",value:function value(){return this.eventService;}},{key:"appendChild",value:function value(e,t){return this.document.documentElement.appendChild(e,t);}},{key:"insertBefore",value:function value(e,t){return this.document.documentElement.insertBefore(e,t);}},{key:"removeChild",value:function value(e){return this.document.documentElement.removeChild(e);}},{key:"getBoundingClientRect",value:function value(){return this.contextService.getBoundingClientRect();}},{key:"mountChildren",value:function value(e){var t=this;e.recursiveCall(function(e){e.isConnected||(e.isConnected=!0,e.ownerDocument=t.document,e.dispatchEvent(new wW("DOMNodeInsertedIntoDocument",{})));});}},{key:"unmountChildren",value:function value(e){var t,i=this,r=[];e.recursiveCall(function(e){e.isConnected&&r.push(e);}),$k(t=Xz(r).call(r)).call(t,function(e){e.isConnected=!1,e.dispatchEvent(new wW("DOMNodeRemovedFromDocument",{})),e!==i.document.documentElement&&(e.ownerDocument=null);});}}]);}(bW),EH=Yk(function e(){Xk(this,e);}),PH=function(e){function t(){var e,i;Xk(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return Wk(i=IN(this,t,uS(e=[]).call(e,n)),"close",!0),Wk(i,"shape",void 0),Wk(i,"ctx",void 0),i;}return Mb(t,e),Yk(t,[{key:"render",value:function value(e,t){var i=e.parsedStyle,r=i.background,n=i.borderColor;if("hidden"!==i.visibility){this.renderPath(e,t);var o=!QN(r)&&!r.isNone,a=!QN(n)&&!n.isNone;o&&this.renderFill(e,t),a&&this.renderStroke(e,t);}}},{key:"renderPath",value:function value(e,t){var i;e.getPath(),t.beginPath(),$k(i=e.steps).call(i,function(e){OW(t,e);}),this.close&&e.steps.length>2&&t.closePath();}},{key:"renderFill",value:function value(e,t){var i=e.parsedStyle,r=i.background,n=i.opacity,o=i.fillOpacity;if(t.save(),t.globalAlpha=n*o,_k(r)){this.setShapeGradientOrigin(e,t);for(var a=0;a<r.length;a++)0===a&&this.setShadow(e,t),t.fillStyle=this.getColor(e,r[a],t),hP(t).call(t);}else this.setShadow(e,t),t.fillStyle=r.formatted,hP(t).call(t);t.restore();}},{key:"renderStroke",value:function value(e,t){var i=this,r=e.parsedStyle,n=r.borderWidth,o=r.borderColor,a=r.opacity,s=r.lineCap,l=r.lineJoin,u=r.miterLimit,c=r.lineDash,h=r.lineDashOffset,d=r.borderOpacity;n&&n.value>0&&(t.save(),QN(n)||(t.lineWidth=n.value),t.miterLimit=u,t.globalAlpha=a*d,t.lineCap=s,t.lineJoin=l,t.setLineDash(c),t.lineDashOffset=h.value,_k(o)?(this.setShapeGradientOrigin(e,t),$k(o).call(o,function(r){t.strokeStyle=i.getColor(e,r,t),t.stroke();})):(t.strokeStyle=o.formatted,t.stroke()),t.restore());}},{key:"setShadow",value:function value(e,t){var i=e.parsedStyle,r=i.shadow,n=i.shadowOffsetX,o=i.shadowOffsetY,a=i.shadowBlur,s=i.shadowColor;(r||s)&&(t.shadowOffsetX=(null==n?void 0:n.value)||r[0],t.shadowOffsetY=(null==o?void 0:o.value)||r[1],t.shadowBlur=(null==a?void 0:a.value)||r[2],t.shadowColor=(null==s?void 0:s.formatted)||r[3]);}},{key:"getColor",value:function value(e,t,i){var r;if(1===t.type||2===t.type){var n=e.getBoundingRect(),o=n.width,a=n.height;r=function(e,t){var i=e.type,r=e.steps,n=e.width,o=e.height,a=e.angle,s=e.cx,l=e.cy,u=e.size,c=null;if(1===i){var h=function(e,t,i){var r=i*Math.PI/180,n=0+e/2,o=0+t/2,a=Math.abs(e*Math.cos(r))+Math.abs(t*Math.sin(r));return{x1:n-Math.cos(r)*a/2,y1:o-Math.sin(r)*a/2,x2:n+Math.cos(r)*a/2,y2:o+Math.sin(r)*a/2};}(n,o,a.value),d=h.x1,f=h.y1,v=h.x2,g=h.y2;c=t.createLinearGradient(d,f,v,g);}else if(2===i){var m=function(e,t,i,r,n){var o=i.value,a=r.value;"%"===i.unit&&(o=i.value/100*e),"%"===r.unit&&(a=r.value/100*t);var s=Math.max(YN({x:0,y:0},{x:o,y:a}),YN({x:0,y:t},{x:o,y:a}),YN({x:e,y:t},{x:o,y:a}),YN({x:e,y:0},{x:o,y:a}));return n&&(ON(n)?s=n.value:jN(n)&&("closest-side"===n?s=Math.min(o,e-o,a,t-a):"farthest-side"===n?s=Math.max(o,e-o,a,t-a):"closest-corner"===n&&(s=Math.min(YN({x:0,y:0},{x:o,y:a}),YN({x:0,y:t},{x:o,y:a}),YN({x:e,y:t},{x:o,y:a}),YN({x:e,y:0},{x:o,y:a}))))),{x:o,y:a,r:s};}(n,o,s,l,u),y=m.x,p=m.y,w=m.r;c=t.createRadialGradient(y,p,0,y,p,w);}return c&&$k(r).call(r,function(e){var t,i=e.offset,r=e.color;"%"===i.unit&&(null===(t=c)||void 0===t||t.addColorStop(i.value/100,r.toString()));}),c;}(Fk(Fk({type:t.type},t.value),{},{width:o,height:a}),i);}return r;}},{key:"setShapeGradientOrigin",value:function value(e,t){var i=e.config.type,r=e.parsedStyle,n=r.r,o=r.rx,a=r.ry;switch(i){case"circle":case"arc":t.translate(0-n.value,0-n.value);break;case"ellipse":t.translate(0-o.value,0-a.value);break;default:t.translate(0,0);}}}]);}(EH),BH=function(e){function t(){var e;return Xk(this,t),(e=IN(this,t)).close=!1,e;}return Mb(t,e),Yk(t);}(PH),DH=function(e){function t(){return Xk(this,t),IN(this,t,arguments);}return Mb(t,e),Yk(t);}(PH),MH=function(e){function t(){return Xk(this,t),IN(this,t,arguments);}return Mb(t,e),Yk(t);}(PH),AH=function(e){function t(){return Xk(this,t),IN(this,t,arguments);}return Mb(t,e),Yk(t,[{key:"render",value:function value(e,t){var i=e.parsedStyle,r=i.width,n=i.height;i.src;var o=i.img,a=i.opacity;"hidden"!==i.visibility&&(jN(o)||o&&(t.save(),t.globalAlpha=a,o instanceof ImageData?t.putImageData(o,0,0):t.drawImage(o,0,0,r.value,n.value),t.restore()));}}]);}(PH),UH=function(e){function t(){var e;return Xk(this,t),(e=IN(this,t)).close=!1,e;}return Mb(t,e),Yk(t);}(PH),zH=function(e){function t(){var e;return Xk(this,t),(e=IN(this,t)).close=!1,e;}return Mb(t,e),Yk(t);}(PH),RH=function(e){function t(){return Xk(this,t),IN(this,t,arguments);}return Mb(t,e),Yk(t);}(PH),NH=function(e){function t(){return Xk(this,t),IN(this,t,arguments);}return Mb(t,e),Yk(t,[{key:"render",value:function value(e,t){var i=e.parsedStyle,r=i.background,n=i.borderColor;if("hidden"!==i.visibility){var o=!QN(r)&&!r.isNone,a=!QN(n)&&!n.isNone;e.getPath();for(var s=e.steps.length,l=0;l<s;l++){var u,c=e.steps[l];t.beginPath(),$k(u=c.step).call(u,function(e){OW(t,e);}),c.close&&(t.closePath(),o&&this.renderFill(e,t)),a&&this.renderStroke(e,t);}}}}]);}(PH),OH=function(e){function t(){return Xk(this,t),IN(this,t,arguments);}return Mb(t,e),Yk(t);}(PH),LH=function(e){function t(){return Xk(this,t),IN(this,t,arguments);}return Mb(t,e),Yk(t,[{key:"render",value:function value(e,t){e&&this.renderText(e,t);}},{key:"renderText",value:function value(e,t){var i,r=this,n=e.parsedStyle,o=e.lines,a=n.color,s=n.borderWidth,l=n.borderColor,u=n.textBaseLine,c=n.opacity,h=n.textAlign,d=n.lineDash,f=n.textMaxWidth,v=n.fillOpacity,g=n.borderOpacity,m=n.letterSpacing;e.setFont(),t.save(),a&&_k(a)?$k(a).call(a,function(i){t.fillStyle=r.getColor(e,i,t);}):t.fillStyle=a.formatted,l&&_k(l)?$k(l).call(l,function(i){t.strokeStyle=r.getColor(e,i,t);}):t.strokeStyle=l.formatted,this.setShadow(e,t),t.font=e.font,t.globalAlpha=c,t.lineWidth=null==s?void 0:s.value,t.textAlign=h,t.textBaseline=u,t.letterSpacing="".concat(m.value,"px"),t.setLineDash(d),t.beginPath();var y=(null===(i=o[0])||void 0===i?void 0:i.y)||0;$k(o).call(o,function(i){var n=i.text,o=i.y-y;n=e.transformText(n),a&&r.fillText(t,n,0,o,v,null==f?void 0:f.value),s&&s.value&&s.value>0&&r.strokeText(t,n,0,o,g,null==f?void 0:f.value);}),t.closePath(),t.restore();}},{key:"fillText",value:function value(e,t,i,r,n,o){var a,s=!QN(n)&&1!==n;s&&(a=e.globalAlpha,e.globalAlpha=n*n),e.fillText(t,i,r,o),s&&(e.globalAlpha=a);}},{key:"strokeText",value:function value(e,t,i,r,n,o){var a,s=!QN(n)&&1!==n;s&&(a=e.globalAlpha,e.globalAlpha=n),e.strokeText(t,i,r,o),s&&(e.globalAlpha=a);}}]);}(PH),WH=function(e){function t(){return Xk(this,t),IN(this,t,arguments);}return Mb(t,e),Yk(t);}(PH),HH=function(e){function t(){return Xk(this,t),IN(this,t,arguments);}return Mb(t,e),Yk(t,[{key:"render",value:function value(e,t){var i,r=this,n=e.parsedStyle,o=n.background,a=n.borderColor;if("hidden"!==n.visibility){var s=!QN(o)&&!o.isNone,l=!QN(a)&&!a.isNone;e.getPath(),t.beginPath();var u=e.steps.length,c=!0;$k(i=e.steps).call(i,function(i,n){for(var o=0;o<i.step.length;o++)OW(t,i.step[o]);i.close&&(c=!1,t.closePath(),s&&r.renderFill(e,t),l&&r.renderStroke(e,t)),i.close&&n<u-1&&(c=!0,t.beginPath());}),c&&l&&this.renderStroke(e,t);}}}]);}(PH),FH=function(){return Yk(function e(t){Xk(this,e),Wk(this,"canvasConfig",void 0),Wk(this,"container",void 0),Wk(this,"canvas",void 0),Wk(this,"dpr",void 0),Wk(this,"context",void 0),Wk(this,"shapeRenderers",{}),this.canvasConfig=t;},[{key:"init",value:function value(){var e=this.canvasConfig,t=e.container,i=e.canvas,r=e.dpr,n=e.willReadFrequently;if(i){this.canvas=i;var o=i.parentElement;t&&o!==t&&t.appendChild(i),this.container=o,this.canvasConfig.container=o;}else if(t&&(this.container=t,jN(t)&&(this.container=document.getElementById(t)),this.container)){var a=document.createElement("canvas");this.container.appendChild(a),this.canvas=a;}this.context=this.canvas.getContext("2d",{willReadFrequently:n}),this.dpr=r||UO(),this.resize(this.canvasConfig.width,this.canvasConfig.height);}},{key:"registerShapeRenderer",value:function value(e,t){this.shapeRenderers[e]||(this.shapeRenderers[e]=t);}},{key:"getShapeRenderer",value:function value(e){return this.shapeRenderers[e];}},{key:"destroy",value:function value(){var e=this.canvas,t=this.container;t&&(null==e?void 0:e.parentNode)&&t.removeChild(e);}},{key:"resize",value:function value(e,t){var i=this.canvas,r=this.dpr;i&&(i.width=e*r,i.height=t*r,i.style.width="".concat(e,"px"),i.style.height="".concat(t,"px"),this.context.scale(r,r));}},{key:"getDPR",value:function value(){return this.dpr;}},{key:"setDPR",value:function value(e){this.canvasConfig.dpr=e,this.dpr=e;}},{key:"getContext",value:function value(){return this.context;}},{key:"getDomElement",value:function value(){return this.canvas;}},{key:"getCanvas",value:function value(){return this.canvas;}},{key:"setCursor",value:function value(e){var t;(null==this||null===(t=this.container)||void 0===t?void 0:t.style)&&(this.container.style.cursor=e);}},{key:"getBoundingClientRect",value:function value(){var e;return null===(e=this.canvas)||void 0===e?void 0:e.getBoundingClientRect();}},{key:"clearCanvas",value:function value(){this.canvas&&(this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.scale(this.dpr,this.dpr));}}]);}(),jH=function(){return Yk(function e(){Xk(this,e),Wk(this,"restoreStack",[]);},[{key:"init",value:function value(e){var t=this,i=e.renderingService.hooks;i.init.on(function(){}),i.destroy.on(function(){}),i.beginFrame.on(function(){}),i.endFrame.on(function(){var i,r=e.contextService.getContext();$k(i=t.restoreStack).call(i,function(){r.restore();}),t.restoreStack=[];}),i.render.on(function(i){t.renderDisplayObject(i,e);}),i.putImageData.on(function(t){if(t.imageData){var i=t.getPosition(),r=i.x,n=i.y,o=e.contextService.getContext(),a=e.contextService.getDPR();o.putImageData(t.imageData,Math.floor(r*a+1),Math.floor(n*a+1));}});}},{key:"renderDisplayObject",value:function value(e,t){if(e.isVisible){for(var i=t.contextService,r=i.getContext(),n=this.restoreStack[this.restoreStack.length-1];n&&e.parentNode!==n;)r.restore(),this.restoreStack.pop(),n=this.restoreStack[this.restoreStack.length-1];r.save(),this.applyTransform(r,e);var o=e.style.clipPath;o&&(r.save(),this.applyTransform(r,o),r.restore(),r.clip()),this.useAnchor(r,e);var a=i.getShapeRenderer(e.shapeType);a&&(a.render(e,r),e.clippable&&r.clip()),this.restoreStack.push(e);}}},{key:"applyTransform",value:function value(e,t){var i,r,n;t.externalMatrixes.length&&$k(i=Xz(r=NI(n=t.externalMatrixes).call(n)).call(r)).call(i,function(t){var i=t.a,r=t.b,n=t.c,o=t.d,a=t.e,s=t.f;e.transform(i,r,n,o,a,s);});var o=t.getLocalTransform(),a=o.a,s=o.b,l=o.c,u=o.d,c=o.e,h=o.f;e.transform(a,s,l,u,c,h);}},{key:"applyAttributes",value:function value(e,t,i){}},{key:"useAnchor",value:function value(e,t){var i=(t.parsedStyle||{}).anchor;if(i&&(0!==i.x||0!==i.y)){var r=t.getGeometryBounds().getRect();e.translate(-(i&&i.x||0)*r.width,-(i&&i.y||0)*r.height);}}},{key:"destroy",value:function value(){}}]);}();Wk(jH,"moduleName",void 0);var YH=function(){return Yk(function e(){Xk(this,e);},[{key:"init",value:function value(e){var t,i=new FH(e.canvasConfig);e.contextService=i,$k(t=[{name:"arc",renderer:new BH()},{name:"circle",renderer:new DH()},{name:"ellipse",renderer:new MH()},{name:"freeline",renderer:new HH()},{name:"image",renderer:new AH()},{name:"line",renderer:new UH()},{name:"path",renderer:new zH()},{name:"polygon",renderer:new RH()},{name:"polyline",renderer:new NH()},{name:"rect",renderer:new OH()},{name:"stampPath",renderer:new WH()},{name:"text",renderer:new LH()}]).call(t,function(e){var t=e.name,r=e.renderer;i.registerShapeRenderer(t,r);});}},{key:"destroy",value:function value(){}}]);}(),XH=function(e){function t(e){var i;return Xk(this,t),(i=IN(this,t,[e])).use(new YH()),i.use(new jH()),i;}return Mb(t,e),Yk(t);}(CH),qH=function(e){function t(e){var i;return Xk(this,t),Wk(Pw(i=IN(this,t,[e])),"name",void 0),Wk(Pw(i),"type",void 0),Wk(Pw(i),"owners",[]),Wk(Pw(i),"isDestroyed",!1),i.name=e.name,i.type=e.type,i.children=e.children||[],i;}return Mb(t,e),Yk(t,[{key:"destroy",value:function value(){this.isDestroyed||(this.children=null,this.owners=null,this.isDestroyed=!0);}},{key:"count",value:function value(){return this.children.length;}},{key:"addOwner",value:function value(e){var t=this.owners;return WI(t).call(t,e)<0&&(t.push(e),!0);}},{key:"removeOwner",value:function value(e){var t=this.owners,i=WI(t).call(t,e);return!(i<0||(mE(t).call(t,i,1),0));}}]);}(vL),ZH=function(){return Yk(function e(t){Xk(this,e),Wk(this,"docs",[]),Wk(this,"isDestroyed",!1),this.docs=[];},[{key:"destroy",value:function value(){var e;this.isDestroyed||($k(e=this.docs).call(e,function(e){e.destroy();}),this.docs=[],this.isDestroyed=!0);}},{key:"addDoc",value:function value(e,t){var i=this.getDoc(e.uid);return i||(i=new qH(e),this.docs.push(i)),t&&i.addOwner(t),i;}},{key:"getDoc",value:function value(e){var t;return CP(t=this.docs).call(t,function(t){return t.uid===e;});}},{key:"getIndexByUid",value:function value(e){var t;return PE(t=this.docs).call(t,function(t){return t.uid===e;});}},{key:"removeDoc",value:function value(e){var t,i=this.getIndexByUid(e);return i>-1&&(mE(t=this.docs).call(t,i,1),!0);}},{key:"removePage",value:function value(e,t){var i=this.getDoc(e);return!!i&&i.remove(t);}}]);}(),_H=function(){return Yk(function e(){Xk(this,e),Wk(this,"canvas",void 0),Wk(this,"renderer",void 0),Wk(this,"root",void 0),this.renderer=new XH(),this.canvas=new IH({renderer:this.renderer,width:10,height:10,canvas:document.createElement("canvas"),dpr:1,willReadFrequently:!0}),this.root=this.canvas.document.documentElement;},[{key:"render",value:function value(e){var t,i,r=this;$k(t=NI(i=this.root.children).call(i)).call(t,function(e){r.root.removeChild(e);}),this.root.appendChild(e),this.canvas.resize(e.width,e.height),this.canvas.render();}},{key:"clear",value:function value(){var e,t,i=this;$k(e=NI(t=this.root.children).call(t)).call(e,function(e){i.root.removeChild(e);}),this.root.sortable.sorted=[];}},{key:"getCanvas",value:function value(){return this.canvas.contextService.getDomElement();}}]);}(),GH=function(e){function t(){var e,i;Xk(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return Wk(i=IN(this,t,uS(e=[]).call(e,n)),"next",void 0),i;}return Mb(t,e),Yk(t,[{key:"setNext",value:function value(e){this.next=e;}},{key:"getNext",value:function value(){return this.next;}}]);}(gL),KH=function KH(e){if(e.layoutStatus.skipCalcZoom)return e.layoutStatus.skipCalcZoom=!1,!0;var t=e.layoutStatus,i=t.viewWidth,r=t.viewHeight,n=t.calcHeight,o=t.calcViewWidth,a=t.calcViewHeight,s=t.scrollbarWidth;t.validVisualWidth;var l,u=t.validLayoutWidth,c=t.validLayoutHeight,h=t.fixedWidth,d=t.fixedHeight,f=e.layoutStatus,v=f.isScrollbarChanged,g=f.isScrollbarXAppeared,m=e.direction,y=i,p=r,w=0,b=1;(w=u*(b=n<=a?1:a/n))>o?(g||(g=!0,v=!0,b=n<=a-s?1:(a-s)/n),w=u*b):g&&(g=!1,v=!0),l=c*b;var k="vertical"===m?(y-w-h)/2:0,S="vertical"===m?0:(p-l-d)/2;return k<0&&(k=0),S<0&&(S=0),e.updateLayoutStatus({layoutLeft:k,layoutTop:S,zoom:b,visualWidth:y,visualHeight:p,currentLayoutWidth:w+h,currentLayoutHeight:l+d,isScrollbarChanged:v,isScrollbarXAppeared:g}),e.setZoom(b),!v||"break";},$H=function $H(e){if(e.layoutStatus.skipCalcZoom)return e.layoutStatus.skipCalcZoom=!1,!0;var t=e.layoutStatus,i=t.viewWidth,r=t.viewHeight;t.scrollbarWidth;var n,o,a=t.validVisualWidth,s=t.validVisualHeight,l=t.validLayoutWidth,u=t.validLayoutHeight,c=t.fixedWidth,h=t.fixedHeight,d=t.zoom,f=e.layoutStatus,v=f.isScrollbarXAppeared,g=f.isScrollbarYAppeared,m=f.isScrollbarChanged,y=e.direction,p=r,w=i;n=l*d,o=u*d,Math.floor(n)>a?v||(v=!0,m=!0):v&&(v=!1,m=!0),Math.floor(o)>s?g||(g=!0,m=!0):g&&(g=!1,m=!0);var b="vertical"===y?(w-n-c)/2:0,k="vertical"===y?0:(p-o-h)/2;return b<0&&(b=0),k<0&&(k=0),e.updateLayoutStatus({layoutLeft:b,layoutTop:k,visualWidth:w,visualHeight:p,currentLayoutWidth:n+c,currentLayoutHeight:o+h,isScrollbarXAppeared:v,isScrollbarYAppeared:g,isScrollbarChanged:m}),e.setZoom(d),!m||"break";},QH=function QH(e){if(e.layoutStatus.skipCalcZoom)return e.layoutStatus.skipCalcZoom=!1,!0;var t=e.layoutStatus,i=t.viewWidth,r=t.viewHeight,n=t.calcWidth,o=t.calcViewWidth;t.calcViewHeight;var a,s=t.scrollbarWidth,l=t.validVisualHeight,u=t.validLayoutWidth,c=t.validLayoutHeight,h=t.fixedWidth,d=t.fixedHeight,f=e.layoutStatus,v=f.isScrollbarChanged,g=f.isScrollbarYAppeared,m=e.direction,y=r,p=i,w=0,b=1;(w=c*(b=n<=o?1:o/n))>l?(g||(g=!0,v=!0,b=n<=o-s?1:(o-s)/n),w=c*b):g&&(g=!1,v=!0),a=u*b;var k="vertical"===m?0:(p-a-h)/2,S="vertical"===m?(y-w-d)/2:0;return k<0&&(k=0),S<0&&(S=0),e.updateLayoutStatus({layoutLeft:k,layoutTop:S,zoom:b,visualWidth:p,visualHeight:y,currentLayoutWidth:a+h,currentLayoutHeight:w+d,isScrollbarYAppeared:g,isScrollbarChanged:v}),e.setZoom(b),!v||"break";},JH=function JH(e){if(e.layoutStatus.skipCalcZoom)return e.layoutStatus.skipCalcZoom=!1,!0;var t=e.layoutStatus,i=t.calcWidth,r=t.calcHeight;return i/t.calcViewWidth>=r/t.calcViewHeight?QH(e):KH(e);},eF=function(e){function t(){var e;return Xk(this,t),(e=IN(this,t)).addStrategy("width",QH),e.addStrategy("height",KH),e.addStrategy("window",JH),e.addStrategy("none",$H),e;}return Mb(t,e),Yk(t,[{key:"layout",value:function value(e){var t=this.next,i=e.fitType;"break"!==this.executeStrategy(i,e)&&t&&t.layout(e);}}]);}(GH),tF=function tF(e){var t=e.currentPage;if(t){var i=e.layoutStatus,r=i.defaultWidth,n=i.defaultHeight,o=i.viewWidth,a=i.viewHeight,s=e.viewer.context.getMargin(),l=e.borderWidth,u=t.image.style.img,c=t.realTimeWidth||(null==u?void 0:u.naturalWidth)||r,h=t.realTimeHeight||(null==u?void 0:u.naturalHeight)||n;e.viewer.context.config.enableSingleModeBorder||(l=0);var d=2*l,f=2*s,v=o-d-f,g=a-d-f;e.updateLayoutStatus({layoutWidth:c,layoutHeight:h,calcWidth:c,calcHeight:h,calcViewWidth:v,calcViewHeight:g,validVisualWidth:v,validVisualHeight:g,validLayoutWidth:c,validLayoutHeight:h,fixedWidth:f+d,fixedHeight:f+d});}},iF=function iF(e){if(!e.total)return!1;var t=e.layoutStatus,i=t.viewWidth,r=t.viewHeight,n=t.isScrollbarAppeared,o=t.isScrollbarChanged,a=e.layoutStatus.scrollbarWidth,s=e.total,l=e.row,u=e.column,c=e.direction,h=e.enableDWT1x1,d=e.viewer.context.getMargin(),f=e.viewer.context.getGap();1===l&&1===u&&h&&(d=0),u*l<s?n||(n=!0,o=!0,"vertical"===c?i-=a:r-=a):n&&(n=!1,o=!0);var v="vertical"===c,g=(i-(u-1)*f-2*d)/u,m=(r-(l+1)*f)/l;1===l&&1===u&&h&&(m=r),v||(m=(r-(l-1)*f-2*d)/l,g=(i-(u+1)*f)/u,1===l&&1===u&&h&&(g=i));var y=Math.max,p=Math.ceil,w=v?y(l,p(s/u)):l,b=v?u:y(u,p(s/l)),k=g*b+(b-1)*f+2*d,S=m*w+(w-1)*f+2*d;return e.updateLayoutStatus({rowHeightArray:[m],columnWidthArray:[g],layoutWidth:k,layoutHeight:S,skipCalcZoom:!0,layoutLeft:0,layoutTop:0,visualWidth:i,visualHeight:r,currentLayoutWidth:k,currentLayoutHeight:S,isScrollbarAppeared:n,isScrollbarChanged:o,realRow:w,realCol:b}),!o||"break";},rF=function rF(e){if(!e.total)return!1;var t=e.layoutStatus,i=t.viewWidth,r=t.viewHeight,n=e.current,o=e.getChildByIndex(n-1),a=e.getChildByIndex(n+1);if(o){var s=nF(e,o),l=s.left,u=s.top;o.updateStyle({x:-i+l,y:u,width:i,height:r});}if(a){var c=nF(e,a),h=c.left,d=c.top;a.updateStyle({x:i+h,y:d,width:i,height:r});}return"break";};function nF(e,t){var i,r,n=e.layoutStatus,o=n.viewWidth,a=n.viewHeight,s=e.borderWidth;e.viewer.context.config.enableSingleModeBorder||(s=0);var l=e.viewer.context.getMargin(),u=t.image.style.img,c=t.realTimeWidth||(null==u?void 0:u.naturalWidth)||e.layoutStatus.defaultWidth,h=t.realTimeHeight||(null==u?void 0:u.naturalHeight)||e.layoutStatus.defaultHeight,d=o-2*l-2*s,f=a-2*l-2*s,v=0,g=0,m=1;c<=d&&h<=f?(v=c,g=h,m=1):c/h>d/f?(v=d,g=h*(m=d/c)):(g=f,v=c*(m=f/h));var y=(d-c*m)/2+s/2+l,p=(f-h*m)/2+s/2+l;y=Math.max(l+s/2,y),p=Math.max(l+s/2,p);var w=c*(1-m)/2,b=h*(1-m)/2;return t.borderBox.updateStyle({x:0,y:0,width:v+2*s,height:g+2*s,borderWidth:s}),t.imageContainer.setLocalScale(1),t.imageContainer.updateStyle({x:s-w,y:s-b,width:c,height:h}),t.imageContainer.setLocalScale(m,m,1),t.zoom=m,t.image.updateStyle({x:0,y:0,width:(null===(i=t.image.style.img)||void 0===i?void 0:i.naturalWidth)||0,height:(null===(r=t.image.style.img)||void 0===r?void 0:r.naturalHeight)||0}),t.updateStyle({visibility:"visible"}),t.imageContainer.updateStyle({visibility:"visible"}),t.borderBox.updateStyle({visibility:"visible"}),t.image.updateStyle({visibility:"visible"}),{left:y-s/2,top:p-s/2};}var oF=function(e){function t(){var e;return Xk(this,t),(e=IN(this,t)).addStrategy("single",tF),e.addStrategy("multiple",iF),e.addStrategy("slide",rF),e;}return Mb(t,e),Yk(t,[{key:"layout",value:function value(e){var t=this.next,i=e.displayMode;"break"!==this.executeStrategy(i,e)&&t&&t.layout(e);}}]);}(GH),aF=function aF(e){var t=e.layoutStatus,i=t.zoom,r=t.visualWidth,n=t.visualHeight,o=t.defaultWidth,a=t.defaultHeight,s=t.currentLayoutWidth,l=t.currentLayoutHeight,u=e.currentPage,c=e.viewer.context.getMargin(),h=e.borderWidth;if(u){e.viewer.context.uiService.updateScrollContentSize(s,l);var d=e.viewer.context.uiService.scrollContainer,f=d.scrollLeft,v=d.scrollTop;e.setPosition({x:-f,y:-v}),e.viewer.context.config.enableSingleModeBorder||(h=0);var g=u.image.style.img,m=u.realTimeWidth||(null==g?void 0:g.naturalWidth)||o,y=u.realTimeHeight||(null==g?void 0:g.naturalHeight)||a,p=m*i,w=y*i,b=(r-p)/2-h/2,k=(n-w)/2-h/2;b=Math.max(c+h/2,b),k=Math.max(c+h/2,k);var S=m*(1-i)/2,x=y*(1-i)/2;u.updateStyle({x:b-h/2,y:k-h/2,width:p+2*h,height:w+2*h,borderWidth:h}),u.borderBox.updateStyle({x:0,y:0,width:p+2*h,height:w+2*h,borderWidth:h}),u.image.updateStyle({width:(null==g?void 0:g.naturalWidth)||0,height:(null==g?void 0:g.naturalHeight)||0}),u.imageContainer.setLocalScale(1),u.imageContainer.updateStyle({x:h-S,y:h-x,width:m,height:y}),u.imageContainer.setLocalScale(i),u.zoom=i;}},sF=function sF(e){var t=e.layoutStatus,i=t.rowHeightArray,r=t.columnWidthArray,n=t.currentLayoutWidth,o=t.currentLayoutHeight,a=e.children,s=e.row,l=e.column,u=e.direction,c=e.borderWidth,h=e.hoveredBorderWidth,d=e.selectedBorderWidth,f=e.enableDWT1x1,v=e.viewer.context.getMargin(),g=e.viewer.context.getGap();1===s&&1===l&&f&&(v=0);var m=Ab(r,1)[0],y=Ab(i,1)[0];e.viewer.context.uiService.updateScrollContentSize(n,o);var p=e.viewer.context.uiService.scrollContainer,w=p.scrollLeft,b=p.scrollTop;e.setPosition({x:-w,y:-b}),$k(a).call(a,function(t,i){var r,n=c;t.isHovered&&(n=h),WI(r=e.selected).call(r,t.uid)>-1&&(n=d);var o=i%l,a=Math.floor(i/l);"horizontal"===u&&(o=Math.floor(i/s),a=i%s);var f=v+o*(g+m)+n/2,p=v+a*(g+y)+n/2,w=m-2*n,b=y-2*n,k=t.getImage().style.img,S=t.realTimeWidth||(null==k?void 0:k.naturalWidth)||0,x=t.realTimeHeight||(null==k?void 0:k.naturalHeight)||0,C=0,V=0,T=S,I=x,E=1;(S>w||x>b)&&(S/x>w/b?(T=w,I=x*(E=w/S)):(I=b,T=S*(E=b/x))),C+=(w-T)/2,V+=(b-I)/2,C+=n,V+=n;var P=S*(1-E)/2,B=x*(1-E)/2;t.image.updateStyle({width:(null==k?void 0:k.naturalWidth)||0,height:(null==k?void 0:k.naturalHeight)||0}),t.imageContainer.updateStyle({x:C-P,y:V-B,width:S,height:x}),t.imageContainer.setLocalScale(E,E,1),t.zoom=E,t.updateStyle({x:f-n/2,y:p-n/2,width:m,height:y}),t.borderBox.updateStyle({x:0,y:0,width:m,height:y});});},lF=function(e){function t(){var e;return Xk(this,t),(e=IN(this,t)).addStrategy("single",aF),e.addStrategy("multiple",sF),e;}return Mb(t,e),Yk(t,[{key:"layout",value:function value(e){var t=this.next,i=e.displayMode;this.executeStrategy(i,e),t&&t.layout(e);}}]);}(GH);function uF(e){var t,i=e.current,r=e.total,n=e.currentPage,o=e.preloadCount;if(e.topPageUid,n){var a=i-o;a<0&&(a=0);var s=i+o;s>=r&&(s=r-1),e.visibleChildren=[],$k(t=e.children).call(t,function(t,i){var r=t.uid===n.uid,o=i>=a&&i<=s,l=t.isEdited,u=t.isUpdated,c=t.isVisible;((l||u)&&r||!c&&r)&&(t.isPageRendered=!0),r&&e.visibleChildren.push(t),t.updateStyle({visibility:r?"visible":"hidden"}),t.borderBox.updateStyle({visibility:r?"visible":"hidden"}),t.image.updateStyle({visibility:r?"visible":"hidden"}),t.imageContainer.updateStyle({visibility:r?"visible":"hidden"}),t.isPreload=o;});}}function cF(e){var t,i=e.layoutStatus,r=i.rowHeightArray,n=i.columnWidthArray,o=i.viewWidth,a=i.viewHeight,s=e.total,l=e.row,u=e.column,c=e.direction,h=e.preloadCount,d=e.topPageUid,f=e.enableDWT1x1,v=e.viewer.context.getMargin(),g=e.viewer.context.getGap();1===l&&1===u&&f&&(v=0);var m=Math.ceil,y=Math.floor,p="vertical"===c,w=p?u:m(s/l),b=p?m(s/u):l,k=0,S=w-1,x=0,C=b-1;if(p)for(var V=0;V<b;V++){var T=0===V?v:g,I=V===b-1?v:g,E=e.children[V*w],P=Ab(r,1)[0];if(E){var B=E.getPosition().y;if(B-T<=1&&B+P>1&&(x=V),B-a<-1&&B+P+I-a>=-1){C=V;break;}}}else for(var D=0;D<w;D++){var M=0===D?v:g,A=D===w-1?v:g,U=e.children[D*b],z=Ab(n,1)[0];if(U){var R=U.getPosition().x;if(R-M<=1&&R+z>1&&(k=D),R-o<=-1&&R+z+A-o>=-1){S=D;break;}}}var N=null;e.visibleChildren=[],$k(t=e.children).call(t,function(t,i){var r=p?y(i/u):i%l,n=p?i%u:y(i/l),o=r>=x&&r<=C&&n>=k&&n<=S,a=r>=x-h&&r<=C+h&&n>=k-h&&n<=S+h;o&&!N&&(N=t.uid),o&&e.visibleChildren.push(t);var s=t.isEdited,c=t.isUpdated,d=t.isVisible;((s||c)&&o||!d&&o)&&(t.isPageRendered=!0),t.updateStyle({visibility:o?"visible":"hidden"}),t.borderBox.updateStyle({visibility:o?"visible":"hidden"}),t.imageContainer.updateStyle({visibility:o?"visible":"hidden"}),t.image.updateStyle({visibility:o?"visible":"hidden"}),t.isPreload=a;var f={x:n<=k?"ahead":n>=S?"behind":"inside",y:r<=x&&r<C?"ahead":r>=C&&r>=x?"behind":"inside",column:n,row:r};t.viewportPosition=f;}),N&&N!==d&&(e.isTopPageChanged=!0,e.topPageUid=N);}var hF=function(e){function t(){var e;return Xk(this,t),(e=IN(this,t)).addStrategy("single",uF),e.addStrategy("multiple",cF),e;}return Mb(t,e),Yk(t,[{key:"layout",value:function value(e){var t=this.next,i=e.displayMode;this.executeStrategy(i,e),t&&t.layout(e);}}]);}(GH),dF=function(){return Yk(function e(){Xk(this,e),Wk(this,"viewers",void 0),Wk(this,"group",{}),Wk(this,"isDestroyed",!1),this.viewers=[];},[{key:"destroy",value:function value(){this.isDestroyed||(this.viewers=[],this.viewers=null,this.group=null,this.isDestroyed=!0);}},{key:"addViewer",value:function value(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(WI(t=this.viewers).call(t,e)>-1)return!1;var r=[];return this.group[i]?r=this.group[i]:this.group[i]=r,r.push(e.uid),this.viewers.push(e),!0;}},{key:"removeViewer",value:function value(e){var t,i,r=PE(t=this.viewers).call(t,function(t){return t.uid===e.uid;});if(r<0)return!1;var n=this.group[e.groupUid],o=WI(n).call(n,e.uid);return mE(n).call(n,o,1),0===n.length&&delete this.group[e.groupUid],mE(i=this.viewers).call(i,r,1),e.destroy(),!0;}},{key:"getViewer",value:function value(e){var t=this.viewers;return e?CP(t).call(t,function(t){return t.uid===e;}):t[0]||null;}},{key:"getAllViewers",value:function value(){var e;return NI(e=this.viewers).call(e);}},{key:"getGroup",value:function value(e){var t=this.getViewer(e);return t?this.group[t.groupUid]:null;}}]);}();function fF(){onmessage=function onmessage(e){var t=e.data.core,i=e.data.sourceWidth,r=e.data.sourceHeight,n=e.data.width,o=e.data.height,a=e.data.source.data,s=n*o*4,l=new ArrayBuffer(s),u=null;try{u=new Uint8ClampedArray(l,0,s);}catch(e){u=new Uint8Array(l,0,s);}for(var c=0;c<o;c++)for(var h=c*r/o,d=Math.floor(h),f=1-(h-d),v=d,g=(c+1)*r/o,m=Math.floor(g-1e-5),y=g-m,p=m,w=c*n*4,b=0;b<n;b++){var k=b*i/n,S=Math.floor(k),x=1-(k-S),C=S,V=(b+1)*i/n,T=Math.floor(V-1e-5),I=V-T,E=T,P=0,B=0,D=0,M=0,A=0,U=255,z=void 0,R=void 0,N=(v+1)*i*4+4*C;for(z=v+1;z<p;++z){var O=U;P+=a[N+2]*x*O,B+=a[N+1]*x*O,D+=a[N]*x*O,M+=a[N+3]*x*O,A+=U*x,N+=4*i;}var L=(v+1)*i*4+4*E;for(z=v+1;z<p;++z){var W=U;P+=a[L+2]*I*W,B+=a[L+1]*I*W,D+=a[L]*I*W,M+=a[L+3]*I*W,A+=U*I,L+=4*i;}var H=v*i*4+4*(C+1);for(R=C+1;R<E;++R){var F=U;P+=a[H+2]*f*F,B+=a[H+1]*f*F,D+=a[H]*f*F,M+=a[H+3]*f*F,A+=U*f,H+=4;}var j=p*i*4+4*(C+1);for(R=C+1;R<E;++R){var Y=U;P+=a[j+2]*y*Y,B+=a[j+1]*y*Y,D+=a[j]*y*Y,M+=a[j+3]*y*Y,A+=U*y,j+=4;}for(z=v+1;z<p;++z){var X=z*i*4+4*(C+1);for(R=C+1;R<E;++R){var q=U;P+=a[X+2]*q,B+=a[X+1]*q,D+=a[X]*q,M+=a[X+3]*q,A+=q,X+=4;}}var Z=v*i*4+4*C,_=U;P+=a[Z+2]*(f*x)*_,B+=a[Z+1]*(f*x)*_,D+=a[Z]*(f*x)*_,M+=a[Z+3]*(f*x)*_,A+=U*(f*x);var G=U;P+=a[(Z=v*i*4+4*E)+2]*(f*I)*G,B+=a[Z+1]*(f*I)*G,D+=a[Z]*(f*I)*G,M+=a[Z+3]*(f*I)*G,A+=U*(f*I);var K=U;P+=a[(Z=p*i*4+4*C)+2]*(y*x)*K,B+=a[Z+1]*(y*x)*K,D+=a[Z]*(y*x)*K,M+=a[Z+3]*(y*x)*K,A+=U*(y*x);var $=U;P+=a[(Z=p*i*4+4*E)+2]*(y*I)*$,B+=a[Z+1]*(y*I)*$,D+=a[Z]*(y*I)*$;var Q=(M+=a[Z+3]*(y*I)*$)/(A+=U*(y*I)),J=0,ee=0,te=0;0!==Q&&(J=P/A,ee=B/A,te=D/A),J+=.5,ee+=.5,te+=.5,Q+=.5,u[w]=Math.floor(te),u[w+=1]=Math.floor(ee),u[w+=1]=Math.floor(J),u[w+=1]=Math.floor(Q),w+=1;}var ie={core:t,target:u,taskUid:e.data.taskUid,callbackId:e.data.callbackId};try{postMessage(ie,[u.buffer]);}catch(e){postMessage(ie,null);}u=null;};}var vF=function(){return Yk(function e(t,i,r){var n=this;Xk(this,e),Wk(this,"worker",void 0),Wk(this,"id",void 0),Wk(this,"manager",void 0),Wk(this,"callbacks",{}),Wk(this,"busy",!1),Wk(this,"counter",0),Wk(this,"tasks",[]),this.worker=t,this.id=i,this.manager=r,this.worker.addEventListener("message",function(e){n.onMessage(e);},!1);},[{key:"setBusy",value:function value(e){if(this.busy=e,!e)if(this.tasks.length){var t=this.tasks.shift();this.send(t);}else this.worker.terminate(),this.manager.removeActor(this);}},{key:"isBusy",value:function value(){return this.busy;}},{key:"getWorker",value:function value(){return this.worker;}},{key:"onMessage",value:function value(e){this.setBusy(!1);var t=e.data.callbackId,i=t?this.callbacks[t]:null;i&&i(e.data),delete this.callbacks[t];}},{key:"send",value:function value(e,t){var i,r;if(this.busy)this.tasks.push(Fk({},e));else{this.setBusy(!0);var n=uS(i=uS(r="".concat(this.id,"-")).call(r,e.action,"-cb-")).call(i,this.counter);e.callback&&(this.callbacks[n]=e.callback,this.counter+=1),e.callbackId=n;var o=Fk(Fk({},e.data),{},{callbackId:n});t?this.worker.postMessage(o,[t.data.buffer]):this.worker.postMessage(o);}}}]);}(),gF=function(){return Yk(function e(t,i){Xk(this,e),Wk(this,"concurrency",1),Wk(this,"actors",[]),Wk(this,"workerUrl",void 0),this.workerUrl=t,this.concurrency=i;},[{key:"send",value:function value(e,t){this.getActor().send(e,t);}},{key:"getActor",value:function value(){var e,t=yx(e=this.actors).call(e,function(e){return!e.isBusy();})[0];if(t)return t;if(this.actors.length<this.concurrency){var i=new Worker(this.workerUrl),r=new vF(i,this.actors.length,this);return this.actors.push(r),r;}var n=Math.floor(Math.random()*this.concurrency);return this.actors[n];}},{key:"removeActor",value:function value(e){var t,i,r=WI(t=this.actors).call(t,e);mE(i=this.actors).call(i,r,1);}},{key:"clear",value:function value(){var e,t=function(e,t){var i=void 0!==ah&&Kh(e)||e["@@iterator"];if(!i){if(Nh(e)||(i=yf(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var r=0,n=function n(){};return{s:n,n:function n(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]};},e:function e(_e2){throw _e2;},f:n};}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var o,a=!0,s=!1;return{s:function s(){i=i.call(e);},n:function n(){var e=i.next();return a=e.done,e;},e:function e(_e3){s=!0,o=_e3;},f:function f(){try{a||null==i.return||i.return();}finally{if(s)throw o;}}};}(this.actors);try{for(t.s();!(e=t.n()).done;){e.value.getWorker().terminate();}}catch(e){t.e(e);}finally{t.f();}this.actors=[];}}]);}(),mF=function(){return Yk(function e(){Xk(this,e);},[{key:"apply",value:function value(e){this.listenSpaceHooks(e),this.listenDVSHooks(e);}},{key:"listenDVSHooks",value:function value(e){var t=this,i=e.hooksService.hooks,r=function r(t){var i=e.spaceService.space;t.trigger!==i.uid&&i.removeSource(t.removedUids);},n=function n(t){var i=e.spaceService.space;t.trigger!==i.uid&&i.move(Fk({emit:!1},t));},o=function o(t){var i=e.spaceService.space;t.trigger!==i.uid&&i.switch(Fk({emit:!1},t));},a=function a(t){var i=e.spaceService.space;t.trigger!==i.uid&&i.reorder(Fk({emit:!1},t));},s=function s(){t.listenSpaceHooks(e);};i.remove.on(r),i.move.on(n),i.switch.on(o),i.reorder.on(a),i.afterSetSpace.on(s),e.hooksService.hooks.destroy.on(function(){i.remove.off(r),i.move.off(n),i.switch.off(o),i.reorder.off(a),i.afterSetSpace.off(s);});}},{key:"listenSpaceHooks",value:function value(e){var t=e.spaceService.space.hooks,i=e.hooksService.hooks,r=function r(e){var t=e.uid;i.removeDoc.emit(t);},n=function n(e){var t=e.name,r=e.uid;i.renameDoc.emit(t,r);},o=function o(t){var i=t.node,r=t.config,n=t.type;e.viewerService.openDoc(i,n,null==r?void 0:r.viewerUid);},a=function a(e){i.appendPagesToDoc.emit(e);},s=function s(e){i.removePagesFromDoc.emit(e);},l=function l(e){i.afterUpdate.emit(e);},u=function u(e){i.remove.emit(e);},c=function c(e){i.switch.emit(e);},h=function h(e){i.move.emit(e);},d=function d(e){i.reorder.emit(e);};t.removeDoc.on(r),t.renameDoc.on(n),t.openDoc.on(o),t.loadToDoc.on(a),t.removeFromDoc.on(s),t.afterUpdateSource.on(l),t.afterRemoveSource.on(u),t.switch.on(c),t.move.on(h),t.reorder.on(d);var _f2=function f(){t.removeDoc.off(r),t.renameDoc.off(n),t.openDoc.off(o),t.loadToDoc.off(a),t.removeFromDoc.off(s),t.afterUpdateSource.off(l),t.afterRemoveSource.off(u),t.switch.off(c),t.move.off(h),t.reorder.off(d),e.spaceService.space.hooks.destroy.off(_f2),e.hooksService.hooks.afterSetSpace.off(_f2);};e.spaceService.space.hooks.destroy.on(_f2),e.hooksService.hooks.afterSetSpace.on(_f2);}}]);}(),yF=function(){return Yk(function e(){Xk(this,e);},[{key:"apply",value:function value(e){this.listenDVSHooks(e);}},{key:"listenDVSHooks",value:function value(e){var t=e.hooksService.hooks,i=function i(t){var i=e.viewerService.getDoc(t.docUid);i&&i.move(t.from,t.to);},r=function r(t){var i=e.viewerService.getDoc(t.docUid);i&&i.switch(t.one,t.other);},n=function n(t){var i=e.viewerService.getDoc(t.docUid);i&&i.reorder(t.indexes);},o=function o(t,i){var r=e.viewerService.getDoc(t);r&&r.removeOwner(i);},a=function a(t){var i=t.uid;e.viewerService.removeDoc(i);},s=function s(t){var i=t.name,r=t.uid;e.viewerService.renameDoc(i,r);},l=function l(t){e.viewerService.appendImagesToDoc(t.docUid,t.sourceUids,t.index);},u=function u(t){e.viewerService.removePagesFromDoc(t.docUid,t.sourceUids);},_c2=function c(){e.viewerService.destroy(),t.move.off(i),t.switch.off(r),t.reorder.off(n),t.removeTab.off(o),t.removeDoc.off(a),t.renameDoc.off(s),t.appendPagesToDoc.off(l),t.removePagesFromDoc.off(u),t.destroy.off(_c2);};t.move.on(i),t.switch.on(r),t.reorder.on(n),t.removeTab.on(o),t.removeDoc.on(a),t.renameDoc.on(s),t.appendPagesToDoc.on(l),t.removePagesFromDoc.on(u),t.destroy.on(_c2);}}]);}(),pF=function(){return Yk(function e(t){Xk(this,e),Wk(this,"context",void 0),Wk(this,"errorMessage","ok"),Wk(this,"errorCode",0),this.context=t;},[{key:"updateErrorMessage",value:function value(e){this.errorMessage=e.message,this.errorCode=e.code;}},{key:"err",value:function value(e){this.errorMessage=e.message,this.errorCode=e.code;}},{key:"destroy",value:function value(){this.errorMessage="",this.errorCode=null;}}]);}(),wF=Yk(function e(t){Xk(this,e),Wk(this,"context",void 0),Wk(this,"hooks",{init:HO.create(),destroy:HO.create(),beforeLoad:HO.create(),load:HO.create(),afterLoad:HO.create(),beforeRemove:HO.create(),remove:HO.create(),afterRemove:HO.create(),beforeUpdate:HO.create(),update:HO.create(),afterUpdate:HO.create(),move:HO.create(),switch:HO.create(),reorder:HO.create(),appendPagesToDoc:HO.create(),removePagesFromDoc:HO.create(),removeDoc:HO.create(),renameDoc:HO.create(),openDoc:HO.create(),beforeChangeBuffer:HO.create(),afterChangeBuffer:HO.create(),changePage:HO.create(),selectPage:HO.create(),beforeRender:HO.create(),render:HO.create(),afterRender:HO.create(),createViewer:HO.create(),removeViewer:HO.create(),afterLoadImage:HO.create(),error:HO.create(),log:HO.create(),rotate:HO.create(),scale:HO.create(),flip:HO.create(),mirror:HO.create(),crop:HO.create(),erase:HO.create(),changeSize:HO.create(),reset:HO.create(),overlay:HO.create(),beforeUndo:HO.create(),undo:HO.create(),beforeRedo:HO.create(),redo:HO.create(),layout:HO.create(),beforeSetSpace:HO.create(),afterSetSpace:HO.create(),focusChanged:HO.create(),checkVisibility:HO.create(),removeTab:HO.create()}),this.context=t;}),bF=function(){return Yk(function e(t){Xk(this,e),Wk(this,"imagePool",{}),Wk(this,"tasks",[]),Wk(this,"loaders",3),Wk(this,"loadTimer",null),Wk(this,"context",void 0),Wk(this,"isDestroyed",!1),this.context=t;},[{key:"destroy",value:function value(){this.context=null,this.tasks=[],this.loaders=0,this.isDestroyed=!0;}},{key:"checkVisibility",value:function value(e){return this.context.viewerService.isPageNeedLoad(e);}},{key:"load",value:function value(e){var t,i=this,r=this.context.spaceService.getStatus(e);r&&!r.isLoading&&(WI(t=this.tasks).call(t,e)<0&&(this.tasks.push(e),this.loading()),this.loadTimer||(this.loadTimer=mL.createTimer(function(){i.loading();},20)));}},{key:"loading",value:function value(){if(this.loaders>0)if(this.tasks.length)for(;this.tasks.length;){var e=this.tasks.shift();if(this.context.viewerService.isPageNeedLoad(e).ori&&(this.loaders-=1,this.run(e).catch(function(){})),this.loaders<1)break;}else this.loadTimer&&(mL.clearTimer(this.loadTimer),this.loadTimer=null);}},{key:"run",value:(t=Ew(VN().m(function e(t){var i,r,n,o,a,s,l,u,c,h,d;return VN().w(function(e){for(;;)switch(e.n){case 0:if(i=this.context,r=i.spaceService,n=i.hooksService,o=i.viewerService,!(a=r.getStatus(t))){e.n=20;break;}if(a.isLoading=!0,s=rO(),a.oriTask=s,a.oriData){e.n=12;break;}return e.n=1,r.getOriginalData(t);case 1:if(l=e.v,a.oriTask===s){e.n=3;break;}return e.n=2,this.run(t);case 2:return e.a(2,void e.v);case 3:if(o.isPageNeedLoad(t).ori){e.n=4;break;}return e.a(2,(this.loaders+=1,void(a.isLoading=!1)));case 4:if(l&&l.oriData){e.n=8;break;}if(u=r.getExternalImageLoader()){e.n=5;break;}return e.a(2,(this.loaders+=1,void(a.isLoading=!1)));case 5:return e.n=6,u.getImage(t);case 6:if(c=e.v){e.n=7;break;}return e.a(2,(this.loaders+=1,void(a.isLoading=!1)));case 7:l.oriData=c,r.updateOriginalData(t,l);case 8:if(h="",10!==document.documentMode){e.n=10;break;}return e.n=9,this.convertData(l.oriData);case 9:h=e.v.data,e.n=11;break;case 10:h=AO(l.oriData).data;case 11:a.oriData=h;case 12:if(a.img&&(!a.img||a.img.src===a.oriData)){e.n=19;break;}if(!this.isDestroyed){e.n=13;break;}return e.a(2);case 13:return e.n=14,this.loadImage(a.oriData);case 14:if(d=e.v){e.n=15;break;}return e.a(2,(this.loaders+=1,void(a.isLoading=!1)));case 15:if(a.oriTask===s){e.n=17;break;}return e.n=16,this.run(t);case 16:return e.a(2,void e.v);case 17:if(o.isPageNeedLoad(t).ori){e.n=18;break;}return e.a(2,(this.loaders+=1,void(a.isLoading=!1)));case 18:a.img=d;case 19:a.isLoading=!1,n.hooks.afterLoadImage.emit(t,"ori");case 20:this.loaders+=1;case 21:return e.a(2);}},e,this);})),function(e){return t.apply(this,arguments);})},{key:"convertData",value:function value(e){return new uB(function(t,i){if(ON(e))t(e);else{var r=new XMLHttpRequest();r.onload=function(){var e=AO(r.response);t(e);},r.open("GET",e,!0),r.responseType="blob",r.send();}});}},{key:"loadImage",value:(e=Ew(VN().m(function e(t){return VN().w(function(e){for(;;)if(0===e.n)return e.a(2,new uB(function(e,i){var r=new Image();r.crossOrigin="Anonymous",r.onload=function(){r.onload=null,r.onerror=null,e(r);},r.onerror=function(t){r.onload=null,r.onerror=null,e(null);},r.src=t;}));},e);})),function(t){return e.apply(this,arguments);})}]);var e,t;}(),kF=function(){return Yk(function e(t){Xk(this,e),Wk(this,"context",void 0),Wk(this,"layouts",[]),Wk(this,"head",void 0),this.context=t,this.use(new oF()),this.use(new eF()),this.use(new lF()),this.use(new hF()),this.init();},[{key:"use",value:function value(e){var t;WI(t=this.layouts).call(t,e)>-1||this.layouts.push(e);}},{key:"clear",value:function value(){this.layouts=[];}},{key:"layout",value:function value(e){0!==e.total?this.head.layout(e):e.layoutStatus.reset();}},{key:"destroy",value:function value(){this.head=null;}},{key:"init",value:function value(){var e=this.layouts;if(e.length){var t=e[0],i=null;this.head=t;for(var r=1,n=e.length;r<n;r++)i=e[r],t.setNext(i),t=i;}}}]);}(),SF=function(){return Yk(function e(t){Xk(this,e),Wk(this,"imagePool",{}),Wk(this,"tasks",[]),Wk(this,"loaders",3),Wk(this,"loadTimer",null),Wk(this,"context",void 0),Wk(this,"isDestroyed",!1),this.context=t;},[{key:"destroy",value:function value(){this.context=null,this.tasks=[],this.loaders=0,this.isDestroyed=!0;}},{key:"checkVisibility",value:function value(e){return this.context.viewerService.isPageNeedLoad(e);}},{key:"load",value:function value(e){var t,i=this,r=this.context.spaceService.getStatus(e);r&&!r.isMinLoading&&(WI(t=this.tasks).call(t,e)<0&&(this.tasks.push(e),this.loading()),this.loadTimer||(this.loadTimer=mL.createTimer(function(){i.loading();},20)));}},{key:"loading",value:function value(){if(this.loaders>0)if(this.tasks.length)for(;this.tasks.length;){var e=this.tasks.shift();if(this.context.viewerService.isPageNeedLoad(e).min&&(this.loaders-=1,this.run(e).catch(function(){})),this.loaders<1)break;}else this.loadTimer&&(mL.clearTimer(this.loadTimer),this.loadTimer=null);}},{key:"run",value:(t=Ew(VN().m(function e(t){var i,r,n,o,a,s,l,u,c,h,d;return VN().w(function(e){for(;;)switch(e.n){case 0:if(i=this.context,r=i.spaceService,n=i.hooksService,o=i.viewerService,!(a=r.getStatus(t))){e.n=13;break;}if(a.isMinLoading=!0,s=rO(),a.minTask=s,a.minData){e.n=5;break;}return e.n=1,r.getOriginalData(t);case 1:if(l=e.v,a.minTask===s){e.n=3;break;}return e.n=2,this.run(t);case 2:return e.a(2,void e.v);case 3:if(o.isPageNeedLoad(t).min){e.n=4;break;}return e.a(2,(this.loaders+=1,void(a.isMinLoading=!1)));case 4:u=AO(l.minData||l.oriData).data,a.minData=u;case 5:if(a.minImg&&(!a.minImg||a.minImg.src===a.minData)){e.n=12;break;}if(!this.isDestroyed){e.n=6;break;}return e.a(2);case 6:return e.n=7,this.loadImage(a.minData);case 7:if(c=e.v){e.n=8;break;}return e.a(2,(this.loaders+=1,void(a.isMinLoading=!1)));case 8:if(a.minTask===s){e.n=10;break;}return e.n=9,this.run(t);case 9:return e.a(2,void e.v);case 10:if(o.isPageNeedLoad(t).min){e.n=11;break;}return e.a(2,(this.loaders+=1,void(a.isMinLoading=!1)));case 11:a.minImg=c,(h=r.space.getMetadata(t))&&(d=h.height/c.naturalHeight,a.imageScale=d);case 12:a.isMinLoading=!1,n.hooks.afterLoadImage.emit(t,"min");case 13:this.loaders+=1;case 14:return e.a(2);}},e,this);})),function(e){return t.apply(this,arguments);})},{key:"loadImage",value:(e=Ew(VN().m(function e(t){return VN().w(function(e){for(;;)if(0===e.n)return e.a(2,new uB(function(e,i){var r=new Image();r.crossOrigin="Anonymous",r.onload=function(){r.onload=null,r.onerror=null,e(r);},r.onerror=function(t){r.onload=null,r.onerror=null,e(null);},r.src=t;}));},e);})),function(t){return e.apply(this,arguments);})}]);var e,t;}(),xF=function(){return Yk(function e(t){Xk(this,e),Wk(this,"context",void 0),this.context=t;},[{key:"getImageData",value:(e=Ew(VN().m(function e(t,i){var r=this;return VN().w(function(e){for(;;)if(0===e.n)return e.a(2,new uB(function(e,n){var o=r.context.spaceService.getStatus(t);o||n(new Error("The page is not exist."));var _a2=function a(n,s){if("min"!==s&&n===t&&o.isSaving){o.isSaving=!1,r.context.hooksService.hooks.afterLoadImage.off(_a2);var l=o.img.naturalWidth,u=o.img.naturalHeight,c=[],h=[];if(r.context.editService){var d={operations:o.operations,width:o.img.naturalWidth,height:o.img.naturalHeight},f=r.context.editService.handle(d);l=f.width,u=f.height,c=f.matrixes,h=f.blanks;}var v=new iH({style:{x:0,y:0,img:o.img,width:o.img.naturalWidth,height:o.img.naturalHeight}});v.externalMatrixes=c;var g=new eH({style:{x:0,y:0,width:l,height:u,background:"#fff"}}),m=new eH();$k(h).call(h,function(e){var t=new oH({id:e.uid,style:{background:e.background,points:e.points,borderWidth:0}});m.appendChild(t);}),v.appendChild(m),g.appendChild(v),r.context.commonCanvas.render(g),r.context.commonCanvas.clear();var y=r.context.commonCanvas.getCanvas(),p=(null==i?void 0:i.type)||"imageData",w=(null==i?void 0:i.mime)||"image/png",b=(null==i?void 0:i.mime)||1,k=Math.max(l,u)||1;if(null!=i&&i.min&&k>720){var S=720/k,x=S*l,C=S*u,V=document.createElement("canvas");V.width=x,V.height=C;var T=V.getContext("2d",{willReadFrequently:!0});if(T.drawImage(y,0,0,Math.floor(l),Math.floor(u),0,0,x,C),"imageData"===p){var I=T.getImageData(0,0,x,C);e(I);}else"blob"===p&&V.toBlob(function(t){e(t);},w,b);}else if("imageData"===p){var E=y.getContext("2d",{willReadFrequently:!0}).getImageData(0,0,l,u);e(E);}else"blob"===p&&y.toBlob(function(t){e(t);},w,b);}};r.context.hooksService.hooks.afterLoadImage.on(_a2),o.isSaving=!0,r.context.imageService.load(t);}));},e);})),function(t,i){return e.apply(this,arguments);})}]);var e;}(),CF=function(){return Yk(function e(t,i){Xk(this,e),Wk(this,"context",void 0),Wk(this,"iSpace",void 0),this.context=t,this.iSpace=i||new zL();},[{key:"space",get:function get(){return this.iSpace;}},{key:"setSpace",value:function value(e){this.iSpace=e;}},{key:"getStatus",value:function value(e){return this.space.statusStore.get(e);}},{key:"getOriginalData",value:function value(e){return this.space.store.get(e);}},{key:"updateOriginalData",value:function value(e,t){return this.space.store.update(e,t);}},{key:"removeOriginalData",value:function value(e){return this.space.store.remove(e);}},{key:"getExternalImageLoader",value:function value(){return this.space.imageLoader;}},{key:"destroy",value:function value(){this.iSpace.destroy(),this.iSpace=null;}}]);}();function VF(e){var t;return uS(t="".concat(FN()," DVS: ")).call(t,e);}var TF=function(){return Yk(function e(t){Xk(this,e),Wk(this,"context",void 0),Wk(this,"logs",[]),Wk(this,"enableLog",!0),this.context=t,this.logs.push(VF("Initialize Log object."));},[{key:"updateLogMessage",value:function value(e){this.enableLog&&(null==this||this.logs.push(VF(e)));}},{key:"log",value:function value(e){this.enableLog&&(null==this||this.logs.push(VF(e)));}},{key:"clear",value:function value(){this.logs=[];}},{key:"destroy",value:function value(){this.logs=null;}}]);}(),IF=function(){return Yk(function e(t){Xk(this,e),Wk(this,"context",void 0),Wk(this,"docManager",void 0),Wk(this,"viewerManager",void 0),Wk(this,"isDestroyed",!1),Wk(this,"scrollbarWidth",0),this.context=t,this.docManager=new ZH(),this.viewerManager=new dF(),this.getScrollbarWidth();},[{key:"isPageNeedLoad",value:function value(e){for(var t={ori:!1,min:!1},i=this.viewerManager.getAllViewers(),r=0,n=i.length;r<n;r++){var o=this.context.spaceService.getStatus(e);o&&o.isSaving&&(t.ori=!0);var a=i[r].checkPageVisibility(e);a.min&&(t.min=!0),a.ori&&(t.ori=!0);}return t;}},{key:"destroy",value:function value(){var e,t=this;this.isDestroyed||($k(e=this.viewerManager.getAllViewers()).call(e,function(e){return t.removeViewer(e);}),this.docManager.destroy(),this.docManager=null,this.isDestroyed=!0);}},{key:"createViewer",value:function value(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=null,r=null,n=t.syncViewerUid;if(n){if(!(r=this.getViewer(n)))return this.context.errorService.err(AN),null;i=r.groupUid;}else i=rO();var o=LO.create(),a=this.context;o.save();var s,l=Fk(Fk({},t),{},{groupUid:i,emitter:o,dvsContext:a}),u=new a.dvs.subClasses.Viewer(l),c=u.uid;(o.restore(),this.context.hooksService.hooks.createViewer.emit({viewer:u}),this.viewerManager.addViewer(u,i),r)&&($k(s=r.getAllTabs()).call(s,function(t){var i;$k(i=t.children).call(i,function(t){var i=e.context.spaceService.getStatus(t.uid);i&&i.addOwner(c);}),e.docManager.getDoc(t.uid).addOwner(c);}),u.context.syncFromViewer(r));return this.context.trackerService.log("Invoking ViewerController#createViewer."),u;}},{key:"removeViewer",value:function value(e){var t,i=this;if(!e)return!1;var r=e;return jN(e)&&(r=this.viewerManager.getViewer(e)),!!r&&(this.viewerManager.removeViewer(r),$k(t=this.docManager.docs).call(t,function(e){var t;e.removeOwner(r.uid)&&$k(t=e.children).call(t,function(e){var t=i.context.spaceService.getStatus(e);t&&t.removeViewer(r.uid);});}),this.context.trackerService.log("Invoking ViewerController#removeViewer."),!0);}},{key:"getViewer",value:function value(e){return this.viewerManager.getViewer(e);}},{key:"openDoc",value:function value(e,t,i){var r,n=this,o=NI(r=e.children).call(r),a=this.docManager.getDoc(e.uid);a||(a=this.docManager.addDoc({uid:e.uid,name:e.name,type:t,children:[]},i)),a.children=o;var s=[];if(i){var l=this.viewerManager.getGroup(i);if(!l)return void this.context.errorService.err(AN);s=QE(l).call(l,function(e){return n.viewerManager.getViewer(e);});}else s=this.viewerManager.getAllViewers();$k(s).call(s,function(e){e&&(a.addOwner(e.uid),e.context.hooksService.hooks.openDoc.emit(a));});}},{key:"removeDoc",value:function value(e){this.docManager.getDoc(e)&&this.docManager.removeDoc(e);}},{key:"renameDoc",value:function value(e,t){var i=this.docManager.getDoc(t);i&&(i.name=e);}},{key:"removePagesFromDoc",value:function value(e,t){var i=this.docManager.getDoc(e);i&&$k(t).call(t,function(e){i.remove(e);});}},{key:"appendImagesToDoc",value:function value(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,r=this.docManager.getDoc(e);if(r){var n=i>-1;$k(t).call(t,function(e,t){var o;WI(o=r.children).call(o,e)<0&&(n?r.insert(e,i+t):r.append(e));});}}},{key:"getDoc",value:function value(e){return this.docManager.getDoc(e);}},{key:"getScrollbarWidth",value:function value(){var e,t=document.createElement("div"),i=document.createElement("div");t.appendChild(i),t.style.width="60px",t.style.height="60px",t.style.position="absolute",t.style.overflow="auto",i.style.width="100px",i.style.height="100px",document.body.appendChild(t);var r=t.offsetWidth-t.clientWidth;document.body.removeChild(t),this.scrollbarWidth=r,$k(e=this.viewerManager.getAllViewers()).call(e,function(e){e.context.setScrollbarWidth(r);});}}]);}(),EF=function(){return Yk(function e(t){Xk(this,e),Wk(this,"context",void 0),Wk(this,"hermiteWorkerUrl",void 0),Wk(this,"workers",[]),Wk(this,"concurrency",navigator.hardwareConcurrency||4),Wk(this,"cores",0),this.context=t,this.createWorkerUlr();},[{key:"createWorkerUlr",value:function value(){this.hermiteWorkerUrl=UI.createObjectURL(new Blob(["(",fF.toString(),")()"],{type:"application/javascript"}));}},{key:"run",value:function value(e,t){var i=this;return new uB(function(r,n){var o=i.getWorker();o||n(new Error("There is no idle worker.")),o.running=!0,o.worker.onmessage=function(e){o.running=!1,r(e.data);},o.worker.onerror=function(e){o.running=!1,n(e);},t?o.worker.postMessage(e,[t]):o.worker.postMessage(e);});}},{key:"getWorker",value:function value(){for(var e=this.workers.length,t=0;t<e;t++)if(!this.workers[t].running)return this.workers[t];if(e<this.concurrency){var i={running:!1,worker:new Worker(this.hermiteWorkerUrl)};return this.workers.push(i),i;}return null;}},{key:"isWorkerIdle",value:function value(){for(var e=this.workers.length,t=0;t<e;t++)if(!this.workers[t].running)return!0;return e<this.concurrency;}}]);}(),PF=function(){return Yk(function e(t){Xk(this,e),Wk(this,"actorSystem",void 0),Wk(this,"context",void 0),Wk(this,"hermiteWorkerUrl",void 0),Wk(this,"concurrency",3),this.context=t,this.createWorkerUlr(),this.actorSystem=new gF(this.hermiteWorkerUrl,this.concurrency);},[{key:"createWorkerUlr",value:function value(){this.hermiteWorkerUrl=UI.createObjectURL(new Blob(["(",fF.toString(),")()"],{type:"application/javascript"}));}},{key:"optimize",value:function value(e,t,i,r,n,o){var a=this;return new uB(function(s,l){var u=e.getContext("2d"),c=Math.floor(t)||1,h=Math.floor(i)||1,d=u.getImageData(0,0,c,h),f={action:"optimize",data:{taskUid:o,sourceWidth:c,sourceHeight:h,width:Math.ceil(r)||1,height:Math.ceil(n)||1,source:d},callback:function callback(e){s(e);}};a.actorSystem.send(f,f.data.source);});}}]);}();function BF(e){var t,i=document.createElement("div");i.style.border=e,e=zS(t=i.style.border).call(t),i=null;var r=Ab(e.match(/(^\d+)p?x?\s+(\w+)\s+(.+)/)||[],4),n=r[1],o=r[2],a=r[3];if(HN(n)||HN(o)||HN(a))return{};var s=[];return"dashed"===o&&(s=[2*$S(n,10),$S(n,10)]),{borderWidth:n,lineDash:s,borderColor:a};}function DF(e,t,i){var r={isOver:!1,pointerX:-1,pointerY:-1,obj:e};if(e&&e.isVisible){var n=e.getPosition(),o=n.x,a=n.y,s=e.width,l=e.height;r.isOver=t>=o&&i>=a&&t<=o+s&&i<=a+l;var u=e.getScale();r.pointerX=(t-o)/u.x,r.pointerY=(i-a)/u.y;}return r;}function MF(e,t){return void 0===t&&(t=[e.getCurrentIndex()]),ZN(t)&&(t=[t]),t;}function AF(e,t){var i;if(!NN(t))return e.err(BN),!1;if(0===t.length)return e.err(AN),!1;var r=e.getCurrentTab();if(!r)return!1;var n=xz(i=NI(t).call(t)).call(i,function(e,t){return e-t;});return n[0]<0||n[n.length-1]>r.total?(e.err(DN),!1):r;}var UF={tag:"div",id:"dvs-viewer",className:"dvs-viewer",children:[{tag:"div",id:"dvs-viewer-middle",className:"dvs-viewer-middle",children:[{tag:"div",id:"dvs-viewer-main",className:"dvs-viewer-main",children:[{tag:"div",id:"dvs-main-container",className:"dvs-main-container",children:[{tag:"div",id:"dvs-scroller-and-canvas",className:"dvs-scroller-and-canvas",children:[{tag:"div",id:"dvs-scroll-container",className:"dvs-scroll-container",children:[{tag:"div",id:"dvs-scroll-content",className:"dvs-scroll-content"}]},{tag:"div",id:"dvs-canvas-container",className:"dvs-canvas-container",children:[]}]},{tag:"div",id:"dvs-video-container",className:"dvs-video-container",children:[{tag:"img",id:"dvs-video-image",class:"dvs-video-image"}]}]}]}]}]},zF={tag:"div",id:"dvs-viewer",className:"dvs-viewer",children:[{tag:"div",id:"dvs-scroll-container",className:"dvs-scroll-container",children:[{tag:"div",id:"dvs-scroll-content",className:"dvs-scroll-content"}]},{tag:"div",id:"dvs-canvas-container",className:"dvs-canvas-container"}]},RF={viewerStyle:{background:"#434246"},canvasStyle:{cursor:"default"},pageStyle:{border:"4px solid #707070",background:"#e2e2e2"},selectedPageStyle:{background:"#6f76ff",border:"4px solid #e98b1f"},hoveredPageStyle:{background:"#a5a9fb",border:"4px solid #e98b1f"},placeholderStyle:{background:"#b5b5b5",border:"0px solid #f00"},pageNumberStyle:{visibility:"visible",width:24,height:24,background:"#fff",borderWidth:1,borderRadius:0,borderColor:"#000",opacity:.5,color:"#000",fontSize:12,fontFamily:"sans-serif",textAlign:"center",textBaseline:"middle",left:"",top:"",right:0,bottom:0},checkboxStyle:{visibility:"visible",width:24,height:24,background:"#fff",borderWidth:2,borderRadius:0,borderColor:"#000",opacity:.5,left:0,top:0},removeBtnStyle:{visibility:"visible",width:24,height:24,background:"#fff",borderWidth:1,borderRadius:"50%",borderColor:"#515151",opacity:1,left:"",top:-8,right:-8,bottom:"",checkMarkColor:"#ea2e2e"},enableDragPage:!0,enableKeyboardControl:!0,multiselectMode:!1,enableOptimizeImage:!1,zoomOrigin:{x:"center",y:"center"},zoom:1,minZoom:.02,maxZoom:8,enableZoom:!0,enableScrollX:!0,enableScrollY:!0,keepZoom:!0,zoomInDelta:1.2,zoomOutDelta:1.2,wheelZoomDelta:1.2,scrollDirection:"vertical",displayMode:"single",toolType:"default",fitType:"window",enableSlide:!0,show:!0,rows:1,columns:1,pure:!1,margin:10,gap:10,autoScroll:!0,autoChangeIndex:!0,autoSelectLatest:!0,enableSelectWithShift:!0,enableSelectWithCtrl:!0,enableZoomWithCtrl:!0,tabMode:"single",enableSyncSelect:!0,enableSingleModeBorder:!1,blankFillColor:"#fff",dragThreshold:3,slideThreshold:20,maxOptimizationSize:7e3,useMinImage:!0,enableDWT1x1:!1,enableEmitPageRendered:!0,autoSelectTopPage:!1,showVideoContainer:!1},NF=function(){return Yk(function e(){Xk(this,e);},[{key:"init",value:function value(e){this.listenDVSHooks(e),this.listenViewerHooks(e);}},{key:"listenDVSHooks",value:function value(e){var t=e.dvsContext.hooksService.hooks,i=function i(t,_i3){"min"===_i3?e.renderMinPage(t):e.renderPage(t);},r=function r(t){e.tabService.updateTab(t);},n=function n(t){e.tabService.movePage(t);},o=function o(t){e.tabService.switchPage(t);},a=function a(t){e.tabService.reorderPages(t);},s=function s(t){e.tabService.changePage(t);},l=function l(t){e.tabService.selectPage(t);},u=function u(t){e.tabService.appendPagesToDoc(t.docUid,t.sourceUids,t.index,t.isSameDoc);},c=function c(t){e.tabService.removePagesFromDoc(t.docUid,t.sourceUids);},h=function h(t){e.tabService.removeDoc(t);},d=function d(t,i){e.tabService.renameDoc(t,i);},f=function f(){e.tabCleared();},v=function v(t){e.isFocus=t===e.viewerUid;};t.afterLoadImage.on(i),t.afterUpdate.on(r),t.move.on(n),t.switch.on(o),t.reorder.on(a),t.changePage.on(s),t.selectPage.on(l),t.appendPagesToDoc.on(u),t.removePagesFromDoc.on(c),t.removeDoc.on(h),t.renameDoc.on(d),t.afterSetSpace.on(f),t.focusChanged.on(v),e.hooksService.hooks.destroy.on(function(){t.afterLoadImage.off(i),t.afterUpdate.off(r),t.move.off(n),t.switch.off(o),t.reorder.off(a),t.changePage.off(s),t.selectPage.off(l),t.appendPagesToDoc.off(u),t.removePagesFromDoc.off(c),t.removeDoc.off(h),t.renameDoc.off(d),t.afterSetSpace.off(f),t.focusChanged.off(v);});}},{key:"listenViewerHooks",value:function value(e){var t=e.hooksService.hooks,i=e.dvsContext.hooksService,r=function r(e){i.hooks.remove.emit(e);},n=function n(e){i.hooks.move.emit(e);},o=function o(e){i.hooks.switch.emit(e);},a=function a(e){i.hooks.reorder.emit(e);},s=function s(e){i.hooks.changePage.emit(e);},l=function l(e){i.hooks.selectPage.emit(e);},u=function u(e){i.hooks.focusChanged.emit(e);},c=function c(t){i.hooks.focusChanged.emit(t,e.viewerUid);},_h2=function h(){t.remove.off(r),t.move.off(n),t.switch.off(o),t.reorder.off(a),t.changePage.off(s),t.selectPage.off(l),t.focusChanged.off(u),t.removeTab.off(c),e.hooksService.hooks.destroy.off(_h2);};t.remove.on(r),t.move.on(n),t.switch.on(o),t.reorder.on(a),t.changePage.on(s),t.selectPage.on(l),t.focusChanged.on(u),t.removeTab.on(c),e.hooksService.hooks.destroy.on(_h2);}}]);}(),OF=Yk(function e(){Xk(this,e);});function LF(e,t){if(e.tabUid===t.uid)return!0;if("tag"===e.tabType)for(var i=t.total,r=0;r<i;r++){var n;if(WI(n=e.uids).call(n,t.getChildByIndex(r).uid)>-1)return!0;}return!1;}var WF=function(){return Yk(function e(){Xk(this,e),Wk(this,"undoStack",[]),Wk(this,"redoStack",[]);},[{key:"execute",value:function value(e){e.execute(),this.undoStack.push(e),this.redoStack.length>0&&(this.redoStack.length=0);}},{key:"undo",value:function value(e){var t,i=PE(t=this.undoStack).call(t,function(t){return t.uid===e;});if(i>-1){var r,n=this.undoStack[i];mE(r=this.undoStack).call(r,i,1),n.undo(),this.redoStack.push(n);}}},{key:"redo",value:function value(e){var t,i=PE(t=this.redoStack).call(t,function(t){return t.uid===e;});if(i>-1){var r,n=this.redoStack[i];mE(r=this.redoStack).call(r,i,1),n.execute(),this.undoStack.push(n);}}},{key:"removeUidsFromCommand",value:function value(e){this.removeFromStack(this.undoStack,e),this.removeFromStack(this.redoStack,e);}},{key:"removeFromStack",value:function value(e,t){var i;$k(i=NI(e).call(e)).call(i,function(i){var r,n=i.action.uids;if(n&&($k(r=NI(n).call(n)).call(r,function(e){if(WI(t).call(t,e)>-1){var i=WI(n).call(n,e);mE(n).call(n,i,1);}}),!n.length)){var o=WI(e).call(e,i);mE(e).call(e,o,1);}});}},{key:"reset",value:function value(){this.undoStack=[],this.redoStack=[];}}]);}(),HF=function(){return Yk(function e(){Xk(this,e);},[{key:"init",value:function value(e){var t=e.dvsContext.hooksService.hooks,i=t.undo,r=t.redo,n=t.reset,o=t.afterUpdate,a=function a(t){var i,r=t.commandUid;t.trigger,$k(i=e.tabService.getAllTabs()).call(i,function(t){var i=t.commandController.undoStack.length,n=t.commandController.undoStack[i-1];(null==n?void 0:n.uid)===r&&(t.commandController.undo(r),e.tabService.isCurrentTab(t.uid)&&e.render());});},s=function s(t){var i,r=t.commandUid;t.trigger,$k(i=e.tabService.getAllTabs()).call(i,function(t){var i=t.commandController.redoStack.length,n=t.commandController.redoStack[i-1];(null==n?void 0:n.uid)===r&&(t.commandController.redo(r),e.tabService.isCurrentTab(t.uid)&&e.render());});},l=function l(t){var i,r=t.uids;$k(i=e.tabService.getAllTabs()).call(i,function(i){LF(t,i)&&(i.commandController.removeUidsFromCommand(r),e.tabService.isCurrentTab(i.uid)&&e.render());});};i.on(a),r.on(s),n.on(l),e.hooksService.hooks.destroy.on(function(){i.off(a),r.off(s),n.off(l);});var u=e.hooksService.hooks.removePagesFromDoc,c=function c(t,i){var r=e.tabService.getTab(t);r&&r.commandController.removeUidsFromCommand(i);},h=function h(t){var i;$k(i=e.tabService.getAllTabs()).call(i,function(e){e.commandController.removeUidsFromCommand([t.modifiedUid]);});};u.on(c),o.on(h),e.hooksService.hooks.destroy.on(function(){u.off(c),o.off(h);});}}]);}();function FF(e,t){var i,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=-1,o=-1,a=0,s=0,l={canvasOffsetX:-1,canvasOffsetY:-1,containerOffsetX:-1,containerOffsetY:-1},u=e.pageX,c=e.pageY,h=Ab(t.formatTouches(e,r),1)[0],d=t.getPointerOverPageInfo(h.pageX,h.pageY);if((i=d.index)>=0){var f;l.canvasOffsetX=Math.round(10*d.pageInfo.pagePositionX)/10,l.canvasOffsetY=Math.round(10*d.pageInfo.pagePositionY)/10,a=Math.round(10*d.pageInfo.pageWidth)/10,s=Math.round(10*d.pageInfo.pageHeight)/10;var v=t.rendererService,g=t.uiService.container;null!==(f=t.viewer)&&void 0!==f&&f.isThumbnail&&(g=t.viewer.thumbnailObject.viewer.context.uiService.container);var m=v.canvasDom,y=g.getBoundingClientRect(),p=y.left,w=y.top,b=m.getBoundingClientRect(),k=b.left,S=b.top;l.containerOffsetX=Math.round(10*(k-p+d.pageInfo.pagePositionX))/10,l.containerOffsetY=Math.round(10*(S-w+d.pageInfo.pagePositionY))/10;}if(d.imageInfo.isOver){n=d.imageInfo.pointerX,o=d.imageInfo.pointerY;var x=t.getCurrentTab();if(x){var C=x.getChildByIndex(i);if(C){var V=t.getStatus(C.uid);if(V&&"multiple"===t.config.displayMode&&t.config.useMinImage){var T=V.imageScale;n*=T,o*=T;}}}}return{index:i,imageX:n,imageY:o,pageX:u,pageY:c,pageWidth:a,pageHeight:s,position:l};}var jF=function(){return Yk(function e(){Xk(this,e);},[{key:"init",value:function value(e){var t,i,r,n,o=e.rendererService.canvasDom,a=0,s=0,l=0,u=0,c=!1,h=!1,d=null,f=!1,v=null,g=null,m=function m(){g&&(clearTimeout(g),g=null),v?g=YP(function(){e.externalResized();},50):v=YP(function(){e.externalResized(),v=null;},42);},y=function y(t){e.isFocus&&e.emit("keyup",t);},p=function p(t){e.isFocus&&e.emit("keydown",t);},w=function w(t){e.hooksService.hooks.focusChanged.emit("");},b=function b(t){var i=FF(t,e);e.emit("click",i,t),e.hooksService.hooks.focusChanged.emit(e.viewerUid),t.stopPropagation();},k=null,S=function S(i){if(0===i.button){var n=FF(i,e);e.emit("mousedown",n,i),h=!0;var o=i.pointerType;"mouse"===o?e.draggingPrepared=!0:"touch"!==o&&"pen"!==o||"multiple"!==e.config.displayMode||(k=YP(function(){e.draggingPrepared=!0;},300));var c=Ab(e.formatTouches(i),1)[0],d=CO()?i.metaKey:i.ctrlKey,f=e.getPointerOverPageInfo(c.pageX,c.pageY).pageInfo.obj,v=e.tabService.getCurrentTab();if(v){var g=e.config;if(f&&"multiple"===g.displayMode&&!d){var m=v.getChildIndex(f);if(i.shiftKey&&g.enableSelectWithShift||g.multiselectMode){if(i.shiftKey&&g.enableSelectWithShift&&(f!==v.currentPage||1!==v.selected.length)){var y=v.getIndexByUid(v.shiftReference);if(y>-1){var p,w=Math.min(m,y),b=Math.max(m,y)-w+1,S=[];e.isSelectedBorderWidthEqualHovered()||f.clearOptimization();for(var x=0;x<b;x++){var C,V=v.getChildByIndex(w+x);WI(C=v.selected).call(C,V.uid)<0&&V.uid!==f.uid&&!e.isSelectedBorderWidthEqualNormal()&&V.clearOptimization(),S.push(V.uid);}m<y&&Xz(S).call(S);var T={selectedUids:S,indexes:[],docUid:v.uid,trigger:e.viewerUid,groupUid:e.groupUid,operation:"shift",updateShiftReference:!1};$k(p=v.selected).call(p,function(t){if(WI(S).call(S,t)<0&&!e.isSelectedBorderWidthEqualNormal()){var i=v.getChildByUid(t);i&&i.clearOptimization();}}),e.hooksService.hooks.selectPage.emit(T);}}}else{var I=v.selected,E=WI(I).call(I,f.uid)>-1;if(v.currentPage!==f&&I.length<2||!E){var P,B={index:m,docUid:v.uid,trigger:e.viewerUid,groupUid:e.groupUid,operation:"shift"};$k(P=v.selected).call(P,function(t){var i=v.getChildByUid(t);i&&(e.isSelectedBorderWidthEqualNormal()||i.clearOptimization());}),e.isSelectedBorderWidthEqualHovered()||f.clearOptimization(),e.hooksService.hooks.changePage.emit(B);}}}if(f){var D;l=c.pageX,u=c.pageY;var M=f.getPosition();a=c.pageX-M.x,s=c.pageY-M.y,t=f,r=NI(D=v.children).call(D);}}}},x=function x(r){var o,v,g=FF(r,e);e.emit("mousemove",g,r),h&&!1===e.draggingPrepared&&k&&(clearTimeout(k),k=null);var m=Ab(e.formatTouches(r),1)[0],y=e.tabService.getCurrentTab();if(y){var p=e.config,w=e.getPointerOverPageInfo(m.pageX,m.pageY).pageInfo.obj,b=y.getChildIndex(d),S=!1,x=!1,C=!1,V=!1;if(w?d?d!==w&&(c||(d.isSelected||e.isBorderWidthEqualHovered()||d.clearOptimization(),w.isSelected||e.isBorderWidthEqualHovered()||w.clearOptimization()),C=!0,S=!0,d=w):(c||w.isSelected||e.isBorderWidthEqualHovered()||w.clearOptimization(),f||(V=!0),S=!0,d=w,f=!1):d&&(c||d.isSelected||e.isBorderWidthEqualHovered()||d.clearOptimization(),C=!0,x=!0,d=null),y&&"multiple"===p.displayMode)if(c){var T,I,E,P;if(w)if(!(WI(P=y.selected).call(P,w.uid)>-1)){var B,D,M,A,U,z=xz(B=QE(D=y.selected).call(D,function(e){return y.getIndexByUid(e);})).call(B,function(e,t){return e-t;}),R=z[0],N=y.getChildIndex(w),O=NI(M=y.children).call(M);$k(A=Xz(U=NI(z).call(z)).call(U)).call(A,function(e){mE(O).call(O,e,1);});var L=WI(O).call(O,w);N>R&&(L+=1),$k(n).call(n,function(e,t){var i=y.getChildByUid(e.uid);mE(O).call(O,L+t,0,i);}),i=QE(O).call(O,function(e){return y.getChildIndex(e);}),y.reorder(i),e.layoutService.layout(y);}$k(T=y.selected).call(T,function(e){var t=y.getChildByUid(e);t.borderBox.setPosition({x:m.pageX-a,y:m.pageY-s}),t.isDragging=!0,t.borderBox.updateStyle({visibility:"hidden"});}),null!==(I=t)&&void 0!==I&&I.updateStyle({zIndex:1}),null!==(E=t)&&void 0!==E&&E.borderBox.updateStyle({visibility:"visible"}),e.render();}else if(w&&w===t&&WI(o=y.selected).call(o,w.uid)>-1&&"crop"!==p.toolType&&e.draggingPrepared){var W,H;Math.pow(Math.pow(m.pageX-l,2)+Math.pow(m.pageY-u,2),.5)>=p.dragThreshold&&t&&p.enableDragPage&&(c=!0,n=xz(W=QE(H=y.selected).call(H,function(e){return{uid:e,index:y.getIndexByUid(e)};})).call(W,function(e,t){return e.index-t.index;}));}var F=!1;y&&r instanceof MouseEvent&&$k(v=y.children).call(v,function(e){w&&w.uid===e.uid?(e.isHovered||(F=!0),e.isHovered=!0):(e.isHovered&&(F=!0),e.isHovered=!1);}),F&&"multiple"===p.displayMode&&e.render(),V&&e.emit("mouseout",Fk(Fk({},g),{},{index:-1}),r,"canvas"),C&&e.emit("mouseout",Fk(Fk({},g),{},{index:b}),r,"page"),S&&e.emit("mouseover",Fk({},g),r,"page"),x&&e.emit("mouseover",Fk(Fk({},g),{},{index:-1}),r,"canvas");}},C=function C(t){if(0===t.button){var i=FF(t,e,!0);e.emit("mouseup",i,t);}},V=function V(o){if(0===o.button&&"annotation"!==e.config.toolType&&h){o instanceof MouseEvent?e.draggingPrepared=!1:o instanceof TouchEvent&&(k&&(clearTimeout(k),k=null),e.draggingPrepared=!1);var a=Ab(e.formatTouches(o,!0),1)[0],s=e.tabService.getCurrentTab();if(s){var l=CO()?o.metaKey:o.ctrlKey,u=e.getPointerOverPageInfo(a.pageX,a.pageY).pageInfo.obj;if(c){var d;if(i){var f,v=QE(f=s.children).call(f,function(e){return WI(r).call(r,e);});s.childNodes=r;var g={indexes:v,trigger:e.viewerUid,docUid:s.uid,type:s.type,operation:"shift"};e.hooksService.hooks.reorder.emit(g),i=null;}null==s||$k(d=s.selected).call(d,function(e){var t=s.getChildByUid(e);t.borderBox.setLocalPosition({x:0,y:0}),t.isDragging=!1,t.borderBox.updateStyle({visibility:"visible"});});var m=[];$k(n).call(n,function(e){var t=s.getIndexByUid(e.uid);m.push([e.index,t]);}),e.emit("dragdone",m);}else if(u&&t===u&&"multiple"===e.config.displayMode&&!o.shiftKey)if(l&&e.config.enableSelectWithCtrl||e.config.multiselectMode){var y,p=NI(y=s.selected).call(y),w=WI(p).call(p,u.uid),b=!1;if(w>-1?(l&&p.length>1||e.config.multiselectMode)&&(mE(p).call(p,w,1),b=!0):(p.push(u.uid),b=!0),b){var S={selectedUids:p,indexes:[],docUid:s.uid,trigger:e.viewerUid,groupUid:e.groupUid,operation:"shift"};e.isSelectedBorderWidthEqualHovered()||u.clearOptimization(),e.hooksService.hooks.selectPage.emit(S);}}else if((!l||!o.shiftKey)&&s.selected.length>1){var x,C={index:s.getChildIndex(u),docUid:s.uid,trigger:e.viewerUid,groupUid:e.groupUid,operation:"shift"};$k(x=s.selected).call(x,function(t){var i=s.getChildByUid(t);i&&(e.isSelectedBorderWidthEqualNormal()||i.clearOptimization());}),e.isSelectedBorderWidthEqualHovered()||u.clearOptimization(),e.hooksService.hooks.changePage.emit(C);}if(s&&"multiple"===e.config.displayMode){var V;if("visible"===e.config.removeBtnStyle.visibility){var T=e.getHitRemoveBtn(a.pageX,a.pageY);T>-1&&e.emit("removeBtnClick",T);}null!==(V=t)&&void 0!==V&&V.updateStyle({zIndex:0}),t=null,c=!1,e.render();}h=!1,t=null;}}},T=function T(t){f=!0;var i=FF(t,e);e.emit("mouseover",i,t);},I=function I(t){var i=e.tabService.getCurrentTab(),r=FF(t,e);if(i){var n;if(d){var o=i.getChildIndex(d);r.index=o;}d=null,e.emit("mouseout",r,t),i&&($k(n=i.children).call(n,function(e){e.isHovered=!1;}),"multiple"===e.config.displayMode&&e.rendererService.render());}},E=function E(t){var i=FF(t,e);e.emit("dblclick",i,t);},P=function P(t){var i=FF(t,e);e.emit("wheel",i,t);},B=function B(t){t.preventDefault();var i=FF(t,e);e.emit("contextmenu",i,t);},D=function D(e){},M=function M(e){e.preventDefault();},A=function A(t){t.preventDefault(),e.emit("drop",t);},U=function U(t){if(!e.isDestroyed){e.emit("scroll",t);var i=e.getCurrentTab();if(i){var r,n=t.target,o=n.scrollLeft,a=n.scrollTop;if(i.setPosition({x:-o,y:-a}),e.layoutService.layout(i),i.updateLayoutStatus({scrollLeft:o,scrollTop:a}),$k(r=i.children).call(r,function(t){!t.isPreload||t.isLoaded||t.imageContainer.imageData||("multiple"===e.config.displayMode&&e.config.useMinImage?e.dvsContext.minImageService.load(t.uid):e.dvsContext.imageService.load(t.uid));}),e.scrollerService.updateScroller({scrollLeft:o,scrollTop:a}),i&&i.isTopPageChanged&&!i.isLoadPage){var s=i.getIndexByUid(i.topPageUid);if(e.config.autoSelectTopPage){i.current=s,i.select([i.currentUid]);var l={selectedUids:[i.currentUid],indexes:[s],docUid:i.uid,trigger:e.viewerUid,groupUid:e.groupUid,operation:"shift",triggerByScroll:!0};e.getLocalHooks().selectPage.emit(l),e.layoutService.layout(i);}}i.isLoadPage&&(i.isLoadPage=!1),e.render();}}};window.addEventListener("resize",m),document.addEventListener("keydown",p),document.addEventListener("keyup",y),document.addEventListener("click",w),o.addEventListener("click",b),window.PointerEvent?(o.addEventListener("pointerdown",S),o.addEventListener("pointermove",x),o.addEventListener("pointerup",C),document.addEventListener("pointerup",V)):window.MSPointerEvent&&(o.addEventListener("MSPointerDown",S),o.addEventListener("MSPointerMove",x),o.addEventListener("MSPointerUp",C),document.addEventListener("MSPointerUp",V)),o.addEventListener("touchmove",function(e){e.cancelable&&e.preventDefault();},{passive:!1}),o.addEventListener("blur",function(){e.hooksService.hooks.focusChanged.emit("");}),o.addEventListener("focus",function(t){e.hooksService.hooks.focusChanged.emit(e.viewerUid);}),o.addEventListener("mouseover",T),o.addEventListener("mouseout",I),o.addEventListener("dblclick",E),o.addEventListener("wheel",P,{passive:!0}),o.addEventListener("contextmenu",B),o.addEventListener("dragstart",D),o.addEventListener("dragover",M),e.uiService.defaultDom.addEventListener("drop",A),e.uiService.hooks.scroll.on(U);var _z2=function z(){v&&clearTimeout(v),g&&clearTimeout(g),k&&clearTimeout(k),window.removeEventListener("resize",m),document.removeEventListener("keydown",p),document.removeEventListener("keyup",y),document.removeEventListener("click",w),o.removeEventListener("click",b),window.PointerEvent?(o.removeEventListener("pointerdown",S),o.removeEventListener("pointermove",x),o.removeEventListener("pointerup",C),document.removeEventListener("pointerup",V)):window.MSPointerEvent&&(o.removeEventListener("MSPointerDown",S),o.removeEventListener("MSPointerMove",x),o.removeEventListener("MSPointerUp",C),document.removeEventListener("MSPointerUp",V)),o.removeEventListener("pointerdown",S),o.removeEventListener("pointermove",x),o.removeEventListener("pointerup",C),document.removeEventListener("pointerup",V),o.removeEventListener("mouseover",T),o.removeEventListener("mouseout",I),o.removeEventListener("dblclick",E),o.removeEventListener("wheel",P),o.removeEventListener("contextmenu",B),o.removeEventListener("dragstart",D),o.removeEventListener("dragover",M),e.uiService.defaultDom.removeEventListener("drop",A),e.hooksService.hooks.destroy.off(_z2),e.uiService.hooks.scroll.off(U);};e.hooksService.hooks.destroy.on(_z2);}}]);}(),YF={visibility:"hidden",left:0,top:0,right:"",bottom:"",width:"24px",height:"24px",opacity:1,borderWidth:1,borderRadius:0,background:"#ffffff",borderColor:"#000000",checkMarkColor:"#000000",checkMarkLineWidth:"2px",translateX:0,translateY:0},XF=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_LN(YF);return Xk(this,t),Wk(Pw(e=IN(this,t,[{style:{visibility:"visible"===i.visibility?"visible":"hidden"}}])),"shapeType","checkbox"),Wk(Pw(e),"checkBoxStyle",void 0),Wk(Pw(e),"parsedCheckBoxStyle",void 0),Wk(Pw(e),"isChecked",!1),e.checkBoxStyle=Fk(Fk({},YF),i),e;}return Mb(t,e),Yk(t,[{key:"checked",get:function get(){return this.isChecked;},set:function set(e){this.isChecked=e;}},{key:"updateStyle",value:function value(e){this.checkBoxStyle=Fk(Fk({},this.checkBoxStyle),e),this.style.visibility=this.checkBoxStyle.visibility;}}]);}(zW),qF={visibility:"hidden",left:"",top:"",right:0,bottom:0,width:"24px",height:"24px",opacity:1,borderWidth:1,borderRadius:"50%",background:"#ffffff",borderColor:"#a79898",color:"#a79898",fontFamily:"sans-serif",fontSize:12,translateX:0,translateY:0},ZF=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_LN(qF),r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"0";return Xk(this,t),Wk(Pw(e=IN(this,t,[{style:{visibility:"visible"===i.visibility?"visible":"hidden"}}])),"shapeType","pageNumber"),Wk(Pw(e),"pageNumberStyle",void 0),Wk(Pw(e),"text",void 0),Wk(Pw(e),"parsedPageNumberStyle",void 0),e.text=r,e.pageNumberStyle=Fk(Fk({},qF),i),e;}return Mb(t,e),Yk(t,[{key:"updateText",value:function value(e){this.text=e;}},{key:"updateStyle",value:function value(e){this.pageNumberStyle=Fk(Fk({},this.pageNumberStyle),e),this.style.visibility="visible"===this.pageNumberStyle.visibility?"visible":"hidden";}}]);}(zW),_F={visibility:"hidden",left:"",top:0,right:0,bottom:"",width:"24px",height:"24px",borderWidth:1,borderRadius:0,background:"#ffffff",borderColor:"#000000",checkMarkColor:"#ff0000",checkMarkLineWidth:"2px",translateX:0,translateY:0},GF=function(e){function t(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_LN(_F);return Xk(this,t),Wk(e=IN(this,t,[i]),"shapeType","removeBtn"),e;}return Mb(t,e),Yk(t);}(XF),KF=function(e){function t(e){var i;Xk(this,t),Wk(Pw(i=IN(this,t,[e])),"uid",void 0),Wk(Pw(i),"isSelected",!1),Wk(Pw(i),"isPreload",!1),Wk(Pw(i),"isMouseover",!1),Wk(Pw(i),"isLoaded",!1),Wk(Pw(i),"blanks",void 0),Wk(Pw(i),"overlays",void 0),Wk(Pw(i),"image",void 0),Wk(Pw(i),"borderBox",void 0),Wk(Pw(i),"imageContainer",void 0),Wk(Pw(i),"checkbox",void 0),Wk(Pw(i),"pageNumber",void 0),Wk(Pw(i),"removeBtn",void 0),Wk(Pw(i),"isHovered",!1),Wk(Pw(i),"isDragging",!1),Wk(Pw(i),"viewportPosition",void 0),Wk(Pw(i),"isPageRendered",!1),Wk(Pw(i),"isEdited",!1),Wk(Pw(i),"isUpdated",!1),Wk(Pw(i),"isOptimized",!1),Wk(Pw(i),"optimizationUid",null),Wk(Pw(i),"optimizedUid",null),Wk(Pw(i),"realTimeWidth",void 0),Wk(Pw(i),"realTimeHeight",void 0),Wk(Pw(i),"zoom",1),Wk(Pw(i),"imageScale",1),i.uid=e.uid,i.realTimeWidth=e.realTimeWidth,i.realTimeHeight=e.realTimeHeight,i.updateStyle(e.style);var r=new iH({id:i.uid,style:{x:0,y:0}}),n=new eH({style:{x:0,y:0}});n.clippable=!0;var o=new eH({style:Fk(Fk({},e.style),e.formattedPageStyle)}),a=new XF(Fk({},e.checkboxStyle)),s=new ZF(Fk({},e.pageNumberStyle),"0"),l=new GF(Fk({},e.removeBtnStyle)),u=new eH(),c=new eH();return r.appendChild(u),i.appendChild(o),n.appendChild(r),n.appendChild(c),o.appendChild(n),o.appendChild(s),o.appendChild(a),o.appendChild(l),i.pageNumber=s,i.checkbox=a,i.removeBtn=l,i.image=r,i.borderBox=o,i.imageContainer=n,i.blanks=u,i.overlays=c,i.initEvent(),i;}return Mb(t,e),Yk(t,[{key:"initEvent",value:function value(){var e=this;this.addEventListener("mouseover",function(){e.isMouseover=!0;}),this.addEventListener("mouseout",function(){e.isMouseover=!1;}),this.addEventListener("mouseup",function(){e.isMouseover=!1;});}},{key:"getImage",value:function value(){return this.image;}},{key:"updateImage",value:function value(e){this.image.style.img=e;}},{key:"clearOptimization",value:function value(){var e;this.isOptimized=!1,null!=this&&null!==(e=this.imageContainer)&&void 0!==e&&e.imageData&&(this.imageContainer.imageData=null),this.optimizationUid=rO();}},{key:"destroy",value:function value(){this.clearOptimization(),this.image.style.img=null,this.image=null,this.imageContainer=null,this.overlays=null,this.blanks=null;}}]);}(eH),$F=function(){return Yk(function e(t,i,r,n){Xk(this,e),Wk(this,"id",void 0),Wk(this,"duration",void 0),Wk(this,"step",void 0),Wk(this,"verify",void 0),Wk(this,"complete",void 0),Wk(this,"active",!1),Wk(this,"effect",void 0),Wk(this,"fps",60),this.id=rO(),this.step=t,this.complete=i,this.duration=r,this.effect=n;},[{key:"play",value:function value(){var e=this,t=Qz(),i=t,r=0,_n3=function n(o){var a=Qz();if(e.active&&!e.verify(e.id)){var s=!0!==o;if(s)for(var l=Math.round((a-i)/(1e3/e.fps))-1,u=0;u<Math.min(l,4);u++)_n3(!0);e.duration&&(r=(a-t)/e.duration)>1&&(r=1);var c=e.effect(r);!1!==e.step(c,s)&&1!==r||!s?s&&(i=a,requestAnimationFrame(_n3)):(e.active=!1,e.complete(e.id,1===r||null===e.duration));}else e.complete(e.id,!1);};return this.active=!0,requestAnimationFrame(_n3),this.id;}},{key:"cancel",value:function value(){var e=!0===this.active;return e&&(this.active=!1),e;}},{key:"pause",value:function value(){}}]);}(),QF=function(e){function t(){var e;return Xk(this,t),Wk(Pw(e=IN(this,t)),"viewportWidth",void 0),Wk(Pw(e),"viewportHeight",void 0),Wk(Pw(e),"contentWidth",void 0),Wk(Pw(e),"contentHeight",void 0),Wk(Pw(e),"scrollingX",!0),Wk(Pw(e),"scrollingY",!0),Wk(Pw(e),"scrollLeft",0),Wk(Pw(e),"scrollTop",0),Wk(Pw(e),"maxScrollLeft",0),Wk(Pw(e),"maxScrollTop",0),Wk(Pw(e),"zoom",1),Wk(Pw(e),"minZoom",.01),Wk(Pw(e),"maxZoom",8),Wk(Pw(e),"zooming",!0),Wk(Pw(e),"locking",!1),Wk(Pw(e),"animating",!1),Wk(Pw(e),"animationDuration",300),Wk(Pw(e),"moveThreshold",5),Wk(Pw(e),"scrollThreshold",3),Wk(Pw(e),"moveSpeed",1),Wk(Pw(e),"decelerationVelocityThreshold",1),Wk(Pw(e),"startX",0),Wk(Pw(e),"startY",0),Wk(Pw(e),"startZoom",1),Wk(Pw(e),"lastX",0),Wk(Pw(e),"lastY",0),Wk(Pw(e),"lastScale",0),Wk(Pw(e),"lastTimeStamp",0),Wk(Pw(e),"futureLeft",0),Wk(Pw(e),"futureTop",0),Wk(Pw(e),"futureZoom",0),Wk(Pw(e),"isStart",!1),Wk(Pw(e),"isMoving",!1),Wk(Pw(e),"originLeft",0),Wk(Pw(e),"originTop",0),Wk(Pw(e),"decelerationVelocityX",0),Wk(Pw(e),"decelerationVelocityY",0),Wk(Pw(e),"enableScrollX",!0),Wk(Pw(e),"enableScrollY",!0),Wk(Pw(e),"interruptedAnimation",!1),Wk(Pw(e),"isDecelerating",!1),Wk(Pw(e),"decelerationId",void 0),Wk(Pw(e),"isAnimating",!1),Wk(Pw(e),"animationId",void 0),Wk(Pw(e),"isSingleTouch",!1),Wk(Pw(e),"isProcessing",!1),Wk(Pw(e),"isDecelerationComplete",!1),Wk(Pw(e),"isDragging",!1),Wk(Pw(e),"positions",[]),Wk(Pw(e),"hooks",{zoomComplete:HO.create(),scrollComplete:HO.create(),publish:HO.create(),beforeZoom:HO.create(),zoomTo:HO.create()}),Wk(Pw(e),"animations",{}),e.viewportWidth=800,e.viewportHeight=800,e;}return Mb(t,e),Yk(t,[{key:"updateScroller",value:function value(e){FU(this,e),this.calcMaxScroll();}},{key:"setOrigin",value:function value(e,t){this.originLeft=e,this.originTop=t;}},{key:"initScroller",value:function value(e){FU(this,e);}},{key:"zoomTo",value:function value(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(this.zooming){this.zoom;var n=this.minZoom,o=this.maxZoom;this.viewportWidth,this.viewportHeight;var a=this.scrollLeft,s=this.scrollTop;this.maxScrollLeft,this.maxScrollTop,HN(i)&&(i=this.originLeft),HN(r)&&(r=this.originTop),this.hooks.beforeZoom.emit(i,r),e=nO(e,n,o),this.publish(a,s,e,t);}}},{key:"zoomBy",value:function value(e,t,i,r){this.zoomTo(this.zoom*e,t,i,r);}},{key:"scrollTo",value:function value(e,t,i,r){this.enableScrollX&&(this.scrollLeft=e),this.enableScrollY&&(this.scrollTop=t);var n=this.scrollLeft,o=this.scrollTop;this.emit("_scrollChanged",{scrollLeft:n,scrollTop:o});}},{key:"scrollBy",value:function value(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.scrollTo(e+this.scrollLeft,t+this.scrollTop,i);}},{key:"canScroll",value:function value(){return this.contentWidth>this.viewportWidth||this.contentHeight>this.viewportHeight;}},{key:"onStartHandler",value:function value(e,t){if(this.canScroll()&&!this.isMoving){var i,r;this.isStart=!0,t instanceof Date&&(t=t.valueOf()),this.interruptedAnimation=!0,this.isDecelerating&&(this.cancelAnimate(this.decelerationId),this.isDecelerating=!0),this.isAnimating&&(this.cancelAnimate(this.animationId),this.isAnimating=!1);var n=1===e.length;n?(i=e[0].pageX,r=e[0].pageY):(i=Math.abs(e[0].pageX+e[1].pageX)/2,r=Math.abs(e[0].pageY+e[1].pageY)/2),this.startX=i,this.startY=r,this.startZoom=this.zoom,this.lastX=i,this.lastY=r,this.lastScale=1,this.lastTimeStamp=t,this.enableScrollX=this.scrollingX&&n,this.enableScrollY=this.scrollingY&&n,this.isProcessing=!0,this.isDecelerationComplete=!1,this.isDragging=!n,this.isSingleTouch=n,this.positions=[];}}},{key:"onMoveHandler",value:function value(e,t,i){if(this.canScroll()&&this.isStart){var r,n;t instanceof Date&&(t=t.valueOf());var o=1===e.length,a=this.positions;if(o?(r=e[0].pageX,n=e[0].pageY):(r=Math.abs(e[0].pageX+e[1].pageX)/2,n=Math.abs(e[0].pageY+e[1].pageY)/2),this.isDragging){var s=r-this.lastX,l=n-this.lastY,u=this.scrollLeft,c=this.scrollTop,h=this.zoom;if(!HN(i)&&this.zooming){var d=h;h=h/this.lastScale*i,d!==(h=nO(h,this.minZoom,this.maxZoom))&&(u=(r+u)/d*h-r,c=(n+c)/d*h-n,this.calcMaxScroll(h));}this.enableScrollX&&(u-=s*this.moveSpeed,u=nO(u,0,this.maxScrollLeft)),this.enableScrollY&&(c-=l*this.moveSpeed,c=nO(c,0,this.maxScrollTop)),a.length>60&&mE(a).call(a,0,30),a.push({scrollLeft:u,scrollTop:c,timeStamp:t}),this.publish(u,c,h);}else{var f=this.locking?this.scrollThreshold:0,v=this.moveThreshold,g=Math.abs(r-this.startX),m=Math.abs(n-this.startY);this.enableScrollX=this.scrollingX&&g>=f,this.enableScrollY=this.scrollingY&&m>=f,a.push({scrollLeft:this.scrollLeft,scrollTop:this.scrollTop,timeStamp:t}),this.isDragging=(this.enableScrollX||this.enableScrollY)&&(g>=v||m>=v),this.isDragging&&(this.interruptedAnimation=!1);}this.lastX=r,this.lastY=n,this.lastTimeStamp=t,this.lastScale=i;}}},{key:"onEndHandler",value:function value(e){if(this.canScroll()&&this.isStart&&this.isProcessing){if(e instanceof Date&&(e=e.valueOf()),this.isProcessing=!1,this.isDragging)if(this.isDragging=!1,this.isSingleTouch&&this.animating&&e-this.lastTimeStamp<100){for(var t=this.positions,i=this.decelerationVelocityThreshold,r=t.length-1,n=r,o=r;o>0&&t[o].timeStamp>this.lastTimeStamp-100;o--)n=o;if(n!==r){var a=t[r].timeStamp-t[n].timeStamp,s=this.scrollLeft-t[n].scrollLeft,l=this.scrollTop-this.positions[n].scrollTop;this.decelerationVelocityX=s/a*(1e3/60),this.decelerationVelocityX=l/a*(1e3/60),Math.abs(this.decelerationVelocityX)>i||Math.abs(this.decelerationVelocityY)>i?this.startDeceleration(e):this.hooks.scrollComplete.emit();}else this.hooks.scrollComplete.emit();}else e-this.lastTimeStamp>100&&this.hooks.scrollComplete.emit();this.isDecelerating||((this.interruptedAnimation||this.isDragging)&&this.hooks.scrollComplete.emit(),this.scrollTo(this.scrollLeft,this.scrollTop,!0,this.zoom)),this.isStart=!1,this.isMoving=!1,this.positions.length=0;}}},{key:"onZoomHandler",value:function value(e,t,i){this.zoomTo(this.zoom*e,!1,t,i);}},{key:"onWheelHandler",value:function value(e){if(!e.ctrlKey){var t=this.scrollLeft,i=this.scrollTop;e.shiftKey?t=this.scrollLeft+e.deltaY:i=this.scrollTop+e.deltaY,this.scrollTo(t,i);}}},{key:"publish",value:function value(e,t,i){var r=this,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=this.isAnimating;if(o&&(this.cancelAnimate(this.animationId),this.isAnimating=!1),n&&this.animating){this.futureLeft=e,this.futureTop=t,this.futureZoom=i;var a=this.scrollLeft,s=this.scrollTop,l=this.zoom;this.isAnimating=!0,this.animationId=this.animate(function(n,o){return o&&(r.scrollLeft=a+(e-a)*n,r.scrollTop=s+(t-s)*n,r.zoom=l+(i-l)*n,r.hooks.publish.emit(r.scrollLeft,r.scrollTop,r.zoom)),!0;},function(e,t){r.animationId===e&&(r.isAnimating=!1),(r.isDecelerationComplete||t)&&r.hooks.scrollComplete.emit(),r.zooming&&(r.calcMaxScroll(),r.hooks.zoomComplete.emit());},this.animationDuration,o?OO:NO);}else this.futureLeft=e,this.futureTop=t,this.futureZoom=i,this.scrollLeft=e,this.scrollTop=t,this.zoom=i,this.hooks.publish.emit(e,t,i),this.zooming&&(this.calcMaxScroll(),this.hooks.zoomComplete.emit());}},{key:"startDeceleration",value:function value(e){}},{key:"animate",value:function value(e,t,i,r){var n=new $F(e,t,i,r);return this.animations[n.id]=n,n.play(),n.id;}},{key:"cancelAnimate",value:function value(e){var t=this.animations[e];t&&(t.cancel(),delete this.animations[e]);}},{key:"calcMaxScroll",value:function value(e){e=e||this.zoom,this.maxScrollLeft=Math.max(0,this.contentWidth*e-this.viewportWidth),this.maxScrollTop=Math.max(0,this.contentHeight*e-this.viewportHeight);}}]);}(LO),JF=function(e){function t(){return Xk(this,t),IN(this,t,arguments);}return Mb(t,e),Yk(t,[{key:"render",value:function value(e,t){e.parsedCheckBoxStyle=ej(e,e.checkBoxStyle);var i=e.parsedCheckBoxStyle.opacity;t.save(),t.globalAlpha=i,this.renderBox(e,t,"out"),t.clip(),this.renderBox(e,t,"in"),hP(this).call(this,e,t),this.renderBox(e,t,"center"),this.stroke(e,t),this.renderCheckMark(e,t),t.restore();}},{key:"renderBox",value:function value(e,t,i){var r=e.parsedCheckBoxStyle,n=r.x,o=r.y,a=r.width,s=r.height,l=r.borderWidth,u=r.borderRadiusX,c=r.borderRadiusY,h=0;"center"===i?h=l/2:"in"===i&&(h=l);var d=[{x:n+u,y:o+c,start:Math.PI,end:3*Math.PI/2},{x:n+a-u,y:o+c,start:3*Math.PI/2,end:2*Math.PI},{x:n+a-u,y:o+s-c,start:0,end:Math.PI/2},{x:n+u,y:o+s-c,start:Math.PI/2,end:Math.PI}],f=Math.max(u-h,0),v=Math.max(c-h,0);if(t.beginPath(),t.ellipse)for(var g=0;g<4;g++){var m=d[g],y=m.x,p=m.y,w=m.start,b=m.end;t.ellipse(y,p,f,v,0,w,b);}else t.rect(n,o,a,s);t.closePath();}},{key:"fill",value:function value(e,t){var i=e.parsedCheckBoxStyle.background;if(KN()){var r=fW(i);t.fillStyle=r.formatted;}else t.fillStyle=i;hP(t).call(t);}},{key:"stroke",value:function value(e,t){var i=e.parsedCheckBoxStyle,r=i.borderColor,n=i.borderWidth;if(KN()){var o=fW(r);t.strokeStyle=o.formatted;}else t.strokeStyle=r;t.lineWidth=n,n>0&&t.stroke();}},{key:"renderCheckMark",value:function value(e,t){if(e.checked){var i=e.parsedCheckBoxStyle,r=i.x,n=i.y,o=i.width,a=i.height,s=i.borderWidth,l=i.checkMarkLineWidth,u=i.checkMarkColor,c=Math.max(Math.min(o-2*s,a-2*s),0),h=r,d=n;if(0!==c){if(o<a?(h+=s,d=d+s+(a-o)/2):(h=h+s+(o-a)/2,d+=s),t.lineWidth=l,KN()){var f=fW(u);t.strokeStyle=f.formatted;}else t.strokeStyle=u;t.beginPath(),t.moveTo(h+.15*c,d+.5*c),t.lineTo(h+.4*c,d+.8*c),t.lineTo(h+.85*c,d+.2*c),t.stroke();}}}}]);}(EH);function ej(e,t){var i,r,n,o=_LN(t),a=e.parentNode.width||100,s=e.parentNode.height||100;$k(i=["borderWidth","checkMarkLineWidth","opacity","fontSize"]).call(i,function(e){HN(o[e])||(o[e]=aW(o[e]).value||0);}),$k(r=["left","top","right","bottom","width","height"]).call(r,function(e){var t,i=-1!==WI(t=["left","right","width"]).call(t,e)?a:s,r=JW(o[e],i);o[e]=r;}),ZN(t.width)||null!==o.width||(ZN(o.left)&&ZN(o.right)?o.width=a-o.left-o.right:o.width=0),ZN(t.height)||null!==o.height||(ZN(o.bottom)&&ZN(o.top)?o.height=s-o.top-o.bottom:o.height=0),$k(n=["borderRadius","translateX","translateY"]).call(n,function(e){var t=o.width,i=o.height,r=Math.max,n=Math.min;if("borderRadius"===e){var a=JW(o[e],t),s=JW(o[e],i);o.borderRadiusX=r(0,n(a,t/2)),o.borderRadiusY=r(0,n(s,i/2));}"translateX"===e&&(o[e]=JW(o[e],t)),"translateY"===e&&(o[e]=JW(o[e],i));});var l=o.left,u=o.top,c=o.right,h=o.bottom,d=o.translateX,f=o.translateY,v=o.borderWidth,g=l,m=u;return 2*v>o.width&&(o.width=2*v),2*v>o.height&&(o.height=2*v),ZN(o.right)&&!ZN(o.left)&&(g=a-o.width-c),ZN(o.bottom)&&!ZN(o.top)&&(m=s-o.height-h),Fk({x:g+d,y:m+f},o);}var tj=function(e){function t(){return Xk(this,t),IN(this,t,arguments);}return Mb(t,e),Yk(t,[{key:"render",value:function value(e,t){e.parsedPageNumberStyle=ej(e,e.pageNumberStyle);var i=e.parsedPageNumberStyle.opacity;t.save(),t.globalAlpha=i,this.renderBox(e,t,"out"),t.clip(),this.renderBox(e,t,"in"),hP(this).call(this,e,t),this.renderBox(e,t,"center"),this.stroke(e,t),this.renderFont(e,t),t.restore();}},{key:"renderBox",value:function value(e,t,i){var r=e.parsedPageNumberStyle,n=r.x,o=r.y,a=r.width,s=r.height,l=r.borderWidth,u=r.borderRadiusX,c=r.borderRadiusY,h=0;"center"===i?h=l/2:"in"===i&&(h=l);var d=[{x:n+u,y:o+c,start:Math.PI,end:3*Math.PI/2},{x:n+a-u,y:o+c,start:3*Math.PI/2,end:2*Math.PI},{x:n+a-u,y:o+s-c,start:0,end:Math.PI/2},{x:n+u,y:o+s-c,start:Math.PI/2,end:Math.PI}],f=Math.max(u-h,0),v=Math.max(c-h,0);if(t.beginPath(),t.ellipse)for(var g=0;g<4;g++){var m=d[g],y=m.x,p=m.y,w=m.start,b=m.end;t.ellipse(y,p,f,v,0,w,b);}else t.rect(n,o,a,s);t.closePath();}},{key:"renderFont",value:function value(e,t){var i,r=e.parsedPageNumberStyle,n=r.x,o=r.y,a=r.width,s=r.height,l=r.fontSize,u=r.color,c=r.fontFamily;if(KN()){var h=fW(u);t.fillStyle=h.formatted;}else t.fillStyle=u;t.textAlign="center",t.textBaseline="middle",t.font=uS(i="".concat(l,"px ")).call(i,c),t.fillText(e.text,n+a/2,o+s/2+l/8,a);}},{key:"fill",value:function value(e,t){var i=e.parsedPageNumberStyle.background;if(KN()){var r=fW(i);t.fillStyle=r.formatted;}else t.fillStyle=i;hP(t).call(t);}},{key:"stroke",value:function value(e,t){var i=e.parsedPageNumberStyle,r=i.borderColor,n=i.borderWidth;if(KN()){var o=fW(r);t.strokeStyle=o.formatted;}else t.strokeStyle=r;t.lineWidth=n,n>0&&t.stroke();}}]);}(EH),ij=function(e){function t(){return Xk(this,t),IN(this,t,arguments);}return Mb(t,e),Yk(t,[{key:"renderCheckMark",value:function value(e,t){var i=e.parsedCheckBoxStyle,r=i.x,n=i.y,o=i.width,a=i.height,s=i.borderWidth,l=i.checkMarkLineWidth,u=i.checkMarkColor,c=Math.max(Math.min(o-2*s,a-2*s),0),h=r,d=n;0!==c&&(o<a?(h+=s,d=d+s+(a-o)/2):(h=h+s+(o-a)/2,d+=s),t.lineWidth=l,t.strokeStyle=u,t.beginPath(),t.moveTo(h+.3*c,d+.3*c),t.lineTo(h+.7*c,d+.7*c),t.moveTo(h+.3*c,d+.7*c),t.lineTo(h+.7*c,d+.3*c),t.stroke());}}]);}(JF),rj=function(){return Yk(function e(t){Xk(this,e),Wk(this,"isMarginFixed",!0),Wk(this,"isGapFixed",!0),Wk(this,"isBorderFixed",!0),Wk(this,"viewWidth",0),Wk(this,"viewHeight",0),Wk(this,"validVisualWidth",0),Wk(this,"validVisualHeight",0),Wk(this,"visualWidth",0),Wk(this,"visualHeight",0),Wk(this,"layoutWidth",0),Wk(this,"layoutHeight",0),Wk(this,"validLayoutWidth",0),Wk(this,"validLayoutHeight",0),Wk(this,"currentLayoutWidth",0),Wk(this,"currentLayoutHeight",0),Wk(this,"layoutLeft",0),Wk(this,"layoutTop",0),Wk(this,"calcWidth",0),Wk(this,"calcHeight",0),Wk(this,"calcViewWidth",0),Wk(this,"calcViewHeight",0),Wk(this,"fixedWidth",0),Wk(this,"fixedHeight",0),Wk(this,"defaultWidth",600),Wk(this,"defaultHeight",800),Wk(this,"rowHeightArray",[]),Wk(this,"columnWidthArray",[]),Wk(this,"scrollbarWidth",17),Wk(this,"zoom",1),Wk(this,"_scrollLeft",0),Wk(this,"scrollTop",0),Wk(this,"realRow",void 0),Wk(this,"realCol",void 0),Wk(this,"skipCalcZoom",!1),Wk(this,"isScrollbarAppeared",!1),Wk(this,"isScrollbarXAppeared",!1),Wk(this,"isScrollbarYAppeared",!1),Wk(this,"isScrollbarChanged",!1),Wk(this,"resized",!1),Wk(this,"placeholderPages",[]),FU(this,t);},[{key:"scrollLeft",get:function get(){return this._scrollLeft;},set:function set(e){this._scrollLeft=e;}},{key:"resetScrollbarStatus",value:function value(){this.isScrollbarAppeared=!1,this.isScrollbarChanged=!1,this.isScrollbarXAppeared=!1,this.isScrollbarYAppeared=!1;}},{key:"reset",value:function value(){this.validVisualWidth=0,this.validVisualHeight=0,this.visualWidth=0,this.visualHeight=0,this.layoutWidth=0,this.layoutHeight=0,this.validLayoutWidth=0,this.validLayoutHeight=0,this.currentLayoutWidth=0,this.currentLayoutHeight=0,this.layoutLeft=0,this.layoutTop=0,this.calcWidth=0,this.calcHeight=0,this.calcViewWidth=0,this.calcViewHeight=0,this.fixedWidth=0,this.fixedHeight=0;}}]);}(),nj=function(e){function t(e){var i;return Xk(this,t),Wk(Pw(i=IN(this,t,[e])),"uid",void 0),Wk(Pw(i),"tabName",void 0),Wk(Pw(i),"type",void 0),Wk(Pw(i),"doc",void 0),Wk(Pw(i),"viewer",void 0),Wk(Pw(i),"current",-1),Wk(Pw(i),"selected",[]),Wk(Pw(i),"fitType","window"),Wk(Pw(i),"displayMode","single"),Wk(Pw(i),"toolType","default"),Wk(Pw(i),"keepZoom",!1),Wk(Pw(i),"isDirty",!0),Wk(Pw(i),"layoutStatus",void 0),Wk(Pw(i),"stepPageIdStack",[]),Wk(Pw(i),"redoStack",[]),Wk(Pw(i),"isDestroyed",!1),Wk(Pw(i),"preloadCount",1),Wk(Pw(i),"row",3),Wk(Pw(i),"column",3),Wk(Pw(i),"direction","vertical"),Wk(Pw(i),"dpr",1),Wk(Pw(i),"gap",20),Wk(Pw(i),"margin",10),Wk(Pw(i),"borderWidth",0),Wk(Pw(i),"hoveredBorderWidth",0),Wk(Pw(i),"selectedBorderWidth",0),Wk(Pw(i),"enableDWT1x1",!1),Wk(Pw(i),"shiftReference",null),Wk(Pw(i),"commandController",void 0),Wk(Pw(i),"topPageUid",null),Wk(Pw(i),"isTopPageChanged",!1),Wk(Pw(i),"isLoadPage",!1),Wk(Pw(i),"visibleChildren",[]),FU(Pw(i),e),i.layoutStatus=new rj({viewWidth:e.viewWidth||0,viewHeight:e.viewHeight||0}),i.commandController=new WF(),i;}return Mb(t,e),Yk(t,[{key:"currentPage",get:function get(){return this.children[this.current];}},{key:"currentUid",get:function get(){var e;return null===(e=this.currentPage)||void 0===e?void 0:e.uid;}},{key:"children",get:function get(){return this.childNodes;}},{key:"total",get:function get(){return this.childNodes.length;}},{key:"setZoom",value:function value(e){var t;this.layoutStatus.zoom=e,$k(t=this.children).call(t,function(t){t.zoom=e;});}},{key:"destroy",value:function value(){EN(t,"destroy",this,3)([]),this.viewer=null,this.selected=null,this.isDestroyed=!0;}},{key:"updateShiftReference",value:function value(){this.shiftReference=this.currentUid;}},{key:"insertChild",value:function value(e,t){return this.appendChild(e,t),!0;}},{key:"removeChild",value:function value(e){var i=this.isChildExist(e),r=this.getChildIndex(e);return EN(t,"removeChild",this,3)([e]),i&&this.selected.length&&(0===this.total?(this.current=-1,this.selected=[]):((this.current===r&&r===this.total||r<this.current)&&(this.current-=1),this.selected=[this.currentUid])),e;}},{key:"removeChildByIndex",value:function value(e){if(e>=0||e<this.total)return!1;var t=this.children[e];return this.removeChild(t),!0;}},{key:"removeChildByUid",value:function value(e){var t=this.getChildByUid(e);return!!t&&(this.removeChild(t),!0);}},{key:"move",value:function value(e,t){var i=this.children,r=Ab(mE(i).call(i,e,1),1)[0];return!!r&&(mE(i).call(i,t,0,r),this.select([i[t].uid]));}},{key:"switch",value:function value(e,t){var i=this.children,r=this.current;return e!==t&&(this.swapChild(i[e],i[t]),r===e?this.select([i[t].uid]):r===t&&this.select([i[e].uid])),!0;}},{key:"swapChild",value:function value(e,t){if(!e.isEqualNode(t)){var i=this.getChildIndex(e),r=this.getChildIndex(t);this.children[i]=t,this.children[r]=e;}}},{key:"next",value:function value(){return 0===this.total?-1:(this.total-this.current>1&&(this.current+=1),this.selected=[this.children[this.current].uid],this.current);}},{key:"prev",value:function value(){return this.total<=0||this.current<0?-1:(this.current>0&&(this.current-=1),this.selected=[this.children[this.current].uid],this.current);}},{key:"first",value:function value(){return 0===this.total?-1:(this.current=0,this.selected=[this.children[0].uid],0);}},{key:"last",value:function value(){return 0===this.total?-1:(this.current=this.total-1,this.selected=[this.children[this.current].uid],this.current);}},{key:"goto",value:function value(e){var t,i=this;return 0===this.total?-1:(e!==this.current&&(e=nO(e,0,this.total-1),this.current=e),this.selected=[this.children[this.current].uid],$k(t=this.children).call(t,function(e){var t;e.isSelected=WI(t=i.selected).call(t,e.uid)>-1;}),this.current);}},{key:"select",value:function value(e){var t,i,r=e.length;if(0===r)return this.selected=e,this.current=-1,$k(t=this.children).call(t,function(e){e.isSelected=!1;}),!0;var n=this.getIndexByUid(e[r-1]);return!(n<0||($k(i=this.children).call(i,function(t){t.isSelected=WI(e).call(e,t.uid)>-1;}),this.selected=e,this.current=n,0));}},{key:"getSelected",value:function value(){var e;return NI(e=this.selected).call(e);}},{key:"getChildByIndex",value:function value(e){return this.children[e];}},{key:"getChildByUid",value:function value(e){var t;return CP(t=this.children).call(t,function(t){return t.uid===e;});}},{key:"getIndexByUid",value:function value(e){var t;return PE(t=this.children).call(t,function(t){return t.uid===e;});}},{key:"getUidByIndex",value:function value(e){var t;return null===(t=this.children[e])||void 0===t?void 0:t.uid;}},{key:"getChildIndex",value:function value(e){var t;return WI(t=this.children).call(t,e);}},{key:"getChildUids",value:function value(){var e;return QE(e=this.children).call(e,function(e){return e.uid;});}},{key:"reorder",value:function value(e){var t=this.children,i=e.length,r=[],n=!1;if(t.length!==i)return!1;for(var o=0;o<i;o++)e[o]===o||(n=!0);if(!n)return!0;for(var a=0;a<i;a++)r[a]=t[e[a]];for(var s=0;s<i;s++)t[s]=r[s];if(this.selected.length){var l=this.selected[this.selected.length-1],u=this.getIndexByUid(l);this.current=u;}return!0;}},{key:"updateLayoutStatus",value:function value(e){FU(this.layoutStatus,e);}}]);}(zW),oj=function(){return Yk(function e(t){var i=t.tabMode;Xk(this,e),Wk(this,"tabs",void 0),Wk(this,"mode",void 0),Wk(this,"currentTabUid",void 0),Wk(this,"isDestroyed",!1),Wk(this,"hooks",{removeTab:HO.create()}),Wk(this,"tabSelectionStack",void 0),this.tabs=[],this.mode=i,this.currentTabUid=null,this.tabSelectionStack=[];},[{key:"destroy",value:function value(){var e;$k(e=this.tabs).call(e,function(e){return e.destroy();}),this.tabs=null,this.tabSelectionStack=null,this.isDestroyed=!0;}},{key:"clear",value:function value(){this.tabs=[],this.currentTabUid=null,this.tabSelectionStack=[];}},{key:"createTab",value:function value(e,t){var i,r=this,n=CP(i=this.tabs).call(i,function(t){return e.uid===t.uid;});if(!n){var o,a,s=Fk({uid:e.uid,name:e.name,type:e.type},t);n=new nj(s),"single"===this.mode&&$k(o=NI(a=this.tabs).call(a)).call(o,function(e){r.closeTab(e.uid);}),this.tabs.push(n);}return n;}},{key:"find",value:function value(e){var t;return CP(t=this.tabs).call(t,function(t){return e===t.uid;});}},{key:"findIndex",value:function value(e){var t;return PE(t=this.tabs).call(t,function(t){return e===t.uid;});}},{key:"setCurrentTab",value:function value(e){var t,i;if(PE(this).call(this,e)<0)return!1;var r=WI(t=this.tabSelectionStack).call(t,e);return r>-1&&mE(i=this.tabSelectionStack).call(i,r,1),this.tabSelectionStack.push(e),this.currentTabUid=e,!0;}},{key:"closeTab",value:function value(e){if(!this.removeTab(e))return!1;var t=this.tabs,i=this.tabSelectionStack,r=WI(i).call(i,e);return mE(i).call(i,r,1),t.length?this.currentTabUid=i[i.length-1]:this.currentTabUid=null,!0;}},{key:"removeTab",value:function value(e){var t,i=PE(this).call(this,e);return i>-1&&(mE(t=this.tabs).call(t,i,1),this.hooks.removeTab.emit(e),!0);}},{key:"getCurTab",value:function value(){return CP(this).call(this,this.currentTabUid);}},{key:"getAllTabs",value:function value(){var e;return NI(e=this.tabs).call(e);}},{key:"setMode",value:function value(e){return("single"===e||"multiple"===e)&&(this.mode=e,!0);}}]);}(),aj=function(){return Yk(function e(){Xk(this,e),Wk(this,"lastTopPageIndex",-1);},[{key:"init",value:function value(e){var t=e.uiService,i=e.rendererService,r=t.canvasContainer,n=t.getViewportSize(),o=n.width,a=n.height;i.initCanvas({container:r,width:o,height:a}),i.registerShapeRenderer("checkbox",new JF()),i.registerShapeRenderer("pageNumber",new tj()),i.registerShapeRenderer("removeBtn",new ij()),this.listenHooks(e);}},{key:"listenHooks",value:function value(e){var t=this,i=e.rendererService.hooks;i.beforeRender.on(this.beforeRenderListener),i.afterRender.on(this.afterRenderListener),e.hooksService.hooks.destroy.on(function(){i.beforeRender.off(t.beforeRenderListener),i.afterRender.off(t.afterRenderListener);});}},{key:"beforeRenderListener",value:function value(e){var t=e.tabService,i=e.config,r=t.getCurrentTab();if(r){var n,o="multiple"===i.displayMode;$k(n=r.children).call(n,function(t,n){var a,s=i.pageNumberStyle.visibility,l=i.checkboxStyle.visibility,u=i.removeBtnStyle.visibility;o||(s="hidden",l="hidden",u="hidden"),t.pageNumber.updateText(String(n+1)),t.pageNumber.updateStyle({visibility:s}),t.checkbox.checked=WI(a=r.selected).call(a,t.uid)>-1,t.checkbox.updateStyle({visibility:l}),t.removeBtn.updateStyle({visibility:u});var c=r.selected,h=i.pageStyle;o&&(CP(c).call(c,function(e){return e===t.uid;})?h=i.selectedPageStyle:t.isHovered&&(h=i.hoveredPageStyle));var d=h,f=d.background,v=d.border,g={};v&&(g=BF(v));var m=g.borderWidth;if(i.enableSingleModeBorder||"single"!==i.displayMode&&"slide"!==i.displayMode||(m=0),t.borderBox.updateStyle(Fk(Fk({background:f},g),{},{borderWidth:m})),t.isDragging&&o){g={};var y=i.placeholderStyle,p=y.background,w=y.border;w&&(g=BF(w)),t.updateStyle(Fk({background:p},g));}else t.updateStyle({background:"#ffffff00",borderWidth:0});"slide"!==i.displayMode&&"single"!==i.displayMode&&"doc"!==i.displayMode||t.borderBox.updateStyle({background:"rgba(255,255,255,0)"}),!$N()&&!KN()&&!t.isOptimized&&t.isVisible&&t.isLoaded&&t.zoom<1&&new uB(function(e,t){YP(function(){e(null);},500);}).then(function(){e.optimizePage(t.uid);});});}}},{key:"afterRenderListener",value:function value(e){var t,i=e.tabService,r=e.config,n=e.rendererService,o=i.getCurrentTab();if(o&&(o.isTopPageChanged||-1!==n.lastTopPageIndex&&0===o.total)&&(o.isTopPageChanged=!1,"multiple"===r.displayMode)){var a=o.getIndexByUid(o.topPageUid);a!==n.lastTopPageIndex&&(e.emit("topPageChanged",a),n.lastTopPageIndex=a);}o&&$k(t=o.children).call(t,function(t,i){t.isPageRendered&&t.isVisible&&(t.isPageRendered=!1,t.isUpdated=!1,t.isEdited=!1,r.enableEmitPageRendered&&e.emit("pageRendered",i));});}}]);}(),sj=function(){return Yk(function e(){Xk(this,e);},[{key:"init",value:function value(e){this.listenNativeEvent(e),this.listenViewerHooks(e);}},{key:"listenViewerHooks",value:function value(e){var t=e.hooksService.hooks,i=function i(t){var i,r,n,o=t.tabNode,a=(null==o||null===(i=o.layoutStatus)||void 0===i?void 0:i.currentLayoutWidth)||0,s=(null==o||null===(r=o.layoutStatus)||void 0===r?void 0:r.currentLayoutHeight)||0;a=Math.max(Math.floor(a)-1,0),s=Math.max(Math.floor(s)-1,0),e.uiService.updateScrollContentSize(a,s),e.scrollerService.updateScroller({contentWidth:a,contentHeight:s}),"single"===e.config.displayMode&&(e.config.zoom=o.layoutStatus.zoom),0!==o.layoutStatus.viewWidth&&0!==o.layoutStatus.viewHeight&&$k(n=o.children).call(n,function(t){if(t.isPreload)t.isLoaded||t.imageContainer.imageData||("multiple"===e.config.displayMode&&e.config.useMinImage?e.dvsContext.minImageService.load(t.uid):e.dvsContext.imageService.load(t.uid));else{t.image.style.img=null,t.isLoaded=!1;var i=e.dvsContext.viewerService.isPageNeedLoad(t.uid);if(i.min&&"multiple"===e.config.displayMode&&e.config.useMinImage){var r=e.getStatus(t.uid);r&&(r.minImg=null);}if(i.ori&&"single"===e.config.displayMode){var n=e.getStatus(t.uid);n&&(n.img=null);}}});},r=function r(t){if(!t.isPassive&&e.config.autoScroll&&"single"!==e.config.displayMode&&"slide"!==e.config.displayMode){var i=e.getCurrentTab(),r=i.layoutStatus,n=r.viewWidth,o=r.viewHeight,a=r.rowHeightArray,s=r.columnWidthArray,l=r.placeholderPages,u=r.scrollLeft,c=r.scrollTop,h=r.realRow,d=r.realCol,f=i.currentPage,v=i.current,g=i.row,m=i.column,y=i.enableDWT1x1,p=f.getLocalPosition(),w=p.x,b=p.y,k=f.viewportPosition,S=u,x=c,C=!1,V=0,T=e.getMargin(),I=e.getGap(),E=1===m&&1===g&&y;if("multiple"===e.config.displayMode)"ahead"===k.x?(S=w-(V=0===k.column?T:E?0:I),C=!0):"behind"===k.x&&(V=k.column===d-1?T:E?0:I,S=w+s[0]-n+V,i.total<=i.row*i.column&&(S=i.getChildByIndex(0).getLocalPosition().x-T),C=!0),"ahead"===k.y?(x=b-(V=0===k.row?T:E?0:I),C=!0):"behind"===k.y&&(V=k.row===h-1?T:E?0:I,x=b+a[0]-o+V,i.total<=i.row*i.column&&(x=i.getChildByIndex(0).getLocalPosition().y-T),C=!0);else if("doc"===e.config.displayMode){var P=l[v];if("ahead"===k.x&&P.x<=i.gap?(C=!0,S=P.x-i.gap):"behind"===k.x&&P.x<=i.gap&&(C=!0,S=P.x+P.width-n+i.gap,P.width>n&&(S=P.x-i.gap)),i.getChildByIndex(i.total-1).getLocalPosition(),l[i.total-1].height,i.margin,"ahead"===k.y)C=!0,x=P.y-i.gap;else if("behind"===k.y){C=!0,x=P.y+P.height-o+i.gap;var B=i.layoutStatus;B.validLayoutHeight*B.zoom+B.fixedHeight<=o&&(x=0),P.height>o&&(x=P.y-i.gap);}}C&&(i.setPosition({x:-S,y:-x}),i.updateLayoutStatus({scrollLeft:S,scrollTop:x}),e.scrollerService.updateScroller({scrollLeft:S,scrollTop:x}),0===i.current?e.uiService.scrollTo(S+1,x+100):i.current===i.total-1&&e.uiService.scrollTo(S-100,x-100),e.uiService.scrollTo(S,x));}};e.layoutService.hooks.afterLayout.on(i),t.currentIndexChanged.on(r),e.hooksService.hooks.destroy.on(function(){e.layoutService.hooks.afterLayout.off(i),t.currentIndexChanged.off(r);});}},{key:"listenNativeEvent",value:function value(e){var t=e.rendererService.canvasDom,i=function i(t){e.scrollerService.mousedownListener(t);},r=function r(t){e.scrollerService.mousemoveListener(t);},n=function n(t){e.scrollerService.mouseupListener(t);},o=function o(t){e.scrollerService.mousedownListener(t);},a=function a(t){e.scrollerService.mousemoveListener(t);},s=function s(t){e.scrollerService.mouseupListener(t);},l=function l(t){var i=e.tabService.getCurrentTab();null==i||!i.total||0===i.selected.length&&"single"===e.config.displayMode||e.scrollerService.wheelListener(t);},u=function u(e){e.cancelable&&e.preventDefault();};t.addEventListener("wheel",l,{passive:!1}),t.addEventListener("touchstart",o,{passive:!1}),t.addEventListener("touchmove",u,{passive:!1}),document.addEventListener("touchmove",a,{passive:!1}),document.addEventListener("touchend",s),t.addEventListener("mousedown",i),document.addEventListener("mousemove",r),document.addEventListener("mouseup",n),e.hooksService.hooks.destroy.on(function(){t.removeEventListener("wheel",l),t.removeEventListener("touchstart",o),t.removeEventListener("touchmove",u),document.removeEventListener("touchmove",a),document.removeEventListener("touchend",s),t.removeEventListener("mousedown",i),document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",n);});}}]);}(),lj=function(){return Yk(function e(){Xk(this,e);},[{key:"init",value:function value(e){this.listenViewerHooks(e);}},{key:"listenTabHooks",value:function value(e){var t=function t(_t4){e.hooksService.hooks.removeTab.emit(_t4);},_i4=function i(){e.tabService.tabManager.hooks.removeTab.off(t),e.hooksService.hooks.destroy.off(_i4);};e.tabService.tabManager.hooks.removeTab.on(t),e.hooksService.hooks.destroy.on(_i4);}},{key:"listenViewerHooks",value:function value(e){var t=this,i={beforeStatus:null,afterStatus:null,operation:null,docUid:null},r=function r(_r3){var n=_r3.modifiedUid,o=_r3.docUid,a=_r3.removedUids,s=e.tabService.getTab(o);s&&e.tabService.isCurrentTab(o)&&(i.beforeStatus=t.createBufferStatus(s,n,a));},n=function n(r){var n=r.modifiedUid,o=r.docUid,a=r.operation,s=r.removedUids,l=e.tabService.getTab(o);if(l&&e.tabService.isCurrentTab(o)){var u,c;i.afterStatus=t.createBufferStatus(l,n,s),i.operation=a,i.docUid=o,i.curIndex=l.current||0,i.total=l.total||0;var h=e.viewer.getSelectedIndexes();e.emit("_imageSelectedUI",h),e.emit("imageSelected",h);var d=l.current,f=l.total;e.emit("_dvsPagerChanged",{current:d,total:f}),r.isSameDoc||e.emit("bufferChanged",Fk({},i));var v=null===(u=i.beforeStatus)||void 0===u?void 0:u.currentUid,g=null===(c=i.afterStatus)||void 0===c?void 0:c.currentUid;if("add"===a&&v!==g){var m=_LN(i);m.operation="shift",e.emit("bufferChanged",m);}}i={beforeStatus:null,afterStatus:null,operation:null,docUid:null,curIndex:0,total:0};},o=function o(t){e.tabService.openDoc(t);},a=e.hooksService.hooks;a.beforeBufferChanged.on(r),a.afterBufferChanged.on(n),a.openDoc.on(o);var _s2=function s(){a.beforeBufferChanged.off(r),a.afterBufferChanged.off(n),a.openDoc.off(o),e.hooksService.hooks.destroy.off(_s2);};e.hooksService.hooks.destroy.on(_s2);}},{key:"createBufferStatus",value:function value(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return{uids:e.getChildUids(),selectedUids:e.getSelected(),currentUid:e.currentUid,modifiedUid:t,removedUids:i};}}]);}();function uj(e,t){if(ON(t)){FU(e.config.viewerStyle,t);var i=e.uiService,r=i.scrollContainer,n=i.canvasContainer,o=e.getBorderWidth(e.config.viewerStyle);n&&r&&(FU(n.style,{left:"".concat(o,"px"),top:"".concat(o,"px")}),FU(r.style,t),e.resized());}}function cj(e,t){if(ON(t)){FU(e.config.canvasStyle,t);var i,r=e.rendererService.canvasDom;if(r)FU(r.style,t),WI(i=eS(t||{})).call(i,"border")>-1&&e.resized();}}function hj(e,t){if(ON(t)){var i;FU(e.config.pageStyle,t);var r=e.getBorderWidth(e.config.pageStyle);$k(i=e.getAllTabs()).call(i,function(e){e.borderWidth=r;}),e.clearCurTabOptimization(),e.render();}}function dj(e,t){if(ON(t)){var i;FU(e.config.selectedPageStyle,t);var r=e.getBorderWidth(e.config.selectedPageStyle);$k(i=e.getAllTabs()).call(i,function(e){e.selectedBorderWidth=r;}),e.clearCurTabOptimization(),e.render();}}function fj(e,t){if(ON(t)){var i;FU(e.config.hoveredPageStyle,t);var r=e.getBorderWidth(e.config.hoveredPageStyle);$k(i=e.getAllTabs()).call(i,function(e){e.hoveredBorderWidth=r;}),e.clearCurTabOptimization(),e.render();}}function vj(e,t){ON&&(FU(e.config.placeholderStyle,t),e.render());}function gj(e,t){var i;ON(t)&&(FU(e.config.pageNumberStyle,t),$k(i=e.getAllTabs()).call(i,function(t){var i;$k(i=t.children).call(i,function(t){t.pageNumber.updateStyle(e.config.pageNumberStyle);});}),e.rendererService.render());}function mj(e,t){var i;ON(t)&&(FU(e.config.checkboxStyle,t),$k(i=e.getAllTabs()).call(i,function(t){var i;$k(i=t.children).call(i,function(t){t.checkbox.updateStyle(e.config.checkboxStyle);});}),e.rendererService.render());}function yj(e,t){var i;ON(t)&&(FU(e.config.removeBtnStyle,t),$k(i=e.getAllTabs()).call(i,function(t){var i;$k(i=t.children).call(i,function(t){t.removeBtn.updateStyle(e.config.removeBtnStyle);});}),e.rendererService.render());}function pj(e,t){e.config.enableDragPage=t;}function wj(e,t){e.config.enableKeyboardControl=t;}function bj(e,t){e.config.multiselectMode=t;}function kj(e,t){e.config.zoomOrigin=t;}function Sj(e,t){t=nO(t,e.config.minZoom,e.config.maxZoom),e.zoomService.zoomTo(t),e.config.zoom=t;}function xj(e,t){e.config.minZoom=t;}function Cj(e,t){e.config.maxZoom=t;}function Vj(e,t){e.config.enableZoom=t;}function Tj(e,t){e.config.enableScrollX=t;}function Ij(e,t){e.config.enableScrollY=t;}function Ej(e,t){e.config.keepZoom=t;}function Pj(e,t){e.config.zoomInDelta=t;}function Bj(e,t){e.config.zoomOutDelta=t;}function Dj(e,t){e.config.wheelZoomDelta=t;}function Mj(e,t){e.config.scrollDirection=t;var i=e.getCurrentTab();i&&(i.direction=t,e.resized());}function Aj(e,t){var i,r=t!==e.config.displayMode;e.config.displayMode=t;var n=e.getCurrentTab();n&&(n.displayMode=t,$k(i=n.children).call(i,function(e){e.isLoaded=!1;}),e.showTab(n),r&&e.resetScrollbarStatus(),e.clearCurTabOptimization(),e.render(),"multiple"===t&&e.emitCurrentIndexChanged());}function Uj(e,t){e.config.toolType=t;var i=e.getCurrentTab();i&&(i.toolType=t,e.rendererService.render());}function zj(e,t){if(e.config.fitType!==t){e.config.fitType=t;var i=e.getCurrentTab();if(i){i.fitType=t,e.resetScrollbarStatus(),e.resetScrollerSize(),e.resize(),e.clearCurTabOptimization(),e.render();var r=e.uiService.scrollContainer,n=r.scrollWidth,o=r.scrollHeight,a=n-r.clientWidth,s=o-r.clientHeight,l=e.config.zoomOrigin,u=l.x,c=l.y,h=0,d=0;"center"===u?h=a/2:"right"===u&&(h=a),"center"===c?d=s/2:"bottom"===c&&(d=s),0===h&&0===d||e.uiService.scrollTo(h,d);}}}function Rj(e,t){if(e.config.show!==t){e.config.show=t;var i=e.uiService,r=i.rootDom,n=i.defaultDom;if(r&&(t?(r.style.display="flex",n.style.display="flex"):r.style.display="none"),e.resized(),t){var o=e.getCurrentTab();o&&(e.showTab(o),e.renderOnly());}}}function Nj(e,t){e.setViewMode(t,e.config.columns);}function Oj(e,t){e.setViewMode(e.config.rows,t);}function Lj(e,t){e.config.pure=!0;}function Wj(e,t){e.config.margin!==t&&(e.config.margin=t,e.clearCurTabOptimization(),e.render());}function Hj(e,t){e.config.gap!==t&&(e.config.gap=t,e.clearCurTabOptimization(),e.render());}function Fj(e,t){e.config.autoChangeIndex=t;}function jj(e,t){e.config.autoScroll=t;}function Yj(e,t){e.config.autoSelectLatest=t;}function Xj(e,t){e.config.enableSelectWithShift=t;}function qj(e,t){e.config.enableZoomWithCtrl=t;}function Zj(e,t){e.config.enableSelectWithCtrl=t;}function _j(e,t){"single"===t||"multiple"===t?(e.config.tabMode=t,e.tabService.tabManager.setMode(t),e.ok()):e.err(AN);}function Gj(e,t){e.config.enableSyncSelect=t;}function Kj(e,t){e.config.enableSingleModeBorder=t;}function $j(e,t){e.config.blankFillColor=t;}function Qj(e,t){e.config.dragThreshold=t;}function Jj(e,t){e.config.slideThreshold=t;}function eY(e,t){e.config.maxOptimizationSize=t;}function tY(e,t){e.config.enableSlide=t;}function iY(e,t){e.config.enableDWT1x1=t;}function rY(e,t){e.config.enableEmitPageRendered=t;}function nY(e,t){e.config.autoSelectTopPage=t;}function oY(e,t){e.config.enableOptimizeImage=t;}function aY(e,t){e.config.useMinImage=t;}var sY=function(){return Yk(function e(t){Xk(this,e),Wk(this,"context",void 0),Wk(this,"handlers",{}),this.context=t,this.initHandlers();},[{key:"destroy",value:function value(){this.context=null,this.handlers={};}},{key:"updateConfig",value:function value(e){for(var t=0,i=aB(e);t<i.length;t++){var r=Ab(i[t],2),n=r[0],o=r[1],a=this.handlers[n];a&&a(this.context,o);}}},{key:"registerHandler",value:function value(e,t){return!this.handlers[e]&&(this.handlers[e]=t,!0);}},{key:"initHandlers",value:function value(){var e={viewerStyle:uj,canvasStyle:cj,pageStyle:hj,selectedPageStyle:dj,hoveredPageStyle:fj,placeholderStyle:vj,pageNumberStyle:gj,checkboxStyle:mj,removeBtnStyle:yj,enableDragPage:pj,enableKeyboardControl:wj,multiselectMode:bj,zoomOrigin:kj,zoom:Sj,minZoom:xj,maxZoom:Cj,enableZoom:Vj,enableScrollX:Tj,enableScrollY:Ij,keepZoom:Ej,zoomInDelta:Pj,zoomOutDelta:Bj,wheelZoomDelta:Dj,scrollDirection:Mj,displayMode:Aj,toolType:Uj,fitType:zj,show:Rj,rows:Nj,columns:Oj,pure:Lj,margin:Wj,gap:Hj,autoChangeIndex:Fj,autoScroll:jj,autoSelectLatest:Yj,enableSelectWithShift:Xj,enableZoomWithCtrl:qj,enableSelectWithCtrl:Zj,tabMode:_j,enableSyncSelect:Gj,enableSingleModeBorder:Kj,blankFillColor:$j,dragThreshold:Qj,slideThreshold:Jj,maxOptimizationSize:eY,enableSlide:tY,enableDWT1x1:iY,enableEmitPageRendered:rY,enableOptimizeImage:oY,useMinImage:aY,autoSelectTopPage:nY};this.handlers=e;}}]);}(),lY=Yk(function e(t){Xk(this,e),Wk(this,"hooks",{init:HO.create(),destroy:HO.create(),beforeLayout:HO.create(),layout:HO.create(),afterLayout:HO.create(),beforeRender:HO.create(),render:HO.create(),afterRender:HO.create(),resize:HO.create(),externalResized:HO.create(),bindContainer:HO.create(),pageChanged:HO.create(),afterScroll:HO.create(),afterZoom:HO.create(),mousedown:HO.create(),mousemove:HO.create(),mouseup:HO.create(),mouseover:HO.create(),mouseout:HO.create(),click:HO.create(),dblclick:HO.create(),wheel:HO.create(),contextmenu:HO.create(),dragStart:HO.create(),loadImage:HO.create(),update:HO.create(),remove:HO.create(),move:HO.create(),switch:HO.create(),reorder:HO.create(),changePage:HO.create(),selectPage:HO.create(),beforeBufferChanged:HO.create(),afterBufferChanged:HO.create(),currentIndexChanged:HO.create(),scrollValueChanged:HO.create(),tabCleared:HO.create(),focusChanged:HO.create(),removePagesFromDoc:HO.create(),appendPagesToDoc:HO.create(),openDoc:HO.create(),removeTab:HO.create()}),Wk(this,"context",void 0),this.context=t;}),uY=function(){return Yk(function e(t){Xk(this,e),Wk(this,"hooks",{beforeLayout:HO.create(),layout:HO.create(),afterLayout:HO.create()}),Wk(this,"context",void 0),this.context=t;},[{key:"layout",value:function value(e){this.hooks.beforeLayout.emit({tabNode:e}),this.context.dvsContext.layoutService.layout(e),e.layoutStatus.isScrollbarChanged&&(e.layoutStatus.isScrollbarChanged=!1,this.hooks.afterLayout.emit({tabNode:e}),this.context.resize(),this.context.clearCurTabOptimization(),this.context.dvsContext.layoutService.layout(e)),this.hooks.afterLayout.emit({tabNode:e});}}]);}(),cY=function(){return Yk(function e(t){Xk(this,e),Wk(this,"canvasDom",void 0),Wk(this,"hooks",{beforeRender:HO.create(),render:HO.create(),afterRender:HO.create()}),Wk(this,"context",void 0),Wk(this,"canvas",void 0),Wk(this,"renderer",void 0),Wk(this,"isInitialized",!1),Wk(this,"lastTopPageIndex",-1),this.context=t;},[{key:"render",value:function value(){if("single"===this.context.config.displayMode){var e,t=null===(e=this.context)||void 0===e?void 0:e.getCurrentTab();if(t){var i=t.currentPage;if(i&&!i.isLoaded)return;}}this.hooks.beforeRender.emit(this.context),this.internalRender(),this.hooks.afterRender.emit(this.context);}},{key:"internalRender",value:function value(){var e,t,i=null===(e=this.context)||void 0===e?void 0:e.getCurrentTab(),r=this.canvas.document.documentElement;if(i)0===r.children.length?r.appendChild(i):WI(t=r.children).call(t,i)<0&&r.replaceChild(i,r.children[0]);else for(var n=r.childNodes.length-1;n>=0;n--)r.removeChild(r.childNodes[n]);this.canvas.render();}},{key:"initCanvas",value:function value(e){var t=e.container,i=e.width,r=e.height,n=new XH({}),o=new IH({renderer:n,container:t,width:i,height:r});this.renderer=n,this.canvas=o,this.canvasDom=o.contextService.getDomElement(),this.canvasDom.tabIndex=0,FU(this.canvasDom.style,this.context.config.canvasStyle),this.isInitialized=!0;}},{key:"registerShapeRenderer",value:function value(e,t){this.canvas.contextService.registerShapeRenderer(e,t);}},{key:"getCanvasPosition",value:function value(){var e=this.canvasDom.getBoundingClientRect(),t=RO(),i=t.scrollX,r=t.scrollY;return{x:e.left+i,y:e.top+r};}},{key:"resetCanvasSize",value:function value(){this.canvasDom.style.width="0px",this.canvasDom.style.height="0px";}}]);}(),hY=function(){return Yk(function e(t){var i=this;Xk(this,e),Wk(this,"context",void 0),Wk(this,"isStart",!1),Wk(this,"scroller",void 0),Wk(this,"startDistance",0),Wk(this,"startZoom",1),Wk(this,"lastScale",1),Wk(this,"originX",0),Wk(this,"originY",0),Wk(this,"startX",0),Wk(this,"startY",0),Wk(this,"isSliding",!1),Wk(this,"isZoom",!1),Wk(this,"slideDirection","left"),Wk(this,"slideDistance",0),Wk(this,"slideTimer",null),Wk(this,"wheelTimer",null),Wk(this,"touchZoomTimer",null),Wk(this,"startTime",0),Wk(this,"isScrolling",!1),Wk(this,"scrollTimer",null),Wk(this,"scrollDirectionX","left"),Wk(this,"scrollDirectionY","up"),Wk(this,"lineHeight",this.getLineHeight()),Wk(this,"startHandler",function(e,t){var r=i.context.config;"default"===r.toolType?(i.isStart=!0,e.length>1&&(i.startDistance=Math.pow(Math.pow(e[0].pageX-e[1].pageX,2)+Math.pow(e[0].pageY-e[1].pageY,2),.5)),i.scroller.onStartHandler(e,t)):"zoomIn"===r.toolType&&"multiple"!==r.displayMode?i.context.zoomService.zoomTo(r.zoom*r.zoomInDelta,e[0].pageX,e[0].pageY):"zoomOut"===r.toolType&&"multiple"!==r.displayMode&&i.context.zoomService.zoomTo(r.zoom/r.zoomOutDelta,e[0].pageX,e[0].pageY);}),this.context=t,this.scroller=new QF(),this.scroller.hooks.publish.on(function(e,i,r){t.uiService.scrollTo(e,i);});},[{key:"getLineHeight",value:function value(){var e=getComputedStyle(document.body),t=e.lineHeight,i=e.fontSize;if(/\d+/.test(t)){var r=Ab(t.match(/(\d+)/),1)[0];return $S(r,10);}if(/\d+/.test(i)){var n=Ab(i.match(/(\d+)/),1)[0];return 1.2*$S(n,10);}return 16;}},{key:"destroy",value:function value(){this.wheelTimer&&(clearTimeout(this.wheelTimer),this.wheelTimer=null),this.touchZoomTimer&&(clearTimeout(this.touchZoomTimer),this.touchZoomTimer=null),this.scrollTimer&&(mL.clearTimer(this.scrollTimer),this.scrollTimer=null),this.slideTimer&&(mL.clearTimer(this.slideTimer),this.slideTimer=null);}},{key:"updateScroller",value:function value(e){this.scroller.updateScroller(e);}},{key:"mousedownListener",value:function value(e){var t;if(!(e instanceof MouseEvent&&"multiple"===this.context.config.displayMode||this.isSliding)){var i=null===(t=this.context)||void 0===t?void 0:t.getCurrentTab();if(i&&i.total){var r=this.context.formatTouches(e);this.startX=r[0].pageX,this.startY=r[0].pageY,this.lastScale=1,this.startTime=new Date().getTime(),this.isScrolling=!1,this.scrollTimer&&(mL.clearTimer(this.scrollTimer),this.scrollTimer=null),this.startZoom=this.context.config.zoom,this.startHandler(r,e.timeStamp);}}}},{key:"mousemoveListener",value:function value(e){var t,i=this;if(this.isStart){var r=this.context.formatTouches(e);if(window.TouchEvent&&e instanceof TouchEvent){if(this.context.draggingPrepared)return void(e.cancelable&&e.preventDefault());if(r.length>1&&this.context.config.enableZoom&&"single"===this.context.config.displayMode){var n=(r[0].pageX+r[1].pageX)/2,o=(r[0].pageY+r[1].pageY)/2,a=Math.pow(Math.pow(r[0].pageX-r[1].pageX,2)+Math.pow(r[0].pageY-r[1].pageY,2),.5)/this.startDistance;e.scale&&(a=e.scale);var s=this.context.config.zoom,l=s;return(s=this.startZoom*a)!==l&&(this.touchZoomTimer||(this.touchZoomTimer=YP(function(){i.context.zoomService.zoomTo(s,n,o),clearTimeout(i.touchZoomTimer),i.touchZoomTimer=null;},25))),this.lastScale=a,void(this.isZoom=!0);}}var u=null===(t=this.context)||void 0===t?void 0:t.getCurrentTab(),c=r[0].pageX-this.startX;if(u&&u.total){if(c>0?this.slideDirection="right":c<0&&(this.slideDirection="left"),this.slideDistance=Math.min(u.layoutStatus.viewWidth,Math.abs(c)),this.isSliding)return"right"===this.slideDirection?u.setPosition({x:this.slideDistance,y:0,z:0}):"left"===this.slideDirection&&u.setPosition({x:-this.slideDistance,y:0,z:0}),void this.context.renderOnly();"single"===this.context.config.displayMode&&"default"===this.context.config.toolType&&this.context.config.enableSlide&&Math.abs(c)>this.context.config.slideThreshold&&!this.context.uiService.isScrollbarAppeared()&&(this.isSliding=!0,this.context.updateViewerConfig({displayMode:"slide"}));}this.scroller.onMoveHandler(r,e.timeStamp);}}},{key:"slide",value:function value(e){var t,i=this,r=0,n=0,o=0,a=!1;this.slideDistance>=this.context.config.slideThreshold?(t=(n=e.layoutStatus.viewWidth)-this.slideDistance,"left"===this.slideDirection?e.current!==e.total-1?(o=-this.slideDistance,r=-t/8):(n=0,t=this.slideDistance,a=!0,o=-this.slideDistance,r=t/8):0!==e.current?(o=this.slideDistance,r=t/8):(n=0,t=this.slideDistance,a=!0,o=this.slideDistance,r=-t/8)):(a=!0,n=0,t=this.slideDistance,"left"===this.slideDirection?(o=-this.slideDistance,r=t/8):(o=this.slideDistance,r=-t/8)),this.slideTimer=mL.createTimer(function(){var t=(o+=r)>=0;if(Math.abs(o)>=n&&(o=n,t||(o*=-1)),e.setPosition({x:o,y:0,z:0}),Math.abs(o)===n)return a||("right"===i.slideDirection?i.context.viewer.prevPage():i.context.viewer.nextPage(),i.context.updateViewerConfig({fitType:"window"})),i.isSliding=!1,i.context.updateViewerConfig({displayMode:"single"}),void mL.clearTimer(i.slideTimer);i.context.renderOnly();},25);}},{key:"mouseupListener",value:function value(e){if(this.isStart){var t=this.context.formatTouches(e,!0),i=this.context.config.displayMode;if(this.isZoom||"slide"!==i){this.scroller.onEndHandler(e.timeStamp);var r=this.context.uiService.getMaxScrollValue(),n=r.maxScrollLeft,o=r.maxScrollTop,a=this.context.uiService.scrollContainer,s=a.scrollLeft,l=a.scrollTop;if(!this.isZoom&&!this.isSliding&&!this.isScrolling&&!this.context.draggingPrepared&&(n>0||o>0)&&window.TouchEvent&&e instanceof TouchEvent&&"default"===this.context.config.toolType){var u=new Date().getTime(),c=t[0].pageX,h=t[0].pageY,d=c-this.startX,f=h-this.startY,v=!1,g=!1;d>0?(v=0!==s,this.scrollDirectionX="right"):(v=s!==n,this.scrollDirectionX="left"),f>0?(g=0!==l,this.scrollDirectionY="down"):(g=l!==o,this.scrollDirectionY="up");var m=u-this.startTime;if((Math.abs(d)>10||Math.abs(f)>10)&&m>0&&m<300&&(v||g)){var y=Math.abs(d)/m,p=Math.abs(f)/m;(y>.4||p>.4)&&(y=Math.min(y,2.8),p=Math.min(p,2.8),this.scroll(y,p,-.05));}}}else{var w,b=null===(w=this.context)||void 0===w?void 0:w.getCurrentTab();b&&this.slide(b);}this.isStart=!1,this.lastScale=1,this.isZoom=!1;}}},{key:"scroll",value:function value(e,t,i){var r=this;this.isScrolling=!0;var n=this.context.uiService.scrollContainer,o=n.scrollLeft,a=n.scrollTop,s=0,l=0;this.scrollTimer=mL.createTimer(function(){var n=r.context.uiService.getMaxScrollValue(),u=n.maxScrollLeft,c=n.maxScrollTop;if(e<=0&&t<=0||!1===r.isScrolling)return mL.clearTimer(r.scrollTimer),r.scrollTimer=null,void(r.isScrolling=!1);e>=0&&("right"===r.scrollDirectionX?s-=40*e:s+=40*e,e+=i),t>=0&&("down"===r.scrollDirectionY?l-=40*t:l+=40*t,t+=i);var h=nO(o+s,0,u),d=nO(a+l,0,c);r.context.uiService.scrollTo(h,d);},25);}},{key:"wheelListener",value:function value(e){var t=this,i=this.context.config,r=e.wheelDelta;if(e.deltaY&&(r=-e.deltaY),1===e.deltaMode&&(r*=this.lineHeight),2===e.deltaMode&&(r=r<0?-100:100),e.ctrlKey&&i.enableZoomWithCtrl){if("multiple"!==i.displayMode){e.cancelable&&e.preventDefault();var n=r>0?i.wheelZoomDelta:1/i.wheelZoomDelta,o=this.context.rendererService.getCanvasPosition(),a=o.x,s=o.y;this.wheelTimer||(this.wheelTimer=YP(function(){t.context.zoomService.zoomTo(i.zoom*n,e.pageX-a,e.pageY-s),clearTimeout(t.wheelTimer),t.wheelTimer=null;},40));}}else e.shiftKey?(e.cancelable&&e.preventDefault(),this.context.uiService.scrollBy(-r,0)):(e.cancelable&&e.preventDefault(),this.context.uiService.scrollBy(0,-r));}}]);}(),dY=function(){return Yk(function e(t){var i=this;Xk(this,e),Wk(this,"context",void 0),Wk(this,"tabManager",void 0),Wk(this,"appendPageTimer",null),Wk(this,"selectPage",function(e){var t=i.context,r=t.groupUid,n=t.hooksService,o=t.viewerUid;if(e.groupUid===r){var a=i.getTab(e.docUid);if(a){i.isCurrentTab(a.uid)&&n.hooks.beforeBufferChanged.emit(e);var s=!e.triggerByScroll||e.triggerByScroll&&e.trigger!==o;s&&(a.select(e.selectedUids),!1!==e.updateShiftReference&&a.updateShiftReference()),i.isCurrentTab(a.uid)&&(s&&!1!==e.updateShiftReference&&i.context.emitCurrentIndexChanged(),n.hooks.afterBufferChanged.emit(e),s&&(i.context.showTab(a),i.context.handleOrigin(),i.context.renderOnly()));}}}),this.context=t,this.tabManager=new oj({tabMode:this.context.config.tabMode});},[{key:"destroy",value:function value(){this.appendPageTimer&&(clearTimeout(this.appendPageTimer),this.appendPageTimer=null);}},{key:"createTab",value:function value(e){var t,i,r=this,n=this.context.config,o=n.displayMode,a=n.toolType,s=n.scrollDirection,l=n.fitType,u=n.rows,c=n.columns,h=n.enableDWT1x1,d=n.pageStyle,f=n.selectedPageStyle,v=n.hoveredPageStyle,g=n.zoom,m=this.context.getBorderWidth(d),y=this.context.getBorderWidth(f),p=this.context.getBorderWidth(v),w=this.context.uiService.getViewportSize(),b={doc:e,displayMode:o,toolType:a,fitType:l,direction:s,viewWidth:w.width||800,viewHeight:w.height||800,dpr:1,scrollbarWidth:17,row:u,column:c,borderWidth:m,selectedBorderWidth:y,hoveredBorderWidth:p,enableDWT1x1:h,viewer:this.context.viewer},k=CP(t=this.tabManager).call(t,e.uid);return k||((k=this.tabManager.createTab(e,b)).layoutStatus.zoom=g,$k(i=e.children).call(i,function(e){var t=r.createPage(e);t&&k.appendChild(t);})),k;}},{key:"getCurrentTab",value:function value(){return this.tabManager.getCurTab();}},{key:"getAllTabs",value:function value(){return this.tabManager.getAllTabs();}},{key:"isCurrentTab",value:function value(e){return this.tabManager.currentTabUid===e;}},{key:"updateTab",value:function value(e){var t,i=this,r=e.modifiedUid,n=e.data,o=this.context,a=o.viewerUid,s=o.groupUid,l=o.hooksService;$k(t=this.tabManager.getAllTabs()).call(t,function(e){var t=e.getChildByUid(r);if(t){var o,u,c,h,d,f={docUid:e.uid,trigger:a,groupUid:s,operation:"modify",modifiedUid:r};i.isCurrentTab(e.uid)&&l.hooks.beforeBufferChanged.emit(f);var v=e.current,g=NI(o=e.selected).call(o);t.isPreload=!1,t.isLoaded=!1,t.isUpdated=!0,t.image.style.img=null,t.clearOptimization(),$k(u=NI(c=t.blanks.childNodes).call(c)).call(u,function(e){t.blanks.removeChild(e);}),void 0!==(null===(h=n.metadata)||void 0===h?void 0:h.width)&&(t.realTimeWidth=n.metadata.width),void 0!==(null===(d=n.metadata)||void 0===d?void 0:d.height)&&(t.realTimeHeight=n.metadata.height),e.current=v,e.selected=g,i.isCurrentTab(e.uid)&&(i.context.showTab(e),l.hooks.afterBufferChanged.emit(f));}});}},{key:"movePage",value:function value(e){var t=this.getTab(e.docUid);if(t){var i=this.context.hooksService;this.isCurrentTab(t.uid)&&i.hooks.beforeBufferChanged.emit(e),t.move(e.from,e.to),this.isCurrentTab(t.uid)&&(this.context.emitCurrentIndexChanged(),i.hooks.afterBufferChanged.emit(e),this.context.showTab(t),this.context.renderOnly());}}},{key:"switchPage",value:function value(e){var t=this.getTab(e.docUid);if(t){var i=this.context.hooksService;this.isCurrentTab(t.uid)&&i.hooks.beforeBufferChanged.emit(e),t.switch(e.one,e.other),this.isCurrentTab(t.uid)&&(this.context.emitCurrentIndexChanged(),i.hooks.afterBufferChanged.emit(e),this.context.showTab(t),this.context.renderOnly());}}},{key:"reorderPages",value:function value(e){var t,i=CP(t=this.tabManager).call(t,e.docUid);if(i){var r=this.context.hooksService;this.isCurrentTab(i.uid)&&r.hooks.beforeBufferChanged.emit(e),i.reorder(e.indexes),this.isCurrentTab(i.uid)&&(r.hooks.afterBufferChanged.emit(e),this.context.showTab(i),this.context.emitCurrentIndexChanged());}}},{key:"changePage",value:function value(e){var t=this.context,i=t.groupUid,r=t.hooksService;if(e.groupUid===i){var n,o=CP(n=this.tabManager).call(n,e.docUid);o&&(o.current!==e.index||o.selected.length>1)&&(this.isCurrentTab(o.uid)&&r.hooks.beforeBufferChanged.emit(e),o.goto(e.index),o.updateShiftReference(),this.isCurrentTab(o.uid)&&(this.context.emitCurrentIndexChanged(),r.hooks.afterBufferChanged.emit(e),this.context.showTab(o),this.context.handleOrigin(),this.context.renderOnly()));}}},{key:"removePagesFromDoc",value:function value(e,t){var i=this.getTab(e);if(i){var r=this.context.hooksService,n={removedUids:t,docUid:i.uid,operation:"remove"};this.isCurrentTab(i.uid)&&r.hooks.beforeBufferChanged.emit(n),$k(t).call(t,function(e){var t=i.getChildByUid(e);t&&t.destroy(),i.removeChildByUid(e);}),i.updateShiftReference(),i.total||(i.topPageUid=null),this.isCurrentTab(i.uid)&&(r.hooks.afterBufferChanged.emit(n),this.context.showTab(i),this.context.handleOrigin(),this.context.renderOnly());}}},{key:"appendPagesToDoc",value:function value(e,t){var i=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=this.getTab(e);if(o){var a=this.context,s=a.viewerUid,l=a.groupUid,u=a.hooksService,c=a.config,h={docUid:e,trigger:s,groupUid:l,operation:"add",isSameDoc:n};this.isCurrentTab(o.uid)&&u.hooks.beforeBufferChanged.emit(h);var d=r>-1;if($k(t).call(t,function(e,t){var n=i.createPage(e);n&&(n.clearOptimization(),d?o.insertChild(n,r+t):o.appendChild(n));}),c.autoSelectLatest){o.currentPage&&o.currentPage.clearOptimization(),o.current=d?r+t.length-1:o.total-1;var f=o.currentPage;f&&o.select([f.uid]);}else o.total>0&&-1===o.current&&(o.current=0,o.select([o.getChildByIndex(0).uid]));o.updateShiftReference(),this.isCurrentTab(o.uid)&&(u.hooks.afterBufferChanged.emit(h),this.appendPageTimer||(this.appendPageTimer=YP(function(){o.isLoadPage=!0,i.getCurrentTab()===o&&(i.context.showTab(o),c.autoSelectLatest&&"single"!==c.displayMode&&"slide"!==c.displayMode&&i.context.config.show?i.context.emitCurrentIndexChanged():i.context.renderOnly()),clearTimeout(i.appendPageTimer),i.appendPageTimer=null;},42)));}}},{key:"openDoc",value:function value(e){var t=this.context,i=t.config,r=t.hooksService,n=t.viewerUid,o=t.groupUid,a=this.getTab(e.uid);a||(a=this.createTab(e)).total>0&&(i.autoSelectLatest?a.current=a.total-1:a.current=0,a.select([a.getChildByIndex(a.current).uid])),this.context.showTab(a);var s={docUid:e.uid,trigger:n,groupUid:o,operation:"filter"};r.hooks.beforeBufferChanged.emit(s),r.hooks.afterBufferChanged.emit(s),i.autoSelectLatest&&"single"!==i.displayMode&&"slide"!==i.displayMode&&this.context.config.show?this.context.emitCurrentIndexChanged():this.context.renderOnly();}},{key:"renameDoc",value:function value(e,t){var i=this.getTab(t);i&&(i.name=e);}},{key:"removeDoc",value:function value(e){return!!jN(e)&&!!this.tabManager.closeTab(e)&&(0===this.getAllTabs().length&&this.context.tabCleared(),this.context.render(),!0);}},{key:"getTab",value:function value(e){var t;return CP(t=this.tabManager).call(t,e);}},{key:"createPage",value:function value(e){var t=this.context.config,i=t.pageStyle,r=t.checkboxStyle,n=t.pageNumberStyle,o=t.removeBtnStyle,a=t.blankFillColor,s=t.defaultWidth,l=t.defaultHeight,u=this.getFormattedStyle(i),c=this.context.getStatus(e);if(!c)return null;var h=c.realTimeWidth,d=c.realTimeHeight;return new KF({uid:e,style:{visibility:"hidden",pointerEvents:"auto",width:h||s,height:d||l},formattedPageStyle:u,checkboxStyle:r,pageNumberStyle:n,removeBtnStyle:o,realTimeWidth:h,realTimeHeight:d,blankFillColor:a||"rgba(0,0,0,0)"});}},{key:"getFormattedStyle",value:function value(e){var t=e.border,i=e.background,r={};return t&&(r=BF(t)),Fk({background:i},r);}},{key:"setViewportSize",value:function value(e,t){var i=this.tabManager.getCurTab();i&&i.updateLayoutStatus({viewWidth:e,viewHeight:t});}}]);}(),fY=function(){return Yk(function e(t){Xk(this,e),Wk(this,"container",void 0),Wk(this,"scrollContent",void 0),Wk(this,"scrollContainer",void 0),Wk(this,"canvasAndScrollContainer",void 0),Wk(this,"canvasContainer",void 0),Wk(this,"defaultDom",void 0),Wk(this,"rootDom",void 0),Wk(this,"hooks",{scroll:HO.create()}),Wk(this,"isBindContainer",!1),Wk(this,"viewerWidth",void 0),Wk(this,"viewerHeight",void 0),Wk(this,"context",void 0),Wk(this,"dpr",UO()),this.context=t;},[{key:"initDefaultUI",value:function value(){var e=this,t=this.context,i=t.postfix,r=t.config,n=this.createDefaultUI(),o=n.querySelector("#dvs-canvas-container".concat(i)),a=n.querySelector("#dvs-scroller-and-canvas".concat(i)),s=n.querySelector("#dvs-scroll-container".concat(i)),l=n.querySelector("#dvs-scroll-content".concat(i));if(this.canvasAndScrollContainer=a,this.scrollContainer=s,this.scrollContent=l,this.canvasContainer=o,this.defaultDom=n,o&&s){var u=this.context.getBorderWidth(r.viewerStyle);FU(o.style,{left:"".concat(u,"px"),top:"".concat(u,"px")}),FU(s.style,r.viewerStyle);}this.scrollContainer.addEventListener("scroll",function(t){e.hooks.scroll.emit(t);});}},{key:"createDefaultUI",value:function value(){var e=this.context,t=e.postfix;return e.config.pure?vY(zF,t):vY(UF,t);}},{key:"updateScrollContentSize",value:function value(e,t){this.scrollContent.style.width="".concat(e,"px"),this.scrollContent.style.height="".concat(t,"px");}},{key:"resizeViewport",value:function value(){var e=this.scrollContainer,t=e.clientWidth,i=e.clientHeight;return this.viewerWidth=e.offsetWidth,this.viewerHeight=e.offsetHeight,FU(this.canvasContainer.style,{width:"".concat(t,"px"),height:"".concat(i,"px")}),{width:t,height:i};}},{key:"getMaxScrollValue",value:function value(){var e=this.scrollContainer;return{maxScrollLeft:e.scrollWidth-e.clientWidth,maxScrollTop:e.scrollHeight-e.clientHeight};}},{key:"isViewerResized",value:function value(){return this.scrollContainer.offsetWidth!==this.viewerWidth||this.scrollContainer.offsetHeight!==this.viewerHeight;}},{key:"isDPRChanged",value:function value(){var e=UO();return this.dpr!==e&&(this.dpr=e,!0);}},{key:"isScrollbarAppeared",value:function value(){return this.scrollContent.offsetWidth>this.scrollContainer.clientWidth||this.scrollContent.offsetHeight>this.scrollContainer.clientHeight;}},{key:"getViewportSize",value:function value(){return{width:this.scrollContainer.clientWidth,height:this.scrollContainer.clientHeight};}},{key:"bindContainer",value:function value(e){if(!e)return!1;var t=e;return e&&jN(e)&&(t=document.querySelector("#".concat(e))),t.appendChild(this.defaultDom),this.container=t,this.rootDom=this.defaultDom,this.isBindContainer=!0,this.context.resize(),!0;}},{key:"unbindContainer",value:function value(){if(0===this.container.children.length)return!1;for(var e=0;e<this.container.children.length;e++)if(this.container.children[e]===this.rootDom){this.container.removeChild(this.rootDom);break;}return this.isBindContainer=!1,!0;}},{key:"scrollTo",value:function value(e,t){this.scrollContainer.scrollTo?this.scrollContainer.scrollTo(e,t):(this.scrollContainer.scrollLeft=e,this.scrollContainer.scrollTop=t);}},{key:"scrollBy",value:function value(e,t){this.scrollContainer.scrollBy?this.scrollContainer.scrollBy(e,t):(this.scrollContainer.scrollLeft+=e,this.scrollContainer.scrollTop+=t);}}]);}();function vY(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=e.tag,r=e.style,n=e.id,o=e.className,a=e.children,s=document.createElement(i);return n&&(s.id=n+t),o&&(s.className=o),FU(s.style,r||{}),a&&$k(a).call(a,function(e){var i=vY(e,t);s.appendChild(i);}),s;}var gY=function(){return Yk(function e(t){Xk(this,e),Wk(this,"context",void 0),Wk(this,"zoomOriginCache",void 0),this.context=t;},[{key:"zoomTo",value:function value(e,t,i){var r;if((e=nO(e,this.context.config.minZoom,this.context.config.maxZoom))===this.context.config.zoom)return!1;var n=this.formatZoomOrigin(t,i);this.updateZoomReferencePoint(n),this.context.config.fitType="none",this.context.config.zoom=e;var o=null===(r=this.context)||void 0===r?void 0:r.getCurrentTab();if(o){var a;if(o.layoutStatus.zoom=e,o.fitType="none","multiple"===this.context.config.displayMode)return!1;this.context.layoutService.layout(o),n=this.formatZoomOrigin(t,i);var s=this.alignZoomReferencePoint(n),l=s.scrollLeft,u=s.scrollTop;return o.updateLayoutStatus({scrollLeft:l,scrollTop:u}),this.context.uiService.scrollTo(l,u),this.context.scrollerService.updateScroller({scrollLeft:l,scrollTop:u}),$k(a=o.childNodes).call(a,function(e){e.clearOptimization();}),this.context.rendererService.render(),!0;}return!1;}},{key:"formatZoomOrigin",value:function value(e,t){var i=this.context.rendererService.canvasDom.getBoundingClientRect(),r=i.width,n=i.height;if(HN(e)||HN(t)){var o=this.context.config.zoomOrigin,a=.5,s=.5;"left"===o.x?a=0:"right"===o.x&&(a=1),"top"===o.y?s=0:"bottom"===o.y&&(s=1),e=r*a,t=n*s;}return{originX:e=nO(e,0,r),originY:t=nO(t,0,n)};}},{key:"updateZoomReferencePoint",value:function value(e){var t,i,r,n,o=this,a=e.originX,s=e.originY,l=null,u=this.context.getPointerOverPageInfo(a,s).pageInfo.obj;if(u){var c=u.imageContainer.getPosition();r=(a-c.x)/this.context.config.zoom,n=(s-c.y)/this.context.config.zoom,t="center",i="center",l=u.uid;}else{var h,d,f=null===(h=this.context)||void 0===h?void 0:h.getCurrentTab(),v=Number.MAX_VALUE;null==f||$k(d=f.children).call(d,function(e){if(e.isVisible){var u=e.imageContainer.getPosition(),c=e.imageContainer,h=c.width,d=c.height,f=new qO(u.x+h/2,u.y+d/2).distanceTo({x:a,y:s});f<v&&(v=f,l=e.uid,a<u.x?(t="start",r=u.x-a):a>u.x+h?(t="end",r=a-(u.x+h)):(t="center",r=(a-u.x)/o.context.config.zoom),s<u.y?(i="start",n=u.y-s):s>u.y+d?(i="end",n=s-(u.y+d)):(i="center",n=(s-u.y)/o.context.config.zoom));}});}this.zoomOriginCache={imageX:r,imageY:n,positionX:t,positionY:i,pageUid:l};}},{key:"alignZoomReferencePoint",value:function value(e){var t,i=e.originX,r=e.originY,n=0,o=0,a=this.zoomOriginCache,s=a.imageX,l=a.imageY,u=a.positionX,c=a.positionY,h=a.pageUid,d=null===(t=this.context)||void 0===t?void 0:t.getCurrentTab();if(d){var f=d.getChildByUid(h);if(f){var v,g,m=f.imageContainer.getPosition();"start"===u?v=m.x-s:"center"===u?v=m.x+s*this.context.config.zoom:"end"===u&&(v=m.x+f.imageContainer.width+s),"start"===c?g=m.y-l:"center"===c?g=m.y+l*this.context.config.zoom:"end"===c&&(g=m.y+f.imageContainer.height+l),n=v-i,o=g-r;}}var y=this.context.uiService.scrollContainer,p=y.scrollLeft,w=y.scrollTop,b=this.context.uiService.getMaxScrollValue(),k=b.maxScrollLeft,S=b.maxScrollTop;return w+=o,{scrollLeft:p=nO(p+=n,0,k),scrollTop:w=nO(w,0,S)};}}]);}(),mY=function(){return Yk(function e(t,i){Xk(this,e),Wk(this,"viewerUid",void 0),Wk(this,"postfix",void 0),Wk(this,"groupUid",void 0),Wk(this,"emitter",void 0),Wk(this,"viewer",void 0),Wk(this,"config",_LN(RF)),Wk(this,"dvsContext",void 0),Wk(this,"boxRenderer",void 0),Wk(this,"configService",void 0),Wk(this,"hooksService",void 0),Wk(this,"layoutService",void 0),Wk(this,"rendererService",void 0),Wk(this,"scrollerService",void 0),Wk(this,"tabService",void 0),Wk(this,"uiService",void 0),Wk(this,"zoomService",void 0),Wk(this,"isFocus",!1),Wk(this,"defaultWidth",600),Wk(this,"defaultHeight",800),Wk(this,"isDestroyed",!1),Wk(this,"iListeners",[]),Wk(this,"draggingPrepared",!1),Wk(this,"showOutline",!1),this.viewer=t,this.configService=new sY(this),this.hooksService=new lY(this),this.layoutService=new uY(this),this.rendererService=new cY(this),this.scrollerService=new hY(this),this.tabService=new dY(this),this.uiService=new fY(this),this.zoomService=new gY(this),this.viewerUid=rO(),this.groupUid=i.groupUid,tO(i.viewerConfig||{},this.config),this.emitter=i.emitter,this.postfix="-".concat(this.viewerUid),this.dvsContext=i.dvsContext,this.uiService.initDefaultUI(),this.initPlugins(),i.container&&this.uiService.bindContainer(i.container),this.config.show||(this.uiService.rootDom?this.uiService.rootDom.style.display="none":this.uiService.defaultDom.style.display="none");},[{key:"initPlugins",value:function value(){var e=this;new HF().init(this),new aj().init(this),new sj().init(this),new jF().init(this),new lj().init(this),new NF().init(this),$k(yY).call(yY,function(t){return t.init(e);});}},{key:"setDisableFocusOutline",value:function value(e){var t,i;this.showOutline=!e;var r=null==this||null===(t=this.rendererService)||void 0===t?void 0:t.canvasDom,n=null==this||null===(i=this.uiService)||void 0===i?void 0:i.scrollContainer;e?(n.classList.add("dvs-disable-outline"),r.classList.add("dvs-disable-outline")):(n.classList.remove("dvs-disable-outline"),r.classList.remove("dvs-disable-outline"));}},{key:"clearCurTabOptimization",value:function value(){var e,t=this.getCurrentTab();t&&$k(e=t.children).call(e,function(e){e.clearOptimization();});}},{key:"updateViewerConfig",value:function value(e){this.configService.updateConfig(e);}},{key:"setViewMode",value:function value(e,t){var i;if(!ZN(t)||!ZN(e))return this.err(BN),!1;if(e<=0||t<=0)return this.err(DN),!1;var r=this.config.rows!==e||this.config.columns!==t;this.config.rows=e,this.config.columns=t;var n=this.getCurrentTab();return n&&(n.row=e,n.column=t,this.resetScrollbarStatus(),$k(i=n.children).call(i,function(e){e.clearOptimization();}),this.render(),r&&this.emitCurrentIndexChanged()),this.ok(),!0;}},{key:"syncFromViewer",value:function value(e){var t=this,i=e.context.tabService.getAllTabs(),r=e.context.tabService.getCurrentTab();$k(i).call(i,function(e){var i,n,o=t.tabService.createTab(e.doc);o.current=e.current,o.select(NI(i=e.selected).call(i)),$k(n=e.children).call(n,function(e,t){if(e.blanks.children.length){var i,r=o.childNodes[t];$k(i=e.blanks.children).call(i,function(e){var t=new oH({id:e.id,style:{points:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],background:e.style.background,borderWidth:0}});r.blanks.appendChild(t);});}if(e.overlays.children.length){var n,a=o.children[t];$k(n=e.overlays.children).call(n,function(e){var t,i=new oH({id:e.id,style:{points:NI(t=e.style.points).call(t),background:e.style.background,borderWidth:0,opacity:e.style.opacity}});a.overlays.appendChild(i);});}}),r.uid===o.uid&&t.showTab(o);});}},{key:"getStatus",value:function value(e){return this.dvsContext.spaceService.getStatus(e);}},{key:"getGlobalHooks",value:function value(){return this.dvsContext.hooksService.hooks;}},{key:"getLocalHooks",value:function value(){return this.hooksService.hooks;}},{key:"getCurrentTab",value:function value(){return this.tabService.getCurrentTab();}},{key:"getTab",value:function value(e){return this.tabService.getTab(e);}},{key:"getAllTabs",value:function value(){return this.tabService.getAllTabs();}},{key:"showTab",value:function value(e){var t,i,r=this;this.tabService.tabManager.setCurrentTab(e.uid),e.style.visibility="visible",this.config.show&&(0===e.total&&(this.resetScrollbarStatus(),this.resetScrollerSize(),this.resize()),this.layoutService.layout(e),0!==e.layoutStatus.viewWidth&&0!==e.layoutStatus.viewHeight&&(0===e.selected.length&&"single"===this.config.displayMode&&($k(t=e.children).call(t,function(e){e.updateStyle({visibility:"hidden"});}),this.resetScrollbarStatus(),this.resetScrollerSize(),this.resize()),$k(i=e.children).call(i,function(e){e.isPreload&&!e.isLoaded&&("multiple"===r.config.displayMode&&r.config.useMinImage?r.dvsContext.minImageService.load(e.uid):r.dvsContext.imageService.load(e.uid));}),this.hooksService.hooks.pageChanged.emit({current:e.current,total:e.total})));}},{key:"emitCurrentIndexChanged",value:function value(){var e=this.tabService.getCurrentTab();if(e&&(this.layoutService.layout(e),e.currentPage)){var t={isPassive:!1,trigger:this.viewerUid,docUid:""};this.hooksService.hooks.currentIndexChanged.emit(t);}}},{key:"resize",value:function value(){this.rendererService.resetCanvasSize();var e=this.uiService.resizeViewport(),t=e.width,i=e.height,r=UO();this.rendererService.canvas.setDPR(r),this.rendererService.canvas.resize(t,i),this.tabService.setViewportSize(t,i),this.scrollerService.updateScroller({viewportWidth:t,viewportHeight:i});}},{key:"resized",value:function value(){this.uiService.isBindContainer&&this.config.show&&(this.resetScrollbarStatus(),this.resize(),this.hooksService.hooks.resize.emit(),this.emitCurrentIndexChanged(),this.clearCurTabOptimization(),this.rendererService.render(),this.handleOrigin(),this.emit("resize",this.viewer.width,this.viewer.height));}},{key:"externalResized",value:function value(){if((this.uiService.isViewerResized()||this.uiService.isDPRChanged())&&this.uiService.isBindContainer&&this.config.show){this.resetScrollbarStatus(),this.resetScrollerSize(),this.resize(),this.hooksService.hooks.externalResized.emit(),this.emitCurrentIndexChanged();var e=this.getCurrentTab();e&&(this.layoutService.layout(e),this.clearCurTabOptimization()),this.rendererService.render(),this.handleOrigin(),this.emit("resize",this.viewer.width,this.viewer.height);}}},{key:"handleOrigin",value:function value(){if("single"===this.config.displayMode){var e=this.uiService.getMaxScrollValue(),t=e.maxScrollLeft,i=e.maxScrollTop,r=this.config.zoomOrigin,n=r.x,o=r.y,a=t/2,s=i/2;"left"===n?a=0:"right"===n&&(a=t),"top"===o?s=0:"bottom"===o&&(s=i),this.uiService.scrollTo(a,s);}}},{key:"getScrollbarWidth",value:function value(){var e,t=document.createElement("div"),i=document.createElement("div");if(t.appendChild(i),t.style.width="60px",t.style.height="60px",t.style.position="absolute",t.style.overflow="auto",i.style.width="100px",i.style.height="100px",null===(e=document)||void 0===e||!e.body)return 0;document.body.appendChild(t);var r=t.offsetWidth-t.clientWidth;return document.body.removeChild(t),r;}},{key:"selectPage",value:function value(e){this.tabService.selectPage(e),this.dvsContext.hooksService.hooks.selectPage.emit(e);}},{key:"getCanvasDpr",value:function value(){return this.rendererService.canvas.contextService.getDPR();}},{key:"optimizePage",value:function value(e){var t=this;if(this.config.enableOptimizeImage){var i=this.tabService.getCurrentTab();if(i){var r=i.getChildByUid(e);if(r){var n;if(r.isOptimized||!r.isVisible||!r.isLoaded||r.optimizationUid===r.optimizedUid||this.scrollerService.isSliding||this.isDestroyed)return;var o=this.getStatus(e);if(!(null!=o&&o.img||null!=o&&o.minImg))return;var a=r.image.style.img,s=a.naturalWidth,l=a.naturalHeight,u=s,c=l,h=this.config.maxOptimizationSize;if(u>h||c>h||r.realTimeWidth>h||r.realTimeHeight>h)return;var d=[],f=[];if(this.dvsContext.editService){var v={operations:o.operations,width:s,height:l};"multiple"===this.config.displayMode&&this.config.useMinImage&&(v.operations=this.dvsContext.editService.toMinImageOperations(o.operations,o.imageScale));var g=this.dvsContext.editService.handle(v);u=g.width,c=g.height,d=g.matrixes,f=g.blanks||[];}var m=new iH({style:{x:0,y:0,img:a,width:s,height:l}});m.externalMatrixes=d;var y="rgba(0,0,0,0)";if("multiple"===this.config.displayMode){var p=this.config.pageStyle;r.isSelected?p=this.config.selectedPageStyle:r.isHovered&&(p=this.config.hoveredPageStyle),y=p.background;}o.useFillColor&&(y=this.config.blankFillColor);var w=new eH({style:{x:0,y:0,width:u,height:c,background:y}}),b=new eH();$k(f).call(f,function(e){var t=new oH({id:e.uid,style:{background:e.background,points:e.points,borderWidth:0}});b.appendChild(t);}),m.appendChild(b),w.appendChild(m);var k=new eH();$k(n=r.overlays.children).call(n,function(e){var t,i=new oH({id:e.id,style:{points:NI(t=e.style.points).call(t),background:e.style.background,borderWidth:0,opacity:e.style.opacity}});k.appendChild(i);}),w.appendChild(k),this.dvsContext.commonCanvas.render(w),this.dvsContext.commonCanvas.clear();var S=this.dvsContext.commonCanvas.getCanvas(),x=UO(),C=Math.floor(r.imageContainer.width*x-1),V=Math.floor(r.imageContainer.height*x-1);r.isOptimized=!0,this.dvsContext.optimizationService.optimize(S,u,c,C,V,r.optimizationUid).then(function(e){if(!t.isDestroyed&&e.taskUid===r.optimizationUid){r.isOptimized=!0,r.optimizedUid=r.optimizationUid;var i=S.getContext("2d",{willReadFrequently:!0}).createImageData(C,V);i.data.set(e.target),r.imageContainer.imageData=i,r.isVisible&&t.render();}}).catch(function(e){r.isOptimized=!1;});}}}}},{key:"renderPage",value:function value(e){if(!(this.isDestroyed||this.config.useMinImage&&"multiple"===this.config.displayMode)){var t=this.tabService.getCurrentTab();if(t){var i=t.getChildByUid(e);if(i){var r=this.dvsContext.spaceService.getStatus(e);r&&(r.img&&(i.isLoaded=!0,i.updateImage(r.img)),i.isVisible&&(this.render(),this.handleOrigin()));}}}}},{key:"renderMinPage",value:function value(e){if(!this.isDestroyed&&this.config.useMinImage&&"multiple"===this.config.displayMode){var t=this.tabService.getCurrentTab();if(t){var i=t.getChildByUid(e);if(i){var r=this.dvsContext.spaceService.getStatus(e);r&&(r.minImg&&(i.isLoaded=!0,i.updateImage(r.minImg)),i.isVisible&&(this.render(),this.handleOrigin()));}}}}},{key:"renderOnly",value:function value(){this.rendererService.render();}},{key:"render",value:function value(){if(!this.config.show)return!1;if(this.isDestroyed)return!1;var e=this.tabService.getCurrentTab();if(e){var t;this.layoutService.layout(e),0===e.selected.length&&"single"===this.config.displayMode&&($k(t=e.children).call(t,function(e){e.updateStyle({visibility:"hidden"});}),this.resetScrollbarStatus(),this.resetScrollerSize(),this.resize()),this.config.zoom=e.layoutStatus.zoom;var i=this.uiService.scrollContainer,r=i.scrollLeft,n=i.scrollTop;e.setPosition({x:-r,y:-n}),e.updateLayoutStatus({scrollLeft:r,scrollTop:n}),this.scrollerService.updateScroller({scrollLeft:r,scrollTop:n});}return this.rendererService.render(),this.ok(),!0;}},{key:"tabCleared",value:function value(){this.tabService.tabManager.clear(),this.uiService.updateScrollContentSize(0,0),this.scrollerService.updateScroller({contentWidth:0,contentHeight:0}),this.render();}},{key:"storeActionToStatus",value:function value(e){var t,i=this;$k(t=(e=_LN(e)).uids).call(t,function(t){var r=i.getStatus(t);if(r){var n=r.operations[r.operations.length-1];n&&n.type===e.actionType||(n={type:e.actionType,detail:[]},r.operations.push(n)),n.detail.push(e);}});}},{key:"removeActionFromStatus",value:function value(e){var t,i=this;$k(t=e.uids).call(t,function(t){var r=i.getStatus(t);if(r){var n=r.operations[r.operations.length-1];if(n&&n.type===e.actionType&&(n.detail.pop(),!n.detail.length)){var o,a,s=WI(o=r.operations).call(o,n);s>-1&&mE(a=r.operations).call(a,s,1);}}});}},{key:"isEmpty",value:function value(){var e=this.getCurrentTab();return!e||0===e.children.length;}},{key:"resetScrollbarStatus",value:function value(){var e,t=this;$k(e=this.getAllTabs()).call(e,function(e){e.layoutStatus.scrollbarWidth=t.getScrollbarWidth(),e.layoutStatus.resetScrollbarStatus();});}},{key:"resetScrollerSize",value:function value(){var e=this.uiService.scrollContainer;this.rendererService.canvasDom.style.width="0px",this.rendererService.canvasDom.style.height="0px",this.uiService.canvasContainer.style.width="0px",this.uiService.canvasContainer.style.height="0px",this.uiService.scrollContent.style.width="0px",this.uiService.scrollContent.style.height="0px";var t=e.clientWidth,i=e.clientHeight;FU(this.uiService.canvasContainer.style,{width:"".concat(t,"px"),height:"".concat(i,"px")});}},{key:"setScrollbarWidth",value:function value(e){var t;$k(t=this.tabService.tabManager.tabs).call(t,function(t){t.scrollbarWidth=e;});}},{key:"getPointerOverPageInfo",value:function value(e,t){var i=function(e,t,i){var r={pageInfo:{isOver:!1,pointerX:-1,pointerY:-1,obj:null,pagePositionX:-1,pagePositionY:-1,pageWidth:-1,pageHeight:-1},imageInfo:{isOver:!1,pointerX:-1,pointerY:-1,obj:null},index:-1};if(e)for(var n=0;n<e.children.length;n++){var o=e.children[n],a=DF(o,t,i);if(a.isOver){r.index=n;var s=o.getPosition(),l=s.x,u=s.y,c=o.getScale(),h=c.x,d=c.y;a.pagePositionX=l,a.pagePositionY=u,a.pageWidth=o.parsedStyle.width.value*h,a.pageHeight=o.parsedStyle.height.value*d,FU(r.pageInfo,a);var f=DF(o.imageContainer,t,i);return FU(r.imageInfo,f),r;}}return r;}(this.tabService.getCurrentTab(),e,t);return i;}},{key:"getHitRemoveBtn",value:function value(e,t){var i=this.getCurrentTab();if(i)for(var r=0;r<i.total;r++){var n=i.childNodes[r];if(n.isVisible&&n.removeBtn.isVisible){var o=n.removeBtn.parsedCheckBoxStyle,a=o.x,s=o.y,l=o.width,u=o.height,c=n.getPosition(),h=c.x,d=c.y;if(e>=a+h&&t>=s+d&&e<=a+h+l&&t<=s+d+u)return r;}}return-1;}},{key:"getCanvasPosition",value:function value(){return this.rendererService.getCanvasPosition();}},{key:"getBorderWidth",value:function value(e){var t=e.border;if(!t)return 0;var i=t.match(/[0-9]+/g)[0];return $S(i||"0",10);}},{key:"isBorderWidthEqualHovered",value:function value(){return this.getBorderWidth(this.config.pageStyle)===this.getBorderWidth(this.config.hoveredPageStyle);}},{key:"isSelectedBorderWidthEqualHovered",value:function value(){return this.getBorderWidth(this.config.selectedPageStyle)===this.getBorderWidth(this.config.hoveredPageStyle);}},{key:"isSelectedBorderWidthEqualNormal",value:function value(){return this.getBorderWidth(this.config.pageStyle)===this.getBorderWidth(this.config.selectedPageStyle);}},{key:"formatTouches",value:function value(e){var t,i=[];t=e instanceof MouseEvent||e instanceof PointerEvent?[e]:arguments.length>1&&void 0!==arguments[1]&&arguments[1]?e.changedTouches:e.touches;for(var r=this.rendererService.getCanvasPosition(),n=r.x,o=r.y,a=0;a<t.length;a++){var s=t[a];i.push({pageX:s.pageX-n,pageY:s.pageY-o});}return i;}},{key:"getMargin",value:function value(){return this.formatMarginAndGap(this.config.margin);}},{key:"getGap",value:function value(){return this.formatMarginAndGap(this.config.gap);}},{key:"formatMarginAndGap",value:function value(e){if(jN(e)){if(/px/.test(e)){var t=Ab(e.match(/(\d+)/),1)[0];return $S(t,10);}if(/%/.test(e)){var i=this.rendererService.canvasDom.width/UO(),r=Ab(e.match(/(\d+)/),1)[0];return i*$S(r,10)/100;}if(/em/.test(e)){var n=Ab(getComputedStyle(this.rendererService.canvasDom).fontSize.match(/(\d+)/),1)[0],o=Ab(e.match(/(\d+)/),1)[0];return $S(n,10)*$S(o,10);}}return ZN(e)?e:$S(e,10);}},{key:"saveEvents",value:function value(){this.emitter.save();}},{key:"restoreEvents",value:function value(){this.emitter.restore();}},{key:"on",value:function value(e,t){if(jN(e)&&GN(t)){var i=this.emitter.on(e,t);this.iListeners.push(i);}else this.err(BN);}},{key:"emit",value:function value(e){for(var t,i,r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];jN(e)?(t=this.emitter).emit.apply(t,uS(i=[e]).call(i,n)):this.err(BN);}},{key:"off",value:function value(e,t){jN(e)&&(void 0===t||GN(t))?this.emitter.off(e,t):this.err(BN);}},{key:"err",value:function value(e){this.dvsContext.errorService.err(e);}},{key:"ok",value:function value(){this.err(PN);}},{key:"unbindEvents",value:function value(){var e,t=this;$k(e=this.iListeners).call(e,function(e){var i=e.name,r=e.fn,n=e.context,o=e.once;t.emitter.off(i,r,n,o);}),this.iListeners=[];}},{key:"destroy",value:function value(){this.isDestroyed||(this.getLocalHooks().destroy.emit(),this.scrollerService.destroy(),this.tabService.destroy(),this.unbindEvents(),this.isDestroyed=!0);}},{key:"getVisiblePagesInfo",value:function value(){var e,t=this.tabService.getCurrentTab();if(!t)return[];if(0===(null==t||null===(e=t.children)||void 0===e?void 0:e.length))return[];if(!this.viewer.getViewerConfig().show)return[];var i=t.visibleChildren,r=[];if(i.length>0){var n,o=this.rendererService,a=this.uiService.container;null!==(n=this.viewer)&&void 0!==n&&n.isThumbnail&&(a=this.viewer.thumbnailObject.viewer.context.uiService.container);var s=o.canvasDom,l=a.getBoundingClientRect(),u=l.left,c=l.top,h=s.getBoundingClientRect(),d=h.left,f=h.top,v=t.getIndexByUid(i[0].id);$k(i).call(i,function(e,t){!function(e,t){if(e.isVisible){var i=e.getPosition(),n=i.x,o=i.y,a=e.getScale(),s=a.x,l=a.y,h=Math.round(e.parsedStyle.width.value*s*10)/10,v=Math.round(e.parsedStyle.height.value*l*10)/10;r.push({pageIndex:t,isHovered:e.isHovered,isSelected:e.isSelected,pageWidth:h,pageHeight:v,canvasOffsetX:Math.round(10*n)/10,canvasOffsetY:Math.round(10*o)/10,containerOffsetX:Math.round(10*(d-u+n))/10,containerOffsetY:Math.round(10*(f-c+o))/10});}}(e,v+t);});}return r;}}]);}(),yY=[],pY=function(){return Yk(function e(t){Xk(this,e),Wk(this,"context",void 0),Wk(this,"OriginalViewer",e),Wk(this,"uid",void 0),Wk(this,"groupUid",null),Wk(this,"postfix",void 0),Wk(this,"destroyFlag",!1),this.context=new mY(this,t),this.uid=this.context.viewerUid,this.postfix=this.context.postfix,this.groupUid=this.context.groupUid;},[{key:"isDestroyed",get:function get(){return this.destroyFlag;}},{key:"currentPageCount",get:function get(){var e=this.getCurrentTab();return(null==e?void 0:e.total)||0;}},{key:"rootDom",get:function get(){return this.context.uiService.rootDom;}},{key:"defaultDom",get:function get(){return this.context.uiService.defaultDom;}},{key:"container",get:function get(){return this.context.uiService.container;}},{key:"scrollContainer",get:function get(){return this.context.uiService.scrollContainer;}},{key:"canvasContainer",get:function get(){return this.context.uiService.canvasContainer;}},{key:"updateViewerConfig",value:function value(e){this.context.updateViewerConfig(e);}},{key:"getViewerConfig",value:function value(){return this.context.config;}},{key:"getViewerConfigByName",value:function value(e){return this.context.config[e];}},{key:"show",value:function value(){if(!0!==this.context.config.show){this.context.config.show=!0;var e=this.context.uiService,t=e.rootDom,i=e.defaultDom;t&&(t.style.display="flex",i.style.display="flex"),this.resized();var r=this.getCurrentTab();return r&&this.context.showTab(r),!0;}return!1;}},{key:"hide",value:function value(){if(!1!==this.context.config.show){this.context.config.show=!1;var e=this.context.uiService.rootDom;return e&&(e.style.display="none"),!0;}return!1;}},{key:"bindContainer",value:function value(e){return this.context.uiService.bindContainer(e);}},{key:"unbindContainer",value:function value(){return this.context.uiService.unbindContainer();}},{key:"externalResized",value:function value(){this.context.externalResized();}},{key:"resized",value:function value(){this.context.resized();}},{key:"checkPageVisibility",value:function value(e){var t={min:!1,ori:!1},i=this.getCurrentTab();if(i){var r=i.getChildByUid(e);r&&r.isPreload&&("multiple"===this.context.config.displayMode&&(t.min=!0),t.ori=!0);}return t;}},{key:"getCurrentTab",value:function value(){var e;return null===(e=this.context)||void 0===e?void 0:e.getCurrentTab();}},{key:"getTab",value:function value(e){return jN(e)?this.context.tabService.getTab(e):(this.err(BN),null);}},{key:"getAllTabs",value:function value(){return this.context.tabService.getAllTabs();}},{key:"removePage",value:function value(e){if(ZN(e)&&(e=[e]),!NN(e))return this.err(BN),!1;var t=e.length;if(0===t)return this.err(AN),!1;var i=this.getCurrentTab();if(!i)return!1;for(var r=[],n=0;n<t;n++){var o=this.getUidByIndex(e[n]);if(!o)return!1;r.push(o);}var a={removedUids:r,docUid:i.uid,trigger:this.uid,operation:"remove"};return this.context.getLocalHooks().remove.emit(a),!0;}},{key:"removeAllPages",value:function value(){var e=this.getCurrentTab();if(e){var t,i={removedUids:QE(t=e.children).call(t,function(e){return e.uid;}),docUid:e.uid,trigger:this.uid,operation:"remove"};e.visibleChildren=[],this.context.getLocalHooks().remove.emit(i);}return this.ok(),!0;}},{key:"switchPage",value:function value(e,t){var i=this.getCurrentTab();if(!i||!this.isIndexValid(i,e)||!this.isIndexValid(i,t))return!1;var r={one:e,other:t,trigger:this.uid,docUid:i.uid,type:i.type,operation:"shift"};return this.context.getLocalHooks().switch.emit(r),!0;}},{key:"movePage",value:function value(e,t){var i=this.getCurrentTab();if(!i||!this.isIndexValid(i,e)||!this.isIndexValid(i,t))return!1;var r={from:e,to:t,trigger:this.uid,docUid:i.uid,type:i.type,operation:"shift"};return this.context.getLocalHooks().move.emit(r),!0;}},{key:"reorderPage",value:function value(e){var t=this.getCurrentTab();if(!t||!NN(e)||t.total!==e.length)return!1;var i={indexes:e,trigger:this.uid,docUid:t.uid,type:t.type,operation:"shift"};return this.context.getLocalHooks().reorder.emit(i),!0;}},{key:"setViewMode",value:function value(e,t){return this.context.setViewMode(e,t);}},{key:"nextPage",value:function value(){var e=this.getCurrentTab();if(!e)return-1;var t=e.current;if(t+1===e.total&&e.selected.length<=1)return t;var i={index:t+1,docUid:e.uid,trigger:this.uid,groupUid:this.groupUid,operation:"shift"};return this.context.getLocalHooks().changePage.emit(i),e.current;}},{key:"prevPage",value:function value(){var e=this.getCurrentTab();if(!e)return-1;var t=e.current;if(t-1<0&&e.selected.length<=1)return t;var i={index:t-1,docUid:e.uid,trigger:this.uid,groupUid:this.groupUid,operation:"shift"};return this.context.getLocalHooks().changePage.emit(i),e.current;}},{key:"firstPage",value:function value(){var e=this.getCurrentTab();if(!e)return-1;var t=e.current;if(0===t&&e.selected.length<=1)return t;var i={index:0,docUid:e.uid,trigger:this.uid,groupUid:this.groupUid,operation:"shift"};return this.context.getLocalHooks().changePage.emit(i),e.current;}},{key:"lastPage",value:function value(){var e=this.getCurrentTab();if(!e)return-1;var t=e.current,i=e.total;if(t===i-1&&e.selected.length<=1)return t;var r={index:i,docUid:e.uid,trigger:this.uid,groupUid:this.groupUid,operation:"shift"};return this.context.getLocalHooks().changePage.emit(r),e.current;}},{key:"gotoPage",value:function value(e){var t=this.getCurrentTab();if(!t)return-1;var i=t.current;if(e>t.total-1||e<0)return-1;if(i===e&&t.selected.length<=1)return i;var r={index:e,docUid:t.uid,trigger:this.uid,groupUid:this.groupUid,operation:"shift"};return this.context.getLocalHooks().changePage.emit(r),t.current;}},{key:"getCurrentIndex",value:function value(){var e=this.getCurrentTab();return e?(this.err(PN),e.current):(this.err(MN),-1);}},{key:"setCurrentIndex",value:function value(e){return-1!==this.gotoPage(e);}},{key:"setSelectedIndexes",value:function value(e){if(!NN(e))return this.err(BN),!1;var t=this.getCurrentTab();if(!t)return!1;var i=t.selected,r=!1;i.length!==e.length&&(r=!0);for(var n=[],o=0;o<e.length;o++){var a=this.getUidByIndex(e[o]);if(!a)return!1;i[o]!==a&&(r=!0),n.push(a);}if(!r)return!0;var s={selectedUids:n,indexes:e,docUid:t.uid,trigger:this.uid,groupUid:this.groupUid,operation:"shift"};return this.context.getLocalHooks().selectPage.emit(s),!0;}},{key:"getSelectedIndexes",value:function value(){var e,t=this.getCurrentTab();if(!t)return this.err(MN),null;var i=QE(e=t.selected).call(e,function(e){return t.getIndexByUid(e);});return this.ok(),i;}},{key:"selectAll",value:function value(){var e,t=this.getCurrentTab();if(!t)return this.err(MN),!1;var i=Ub(KB(e=Array(t.total)).call(e));return this.setSelectedIndexes(i);}},{key:"getIndexByUid",value:function value(e){if(!jN(e))return null;var t=this.getCurrentTab();if(!t)return this.err(MN),null;var i=t.getIndexByUid(e);return i>-1?this.ok():this.err(AN),i;}},{key:"getUidByIndex",value:function value(e){var t=this.getCurrentTab();return t?this.isIndexValid(t,e)?(this.ok(),t.children[e].uid):null:(this.err(MN),null);}},{key:"undo",value:function value(){var e=this.getCurrentTab();if(e){var t=e.commandController.undoStack,i=t[t.length-1];if(i){var r,n={commandUid:i.uid,trigger:this.uid};return $k(r=i.action.uids).call(r,function(t){var i=e.getChildByUid(t);i&&i.clearOptimization();}),this.context.getGlobalHooks().undo.emit(n),!0;}}return!1;}},{key:"redo",value:function value(){var e=this.getCurrentTab();if(e){var t=e.commandController.redoStack,i=t[t.length-1];if(i){var r,n={commandUid:i.uid,trigger:this.uid};return $k(r=i.action.uids).call(r,function(t){var i=e.getChildByUid(t);i&&i.clearOptimization();}),this.context.storeActionToStatus(i.action),this.context.getGlobalHooks().redo.emit(n),!0;}}return!1;}},{key:"reset",value:function value(e){var t=this;if(!AF(this,e=MF(this,e)))return!1;var i=this.getCurrentTab(),r=QE(e).call(e,function(e){return i.getChildByIndex(e).uid;}),n={tabUid:i.uid,tabType:i.type,trigger:this.uid,uids:r};return $k(r).call(r,function(e){var r=t.context.getStatus(e);r&&(r.operations=[]);var n=i.getChildByUid(e);n&&n.clearOptimization();}),this.context.getGlobalHooks().reset.emit(n),!0;}},{key:"zoomIn",value:function value(){var e=this.getViewerConfigByName("zoom");this.updateViewerConfig({zoom:1.2*e});}},{key:"zoomOut",value:function value(){var e=this.getViewerConfigByName("zoom");this.updateViewerConfig({zoom:e/1.2});}},{key:"render",value:function value(){return this.context.render();}},{key:"on",value:function value(e,t){this.context.on(e,t);}},{key:"emit",value:function value(e){for(var t,i,r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];(t=this.context).emit.apply(t,uS(i=[e]).call(i,n));}},{key:"off",value:function value(e,t){this.context.off(e,t);}},{key:"err",value:function value(e){this.context.dvsContext.errorService.err(e);}},{key:"ok",value:function value(){this.err(PN);}},{key:"isIndexValid",value:function value(e,t){return ZN(t)?!(t<0||t>=e.total)||(this.err(DN),!1):(this.err(BN),!1);}},{key:"destroy",value:function value(){this.destroyFlag||(this.context.destroy(),this.context=null,this.destroyFlag=!0);}}],[{key:"use",value:function value(e){WI(yY).call(yY,e)<0&&yY.push(e);}}]);}(),wY={Viewer:pY},bY=function(){return Yk(function e(t,i){Xk(this,e),Wk(this,"dvs",void 0),Wk(this,"errorService",void 0),Wk(this,"hooksService",void 0),Wk(this,"imageService",void 0),Wk(this,"minImageService",void 0),Wk(this,"layoutService",void 0),Wk(this,"spaceService",void 0),Wk(this,"trackerService",void 0),Wk(this,"viewerService",void 0),Wk(this,"saveService",void 0),Wk(this,"workerService",void 0),Wk(this,"commonCanvas",void 0),Wk(this,"optimizationService",void 0),this.dvs=t,this.errorService=new pF(this),this.hooksService=new wF(this),this.imageService=new bF(this),this.minImageService=new SF(this),this.layoutService=new kF(this),this.spaceService=new CF(this,i),this.trackerService=new TF(this),this.viewerService=new IF(this),this.saveService=new xF(this),this.workerService=new EF(this),this.commonCanvas=new _H(),this.optimizationService=new PF(this);},[{key:"destroy",value:function value(){this.imageService.destroy(),this.minImageService.destroy();}},{key:"getSpace",value:function value(){return this.spaceService.space;}}]);}(),kY=[],SY=function(){return Yk(function e(t){Xk(this,e),Wk(this,"uid",void 0),Wk(this,"emitter",void 0),Wk(this,"subClasses",void 0),Wk(this,"isDestroyed",!1),Wk(this,"options",void 0),Wk(this,"context",void 0),this.uid=rO(),this.subClasses=wY,this.emitter=LO.create(),this.options=t,this.context=new bY(this,t.space),this.init(),xH(["borderWidth","letterSpacing","lineDashOffset","shadowOffsetX","shadowOffsetY","shadowBlur","textMaxWidth"],aW,void 0),xH(["startAngle","endAngle"],lW,void 0),xH(["r","rx","ry","width","height","padding","fontSize","arrowWidth","markSize","markLineWidth"],aW,void 0),xH(["borderColor","background","shadowColor","color"],fW,void 0),xH(["opacity","fillOpacity","borderOpacity"],mW,void 0),SH("lineDash",gW,void 0),SH("shadow",vW,void 0),xH(["x","y"],void 0,yW),xH(["points"],void 0,yH),xH(["x1","y1","x2","y2"],void 0,mH),xH(["startPoint","endPoint"],void 0,bH),xH(["lineEnding"],void 0,kH),xH(["fontStyle","fontVariant","fontWeight","fontFamily","fontSize"],void 0,pH),xH(["x","y","width","wordWarp","lineHeight","text","textTransform","textBaseLine"],void 0,gH),xH(["width","height"],void 0,wH);},[{key:"init",value:function value(){var e=this;new mF().apply(this.context),new yF().apply(this.context),this.emitter.save(),$k(kY).call(kY,function(t){var i,r=t.plugin,n=t.config;!GN(r)&&GN(r.init)&&r.init.apply(r,uS(i=[e]).call(i,Ub(n)));}),this.context.hooksService.hooks.init.emit(),this.emitter.restore();}},{key:"setSpace",value:function value(e){e!==this.context.spaceService.space&&(this.context.hooksService.hooks.beforeSetSpace.emit(e),this.context.spaceService.setSpace(e),this.context.hooksService.hooks.afterSetSpace.emit(e));}},{key:"getImageData",value:function value(e,t){return this.context.saveService.getImageData(e,t);}},{key:"destroy",value:function value(){var e;this.isDestroyed||(this.context.hooksService.hooks.destroy.emit(),this.context.destroy(),null!==(e=this.emitter)&&void 0!==e&&e.destroy(),this.emitter=null,this.subClasses=null,this.isDestroyed=!0);}},{key:"removeSource",value:function value(e){return this.context.spaceService.space.removeSource(e);}},{key:"loadSource",value:function value(e){return this.context.spaceService.space.loadSource(e);}},{key:"updateSource",value:function value(e,t){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.context.spaceService.space.updateSource(e,t,i);}},{key:"createViewer",value:function value(e){return this.context.viewerService.createViewer(e);}},{key:"removeViewer",value:function value(e){return this.context.viewerService.removeViewer(e);}},{key:"getViewerByUid",value:function value(e){return this.context.viewerService.getViewer(e);}},{key:"getViewerByIndex",value:function value(e){return this.context.viewerService.viewerManager.getAllViewers()[e];}},{key:"getViewerList",value:function value(){var e;return NI(e=this.context.viewerService.viewerManager.getAllViewers()).call(e);}}],[{key:"use",value:function value(e){for(var t,i,r,n=arguments.length,o=new Array(n>1?n-1:0),a=1;a<n;a++)o[a-1]=arguments[a];return WI(t=QE(kY).call(kY,function(e){return e.plugin;})).call(t,e)>-1?(console.error("The plugin ".concat(e.name," is already installed.")),this):("function"==typeof e?e.apply(void 0,uS(i=[this]).call(i,o)):"function"==typeof e.install&&e.install.apply(e,uS(r=[this]).call(r,o)),kY.push({plugin:e,config:o}),this);}},{key:"useAll",value:function value(e){var t=this;return $k(e).call(e,function(e){if(NN(e)){var i,r=Oh(a=e)||Ld(a)||yf(a)||pf(),n=r[0],o=NI(r).call(r,1);t.use.apply(t,uS(i=[n]).call(i,Ub(o)));}else t.use(e);var a;}),this;}},{key:"getClassStore",value:function value(){return wY;}},{key:"getPlugins",value:function value(){return kY;}}]);}(),xY={sequence:-1,location:"horizontal",size:180,thumbnailStyle:{},canvasStyle:{border:"1px solid #2a2a2a"},pageStyle:{},selectedPageStyle:{},placeholderStyle:{},hoveredPageStyle:{},pageNumberStyle:{},checkboxStyle:{},removeBtnStyle:{},enableDragPage:!0,enableKeyboardControl:!0,multiselectMode:!1,scrollDirection:"vertical",rows:4,columns:1,show:!0,enableResizing:!0,autoChangeIndex:!0,gap:10,margin:10,autoSelectTopPage:!1,autoScroll:!0,autoSelectLatest:!0},CY={enableOptimizeImage:!1,enableZoom:!1,displayMode:"multiple",toolType:"default",rows:4,columns:1,pure:!0,tabMode:"single"},VY=function(){return Yk(function e(t){Xk(this,e),Wk(this,"uid",void 0),Wk(this,"emitter",void 0),Wk(this,"thbConfig",{}),Wk(this,"innerViewer",void 0),Wk(this,"viewer",void 0),Wk(this,"postfix",void 0),Wk(this,"container",void 0),Wk(this,"hooks",{destroy:HO.create()}),Wk(this,"configHandlers",{}),Wk(this,"isDestroyed",!1);var i=LO.create();this.emitter=i,this.viewer=t.viewer,tO(CY,this.thbConfig),tO(xY,this.thbConfig),tO(t.viewerConfig||{},this.thbConfig),this.initThbConfigHandlers(),this.innerViewer=new this.viewer.OriginalViewer(Fk(Fk({},t),{},{emitter:i,viewerConfig:Fk(Fk({},this.thbConfig),{},{viewerStyle:Fk({},this.thbConfig.thumbnailStyle)}),groupUid:this.viewer.groupUid,dvsContext:t.viewer.context.dvsContext})),this.innerViewer.isThumbnail=!0,this.innerViewer.thumbnailObject=this,this.uid=this.innerViewer.uid,this.postfix=this.innerViewer.context.postfix,this.listenViewerHooks(),t.container||this.updatePosition();},[{key:"listenViewerHooks",value:function value(){var e=this,t=this.viewer.context.hooksService.hooks,i=function i(){e.innerViewer&&e.innerViewer.context.resized();},r=function r(){e.innerViewer&&e.innerViewer.externalResized();},n=function n(t){e.innerViewer.context.hooksService.hooks.openDoc.emit(t);};t.resize.on(i),t.externalResized.on(r),t.openDoc.on(n),t.destroy.on(function(){e.destroy();}),this.hooks.destroy.on(function(){t.resize.off(i),t.externalResized.off(r),t.openDoc.off(n);});}},{key:"updatePosition",value:function value(){var e=null,t=this.innerViewer.context.uiService.defaultDom,i=this.viewer.context.uiService.defaultDom;"horizontal"===this.thbConfig.location?(t.style.width=TY(this.thbConfig.size),t.style.height="100%",e=i.querySelector("#dvs-viewer-middle".concat(this.viewer.context.postfix))):(t.style.width="100%",t.style.height=TY(this.thbConfig.size),e=i);var r=String(this.thbConfig.sequence);t.style.order=r,this.container=e,this.innerViewer.context.uiService.bindContainer(e),this.viewer.externalResized();}},{key:"getThbConfig",value:function value(){return this.thbConfig;}},{key:"getThbConfigByName",value:function value(e){return this.thbConfig[e];}},{key:"updateThbConfig",value:function value(e){for(var t=0,i=aB(e);t<i.length;t++){var r=Ab(i[t],2),n=r[0],o=r[1],a=this.configHandlers[n];a&&a(this,o);}}},{key:"initThbConfigHandlers",value:function value(){this.configHandlers={thumbnailStyle:IY,canvasStyle:EY,pageStyle:PY,selectedPageStyle:BY,placeholderStyle:DY,hoveredPageStyle:MY,pageNumberStyle:AY,checkboxStyle:UY,removeBtnStyle:zY,scrollDirection:RY,multiselectMode:NY,enableDragPage:OY,enableKeyboardControl:LY,show:WY,rows:HY,columns:FY,margin:jY,gap:YY,autoSelectTopPage:XY,size:qY,sequence:ZY,location:_Y,showRemoveBtn:GY,autoScroll:KY,autoSelectLatest:$Y};}},{key:"show",value:function value(){return this.updateThbConfig({show:!0}),!0;}},{key:"hide",value:function value(){return this.updateThbConfig({show:!1}),!0;}},{key:"resized",value:function value(){this.viewer.resized(),this.innerViewer.resized();}},{key:"setViewMode",value:function value(e,t){return this.innerViewer.setViewMode(e,t);}},{key:"bindContainer",value:function value(e){return this.innerViewer.bindContainer(e);}},{key:"unbindContainer",value:function value(){return this.innerViewer.unbindContainer();}},{key:"on",value:function value(e,t){jN(e)&&GN(t)?this.emitter.on(e,t):this.err(BN);}},{key:"emit",value:function value(e){for(var t,i,r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];jN(e)?(t=this.emitter).emit.apply(t,uS(i=[e]).call(i,n)):this.err(BN);}},{key:"off",value:function value(e,t){jN(e)&&(void 0===t||GN(t))?this.emitter.off(e,t):this.err(BN);}},{key:"destroy",value:function value(){this.isDestroyed||(this.hooks.destroy.emit(),this.innerViewer.unbindContainer(),this.innerViewer.destroy(),this.innerViewer=null,this.container=null,this.isDestroyed=!0);}},{key:"err",value:function value(e){this.emitter.emit("_dvsUpdateErrorMessage",e);}},{key:"ok",value:function value(){this.emitter.emit("_dvsUpdateErrorMessage",PN);}}]);}();function TY(e){if(jN(e)){if(!/%/.test(e)&&!/px/.test(e)&&!/em/.test(e))return"".concat(e,"px");}else if(ZN(e))return"".concat(e,"px");return e;}function IY(e,t){FU(e.thbConfig.thumbnailStyle,t),e.innerViewer.updateViewerConfig({viewerStyle:Fk({},e.thbConfig.thumbnailStyle)}),e.viewer.resized();}function EY(e,t){FU(e.thbConfig.canvasStyle,t),e.innerViewer.updateViewerConfig({canvasStyle:Fk({},e.thbConfig.canvasStyle)}),e.viewer.resized();}function PY(e,t){FU(e.thbConfig.pageStyle,t),e.innerViewer.updateViewerConfig({pageStyle:Fk({},e.thbConfig.pageStyle)}),e.innerViewer.render();}function BY(e,t){FU(e.thbConfig.selectedPageStyle,t),e.innerViewer.updateViewerConfig({selectedPageStyle:Fk({},e.thbConfig.selectedPageStyle)}),e.innerViewer.render();}function DY(e,t){FU(e.thbConfig.placeholderStyle,t),e.innerViewer.updateViewerConfig({placeholderStyle:Fk({},e.thbConfig.placeholderStyle)}),e.innerViewer.render();}function MY(e,t){FU(e.thbConfig.hoveredPageStyle,t),e.innerViewer.updateViewerConfig({hoveredPageStyle:Fk({},e.thbConfig.hoveredPageStyle)}),e.innerViewer.render();}function AY(e,t){FU(e.thbConfig.pageNumberStyle,t),e.innerViewer.updateViewerConfig({pageNumberStyle:Fk({},e.thbConfig.pageNumberStyle)}),e.innerViewer.render();}function UY(e,t){FU(e.thbConfig.checkboxStyle,t),e.innerViewer.updateViewerConfig({checkboxStyle:Fk({},e.thbConfig.checkboxStyle)}),e.innerViewer.render();}function zY(e,t){FU(e.thbConfig.removeBtnStyle,t),e.innerViewer.updateViewerConfig({removeBtnStyle:Fk({},e.thbConfig.removeBtnStyle)}),e.innerViewer.render();}function RY(e,t){e.thbConfig.scrollDirection=t,e.innerViewer.updateViewerConfig({scrollDirection:t}),e.innerViewer.render();}function NY(e,t){e.thbConfig.multiselectMode=t,e.innerViewer.updateViewerConfig({multiselectMode:t}),e.innerViewer.render();}function OY(e,t){e.thbConfig.enableDragPage=t,e.innerViewer.updateViewerConfig({enableDragPage:t});}function LY(e,t){e.thbConfig.enableKeyboardControl=t,e.innerViewer.updateViewerConfig({enableKeyboardControl:t});}function WY(e,t){if(_N(t)&&e.thbConfig.show!==t){e.thbConfig.show=t,e.innerViewer.context.config.show=t;var i=(e.innerViewer||{}).defaultDom;i&&(i.style.display=t?"flex":"none"),e.viewer.externalResized();var r=e.innerViewer.getCurrentTab();if(r){e.innerViewer.context.showTab(r),e.innerViewer.context.renderOnly();var n=e.innerViewer.context.config;n.autoSelectLatest&&n.show&&n.autoScroll&&e.innerViewer.context.emitCurrentIndexChanged();}}}function HY(e,t){ZN(t)?t<=0?e.err(DN):(e.thbConfig.rows=t,e.setViewMode(t,e.thbConfig.columns),e.ok()):e.err(BN);}function FY(e,t){ZN(t)?t<=0?e.err(DN):(e.thbConfig.columns=t,e.setViewMode(e.thbConfig.rows,t),e.ok()):e.err(BN);}function jY(e,t){e.thbConfig.margin=t,e.innerViewer.updateViewerConfig({margin:t});}function YY(e,t){e.thbConfig.gap=t,e.innerViewer.updateViewerConfig({gap:t});}function XY(e,t){e.thbConfig.autoSelectTopPage=t,e.innerViewer.updateViewerConfig({autoSelectTopPage:t});}function qY(e,t){!function(e){var t=String(e);return!!/^\d+(px|em)$|^\d+$|^(100|[1-9]?\d(\.\d\d?\d?)?)%$/.test(t);}(t)?e.err(UN):(e.thbConfig.size=t,e.updatePosition(),e.ok());}function ZY(e,t){ZN(t)?(e.thbConfig.sequence=t,e.updatePosition(),e.ok()):e.err(BN);}function _Y(e,t){"horizontal"===t||"vertical"===t?(e.thbConfig.location=t,e.updatePosition(),e.ok()):e.err(BN);}function GY(e,t){_N(t)?(e.thbConfig.showRemoveBtn=t,e.ok()):e.err(BN);}function KY(e,t){e.thbConfig.autoScroll=t,e.innerViewer.updateViewerConfig({autoScroll:t});}function $Y(e,t){e.thbConfig.autoSelectLatest=t,e.innerViewer.updateViewerConfig({autoSelectLatest:t});}var QY={name:"dvsThumbnail",install:function install(e){var t=e.getClassStore(),i=function(e,t){return t=function(e){function t(e){var i;return Xk(this,t),Wk(Pw(i=IN(this,t,[e])),"thumbnails",void 0),i.thumbnails=[],i;}return Mb(t,e),Yk(t,[{key:"createThumbnail",value:function value(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new VY({container:e.container||"",viewerConfig:e,dvs:this.dvs,viewer:this});this.thumbnails.push(t);var i=this.context.getCurrentTab();if(i){var r,n,o=t.innerViewer.context,a=o.tabService.createTab(i.doc);a.current=i.current,a.select(NI(r=i.selected).call(r)),$k(n=i.children).call(n,function(e,t){if(e.blanks.children.length){var i,r=a.childNodes[t];$k(i=e.blanks.children).call(i,function(e){var t=new oH({id:e.id,style:{points:[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],background:e.style.background,borderWidth:0}});r.blanks.appendChild(t);});}if(e.overlays.children.length){var n,o=a.children[t];$k(n=e.overlays.children).call(n,function(e){var t,i=new oH({id:e.id,style:{points:NI(t=e.style.points).call(t),background:e.style.background,borderWidth:0,opacity:e.style.opacity}});o.overlays.appendChild(i);});}}),o.showTab(a),o.config.autoSelectLatest&&o.config.show?o.emitCurrentIndexChanged():o.renderOnly();}return e.container&&this.context.resized(),t;}},{key:"removeThumbnail",value:function value(e){var t,i,r,n;return jN(e)?r=PE(t=this.thumbnails).call(t,function(t){return t.uid===e;}):ON(e)&&(r=PE(i=this.thumbnails).call(i,function(t){return t===e;})),r>-1&&(Ab(mE(n=this.thumbnails).call(n,r,1),1)[0].destroy(),!0);}},{key:"getThumbnailList",value:function value(){return this.thumbnails;}},{key:"getThumbnailByIndex",value:function value(e){return this.thumbnails[e];}},{key:"getThumbnailByUid",value:function value(e){var t;return CP(t=this.thumbnails).call(t,function(t){return t.uid===e;});}},{key:"checkPageVisibility",value:function value(e){var t={min:!1,ori:!1},i=this.getCurrentTab();if(i){var r=i.getChildByUid(e);r&&r.isPreload&&("multiple"===this.context.config.displayMode&&(t.min=!0),t.ori=!0);}for(var n=0,o=this.thumbnails.length;n<o;n++){var a=this.thumbnails[n].innerViewer.checkPageVisibility(e);a.min&&(t.min=!0),a.ori&&(t.ori=!0);}return t;}}]);}(e),Wk(t,"use",e.use),t;}(t.Viewer);t.Viewer=i;}},JY=function(){function e(t,i){Xk(this,e),Wk(this,"reducer",void 0),Wk(this,"state",void 0),Wk(this,"listeners",[]),this.reducer=t,this.state=i,this.dispatch({type:""});}return Yk(e,[{key:"subscribe",value:function value(e){return this.listeners.push(e),function(){var t,i,r=null===(t=this.listeners)||void 0===t?void 0:WI(t).call(t,e);null===(i=this.listeners)||void 0===i||mE(i).call(i,r,1);};}},{key:"dispatch",value:function value(e){var t;this.state=this.reducer(this.state,e),$k(t=this.listeners).call(t,function(t){t(e);});}},{key:"getState",value:function value(){return this.state;}},{key:"replaceReducer",value:function value(e){this.reducer=e,this.dispatch({type:""});}}],[{key:"create",value:function value(t,i,r){return"function"==typeof i&&void 0===r&&(r=i,i=void 0),r?r(e.create)(t,i):new e(t,i);}},{key:"combineReducers",value:function value(e){return function(t,i){var r;null!==(r=t)&&void 0!==r||(t={});for(var n={},o=0,a=aB(e);o<a.length;o++){var s=Ab(a[o],2),l=s[0],u=(0,s[1])(t[l],i);n[l]=u;}return n;};}},{key:"applyMiddleware",value:function value(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return function(e){return function(i,r){var n=e(i,r),o={getState:n.getState},a=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return 0===t.length?function(e){return e;}:1===t.length?t[0]:vx(t).call(t,function(e,t){return function(){return e(t.apply(void 0,arguments));};});}.apply(void 0,Ub(QE(t).call(t,function(e){return e(o);})))(n.dispatch);return Fk(Fk({},n),{},{dispatch:a});};};}}]);}(),eX=/^<\/([^>]*)>/,tX=/^<([^\s>]+)[^>]*>/,iX=/^<slot>.*<\/slot>/,rX=/(:?[@\w-]+)\s*=\s*"(.*?)"/;function nX(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=oX(e.template,e.data,e.components,e.injection,t),r=i.length;return r&&(i[0].cpInstance=e,i[r-1].cpInstance=e),i;}function oX(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],o=zS(e).call(e),a=[];function s(e){o=o.substring(e);}function l(e){var n=Ab(e,2),o=n[0],s=n[1];if(s){var l=function(e){var t={},i=eO(e,rX);return i?($k(i).call(i,function(e){var i=Ab(e,3),r=i[1],n=i[2];t[r]=n;}),t):t;}(o),u=t[":for"];u&&(delete t[":for"],l[":for"]=u);var c={type:"start",name:s,data:t,attrs:l};if(a.push(c),(i[s]||r.components&&r.components[s])&&(c.cpOption={Component:i[s]||r.components[s],injection:r}),"input"===s||/\/>/.test(o)){var h={type:"end",name:s,data:t,attrs:{}};a.push(h);}}}function u(e){var t=Ab(e,2)[1];if(t){var i={type:"end",name:t,attrs:{}};a.push(i);}}function c(e){if(e=zS(e).call(e)){var i={type:"text",name:e,attrs:{},data:t};a.push(i);}}function h(){a.push.apply(a,Ub(n));}for(;o;){var d=WI(o).call(o,"<"),f=void 0;if(0===d){var v=o.match(eX);if(v){s(v[0].length),u(v);continue;}var g=o.match(iX);if(g){s(g[0].length),h();continue;}var m=o.match(tX);if(m&&m[0]!==m.input){s(m[0].length),l(m);continue;}f=o;}else f=d>0?o.substring(0,d):o;f&&(s(f.length),c(f));}return a;}function aX(e){var t=e.cpInstance;e.el;var i=e.children;t&&!t.isInserted&&(t.isInserted=!0,t.inserted&&t.inserted()),$k(i).call(i,function(e){aX(e);});}function sX(e,t){return t.key===e.key&&t.tagName===e.tagName;}function lX(e,t,i){for(var r={},n=t;n<=i;++n){var o=e[n];if(o&&o.data){var a=o.data.key;a&&(r[a]=n);}}return r;}function uX(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t<=i;)cX(e[t]),t+=1;}function cX(e){if(e){var t=e.el,i=e.children;if(function(e,t){var i=e.cpInstance;i&&(i.unbindSelfEvents(),i.unbindGlobalEvents(),i.unbindNativeEvents(),null===(t=i.beforeDestroyed)||void 0===t||t.call(i,e));}(e),t){var r=t.parentElement;r&&r.removeChild(t),t.dvsNode=null,e.el=null;}return function(e){var t=e.cpInstance;t&&t.destroyed&&t.destroyed(e);}(e),e.text=null,e.parent=null,i.length&&$k(i).call(i,function(e){cX(e);}),!0;}return!1;}function hX(e,t,i,r,n){for(var o=document.createDocumentFragment(),a=r;a<=n;a++){var s=i[a];o.appendChild(s.renderDom());}BO(o,t,e);}function dX(e,t){var i,r,n,o;if(e!==t){if((null===(i=e.cpInstance)||void 0===i||null===(r=i.constructor)||void 0===r?void 0:r.name)!==(null===(n=t.cpInstance)||void 0===n||null===(o=n.constructor)||void 0===o?void 0:o.name))return hX(e.parent.el,e.el,[t],0,0),void cX(e);var a=e.el;e.data;var s=e.children,l=e.tagName,u=e.text;t.el=a,a.dvsNode=t;var c,h=t.data,d=t.children,f=t.tagName,v=t.text;if(a.setAttribute)$k(c=eS(h)).call(c,function(e){a instanceof HTMLInputElement&&"value"===e?a.value=h[e]:a.setAttribute(e,h[e]);});l===f&&"TEXT"===f&&u!==v?a.textContent=PO(v):s.length&&d.length?function(e,t,i){for(var r,n=0,o=0,a=t.length-1,s=i.length-1,l=t[n],u=t[a],c=i[o],h=i[s];n<=a&&o<=s;)if(null==l)l=t[n+=1];else if(null==u)u=t[a-=1];else if(null==c)c=i[o+=1];else if(null==h)h=i[s-=1];else if(sX(l,c))dX(l,c),o+=1,l=t[n+=1],c=i[o];else if(sX(u,h))dX(u,h),s-=1,u=t[a-=1],h=i[s];else if(sX(l,h))dX(l,h),DO(l.el,u.el),s-=1,l=t[n+=1],h=i[s];else if(sX(u,c))dX(u,c),BO(u.el,l.el,e),o+=1,u=t[a-=1],c=i[o];else{void 0===r&&(r=lX(t,n,a));var d=r[c.key];if(void 0===d)hX(e,l.el,i,o,o),c=i[o+=1];else{var f=t[d];dX(f,c),BO(f.el,l.el,e),t[d]=null,c=i[o+=1];}}n>a?hX(e,i[s+1]?i[s+1].el:null,i,o,s):o>s&&uX(t,n,a);}(a,s,d):d.length?hX(a,null,d,0,d.length-1):s.length&&uX(s,0,s.length),function(e,t){var i=(e||{}).cpInstance,r=t.cpInstance;i&&(r&&(i.data=r.data,i.injection=Fk(Fk({},i.injection),r.injection)),t.cpInstance=i,i.dvsNode=t,i.updated&&i.updated(t));}(e,t);}}var fX=function(){return Yk(function e(t){Xk(this,e),Wk(this,"el",void 0),Wk(this,"tagName",void 0),Wk(this,"sel",""),Wk(this,"data",void 0),Wk(this,"children",void 0),Wk(this,"text",void 0),Wk(this,"key",void 0),Wk(this,"cpInstance",void 0),Wk(this,"cpOptions",void 0),Wk(this,"inserted",!1),Wk(this,"parent",void 0),this.createVNode(t);},[{key:"renderDom",value:function value(){var e,t;if(this.el)return this.el;var i,r=this.cpInstance;if("FRAGMENT"===this.tagName)i=document.createDocumentFragment();else if("TEXT"===this.tagName){var n=PO(this.text);i=document.createTextNode(n);}else{var o;i=document.createElement("IMAGE"===this.tagName?"IMG":this.tagName);for(var a=0,s=aB(this.data);a<s.length;a++){var l=Ab(s[a],2),u=l[0],c=l[1];if("style"===u){var h=vX(c);for(var d in h)h.hasOwnProperty(d)&&(i.style[d]=h[d]);}else i.setAttribute(u,c);}if(null!==(o=this.data)&&void 0!==o&&o.events)for(var f=0,v=aB(null===(g=this.data)||void 0===g?void 0:g.events);f<v.length;f++){var g,m=Ab(v[f],2),y=m[0],p=m[1];i.addEventListener(y,p);}}return $k(e=this.children).call(e,function(e){var t=e.renderDom();i.appendChild(t);}),i.dvsNode=this,this.el=i,null!=r&&null!==(t=r.updated)&&void 0!==t&&t.call(r,this),function(e,t){var i=e.cpInstance,r=e.el;i&&(i.dvsNode=e,null===(t=i.created)||void 0===t||t.call(i,r));}(this),i;}},{key:"patch",value:function value(e){return function(e,t,i){if(sX(e,t))dX(e,t);else{var r=e.el,n=r.parentNode;null!==n&&(t.el=t.renderDom(),BO(t.el,r,n),uX([e]),e=null);}var o=-1,a=e.parent;return null!=a&&$k(i=a.children).call(i,function(t,i){t===e&&(o=i);}),o>-1&&(a.children[o]=t,t.parent=a,e.el=null),t;}(this,e);}},{key:"destroy",value:function value(){return cX(this);}},{key:"createVNode",value:function value(e){var t=e.tagName,i=e.data,r=void 0===i?{}:i,n=e.children,o=void 0===n?[]:n,a=e.el,s=void 0===a?null:a,l=e.key,u=e.text,c=void 0===u?"":u,h=e.cpOptions,d=e.cpInstance,f=t;r.id&&(f+="#".concat(r.id)),r.class&&(f+=".".concat(r.class)),this.sel=f,this.data=r,this.tagName=t,this.children=o,this.el=s,this.key=l,this.text=c,this.cpInstance=d,this.cpOptions=h;}}]);}();function vX(e){var t=e.split(";"),i={};return $k(t).call(t,function(e){var t,r=zS(e).call(e);if(r){var n=QE(t=r.split(":")).call(t,function(e){return zS(e).call(e);}),o=Ab(n,2),a=o[0],s=o[1],l=a.replace(/-(\w)/g,function(e,t){return t.toUpperCase();});i[l]=s;}}),i;}function gX(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=[],r=[],n=[];return $k(e).call(e,function(e){if("start"===e.type)i.push(e),r.push(n),n=[];else if("text"===e.type)n.push({type:"text",value:e.name,data:e.data});else if(e instanceof fX)n.push(e);else{for(var t=i.pop();t.name!==e.name;)t=i.pop();if(t){var o=t,a=o.name,s=o.cpInstance,l=o.attrs,u={type:"token",tagName:a,cpInstance:s,cpOption:o.cpOption,attrs:l,data:o.data,children:n};$k(n).call(n,function(e){e.parent=u;}),(n=r.pop()).push(u);}}}),t?n[0]:n;}var mX=/'.+'|\\".+\\"|[\w$.]+/g,yX=/{{([^\s@}]+)}}/;function pX(e,t){for(var i=function i(){var i=n[r],o=Ab(i.match(/^(:|@)(.+)/)||[],3),a=o[1],s=o[2];if(!s)return 1;var l=e[i];if(delete e[i],"for"===s){var u,c,h,d=Ab(l.split(" in "),2),f=d[0],v=d[1],g=Ab(f.split(","),2),m=g[0],y=g[1];m=zS(m).call(m),y=null===(u=y)||void 0===u?void 0:zS(u).call(u),v=null===(c=v)||void 0===c?void 0:zS(c).call(c);var p=[],w=vx(h=v.split(".")).call(h,function(e,t){return e[t];},t);if(NN(w))$k(w).call(w,function(e,t){var i={};i[m]=e,y&&(i[y]=t),p.push(i);});else if(ON(w))for(var b=0,k=aB(w);b<k.length;b++){var S=Ab(k[b],2),x=S[0],C=S[1],V={};V[m]=C,y&&(V[y]=x),p.push(V);}e[":for"]=p;}else{var T,I,E=vx(T=l.split(".")).call(T,function(e,t){return null==e?void 0:e[t];},t);if(void 0!==E)"class"===s&&e[s]?e[s]=uS(I="".concat(e[s]," ")).call(I,E):e[s]=E;else{l=l.replace(mX,function(e){if(WI(e).call(e,'"')<0&&WI(e).call(e,"'")<0){var i;if(/^(true|false|\d+|undefined|null)$/.test(e))return e;var r=vx(i=e.split(".")).call(i,function(e,t){return null==e?void 0:e[t];},t);return WR(r);}return e;});try{var P,B=function(e,t){var i=null;try{for(var r=e.split(","),n=0;n<r.length;n++){var o=r[n],a=/(\w+)(\[(\d+)\])?/,s=o.match(a);if(!s){t=null;break;}var l=s[1],u=s[3];if(!Object.prototype.hasOwnProperty.call(t,l)){t=null;break;}t=t[l],void 0!==u&&_k(t)&&(t=t[u]);}i=t;}catch(e){i=null;}return i;}(l,t);QN(B)&&(e[s]=void 0),"class"===s&&e[s]?e[s]=uS(P="".concat(e[s]," ")).call(P,B):e[s]=B;}catch(t){e[s]=void 0;}}"@"===a&&(e.events||(e.events={}),e.events[s]=e[s],delete e["@".concat(s)]);}},r=0,n=eS(e);r<n.length;r++)i();}function wX(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(NN(e)){var i=[];return $k(e).call(e,function(e){i.push.apply(i,Ub(bX(wX(e))));}),i;}if(e instanceof fX)return e;if("token"===e.type){var r,n,o=e.tagName,a=e.attrs,s=e.cpInstance,l=e.children,u=e.data,c=e.cpOption;if(a[":for"])return function(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.attrs,n=e.data,o=JSON.parse(WR(r)),a={":for":r[":for"]};delete r[":for"],pX(a,Fk(Fk({},n),i));var s=[];return $k(t=a[":for"]).call(t,function(t){var i=wX(e,t);s.push.apply(s,Ub(bX(i)));}),e.attrs=o,s;}(e,t);var h,d=Fk(Fk({},u),t),f=Fk({},a);if(pX(a,d),Object.prototype.hasOwnProperty.call(a,"if")&&!a.if)h=null;else if(delete a.if,c)h=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.children,r=e.attrs,n=e.cpOption,o=kX(i,t),a=gX(nX(new(0,n.Component)({data:r,injection:n.injection}),o));return a?bX(wX(a))[0]:null;}(e,t);else{var v=a.key;void 0!==v&&delete a.key;var g=kX(l,t);h=new fX({tagName:o.toUpperCase(),data:a,cpInstance:s,key:v,children:g});}return e.attrs=f,null!==(r=h)&&void 0!==r&&$k(n=r.children).call(n,function(e){e.parent=h;}),h;}return function(e){var t,i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.value,o=null===(t=e.parent)||void 0===t||null===(i=t.attrs)||void 0===i?void 0:i.html;return n=function(e,t){var i=eO(e,yX);return i.length&&$k(i).call(i,function(i){var r,n=vx(r=i[1].split(".")).call(r,function(e,t){return e[t];},t),o=i[0];e=e.replace(o,n);}),e;}(zS(n).call(n),Fk(Fk({},e.data),r)),o?wX(gX(oX(n),!1)):new fX({tagName:"TEXT",text:n});}(e,t);}function bX(e){return e?(NN(e)||(e=[e]),e):[];}function kX(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=[];return $k(e).call(e,function(e){var r=wX(e,t)||[];i.push.apply(i,Ub(bX(r)));}),i;}var SX=function(){return Yk(function e(t){var i=t.data,r=void 0===i?{}:i,n=t.template,o=void 0===n?"":n,a=t.components,s=void 0===a?{}:a,l=t.injection,u=void 0===l?{}:l;Xk(this,e),Wk(this,"template",""),Wk(this,"data",{}),Wk(this,"components",{}),Wk(this,"injection",{}),Wk(this,"isInserted",!1),Wk(this,"emitter",void 0),Wk(this,"uiEmitter",void 0),Wk(this,"viewerEmitter",void 0),Wk(this,"dvsNode",null),Wk(this,"el",void 0),Wk(this,"created",void 0),Wk(this,"inserted",void 0),Wk(this,"updated",void 0),Wk(this,"beforeDestroyed",void 0),Wk(this,"destroyed",void 0),Wk(this,"selfEvents",[]),Wk(this,"globalEvents",[]),Wk(this,"nativeEvents",[]),this.emitter=LO.create(),this.setData(r),this.template=o,this.setComponents(s),this.setInjects(u),this.uiEmitter=this.injection.emitter,this.viewerEmitter=this.injection.viewerEmitter,this.autoBindEvents();},[{key:"parseHTML",value:function value(){return wX(gX(nX(this,[])));}},{key:"setData",value:function value(e){FU(this.data,e);}},{key:"setComponents",value:function value(e){FU(this.components,e);}},{key:"setInjects",value:function value(e){FU(this.injection,e);}},{key:"autoBindEvents",value:function value(){for(var e=this,t=function t(){var t=Ab(r[i],2),n=t[0],o=t[1];e.on(n,function(){o.apply(void 0,arguments);});},i=0,r=aB(this.data.events||{});i<r.length;i++)t();for(var n=function n(){var t=Ab(a[o],2),i=t[0],r=t[1];e.on(i,function(){for(var t,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];jN(r)?e.$emit.apply(e,uS(t=[r]).call(t,n)):GN(r)&&r.apply(void 0,n);});},o=0,a=aB((null===(s=this.data)||void 0===s||null===(l=s.options)||void 0===l?void 0:l.events)||{});o<a.length;o++){var s,l;n();}}},{key:"unbindSelfEvents",value:function value(){var e,t=this;$k(e=this.selfEvents).call(e,function(e){var i=Ab(e,2),r=i[0],n=i[1];t.emitter.off(r,n);}),this.selfEvents=[];}},{key:"unbindGlobalEvents",value:function value(){var e,t=this;$k(e=this.globalEvents).call(e,function(e){var i=Ab(e,2),r=i[0],n=i[1];t.uiEmitter.off(r,n);}),this.globalEvents=[];}},{key:"unbindNativeEvents",value:function value(){var e;$k(e=this.nativeEvents).call(e,function(e){e();}),this.nativeEvents=[];}},{key:"on",value:function value(e,t){this.emitter.on(e,t),this.selfEvents.push([e,t]);}},{key:"emit",value:function value(e){for(var t,i,r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];(t=this.emitter).emit.apply(t,uS(i=[e]).call(i,n));}},{key:"$on",value:function value(e,t){var i;this.uiEmitter&&(null!==(i=this.uiEmitter)&&void 0!==i&&i.on(e,t),this.globalEvents.push([e,t]));}},{key:"$emit",value:function value(e){for(var t,i,r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];null===(t=this.uiEmitter)||void 0===t||t.emit.apply(t,uS(i=[e]).call(i,n));}},{key:"nativeOn",value:function value(e,t,i){var r=function(e,t,i){return e?(e.addEventListener(t,i,void 0),function(){e.removeEventListener(t,i);}):null;}(e,t,i);r&&this.nativeEvents.push(r);}},{key:"reRenderVNode",value:function value(){var e=function(e){return wX(gX(nX(e)));}(this);this.dvsNode.patch(e);}},{key:"query",value:function value(e){var t;return null===(t=this.el)||void 0===t?void 0:t.querySelector(e);}},{key:"queryAll",value:function value(e){var t;return null===(t=this.el)||void 0===t?void 0:t.querySelectorAll(e);}}]);}();Wk(SX,"storeName",void 0),Wk(SX,"hasStore",!1),Wk(SX,"reducer",void 0),Wk(SX,"initState",void 0);var xX=function(){function e(t){Xk(this,e),Wk(this,"container",void 0),Wk(this,"emitter",null),Wk(this,"viewerEmitter",null),Wk(this,"options",void 0),Wk(this,"rootVNode",void 0),Wk(this,"postfix",void 0),Wk(this,"injection",void 0),Wk(this,"data",void 0),Wk(this,"isInserted",!1),Wk(this,"iListeners",[]),Wk(this,"rootDom",void 0),Wk(this,"stores",{});var i=t.container,r=t.injection,n=t.emitter,o=t.postfix,a=t.data;this.viewerEmitter=n,this.emitter=LO.create(),this.postfix=o||"-".concat(rO()),this.options=t,this.injection=r,this.data=a,jN(i)?this.container=document.getElementById(i):"DIV"===(null==i?void 0:i.nodeName)&&(this.container=i),this.initStore(),this.init();}return Yk(e,[{key:"initStore",value:function value(){for(var t=0,i=XR(e.getComponents());t<i.length;t++){var r=i[t];if(!r.hasStore||this.stores[r.storeName]);else{var n=JY.create(r.reducer,r.initState);this.stores[r.storeName]=n;}}}},{key:"init",value:function value(){var t=new SX({data:this.options.uiConfig,template:'<Root :options="root"></Root>',components:e.getComponents(),injection:Fk(Fk({},this.injection),{},{components:e.getComponents(),postfix:this.postfix,emitter:this.emitter,viewerEmitter:this.viewerEmitter,stores:this.stores,i18n:this.options.uiConfig.i18n})}).parseHTML(),i=t.renderDom();this.rootVNode=t,this.rootDom=i,this.container&&(this.container.appendChild(i),aX(t),this.isInserted=!0);}},{key:"bindContainer",value:function value(e){this.container=e,e.appendChild(this.rootDom),this.isInserted||aX(this.rootVNode);}},{key:"unbindContainer",value:function value(){for(var e=0;e<this.container.children.length;e++)if(this.container.children[e]===this.rootDom)return void this.container.removeChild(this.rootDom);}},{key:"queryByDataId",value:function value(e){var t;return null===(t=this.rootDom)||void 0===t?void 0:t.querySelector("[data-id=".concat(e,"]"));}},{key:"queryAllByDataId",value:function value(e){var t;return null===(t=this.rootDom)||void 0===t?void 0:t.querySelectorAll("[data-id=".concat(e,"]"));}},{key:"on",value:function value(e,t){var i=this.emitter.on(e,t);this.iListeners.push(i);}},{key:"emit",value:function value(e){for(var t,i,r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];(t=this.emitter).emit.apply(t,uS(i=[e]).call(i,n));}},{key:"off",value:function value(e,t){this.emitter.off(e,t);}},{key:"unbindEvents",value:function value(){var e,t=this;$k(e=this.iListeners).call(e,function(e){var i=e.name,r=e.fn,n=e.context,o=e.once;t.emitter.off(i,r,n,o);});}},{key:"destroy",value:function value(){this.unbindEvents();}}],[{key:"registerComponent",value:function value(){for(var t=0,i=aB(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});t<i.length;t++){var r=Ab(i[t],2),n=r[0],o=r[1];if(e.isAlreadyRegistered(n))return;this.components[n]=o;}}},{key:"isAlreadyRegistered",value:function value(e){return!!this.components[e];}},{key:"getComponents",value:function value(){return this.components;}}]);}();Wk(xX,"components",{});var CX=function CX(e,t,i,r){var n,o,a=e||{},s=a.id,l=a.title,u=a.dataId,c=a.style,h=a.className,d=function(e){var t="";if(e)for(var i=0,r=aB(e);i<r.length;i++){var n,o=Ab(r[i],2),a=o[0],s=o[1];t+=uS(n="".concat(zN(a),":")).call(n,s,";");}return t;}(c);return(HN(s)?"":' id="'.concat(s,'"'))+uS(n=uS(o=' class="'.concat(t)).call(o,null!=i?i:""," ")).call(n,h||"",'"')+(HN(r)?"":' :class="'.concat(r,'"'))+(d?' style="'.concat(d,'"'):"")+(HN(l)?"":' title="'.concat(l,'"'))+(HN(u)?"":' data-id="'.concat(u,'"'));},VX=function VX(e,t){var i,r,n,o=(null===(i=t)||void 0===i?void 0:i.className)||"";return tO(e=e||{},t=t||{}),t.className=uS(r="".concat(o," ")).call(r,(null===(n=t)||void 0===n?void 0:n.className)||""),t;},TX=function(e){function t(e){var i;if(Xk(this,t),Wk(Pw(i=IN(this,t,[e])),"status",!1),Wk(Pw(i),"store",void 0),Wk(Pw(i),"unsubscribe",void 0),Wk(Pw(i),"created",function(e){i.el=e,i.initEvent(),i.$on("setButtonClass",function(e,t){e===i.data.options.name&&(i.el.className="dvs-btn ".concat(t));});}),Wk(Pw(i),"updated",function(){}),Wk(Pw(i),"destroyed",function(){var e,t;i.data.options.selectable&&(null===(e=(t=i).unsubscribe)||void 0===e||e.call(t));}),i.data.options.selectable){var r;i.store=i.injection.stores[t.storeName];var n=i.store.getState();i.setData({isSelect:WI(r=n.select).call(r,i.data.options.dataId)>-1}),i.unsubscribe=i.store.subscribe(function(){var e=i.data.options.dataId,t=i.store.getState(),r=t.select,n=t.unselect;WI(r).call(r,e)>-1&&!i.data.isSelect?(i.data.isSelect=!0,i.reRenderVNode()):WI(n).call(n,e)>-1&&i.data.isSelect&&(i.data.isSelect=!1,i.reRenderVNode());});}return i.initTemplate(),i;}return Mb(t,e),Yk(t,[{key:"initEvent",value:function value(){var e=this,t=this.data.options.events;if(t)for(var i=function i(){var t=Ab(n[r],2),i=t[0],o=t[1];e.el.addEventListener(i,function(t){e.uiEmitter.emit(o,t,e);});},r=0,n=aB(t);r<n.length;r++)i();}},{key:"initNativeEvent",value:function value(){var e,t=this,i=this.el,r=this.data.options;$k(e=eS(r.events||{})).call(e,function(e){t.nativeOn(i,e,function(i){t.emit(e,i,t);});});}},{key:"initTemplate",value:function value(){var e,t=this.data.options,i=t.selectable?"isSelect?'dvs-selected':''":void 0,r=CX(t,"dvs-btn","",i);this.template=uS(e="<div ".concat(r," >")).call(e,HN(t.label)?"":t.label,"<slot></slot></div>");}}]);}(SX);Wk(TX,"hasStore",!0),Wk(TX,"storeName","button"),Wk(TX,"reducer",function(e,t){var i,r,n,o;switch(e||(e={select:[],unselect:[]}),t.type){case"setButton":return $k(i=t.select).call(i,function(t){var i,r,n=PE(i=e.unselect).call(i,function(e){return e===t;});mE(r=e.unselect).call(r,n,1);}),$k(r=t.unselect).call(r,function(t){var i,r,n=PE(i=e.select).call(i,function(e){return e===t;});mE(r=e.select).call(r,n,1);}),e.select=Ub(new UA(uS(n=[]).call(n,Ub(e.select),Ub(t.select)))),e.unselect=Ub(new UA(uS(o=[]).call(o,Ub(e.unselect),Ub(t.unselect)))),Fk({},e);case"select":return Fk(Fk({},e),{},{select:t.select});case"unselect":return Fk(Fk({},e),{},{unselect:t.unselect});default:return e;}});var IX=function(e){function t(e){var i;return Xk(this,t),Wk(Pw(i=IN(this,t,[e])),"startScroll",!1),Wk(Pw(i),"allowScroll",!1),Wk(Pw(i),"startInfo",void 0),Wk(Pw(i),"created",function(e){i.el=e,i.allowScroll&&(i.addButtonScroll(),i.addResizeEvent());}),Wk(Pw(i),"inserted",function(){i.updateShowMore();}),i.initTemplate(),i;}return Mb(t,e),Yk(t,[{key:"initTemplate",value:function value(){var e=this.data.options;e.style,e.id,e.className;var t=e.children;this.injection;var i="<div ".concat(CX(this.data.options,"dvs-group",""),">");t&&$k(t).call(t,function(e,t){var r,n,o=e.enable,a=e.type;!1!==o&&(zS(a).call(a),i+=uS(r=uS(n="<".concat(a,' :options="options.children.')).call(n,t,'"></')).call(r,a,">"));}),i+="</div>",this.template=i;}},{key:"addButtonScroll",value:function value(){var e=this,t=this.el;t.onmousedown=function(i){return!(i.button&&0!==i.button||t.scrollWidth<=t.clientWidth&&t.scrollHeight<=t.clientHeight||(e.startScroll=!0,e.startInfo={x:i.clientX,y:i.clientY,left:t.scrollLeft,top:t.scrollTop},0));},t.onmousemove=function(i){if(!e.startScroll)return!1;var r=e.startInfo,n=r.x,o=r.y,a=r.left,s=r.top,l=i.clientX-n,u=i.clientY-o;return(Math.abs(l)>5||Math.abs(u)>5)&&(t.scrollLeft=a-l,t.scrollTop=s-u),e.updateShowMore(),!0;},this.nativeOn(document.body,"mouseup",function(){e.startScroll=!1;});var i=t.querySelector(".dvs-showBefore");i&&(i.onclick=function(){t.scrollLeft=0,e.updateShowMore();});var r=t.querySelector(".dvs-showAfter");r&&(r.onclick=function(){t.scrollLeft=t.scrollWidth,e.updateShowMore();});}},{key:"updateShowMore",value:function value(){var e=this.el,t=e.clientWidth,i=e.scrollWidth,r=e.scrollLeft,n=e.querySelector(".dvs-showBefore");n&&(n.classList[r>5&&t>40?"remove":"add"]("dvs-display-none"),n.style.transform="translate3d(".concat(r,"px,0,0)"));var o=e.querySelector(".dvs-showAfter");o&&(o.classList[r+t<i-5&&t>40?"remove":"add"]("dvs-display-none"),o.style.transform="translate3d(".concat(r,"px,0,0)"));}},{key:"addResizeEvent",value:function value(){var e=this;this.nativeOn(window,"resize",function(){e.updateShowMore();});}}]);}(SX),EX=function(e){function t(e){var i;return Xk(this,t),Wk(Pw(i=IN(this,t,[e])),"created",function(e){i.el=e;}),Wk(Pw(i),"inserted",function(){i.injection.viewer.context.uiService.bindContainer(i.el);}),i.initTemplate(),i;}return Mb(t,e),Yk(t,[{key:"initTemplate",value:function value(){var e="<div ".concat(CX(this.data.options,"dvs-main-canvas","")," ><slot></slot></div>");this.template=e;}}]);}(SX);var PX=function(e){function t(e){var i;return Xk(this,t),Wk(Pw(i=IN(this,t,[e])),"current",0),Wk(Pw(i),"total",0),Wk(Pw(i),"store",void 0),Wk(Pw(i),"unsubscribe",void 0),Wk(Pw(i),"prefix","dvs-pagination-"),Wk(Pw(i),"created",function(e){i.el=e,i.updateStyle(),i.initEvent();}),Wk(Pw(i),"updated",function(){i.updateStyle();}),Wk(Pw(i),"destroyed",function(){var e,t;null===(e=(t=i).unsubscribe)||void 0===e||e.call(t);}),i.data.firstPage=VX(i.data.options.firstPage,{className:i.getClassName("first-page")}),i.data.prevPage=VX(i.data.options.prevPage,{className:i.getClassName("prev-page")}),i.data.nextPage=VX(i.data.options.nextPage,{className:i.getClassName("next-page")}),i.data.lastPage=VX(i.data.options.lastPage,{className:i.getClassName("last-page")}),i.data.gotoPage=e.gotoPage||{},i.data.total=e.total||{},i.data.separator=e.separator||{},i.store=i.injection.stores[t.storeName],i.unsubscribe=i.store.subscribe(function(){i.initDataFromStore(),i.reRenderVNode();}),i.initDataFromStore(),i.initTemplate(),i;}return Mb(t,e),Yk(t,[{key:"getClassName",value:function value(e){var t,i,r=this.prefix;return uS(t=uS(i="".concat(r,"iconfont dvs-icon-")).call(i,e," ")).call(t,r+e);}},{key:"initDataFromStore",value:function value(){this.setData({pageDetails:Fk(Fk({},this.store.getState()),{},{current:this.store.getState().current+1})});}},{key:"updateStyle",value:function value(){if(this.el){var e=this.data.pageDetails,t=e.current,i=e.total,r=this.prefix,n=this.query(".".concat(r,"first-page")),o=this.query(".".concat(r,"prev-page")),a=this.query(".".concat(r,"next-page")),s=this.query(".".concat(r,"last-page"));1===t||0===i?(this.disable(n),this.disable(o)):(this.enable(n),this.enable(o)),t===i||0===i?(this.disable(a),this.disable(s)):(this.enable(a),this.enable(s));}}},{key:"disable",value:function value(e){var t="".concat(this.prefix,"disable");e.classList.contains(t)||e.classList.add(t);}},{key:"enable",value:function value(e){var t="".concat(this.prefix,"disable");e.classList.contains(t)&&e.classList.remove(t);}},{key:"initEvent",value:function value(){var e=this,t=this.prefix,i=this.query(".".concat(t,"first-page")),r=this.query(".".concat(t,"prev-page")),n=this.query(".".concat(t,"next-page")),o=this.query(".".concat(t,"last-page")),a=this.query(".".concat(t,"goto"));this.nativeOn(i,"click",function(){var t=e.data.pageDetails,i=t.current,r=t.total;1!==i&&r>1&&(e.store.dispatch({type:"firstPage"}),e.emit("change",e.data.pageDetails));}),this.nativeOn(r,"click",function(){var t=e.data.pageDetails,i=t.current,r=t.total;1!==i&&r>1&&(e.store.dispatch({type:"previousPage"}),e.emit("change",e.data.pageDetails));}),this.nativeOn(n,"click",function(){var t=e.data.pageDetails,i=t.current,r=t.total;i!==r&&r>1&&(e.store.dispatch({type:"nextPage"}),e.emit("change",e.data.pageDetails));}),this.nativeOn(o,"click",function(){var t=e.data.pageDetails,i=t.current,r=t.total;i!==r&&r>1&&(e.store.dispatch({type:"lastPage"}),e.emit("change",e.data.pageDetails));}),this.nativeOn(a,"input",function(e){a.value=e.target.value.replace(/[^\d]/g,"");}),this.nativeOn(a,"keyup",function(t){if("Enter"===t.key){var i=e.data.pageDetails.total,r=$S(a.value,10);r=nO(r,1,i),a.value=String(r),0!==i&&(e.store.dispatch({type:"gotoPage",current:r-1}),e.emit("change",e.data.pageDetails));}});}},{key:"initTemplate",value:function value(){var e,t,i,r=this.data.options,n=r.gotoPage,o=r.total,a=r.separator;this.injection;var s="dvs-pagination",l=uS(e=uS(t=uS(i="<div ".concat(CX(this.data.options,s,""),'><Button :options="firstPage"></Button><Button :options="prevPage"></Button><input ')).call(i,CX(n,s,"-goto"),' :value="pageDetails.current" :title="pageDetails.current"><div ')).call(t,CX(a,s,"-separator"),"></div><span ")).call(e,CX(o,s,"-total"),' :title="pageDetails.total">{{pageDetails.total}}</span><Button :options="nextPage"></Button><Button :options="lastPage"></Button></div>');this.template=l;}}]);}(SX);Wk(PX,"hasStore",!0),Wk(PX,"storeName","pagination"),Wk(PX,"reducer",function(e,t){switch(e||(e={current:-1,total:0}),t.type){case"setPageNumber":return Fk(Fk({},e),t.pageDetails);case"firstPage":return Fk(Fk({},e),{},{current:0});case"lastPage":return Fk(Fk({},e),{},{current:e.total-1});case"nextPage":return Fk(Fk({},e),{},{current:e.current+1});case"previousPage":return Fk(Fk({},e),{},{current:e.current-1});case"gotoPage":return Fk(Fk({},e),{},{current:t.current});default:return e;}});var BX=function(e){function t(e){var i;Xk(this,t),Wk(Pw(i=IN(this,t,[e])),"postfix",""),Wk(Pw(i),"created",function(e){i.el=e,i.initNativeEvent();}),e.template&&(i.template=e.template);var r=i.injection,n=r.emitter,o=r.postfix;return i.uiEmitter=n,i.emitter=n,i.postfix=o,i.initTemplate(),i;}return Mb(t,e),Yk(t,[{key:"initTemplate",value:function value(){var e=this.data.options.children,t="<div ".concat(CX(this.data.options,"dvs-root","")," >");e&&$k(e).call(e,function(e,i){var r,n,o=e.enable,a=e.type;!1!==o&&(t+=uS(r=uS(n="<".concat(a,' :options="options.children.')).call(n,i,'"></')).call(r,a,">"));}),t+="</div>",this.template=t;}},{key:"initNativeEvent",value:function value(){}}]);}(SX),DX={name:"dvsUi",install:function install(e){for(var t=e.getClassStore(),i=t.Viewer,r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];t.Viewer=function(e,t,i){var r=Ab(t,1)[0];return i=function(e){function t(e){var i;return Xk(this,t),Wk(Pw(i=IN(this,t,[e])),"ui",void 0),Wk(Pw(i),"uiConfig",void 0),Wk(Pw(i),"bindPostfix",!0),i.uiConfig=tO(e.uiConfig||{root:{}},_LN(r||{})),n(i.uiConfig.root,i.context.postfix),xX.registerComponent({Group:IX,Button:TX,Root:BX,MainCanvas:EX,Pagination:PX}),i.ui=new xX({container:e.container,emitter:i.context.emitter,postfix:i.context.postfix,uiConfig:i.uiConfig,injection:{viewer:Pw(i)}}),i.context.uiService.rootDom=i.ui.rootDom,i.bindContainer(e.container),i.context.hooksService.hooks.destroy.on(function(){i.ui.unbindContainer();}),i.initEvent(),i;}return Mb(t,e),Yk(t,[{key:"width",get:function get(){var e=getComputedStyle(this.rootDom).width.match(/\d+/);if(!e)return 0;var t=Ab(e,1)[0];return $S(t,10);},set:function set(e){this.uiConfig.root.style.width=e,e=String(e),/\d+$/.test(e)&&(e="".concat(e,"px")),this.rootDom.style.width="".concat(e),this.externalResized();}},{key:"height",get:function get(){var e=getComputedStyle(this.rootDom).height.match(/\d+/);if(!e)return 0;var t=Ab(e,1)[0];return $S(t,10);},set:function set(e){this.uiConfig.root.style.height=e,e=String(e),/\d+$/.test(e)&&(e="".concat(e,"px")),this.rootDom.style.height="".concat(e),this.externalResized();}},{key:"setButtonClass",value:function value(e,t){this.ui.emit("setButtonClass",e,t);}},{key:"updateUiConfig",value:function value(e){return!0;}},{key:"bindContainer",value:function value(e){if(!e)return!1;var t=e;return jN(e)&&(t=document.querySelector("#".concat(e))),this.ui.bindContainer(t),this.context.uiService.container=t,this.context.uiService.rootDom=this.ui.rootDom,this.getViewerConfig().show||(this.context.uiService.rootDom.style.display="none"),this.context.uiService.isBindContainer=!0,this.resized(),!0;}},{key:"initEvent",value:function value(){var e=this;this.context.hooksService.hooks.pageChanged.on(function(t){var i,r;null===(i=e.ui)||void 0===i||null===(r=i.stores[PX.storeName])||void 0===r||r.dispatch({type:"setPageNumber",pageDetails:t});});}}]);}(e),Wk(i,"use",e.use),i;function n(e,t){if(ON(e)){HN(e.id)||(e.id+=t);for(var i=0,r=aB(e);i<r.length;i++){var o=Ab(r[i],2);o[0],n(o[1],t);}}else NN(e)&&$k(e).call(e,function(e){n(e,t);});}}(i,n);}},MX=function(){return Yk(function e(){Xk(this,e);},[{key:"init",value:function value(e){var t=e.dvsContext.hooksService.hooks.overlay,i=function i(t){var i=t.uids,r=t.left,n=t.top,o=t.width,a=t.height,s=t.tabUid;t.trigger;var l=t.color,u=t.opacity,c=t.overlayUid,h=e.getTab(s);h&&($k(i).call(i,function(e){var t=h.getChildByUid(e);if(t){var i=new oH({id:c,style:{points:[{x:r,y:n},{x:r+o,y:n},{x:r+o,y:n+a},{x:r,y:n+a}],background:l,borderWidth:0,opacity:u}});t.overlays.appendChild(i),t.clearOptimization();}}),e.tabService.isCurrentTab(s)&&(e.showTab(h),e.renderOnly()));},r=function r(t){var i,r=t.tabNode;$k(i=r.childNodes).call(i,function(t){var i=e.getStatus(t.uid);if(i&&t.isVisible){var r,n,o;$k(r=NI(n=t.overlays.childNodes).call(n)).call(r,function(e){t.overlays.removeChild(e);});var a=i.imageScale;$k(o=i.overlays).call(o,function(i){i.uids;var r=i.left,n=i.top,o=i.width,s=i.height;i.tabUid,i.trigger;var l=i.color,u=i.opacity,c=i.overlayUid;"multiple"===e.config.displayMode&&e.config.useMinImage&&(r/=a,n/=a,o/=a,s/=a);var h=new oH({id:c,style:{points:[{x:r,y:n},{x:r+o,y:n},{x:r+o,y:n+s},{x:r,y:n+s}],background:l,borderWidth:0,opacity:u}});t.overlays.appendChild(h);});}});};e.layoutService.hooks.beforeLayout.on(r),t.on(i),e.hooksService.hooks.destroy.on(function(){t.off(i),e.layoutService.hooks.beforeLayout.off(r);});}}]);}(),AX={name:"dvsDWT",install:function install(e){var t=e.getClassStore(),i=t.Viewer;if(i){var r=function(e,t){return t=function(e){function t(e){var i;return Xk(this,t),Wk(i=IN(this,t,[e]),"imageSize",void 0),Wk(i,"loadingVideoImage",!1),Wk(i,"nextVideoImageUrl",void 0),i.context.configService.registerHandler("showVideoContainer",function(e,t){e.config.showVideoContainer=t;var i=document.querySelector("#dvs-video-container".concat(e.postfix));i&&(t?(i.style.display="flex",i.firstChild.style.display="inline",e.uiService.canvasAndScrollContainer.style.display="none"):(i.style.display="none",i.firstChild.style.display="none",e.uiService.canvasAndScrollContainer.style.display="flex",e.resized()));}),i;}return Mb(t,e),Yk(t,[{key:"dwtWidth",get:function get(){return this.width;},set:function set(e){this.width=e,this.emit("dwtResize",this.width,this.height);}},{key:"dwtHeight",get:function get(){return this.height;},set:function set(e){this.height=e,this.emit("dwtResize",this.width,this.height);}},{key:"dwtRender",value:function value(){var e=this,t=this.render();if(t&&"single"===this.context.config.displayMode){var i=this.getCurrentIndex();this.emit("pageRendered",i);}if(t&&"multiple"===this.context.config.displayMode){var r,n=this.getCurrentTab();n&&$k(r=n.children).call(r,function(t,i){t.isVisible&&e.emit("pageRendered",i);});}return t;}},{key:"updateVideoImage",value:function value(e){var t=this;if(!this.getViewerConfig().showVideoContainer)return!1;if(this.loadingVideoImage)return this.nextVideoImageUrl=e,!1;this.loadingVideoImage=!0;var i=document.querySelector("#dvs-video-image".concat(this.postfix));if(i.times?i.times++:i.times=1,i){i.src=e,i.setAttribute("loaded","");var r=YP(function(){var r=i.getAttribute("loaded");if("true"==r||"false"==r);else{if(i.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsIAAA7CARUoSoAAAAANSURBVBhXY/j///9/AAn7A/0FQ0XKAAAAAElFTkSuQmCC",t.loadingVideoImage=!1,t.nextVideoImageUrl){i.times=0;var n=t.nextVideoImageUrl;return t.nextVideoImageUrl=null,void t.updateVideoImage(n);}if(i.times<4&&i.times>0)return void YP(function(){t.updateVideoImage(e);},300);}},1e3);i.onload=function(){if(i.times=0,t.loadingVideoImage=!1,i.setAttribute("loaded","true"),clearTimeout(r),t.nextVideoImageUrl){var e=t.nextVideoImageUrl;return t.nextVideoImageUrl=null,void t.updateVideoImage(e);}var n=i.naturalWidth,o=i.naturalHeight,a=i.clientWidth,s=i.clientHeight,l=t.imageSize;l&&l.naturalWidth===n&&l.naturalHeight===o&&l.clientWidth===a&&l.clientHeight===s||(t.imageSize={naturalWidth:n,naturalHeight:o,clientWidth:a,clientHeight:s},t.updateVideoSize());},i.onerror=i.onabort=function(){if(i.times=0,t.loadingVideoImage=!1,i.setAttribute("loaded","false"),clearTimeout(r),t.nextVideoImageUrl){var e=t.nextVideoImageUrl;return t.nextVideoImageUrl=null,void t.updateVideoImage(e);}};}else this.loadingVideoImage=!1;return!0;}},{key:"updateVideoSize",value:function value(){if(this.imageSize&&this.getViewerConfig().showVideoContainer){var e=document.querySelector("#dvs-video-container".concat(this.postfix)),t=document.querySelector("#dvs-video-image".concat(this.postfix)),i=e.clientWidth,r=e.clientHeight,n=this.imageSize,o=n.naturalWidth,a=n.naturalHeight,s=o,l=a;o/a>=i/r?(s=i,l=a*(i/o)):(l=r,s=o*(r/a)),t.style.width="".concat(s,"px"),t.style.height="".concat(l,"px"),this.imageSize.clientWidth=t.clientWidth,this.imageSize.clientHeight=t.clientHeight;}}},{key:"overlayRectangle",value:function value(e,t,i,r,n){var o=this,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"#000",s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;if(!AF(this,e=MF(this,e)))return!1;var l=this.getCurrentTab(),u=QE(e).call(e,function(e){return l.getUidByIndex(e);}),c={tabUid:l.uid,tabType:l.type,trigger:this.uid,uids:u,left:t,top:i,width:r,height:n,color:a,opacity:s,overlayUid:rO()};return $k(u).call(u,function(e){o.context.getStatus(e).overlays.push(Fk({},c));}),this.context.dvsContext.hooksService.hooks.overlay.emit(c),!0;}},{key:"getCurrentPageUids",value:function value(){var e,t=this.getCurrentTab();return t?QE(e=t.children).call(e,function(e){return e.uid;}):[];}},{key:"getCurrentPageCounts",value:function value(){var e=this.getCurrentTab();return(null==e?void 0:e.total)||0;}}]);}(e),Wk(t,"use",e.use),t;}(i);r.use(new MX()),t.Viewer=r;}}},UX=function(){return Yk(function e(t){Xk(this,e),Wk(this,"context",void 0),Wk(this,"outer",void 0),Wk(this,"inner",void 0),Wk(this,"original",void 0),Wk(this,"matrixes",void 0),Wk(this,"blanks",[]),Wk(this,"overlays",[]),this.context=t;},[{key:"handle",value:function value(e){var t,i=this;this.outer=new eH(),this.inner=new eH(),this.outer.appendChild(this.inner),this.original=this.inner,this.matrixes=[],this.blanks=[],this.overlays=[];var r=e.operations,n=e.width,o=e.height,a=e.blanks,s=n,l=o;return this.inner.updateStyle({x:0,y:0,width:n,height:o}),this.outer.updateStyle({width:n,height:o}),r&&$k(r).call(r,function(e){if("r"===e.type){var t=i.rotate(e,s,l),r=t.rWidth,n=t.rHeight;s=r,l=n;}else if("c"===e.type){var o=i.crop(e),u=o.width,c=o.height;s=u,l=c;}else if("f"===e.type)i.flip(e);else if("z"===e.type){var h=i.resize(e,s,l),d=h.rWidth,f=h.rHeight;s=d,l=f;}else"e"===e.type&&i.erase(e,a);}),{width:s,height:l,matrixes:NI(t=this.matrixes).call(t),blanks:this.blanks};}},{key:"erase",value:function value(e,t){var i,r=this;$k(i=e.detail).call(i,function(e){var t,i=e.left,n=e.top,o=e.width,a=e.height,s=r.original.getWorldTransform().clone().invertSelf(),l=QE(t=[[i,n],[i+o,n],[i+o,n+a],[i,n+a]]).call(t,function(e){var t=Ab(e,2),i=t[0],r=t[1];return s.transformPoint({x:i,y:r,z:0});});r.blanks.push({uid:e.eraseUid,points:l,background:e.color});});}},{key:"resize",value:function value(e,t,i){var r=e.detail[e.detail.length-1];r||console.error("resize operation is empty");var n=r.width,o=r.height,a=n/t,s=o/i,l=(n-t)/2,u=(o-i)/2,c=new eH();c.updateStyle({x:0,y:0,width:n,height:o}),c.appendChild(this.outer),this.inner=this.outer,this.outer=c,this.inner.scale(a,s,1);var h=this.inner.getPosition(),d=h.x,f=h.y;this.inner.setPosition({x:d+l,y:f+u,z:0});var v=this.inner.getLocalTransform();return this.matrixes.push(v),{rWidth:n,rHeight:o};}},{key:"flip",value:function value(e){var t,i=[1,1,1];$k(t=e.detail).call(t,function(e){"v"===e.dir?(i[1]*=-1,i[2]*=-1):"h"===e.dir&&(i[0]*=-1,i[2]*=-1);});var r=new eH();r.updateStyle({x:0,y:0,width:this.outer.width,height:this.outer.height}),r.appendChild(this.outer),this.outer.scale(i[0],i[1],i[2]),this.inner=this.outer,this.outer=r;var n=this.inner.getLocalTransform();this.matrixes.push(n);}},{key:"crop",value:function value(e){var t,i=null;if($k(t=e.detail).call(t,function(e){var t=e.left,r=e.top,n=e.width,o=e.height;if(i){var a=i.getRect(),s=a.left,l=a.top,u=new hH(t+s,t+s+n,r+l,r+l+o);i=i.intersection(u);}else i=new hH(t,t+n,r,r+o);}),!i)return console.error("there is no crop operation"),{width:0,height:0};var r=i.getRect(),n=new eH();n.updateStyle({x:0,y:0,width:r.width,height:r.height}),n.appendChild(this.outer),this.inner=this.outer,this.outer=n;var o=this.inner.getPosition(),a=o.x,s=o.y;this.inner.setPosition({x:a-r.left,y:s-r.top,z:0});var l=this.inner.getLocalTransform();return this.matrixes.push(l),i.getRect();}},{key:"rotate",value:function value(e,t,i){var r,n=this,o=null,a=0;if($k(r=e.detail).call(r,function(e){if(null===o&&(o=e.type),e.type===o)a+=e.angle;else{var r=n.executeRotate(o,a,t,i),s=r.width,l=r.height;t=s,i=l,o=e.type,a=e.angle;}}),o){var s=this.executeRotate(o,a,t,i),l=s.width,u=s.height;t=l,i=u;}return{rWidth:t,rHeight:i};}},{key:"rotateInContainMode",value:function value(e,t,i){var r=function(e,t,i,r,n,o,a){var s=0+i/2,l=0+r/2,u=fL(0,0,s,l,n),c=fL(0+i,0,s,l,n),h=fL(0+i,0+r,s,l,n),d=fL(0,0+r,s,l,n),f=xz(o=[c.x,u.x,d.x,h.x]).call(o,function(e,t){return e-t;}),v=xz(a=[c.y,u.y,d.y,h.y]).call(a,function(e,t){return e-t;});return{x:f[0],y:v[0],width:f[3]-f[0],height:v[3]-v[0]};}(0,0,t,i,FO(e)),n=r.width,o=r.height,a=(n-t)/2,s=(o-i)/2;t=n,i=o;var l=new eH();l.updateStyle({x:0,y:0,width:n,height:o}),l.appendChild(this.outer),this.outer.rotateLocal(e),this.inner=this.outer,this.outer=l;var u=this.inner.getPosition(),c=u.x,h=u.y;this.inner.setPosition({x:c+a,y:h+s,z:0});var d=this.inner.getLocalTransform();return this.matrixes.push(d),{rWidth:n,rHeight:o};}},{key:"executeRotate",value:function value(e,t,i,r){if("clip"===e){var n=new eH();n.updateStyle({x:0,y:0,width:i,height:r}),n.appendChild(this.outer),this.outer.rotateLocal(t),this.inner=this.outer,this.outer=n;var o=this.inner.getLocalTransform();this.matrixes.push(o);}else if("contain"===e){var a=this.rotateInContainMode(t,i,r);i=a.rWidth,r=a.rHeight;}return{width:i,height:r};}},{key:"toMinImageOperations",value:function value(e,t){var i=[];return $k(e).call(e,function(e){var r,n,o,a={type:e.type,detail:[]};i.push(a),"c"===e.type||"e"===e.type?$k(r=e.detail).call(r,function(e){var i=Fk(Fk({},e),{},{left:e.left/t,top:e.top/t,width:e.width/t,height:e.height/t});a.detail.push(i);}):"f"===e.type||"r"===e.type?$k(n=e.detail).call(n,function(e){var t=Fk({},e);a.detail.push(t);}):"z"===e.type&&$k(o=e.detail).call(o,function(e){var i=Fk(Fk({},e),{},{width:e.width/t,height:e.height/t});a.detail.push(i);});}),i;}}]);}(),zX=function(e){function t(e,i){var r;return Xk(this,t),Wk(Pw(r=IN(this,t)),"uid",void 0),Wk(Pw(r),"context",void 0),Wk(Pw(r),"action",void 0),Wk(Pw(r),"tabUid",void 0),r.context=e,r.action=i,r.uid=i.commandUid,r.tabUid=i.tabUid,r;}return Mb(t,e),Yk(t,[{key:"execute",value:function value(){}},{key:"undo",value:function value(){this.context.removeActionFromStatus(this.action);}}]);}(OF),RX=function(e){function t(){return Xk(this,t),IN(this,t,arguments);}return Mb(t,e),Yk(t);}(zX),NX=function(e){function t(){return Xk(this,t),IN(this,t,arguments);}return Mb(t,e),Yk(t);}(zX),OX=function(e){function t(){return Xk(this,t),IN(this,t,arguments);}return Mb(t,e),Yk(t,[{key:"execute",value:function value(){var e=this.action,t=e.left,i=e.top,r=e.width,n=e.height,o=e.color,a=e.uids,s=e.eraseUid,l=this.context.getTab(this.tabUid);l&&$k(a).call(a,function(e){var a=l.getChildByUid(e);if(a){var u=new oH({id:s,style:{points:[{x:t,y:i},{x:t+r,y:i},{x:t+r,y:i+n},{x:t,y:i+n}],background:o,borderWidth:0}});a.blanks.appendChild(u);}});}},{key:"undo",value:function value(){var e,t=this;this.context.removeActionFromStatus(this.action);var i=this.context.getTab(this.tabUid);i&&$k(e=this.action.uids).call(e,function(e){var r=i.getChildByUid(e);if(r){var n,o=CP(n=r.blanks.children).call(n,function(e){return e.id===t.action.eraseUid;});o&&r.blanks.removeChild(o);}});}}]);}(zX),LX=function(e){function t(){return Xk(this,t),IN(this,t,arguments);}return Mb(t,e),Yk(t);}(zX),WX=function(e){function t(){return Xk(this,t),IN(this,t,arguments);}return Mb(t,e),Yk(t);}(zX),HX=function(){return Yk(function e(){Xk(this,e);},[{key:"init",value:function value(e){var t=e.getGlobalHooks(),i=t.rotate,r=t.flip,n=t.crop,o=t.erase,a=t.changeSize,s=t.reset,l=function l(t){var i;$k(i=e.getAllTabs()).call(i,function(i){var r;if(LF(t,i)){var n,o=null;switch($k(n=(t=_LN(t)).uids).call(n,function(e){var t=i.getChildByUid(e);t.isEdited=!0,t&&t.clearOptimization();}),t.actionType){case"r":(Math.abs(t.angle)%90||"clip"===t.type)&&$k(r=t.uids).call(r,function(t){var r=i.getChildByUid(t);r&&(r.imageContainer.updateStyle({background:e.config.blankFillColor}),e.getStatus(r.uid).useFillColor=!0);}),o=new WX(e,t);break;case"f":o=new LX(e,t);break;case"c":o=new NX(e,t);break;case"e":o=new OX(e,t);break;case"z":o=new RX(e,t);}i.commandController.execute(o),e.tabService.isCurrentTab(i.uid)&&e.render();}});},u=function u(t){var i,r=t.uids;$k(i=e.getAllTabs()).call(i,function(i){LF(t,i)&&($k(r).call(r,function(e){var t,r,n=i.getChildByUid(e);n.isEdited=!0,n&&$k(t=NI(r=n.blanks.childNodes).call(r)).call(t,function(e){n.blanks.removeChild(e);});}),e.tabService.isCurrentTab(i.uid)&&e.render());});};e.layoutService.hooks.beforeLayout.on(function(t){var i,r=t.tabNode;$k(i=r.childNodes).call(i,function(t){var i=e.getStatus(t.uid);if(i&&t.isVisible&&t.isLoaded&&t.image.style.img){var r,n,o,a={operations:i.operations,width:(null===(r=t.image.style.img)||void 0===r?void 0:r.naturalWidth)||0,height:(null===(n=t.image.style.img)||void 0===n?void 0:n.naturalHeight)||0,blanks:QE(o=t.blanks.children).call(o,function(e){return e.id;})};"multiple"===e.config.displayMode&&e.config.useMinImage&&(a.operations=e.dvsContext.editService.toMinImageOperations(i.operations,i.imageScale));var s=e.dvsContext.editService.handle(a),l=s.width,u=s.height,c=s.matrixes,h=s.blanks;t.image.externalMatrixes=c,t.realTimeWidth=l,t.realTimeHeight=u,"multiple"===e.config.displayMode&&e.config.useMinImage||i.setRealTimeSize(l,u),$k(h).call(h,function(e){var i;CP(i=t.blanks.children).call(i,function(t){return t.id===e.uid;}).updateStyle({points:e.points,background:e.background});});}});}),i.on(l),r.on(l),n.on(l),o.on(l),a.on(l),s.on(u),e.hooksService.hooks.destroy.on(function(){i.off(l),r.off(l),n.off(l),o.off(l),a.off(l),s.off(u);});}}]);}(),FX={name:"dvsEdit",install:function install(e){var t=e.getClassStore(),i=t.Viewer;if(i){var r=function(e,t){return t=function(e){function t(e){var i;return Xk(this,t),Wk(Pw(i=IN(this,t,[e])),"viewerConfig",void 0),i.context.configService.registerHandler("rotationType",function(e,t){e.config.rotationType=t;}),i.context.config.rotationType||(i.context.config.rotationType="contain"),i;}return Mb(t,e),Yk(t,[{key:"rotate",value:function value(e,t){if(!AF(this,t=MF(this,t)))return!1;var i=this.getCurrentTab(),r=QE(t).call(t,function(e){return i.getUidByIndex(e);}),n={actionType:"r",commandUid:rO(),tabUid:i.uid,tabType:i.type,trigger:this.uid,uids:r,angle:e,type:this.getViewerConfigByName("rotationType")};return this.context.storeActionToStatus(n),this.context.getGlobalHooks().rotate.emit(n),!0;}},{key:"flip",value:function value(e,t){if(!AF(this,e=MF(this,e)))return!1;var i=this.getCurrentTab(),r=QE(e).call(e,function(e){return i.getUidByIndex(e);}),n={actionType:"f",commandUid:rO(),tabUid:i.uid,tabType:i.type,trigger:this.uid,uids:r,dir:t||"v"};return this.context.storeActionToStatus(n),this.context.getGlobalHooks().flip.emit(n),!0;}},{key:"mirror",value:function value(e){return this.flip(e,"h");}},{key:"changePageSize",value:function value(e,t,i){if(!AF(this,e=MF(this,e)))return!1;var r=this.getCurrentTab(),n=QE(e).call(e,function(e){return r.getUidByIndex(e);}),o={actionType:"z",commandUid:rO(),tabUid:r.uid,tabType:r.type,trigger:this.uid,uids:n,width:t,height:i};return this.context.storeActionToStatus(o),this.context.getGlobalHooks().changeSize.emit(o),!0;}},{key:"crop",value:function value(e,t,i,r,n){if(!AF(this,e=MF(this,e)))return!1;var o=this.getCurrentTab(),a=QE(e).call(e,function(e){return o.getUidByIndex(e);}),s={actionType:"c",commandUid:rO(),tabUid:o.uid,tabType:o.type,trigger:this.uid,uids:a,left:t,top:i,width:r,height:n};return this.context.storeActionToStatus(s),this.context.getGlobalHooks().crop.emit(s),!0;}},{key:"erase",value:function value(e,t,i,r,n,o){if(!AF(this,e=MF(this,e)))return!1;var a=this.getCurrentTab(),s=QE(e).call(e,function(e){return a.getUidByIndex(e);}),l={actionType:"e",commandUid:rO(),tabUid:a.uid,tabType:a.type,trigger:this.uid,eraseUid:rO(),uids:s,left:t,top:i,width:r,height:n,color:o};return this.context.storeActionToStatus(l),this.context.getGlobalHooks().erase.emit(l),!0;}}]);}(e),Wk(t,"use",e.use),t;}(i);r.use(new HX()),t.Viewer=r;}},init:function init(e){e.context.editService=new UX(e.context);}},jX=function(){return Yk(function e(t,i,r,n){Xk(this,e),Wk(this,"webViewer",void 0),Wk(this,"bDispose",!1),Wk(this,"element",void 0),Wk(this,"container",void 0),Wk(this,"css",void 0),this.webViewer=t,this.element=i,this.element.style.flexShrink="0";var o=this.webViewer.myViewer.rootDom;this.container=o.querySelector("#dvs-viewer-main".concat(t.myViewer.postfix));var a="dvs-customElement-right";switch(r){case"left":a="dvs-customElement-left";break;case"top":a="dvs-customElement-top";break;case"bottom":a="dvs-customElement-bottom";}n&&this.element.classList.add("dvs-customElement-full"),this.css=a,this.container.classList.add(a),this.container.appendChild(i),this.hide();},[{key:"show",value:function value(){if(this.element)return this.element.style.display="block",this.webViewer.resized(),this.webViewer.resized(),!0;var e=this.bDispose?"CustomElementDispose":"CustomElementNotExist";return this.webViewer.setError(e),!1;}},{key:"hide",value:function value(){if(this.element)return this.element.style.display="none",this.webViewer.resized(),this.webViewer.resized(),!0;var e=this.bDispose?"CustomElementDispose":"CustomElementNotExist";return this.webViewer.setError(e),!1;}},{key:"dispose",value:function value(){return this.bDispose||(this.element&&(this.container.removeChild(this.element),this.webViewer.resized(),this.webViewer.resized(),this.webViewer.customElement=void 0,this.element=null,this.container.classList.remove(this.css),this.container=void 0),this.bDispose=!0),!0;}}]);}();function YX(e){var t=function t(e){var t=Number(e).toString(16).toUpperCase();return 1===t.length&&(t=["0",t].join("")),t;},i=(65280&e)>>8,r=255&e;return["#",t(e>>16),t(i),t(r)].join("");}function XX(e){if(HN(e))return!1;if(""===e)return!0;var t=document.createElement("div");return t.style.background=e,""!==t.style.background;}function qX(e){if(HN(e))return!1;if(""===e)return!0;var t=document.createElement("div");t.style.border=e;var i=t.style,r=i.borderWidth,n=i.borderColor,o=i.borderStyle;return"initial"!==r&&""!==r&&"initial"!==n&&""!==r&&"initial"!==o&&""!==r;}function ZX(e){var t=sW(e);return!(HN(t)||t.value<0);}var _X=10===document.documentMode?"dvs-buttons-ie":"dvs-buttons";function GX(e){var t;return uS(t="dvs-editor-iconfont ds-dwt-ui-icon-".concat(e," ")).call(t,_X);}var KX={type:"Button",className:"".concat(_X," dwt-viewer-imageEditor-emptyBtn"),style:{visibility:"visible"}},$X={type:"Button",name:"previous",id:"previous",className:GX("preImage"),style:{visibility:"visible"},events:{click:"previousImage"}},QX={type:"Button",name:"next",id:"next",className:GX("nextImage"),style:{visibility:"visible"},events:{click:"nextImage"}},JX={type:"Button",name:"scan",id:"scan",className:GX("acquire"),style:{visibility:"visible"},events:{click:"scanImage"}},eq={type:"Button",name:"load",id:"load",className:GX("load"),style:{visibility:"visible"},events:{click:"loadImage"}},tq={type:"Button",name:"print",id:"print",className:GX("printImage"),style:{visibility:"visible"},events:{click:"printImage"}},iq={type:"Button",name:"removeAll",id:"removeAll",className:GX("removeall"),style:{visibility:"visible"},events:{click:"removeAllImage"}},rq={type:"Button",name:"removeSelected",id:"removeSelected",className:GX("removeImage"),style:{visibility:"visible"},events:{click:"removeImage"}},nq={type:"Button",name:"rotateLeft",id:"rotateLeft",className:GX("rotateLeftImage"),style:{visibility:"visible"},events:{click:"rotateLeft"}},oq={type:"Button",name:"rotate",id:"rotate",className:GX("rotate"),style:{visibility:"visible",position:"relative"},events:{click:"rotate"}},aq={type:"Button",name:"rotateRight",id:"rotateRight",className:GX("rotateRightImage"),style:{visibility:"visible"},events:{click:"rotateRight"}},sq={type:"Button",name:"deskew",id:"deskew",className:GX("deskew"),style:{visibility:"visible"},events:{click:"deskew"}},lq={type:"Button",name:"crop",id:"crop",className:GX("cropImage-grey"),style:{visibility:"visible"},events:{click:"cropImage"}},uq={type:"Button",name:"cut",id:"cut",className:GX("erase-grey"),style:{visibility:"visible"},events:{click:"cutImage"}},cq={type:"Button",name:"changeImageSize",id:"changeImageSize",className:GX("changeImageSize"),style:{visibility:"visible",position:"relative"},events:{click:"changeImageSize"}},hq={type:"Button",name:"flip",id:"flip",className:GX("flipImage"),style:{visibility:"visible"},events:{click:"flipImage"}},dq={type:"Button",name:"mirror",id:"mirror",className:GX("mirrorImage"),style:{visibility:"visible"},events:{click:"mirrorImage"}},fq={type:"Button",name:"zoomIn",id:"zoomIn",className:GX("zoomin"),style:{visibility:"visible"},events:{click:"zoomIn"}},vq={type:"Button",name:"originalSize",id:"originalSize",className:GX("originalsize"),style:{visibility:"visible"},events:{click:"originalSize"}},gq={type:"Button",name:"zoomOut",id:"zoomOut",className:GX("zoomout"),style:{visibility:"visible"},events:{click:"zoomOut"}},mq={type:"Button",name:"fit",id:"fit",className:GX("fullWebType"),style:{visibility:"visible"},events:{click:"fitWindow"}},yq={type:"Button",name:"fitW",id:"fitW",className:GX("fitWidthType"),style:{visibility:"visible"},events:{click:"fitWidth"}},pq={type:"Button",name:"fitH",id:"fitH",className:GX("fitHeightType"),style:{visibility:"visible"},events:{click:"fitHeight"}},wq={type:"Button",name:"hand",id:"hand",className:GX("hand"),style:{visibility:"visible"},events:{click:"handMode"}},bq={type:"Button",name:"rectSelect",id:"rectSelect",className:GX("select"),style:{visibility:"visible"},events:{click:"selectMode"}},kq={type:"Button",name:"zoom",id:"zoom",className:GX("clicktozoomin"),style:{visibility:"visible"},events:{click:"zoomMode"}},Sq={type:"Button",name:"restore",id:"restore",className:GX("restore"),style:{visibility:"visible"},events:{click:"restoreImage"}},xq={type:"Button",name:"save",id:"save",className:GX("saveImage"),style:{visibility:"visible"},events:{click:"saveImage"}},Cq={type:"Button",name:"close",id:"close",className:GX("close"),style:{visibility:"visible"},events:{click:"closeImageEditor"}},Vq=["previousImage","nextImage","scanImage","loadImage","printImage","removeAllImage","removeImage","rotateLeft","rotate","rotateRight","deskew","cropImage","cutImage","changeImageSize","flipImage","mirrorImage","zoomIn","originalSize","zoomOut","fitWindow","fitWidth","fitHeight","handMode","selectMode","zoomMode","restoreImage","saveImage","closeImageEditor"],Tq=["bufferChanged","click","pageAreaSelected","pageAreaUnselected"],Iq={root:{style:{display:"flex",flexDirection:"column",position:"relative"},id:"root",children:[{type:"Group",style:{height:"40px",minHeight:"30px",background:"rgb(58, 57, 59)",boxSizing:"border-box"},id:"header",className:"dwt-viewer-imageEditor-header",children:[{style:{width:"95%"},type:"Group",className:"dwt-viewer-imageEditor-leftButtons",children:[$X,QX,KX,JX,eq,tq,KX,iq,rq,KX,nq,oq,aq,sq,KX,lq,uq,cq,hq,dq,KX,fq,vq,gq,KX,mq,yq,pq,KX,wq,bq,kq,KX,Sq,xq]},{style:{width:"5%",justifyContent:"flex-end"},type:"Group",className:"dwt-viewer-imageEditor-rightButtons",children:[Cq]}]},{type:"MainCanvas",id:"canvas",className:"dvs-canvas"}]}},Eq={flex:"1",visibility:"visible",fontSize:"1.2em"},Pq={visibility:"visible",fontSize:"1.2em"},Bq={root:{style:{display:"flex",flexDirection:"column",position:"relative"},id:"root",children:[{type:"Group",dataId:"header",style:{padding:"0 8px",height:"40px",background:"#2a292b",boxSizing:"border-box"},className:"dwt-viewer-imageEditor-header",children:[Fk(Fk({},eq),{},{style:Fk({},Pq)}),Fk(Fk({},Cq),{},{style:Fk({},Pq)})]},{type:"Group",dataId:"body",style:{display:"flex",flexDirection:"column"},children:[{type:"Group",dataId:"topMenu",style:{height:"60px",boxSizing:"border-box",background:"#3a393b"},children:[Fk(Fk({},nq),{},{style:Fk({},Eq)}),Fk(Fk({},aq),{},{style:Fk({},Eq)}),Fk(Fk({},hq),{},{style:Fk({},Eq)}),Fk(Fk({},dq),{},{style:Fk({},Eq)}),Fk(Fk({},lq),{},{style:Fk({},Eq)}),Fk(Fk({},uq),{},{style:Fk({},Eq)}),Fk(Fk({},wq),{},{style:Fk({},Eq)}),Fk(Fk({},bq),{},{style:Fk({},Eq)})]},{type:"MainCanvas",dataId:"canvas",className:"dvs-canvas"},{type:"Group",dataId:"bottomMenu",style:{height:"60px",background:"rgb(58, 57, 59)"},children:[{type:"Pagination",className:"dvs-imageEditor-pagination",events:{change:"paginationChange"},style:{display:"flex",width:"50%"},firstPage:{id:"firstPage",style:{visibility:"visible",flex:1}},lastPage:{id:"lastPage",style:{visibility:"visible",flex:1}},prevPage:{id:"previousPage",style:{visibility:"visible",flex:1}},nextPage:{id:"nextPage",style:{visibility:"visible",flex:1}},gotoPage:{style:{visibility:"visible",flex:1}},total:{style:{visibility:"visible",flex:1,textAlign:"center"}}},Fk(Fk({},iq),{},{style:Fk({},Eq)}),Fk(Fk({},rq),{},{style:Fk({},Eq)}),Fk(Fk({},Sq),{},{style:Fk({},Eq)}),Fk(Fk({},xq),{},{style:Fk({},Eq)})]}]}]}};function Dq(e){var t={};return ZN(null==e?void 0:e.borderWidth)&&(t.borderWidth=e.borderWidth),NN(null==e?void 0:e.lineDash)&&ZN(e.lineDash[0])&&ZN(e.lineDash[1])&&(t.dashLine=[e.lineDash[0],e.lineDash[1]]),jN(null==e?void 0:e.borderColor)&&(t.borderColor=e.borderColor),jN(null==e?void 0:e.handleColor)&&(t.ctrlBorderColor=e.handleColor),ZN(null==e?void 0:e.handleWidth)&&(t.ctrlWidth=e.handleWidth),ZN(null==e?void 0:e.handleHeight)&&(t.ctrlHeight=e.handleHeight),t;}function Mq(e){return{borderWidth:e.borderWidth,lineDash:e.dashLine,handleWidth:e.ctrlWidth,handleHeight:e.ctrlHeight,handleColor:e.ctrlBorderColor,borderColor:e.borderColor};}var Aq=function(){return Yk(function e(t,i){Xk(this,e),Wk(this,"dvs",void 0),Wk(this,"cutColor","white"),Wk(this,"webViewer",void 0),Wk(this,"editorViewer",void 0),Wk(this,"viewerSetting",void 0),Wk(this,"containerElement",void 0),Wk(this,"uiSetting",Iq),Wk(this,"editorSetting",void 0),Wk(this,"bShowImageEditor",!1),Wk(this,"lastRotateAngle",45),Wk(this,"lastRotateKeepSize",!1),Wk(this,"promoteSaveChange",!0),Wk(this,"workMode",!1),Wk(this,"bCrop",!1),Wk(this,"bErase",!1),Wk(this,"curIndex",0),Wk(this,"bChanged",!1),Wk(this,"bChangedUid",""),Wk(this,"cursor","select"),Wk(this,"defaultBtnClass","dvs-btn dvs-editor-iconfont dvs-buttons"),Wk(this,"bDispose",!1),Wk(this,"bMobile",!1),Wk(this,"bFullScreen",!1),Wk(this,"deskewStarted",!1),this.webViewer=t,this.dvs=t.myDvs,this.editorSetting=i||YL,this.promoteSaveChange=i.promptToSaveChange,this.workMode=0===i.workMode,this.updateEditorSetting(i),this.init(i);},[{key:"init",value:function value(e){this.bMobile=$N(),this.editorViewer=this.webViewer.myDvs.createViewer({viewerConfig:{viewerStyle:{background:"white"},canvasStyle:{background:"rgba(0,0,0,0)"},pageStyle:{background:"white"},displayMode:"single",enableOptimizeImage:!0,enableSlide:!0,maxZoom:50,margin:0},uiConfig:this.uiSetting,syncViewerUid:this.webViewer.myViewer.uid}),this.updateViewerSetting(e),0!==this.dvs.context.errorService.errorCode&&this.webViewer.setDefaultError(),this.bDispose=!1,this.bindEditorEvents(),_R(this).call(this),this.disableMobileInput(),this.setWidth(null==e?void 0:e.width),this.setHeight(null==e?void 0:e.height),this.setIfAutoScroll(this.webViewer.getIfAutoScroll());}},{key:"updateViewerSetting",value:function value(e){if(!this.editorViewer)return!1;var t=e.innerBorder,i=e.background,r=e.zoomOrigin,n=this.editorViewer.getViewerConfig().canvasStyle,o={border:t||n.border,background:i||n.background};return this.setZoomOrigin(r),this.editorViewer.updateViewerConfig({cropBoxConfig:_LN(XL),canvasStyle:o}),!0;}},{key:"updateUISetting",value:function value(e){this.editorSetting=e,this.uiSetting=_LN(Iq);var t=this.uiSetting.root.children[0],i=t.children[0].children,r=t.children[1].children;if(e.topMenuBorder&&qX(e.topMenuBorder)&&(t.style.border=e.topMenuBorder),e.border&&qX(e.border)&&(this.uiSetting.root.style.border=e.border),this.editorSetting.buttons){for(var n,o=this.editorSetting.buttons,a=o.titles,s=o.visibility,l=[i,r],u=[],c=function c(e){var t;$k(t=l[e]).call(t,function(t,i){var r,n=null==t||null===(r=t.name)||void 0===r?void 0:r.toLocaleLowerCase();HN(a)||HN(a[n])||(t.title=a[n]),HN(s)||HN(s[n])||(t.style.display=!0===s[n]?"":"none",!1===s[n]&&0===e&&u.push(i));});},h=0;h<l.length;h++)c(h);$k(n=[[0,1],[3,4,5],[7,8],[10,11,12,13],[15,16,17,18,19],[21,22,23],[25,26,27],[29,30,31]]).call(n,function(e){if(function(e,t){for(var i=0;i<t.length;i++)if(!RB(e).call(e,t[i]))return!1;return!0;}(u,e)){var t=e[e.length-1]+1;i[t].style.display="none";}});}return this.uiSetting;}},{key:"updateMobileUISetting",value:function value(e){this.editorSetting=e,this.uiSetting=_LN(Bq);var t=this.uiSetting.root.children[0],i=this.uiSetting.root.children[1],r=t.children,n=i.children[0],o=n.children,a=i.children[2].children;if(e.topMenuBorder&&qX(e.topMenuBorder)&&(n.style.border=e.topMenuBorder),e.border&&qX(e.border)&&(this.uiSetting.root.style.border=e.border),this.editorSetting.buttons)for(var s=this.editorSetting.buttons,l=s.titles,u=s.visibility,c=[r,o,a],h=0;h<c.length;h++){var d;$k(d=c[h]).call(d,function(e){var t,i=null==e||null===(t=e.name)||void 0===t?void 0:t.toLocaleLowerCase();HN(l)||HN(l[i])||(e.title=l[i]),HN(u)||HN(u[i])||(e.style.visibility=!0===u[i]?"visible":"hidden");});}return this.uiSetting;}},{key:"updateEditorSetting",value:function value(e){this.editorSetting=e,$N()?this.updateMobileUISetting(e):this.updateUISetting(e);}},{key:"bindEditorEvents",value:function value(){var e=this;$k(Vq).call(Vq,function(t){e.editorViewer.ui.on(t,function(){e.hideImageEditorDialog(),e[t]();});}),$k(Tq).call(Tq,function(t){e.editorViewer.on(t,function(i,r){e[t](i,r);});}),this.editorViewer.on("contextmenu",function(e,t){t.preventDefault();});var t=this.webViewer.webViewerInitConfig.viewerEvents;GN(null==t?void 0:t.onDrop)&&this.editorViewer.on("drop",function(i,r){e.webViewer.acceptDrop&&(null==t||t.onDrop(i,r));}),this.bMobile&&this.editorViewer.ui.on("paginationChange",function(t){e.goToPage(t.current-1);});}},{key:"resize",value:function value(){if(this.editorViewer){var e=this.editorViewer.rootDom;if(e){var t=this.editorViewer.width,i=16;t>600&&(i=Math.min(22,t/750*16)),i<16&&(i=16),this.bMobile&&(i=20),e.style.fontSize="".concat(i,"px");}}}},{key:"hideImageEditorDialog",value:function value(){this.closeRotateDialog(),this.closeChangeSizeDialog();}},{key:"updateZoomInState",value:function value(e){var t=e?"ds-dwt-ui-icon-zoomin":"ds-dwt-ui-icon-zoomin dvs-grey";this.setButtonClass("zoomIn",t);}},{key:"updateZoomOutState",value:function value(e){var t=e?"ds-dwt-ui-icon-zoomout":"ds-dwt-ui-icon-zoomout dvs-grey";this.setButtonClass("zoomOut",t);}},{key:"updateDeskewState",value:function value(e){var t=e?"ds-dwt-ui-icon-deskew":"ds-dwt-ui-icon-deskew dvs-grey";this.setButtonClass("deskew",t);}},{key:"updateEraseState",value:function value(e,t){var i=e?"ds-dwt-ui-icon-erase":"ds-dwt-ui-icon-erase dvs-grey";this.setButtonClass("cut",i),t&&this.clearSelectedArea();}},{key:"updateCropState",value:function value(e,t){var i=e?"ds-dwt-ui-icon-cropImage":"ds-dwt-ui-icon-cropImage dvs-grey";this.setButtonClass("crop",i),t&&this.clearSelectedArea();}},{key:"updateSaveAndRestoreBtn",value:function value(){var e=this.bChanged?"ds-dwt-ui-icon-saveImage":"ds-dwt-ui-icon-saveImage dvs-grey",t=this.bChanged?"ds-dwt-ui-icon-restore":"ds-dwt-ui-icon-restore dvs-grey";this.setButtonClass("save",e),this.setButtonClass("restore",t);}},{key:"updateCursorState",value:function value(){switch(this.cursor){case"pointer":this.handMode();break;case"zoom":this.zoomMode();break;default:this.selectMode();}return!0;}},{key:"updateMouseModeState",value:function value(e){this.setButtonClass("hand","ds-dwt-ui-icon-hand"),this.setButtonClass("rectSelect","ds-dwt-ui-icon-select"),this.setButtonClass("zoom","ds-dwt-ui-icon-clicktozoomin"),"pointer"===e?this.setButtonClass("hand","ds-dwt-ui-icon-hand dwt-viewer-imageEditor-selected"):"crosshair"===e?this.setButtonClass("rectSelect","ds-dwt-ui-icon-select dwt-viewer-imageEditor-selected"):this.setButtonClass("zoom","ds-dwt-ui-icon-clicktozoomin dwt-viewer-imageEditor-selected");}},{key:"updateState",value:function value(){if(this.editorViewer){var e=this.webViewer.getHowManyImagesInBuffer(),t=this.webViewer.getCurrentIndex();e>1?(this.webViewer.getCurrentIndex()===e-1||e<=1?this.setButtonClass("next","ds-dwt-ui-icon-nextImage dvs-grey"):this.setButtonClass("next","ds-dwt-ui-icon-nextImage"),t<=0||e<=1?this.setButtonClass("previous","ds-dwt-ui-icon-preImage dvs-grey"):this.setButtonClass("previous","ds-dwt-ui-icon-preImage")):(this.setButtonClass("next","ds-dwt-ui-icon-nextImage dvs-grey"),this.setButtonClass("previous","ds-dwt-ui-icon-preImage dvs-grey")),this.updateSaveAndRestoreBtn(),this.updateCropState(!1,!0),this.updateEraseState(!1,!0),this.updateCursorState();}}},{key:"setChangedState",value:function value(e){e?(this.bChanged=!0,this.bChangedUid=this.webViewer.getCurrentImgUUid()):(this.bChanged=!1,this.bChangedUid="");}},{key:"disableMobileInput",value:function value(){if(this.bMobile){var e=document.querySelector(".dvs-pagination-goto");e&&(e.disabled=!0);}}},{key:"bindStopPropagation",value:function value(e){var t=document.getElementById(e);t&&(t.onclick=function(e){MO(e);});}},{key:"updateEditorConfig",value:function value(e){this.editorViewer.updateViewerConfig(e);}},{key:"setIfAutoScroll",value:function value(e){return!!this.editorViewer&&(this.updateEditorConfig({autoSelectLatest:e,autoScroll:e}),!0);}},{key:"getSelectionBoxStyle",value:function value(){if(!this.editorViewer){var e=this.bDispose?"ImageEditorDispose":"ImageEditorNotExist";return this.webViewer.setError(e),!1;}return Mq(this.editorViewer.cropBoxConfig);}},{key:"setSelectionBoxStyle",value:function value(e){if(!this.editorViewer){var t=this.bDispose?"ImageEditorDispose":"ImageEditorNotExist";return this.webViewer.setError(t),!1;}if(!ON(e))return!1;var i=Dq(e);return this.updateEditorConfig({cropBoxConfig:i}),!0;}},{key:"resetButtonState",value:function value(){this.setChangedState(!1),this.updateSaveAndRestoreBtn();}},{key:"bind",value:function value(){var e;if(this.bShowImageEditor)return!0;if(!this.editorViewer){var t=this.bDispose?"ImageEditorDispose":"ImageEditorNotExist";return this.webViewer.setError(t),!1;}if(this.editorSetting&&this.editorSetting.element)this.bFullScreen=!1,jN(this.editorSetting.element)?this.containerElement=document.getElementById(this.editorSetting.element):this.containerElement=this.editorSetting.element;else{var i=document.createElement("div");i.className="dwt-viewer-imageEditor-fullScreen",document.body.insertBefore(i,document.body.firstElementChild),this.bFullScreen=!0,this.containerElement=i;}if(this.editorViewer.bindContainer(this.containerElement),this.editorViewer.hide(),this.updateState(),this.setSelectionRectAspectRatio((null===(e=this.editorSetting)||void 0===e?void 0:e.selectionRectAspectRatio)||0),!this.bMobile){var r=document.getElementById("header".concat(this.editorViewer.postfix));r&&r.addEventListener("wheel",function(e){e.preventDefault();},{passive:!1});}return!0;}},{key:"close",value:function value(){if(!this.editorViewer){var e=this.bDispose?"ImageEditorDispose":"ImageEditorNotExist";return this.webViewer.setError(e),!1;}this.bFullScreen&&document.body.removeChild(this.containerElement);var t=this.webViewer.webViewerInitConfig.imageEditorEvents;return this.bShowImageEditor=!1,this.webViewer.bShowImageEditor=!1,this.hideImageEditorDialog(),this.dvs.removeViewer(this.editorViewer),this.bFullScreen=!1,this.containerElement=null,this.editorViewer=void 0,this.webViewer.imageEditor=void 0,this.dvs=null,this.bDispose=!0,t&&GN(null==t?void 0:t.close)&&null!=t&&t.close(),window.removeEventListener("resize",window.dvsResize),window.dvsResize=null,document.body.style.overflow="",!0;}},{key:"show",value:function value(){var e;if(this.bShowImageEditor)return!0;if(this.editorViewer)return this.bFullScreen&&(this.containerElement.style.display="block",document.body.style.overflow="hidden"),this.bShowImageEditor=!0,this.editorViewer.show(),window.dvsResize=_R(e=this.resize).call(e,this),window.addEventListener("resize",window.dvsResize),this.resize(),!0;var t=this.bDispose?"ImageEditorDispose":"ImageEditorNotExist";return this.webViewer.setError(t),!1;}},{key:"hide",value:function value(){if(this.editorViewer)return this.editorViewer.hide(),this.bShowImageEditor=!1,this.bFullScreen&&(document.body.style.overflow="",this.containerElement.style.display="none"),window.removeEventListener("resize",window.dvsResize),window.dvsResize=null,!0;var e=this.bDispose?"ImageEditorDispose":"ImageEditorNotExist";return this.webViewer.setError(e),!1;}},{key:"hideImageEditor",value:function value(){var e=this;this.bChanged?this.showSaveDialog(function(){e.hide();},this.webViewer.getCurrentImgUUid()):this.hide();}},{key:"setSelectionRectAspectRatio",value:function value(e){if(!this.editorViewer)return!1;var t=e>0,i=e>0?e:0;return this.editorViewer.updateViewerConfig({cropBoxConfig:{aspectRatio:i,keepAspectRatio:t}}),!0;}},{key:"clearSelectedArea",value:function value(){if(!this.editorViewer||this.bDispose)return!1;var e=this.webViewer.getHowManyImagesInBuffer(),t=this.webViewer.getCurrentIndex();if(e<=0||t<0)return!0;var i=this.editorViewer.clearCropBox();return this.editorViewer.render(),i||this.webViewer.setDefaultError(),i;}},{key:"setOperationMode",value:function value(e){if(this.editorViewer){var t="default";switch(e){case 1:t="crop";break;case 2:t="zoomIn";break;case 3:t="zoomOut";break;case 4:t="annotation";break;default:t="default";}this.editorViewer.updateViewerConfig({toolType:t});}}},{key:"setCursor",value:function value(e){if(!this.editorViewer)return!1;var t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex();if(t<=0||i<0)return!1;var r="pointer",n=0,o=this.bMobile?"pointer":"crosshair";switch(e){case"zoom-out":o="zoom",r="zoom-out",n=3;break;case"zoom-in":o="zoom",r="zoom-in",n=2;break;case"crosshair":o="crosshair",r="crosshair",n=1;break;default:o="pointer",r="pointer",n=0;}var a={cursor:r};return this.editorViewer.updateViewerConfig({canvasStyle:a}),this.setOperationMode(n),this.updateMouseModeState(e),this.cursor=o,!0;}},{key:"setFit",value:function value(e){if(!this.webViewer||!this.editorViewer)return!1;var t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex();return!(t<=0||i<0||(this.editorViewer.updateViewerConfig({fitType:e}),this.updateZoomInState(!0),this.updateZoomOutState(!0),this.updateCropState(!1,!0),this.updateEraseState(!1,!0),0));}},{key:"setWidth",value:function value(e){return!(!this.webViewer||!this.editorViewer)&&!(jN(e)&&!/^((\d+em)|(\d+px)|(\d+%)|(\d+))$/.test(e)||ZN(e)&&e<=0||(this.editorViewer.dwtWidth=e,this.resize(),0));}},{key:"setHeight",value:function value(e){return!(!this.webViewer||!this.editorViewer)&&!(jN(e)&&!/^((\d+em)|(\d+px)|(\d+%)|(\d+))$/.test(e)||ZN(e)&&e<=0||(this.editorViewer.dwtHeight=e,this.resize(),0));}},{key:"setButtonClass",value:function value(e,t){var i;return!!this.editorViewer&&this.editorViewer.setButtonClass(e,uS(i="".concat(this.defaultBtnClass," ")).call(i,t));}},{key:"setZoomOrigin",value:function value(e){var t,i;if(!this.editorViewer){var r=this.bDispose?"ImageEditorDispose":"ImageEditorNotExist";return this.webViewer.setError(r),!1;}if(!ON(e)||!jN(null==e?void 0:e.x)||!jN(null==e?void 0:e.y))return this.webViewer.setError("InvalidValue"),!1;var n=e.x,o=e.y;return-1===WI(t=["left","right","center"]).call(t,n)||-1===WI(i=["top","bottom","center"]).call(i,o)?(this.webViewer.setError("InvalidValue"),!1):(this.editorViewer.updateViewerConfig({zoomOrigin:{x:n,y:o}}),!0);}},{key:"getZoomOrigin",value:function value(){return this.bDispose?"":this.editorViewer.getViewerConfigByName("zoomOrigin");}},{key:"previousImage",value:function value(){var e=this;if(!this.webViewer||!this.editorViewer)return!1;var t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex();return!(t<2||0===i||(this.bChanged?this.showSaveDialog(function(){e.editorViewer.prevPage(),e.updateState();},this.webViewer.getCurrentImgUUid()):(this.editorViewer.prevPage(),this.updateState()),0));}},{key:"nextImage",value:function value(){var e=this;if(!this.webViewer||!this.editorViewer)return!1;var t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex();return!(t<2||i===t-1||(this.bChanged?this.showSaveDialog(function(){e.editorViewer.nextPage(),e.updateState();},this.webViewer.getCurrentImgUUid()):(this.editorViewer.nextPage(),this.updateState()),0));}},{key:"scanImage",value:function value(){var e=this;if(!this.webViewer||!this.editorViewer)return!1;var t=this.webViewer.webViewerInitConfig.imageEditorEvents;return!(!t||!GN(null==t?void 0:t.acquire)||(this.bChanged?this.showSaveDialog(function(){null!=t&&t.acquire(e.editorSetting.dialogText.selectSource),e.updateState();},this.webViewer.getCurrentImgUUid()):(null!=t&&t.acquire(this.editorSetting.dialogText.selectSource),this.updateState()),0));}},{key:"loadImage",value:function value(){var e=this;if(!this.webViewer||!this.editorViewer)return!1;var t=this.webViewer.webViewerInitConfig.imageEditorEvents;return!(!t||!GN(null==t?void 0:t.loadImage)||(this.bChanged?this.showSaveDialog(function(){null!=t&&t.loadImage(),e.updateState();},this.webViewer.getCurrentImgUUid()):(null!=t&&t.loadImage(),this.updateState()),0));}},{key:"removeAllImage",value:function value(){var e=this.webViewer.webViewerInitConfig.imageEditorEvents,t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex();return!(t<=0||i<0||(e&&GN(null==e?void 0:e.removeAllImage)?null==e||e.removeAllImage():this.webViewer.bufferService.removeAllImages(),this.setChangedState(!1),this.updateState(),0));}},{key:"removeImage",value:function value(){var e=this.webViewer.webViewerInitConfig.imageEditorEvents,t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex();return!(t<=0||i<0||(e&&GN(null==e?void 0:e.removeImage)?null==e||e.removeImage():this.webViewer.bufferService.removeSelectedImages(),this.setChangedState(!1),this.updateState(),0));}},{key:"rotate",value:function value(){this.showRotateDialog();}},{key:"changeImageSize",value:function value(){this.showChangeSizeDialog();}},{key:"zoomIn",value:function value(){if(!this.webViewer||!this.editorViewer)return!1;var e=this.webViewer.getHowManyImagesInBuffer(),t=this.webViewer.getCurrentIndex();if(e<=0||t<0)return!1;var i=this.editorViewer.getViewerConfig();return i.zoom<i.maxZoom?(this.editorViewer.zoomIn(),this.updateZoomInState(!0)):this.updateZoomInState(!1),this.updateZoomOutState(!0),this.updateCropState(!1,!0),this.updateEraseState(!1,!0),!0;}},{key:"originalSize",value:function value(){if(!this.webViewer||!this.editorViewer)return!1;var e=this.webViewer.getHowManyImagesInBuffer(),t=this.webViewer.getCurrentIndex();return!(e<=0||t<0||(this.editorViewer.updateViewerConfig({zoom:1}),this.updateZoomInState(!0),this.updateZoomOutState(!0),this.updateCropState(!1,!0),this.updateEraseState(!1,!0),0));}},{key:"zoomOut",value:function value(){if(!this.webViewer||!this.editorViewer)return!1;var e=this.webViewer.getHowManyImagesInBuffer(),t=this.webViewer.getCurrentIndex();if(e<=0||t<0)return!1;var i=this.editorViewer.getViewerConfig();return i.zoom>i.minZoom?(this.editorViewer.zoomOut(),this.updateZoomOutState(!0)):this.updateZoomOutState(!1),this.updateZoomInState(!0),this.updateCropState(!1,!0),this.updateEraseState(!1,!0),!0;}},{key:"fitWindow",value:function value(){this.setFit("window");}},{key:"fitWidth",value:function value(){this.setFit("width");}},{key:"fitHeight",value:function value(){this.setFit("height");}},{key:"selectMode",value:function value(){this.setCursor("crosshair");}},{key:"handMode",value:function value(){this.clearSelectedArea(),this.setCursor("pointer");}},{key:"zoomMode",value:function value(){this.clearSelectedArea(),this.setCursor("zoom-in");}},{key:"restoreImage",value:function value(e){if(!this.webViewer||!this.editorViewer)return!1;if(!this.bChanged)return!1;var t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex();if(HN(e)||(i=this.webViewer.myViewer.getIndexByUid(e)),t<=0||i<0)return!1;var r=this.webViewer.webViewerInitConfig.imageEditorServerCallback;if(this.workMode&&r&&GN(null==r?void 0:r.restore)){var n=e||this.webViewer.getCurrentImgUUid();r.restore(n);}else this.editorViewer.reset(i),this.webViewer.myViewer.resized();return this.setChangedState(!1),this.updateState(),this.webViewer.clearSelectedAreas(),!0;}},{key:"first",value:function value(){var e=this;this.bChanged?this.showSaveDialog(function(){e.goToPage(0);},this.webViewer.getCurrentImgUUid()):this.goToPage(0);}},{key:"last",value:function value(){var e=this,t=this.webViewer.getHowManyImagesInBuffer()-1;this.bChanged?this.showSaveDialog(function(){e.goToPage(t);},this.webViewer.getCurrentImgUUid()):this.goToPage(t);}},{key:"go",value:function value(e){var t=this;this.bChanged?this.showSaveDialog(function(){t.goToPage(e);},this.webViewer.getCurrentImgUUid()):this.goToPage(e);}},{key:"goToPage",value:function value(e){var t=this;if(!this.webViewer||!this.editorViewer)return!1;var i=this.webViewer.getHowManyImagesInBuffer(),r=this.webViewer.getCurrentIndex();return!(i<=0||r<0||!this.bShowImageEditor||HN(e)||-1===e||(this.bChanged?this.showSaveDialog(function(){t.editorViewer.gotoPage(e),t.updateState();},this.webViewer.getCurrentImgUUid()):(this.editorViewer.gotoPage(e),this.updateState()),0));}},{key:"selectPages",value:function value(e){var t=this,i=this.webViewer.getHowManyImagesInBuffer();return nN(e).call(e,function(e){return e>i-1;})?(this.webViewer.setError("ParameterOutRange"),!1):(this.bChanged?this.showSaveDialog(function(){t.webViewer.myViewer.setSelectedIndexes(e),t.updateState();},this.webViewer.getCurrentImgUUid()):(this.webViewer.myViewer.setSelectedIndexes(e),this.updateState()),!0);}},{key:"closeImageEditor",value:function value(){var e=this;0!==this.webViewer.getHowManyImagesInBuffer()&&this.bChanged?this.showSaveDialog(function(){e.close();},this.webViewer.getCurrentImgUUid()):this.close();}},{key:"dispose",value:function value(){this.bChanged&&this.saveImage(this.webViewer.getCurrentImgUUid()),this.close();}},{key:"printImage",value:(d=Ew(VN().m(function e(){var t,i,r,n,o,a,s,l,u;return VN().w(function(e){for(;;)switch(e.n){case 0:if(this.webViewer&&this.editorViewer){e.n=1;break;}return e.a(2,!1);case 1:if(t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex(),!(t<=0||i<0)){e.n=2;break;}return e.a(2,!1);case 2:return r=this.editorViewer.getCurrentTab(),n=r.currentPage,o=n.realTimeWidth,a=n.realTimeHeight,s=n.uid,l="",e.n=3,this.webViewer.myDvs.getImageData(s,{type:"blob"});case 3:if(u=e.v,!KN()){e.n=5;break;}return e.n=4,new uB(function(e){var t=new FileReader();t.onload=function(){return e(t.result);},t.readAsDataURL(u);});case 4:l=e.v,e.n=6;break;case 5:l=AO(u).data;case 6:return e.a(2,(function(e,t){var i,r="";r=uS(t="".concat(r,'<div class="image-container"><img src="')).call(t,e.url,'" /></div>');var n="".concat(Dynamsoft.DWT.ResourcesPath,"/src/dynamsoft.webtwain.css"),o=["alwaysRaised=yes,z-look=yes,top=0,left=0,toolbar=no,menubar=no,location=no,status=no,width=",0,",height=",0].join(""),a=window.open("about:blank","_blank",o),s=["<html>",'<head><link rel="stylesheet" type="text/css" href="',n,'"></head>','<body id="D_body">',r,"</body></html>"].join("");a&&(a.document.write(s),a.document.close(),a.focus(),(i=a.document.body)&&(i.onload=function(){a&&a.print();}));}({url:l,width:Math.floor(o),height:Math.floor(a)}),this.updateState(),!0));}},e,this);})),function(){return d.apply(this,arguments);})},{key:"rotateLeft",value:(h=Ew(VN().m(function e(){var t,i,r;return VN().w(function(e){for(;;)switch(e.n){case 0:if(t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex(),!(t<=0||i<0)){e.n=1;break;}return e.a(2,!1);case 1:if(!1!==this.bChanged||!this.workMode){e.n=2;break;}return e.n=2,this.saveToServerBeforeEdit();case 2:return r=this.webViewer.webViewerInitConfig.imageEditorServerCallback,e.a(2,(this.workMode&&r&&GN(null==r?void 0:r.rotateLeft)?null==r||r.rotateLeft():this.editorViewer.rotate(-90,i),this.setChangedState(!0),this.updateState(),this.webViewer.clearSelectedAreas(),!0));}},e,this);})),function(){return h.apply(this,arguments);})},{key:"rotateInner",value:(c=Ew(VN().m(function e(){var t,i,r,n,o,a,s;return VN().w(function(e){for(;;)switch(e.n){case 0:if(t=document.getElementById("dvsImageEditorKeepSize"),i=document.getElementById("dvsImageEditorRotateAngle"),r=$S(i.value,10),n=this.webViewer.getHowManyImagesInBuffer(),o=this.webViewer.getCurrentIndex(),!(n<=0||o<0)){e.n=1;break;}return e.a(2,!1);case 1:if(!1!==this.bChanged||!this.workMode){e.n=2;break;}return e.n=2,this.saveToServerBeforeEdit();case 2:return a=this.webViewer.webViewerInitConfig.imageEditorServerCallback,this.workMode&&a&&GN(null==a?void 0:a.rotate)?(s=document.getElementById("dvsImageEditorInterpolation"),null==a||a.rotate(r,s.selectedIndex+1,t.checked)):this.webViewer.rotateInner(o,r,t.checked),e.a(2,(this.setChangedState(!0),this.closeRotateDialog(),this.updateState(),this.webViewer.clearSelectedAreas(),this.lastRotateAngle=r,this.lastRotateKeepSize=t.checked,!0));}},e,this);})),function(){return c.apply(this,arguments);})},{key:"rotateRight",value:(u=Ew(VN().m(function e(){var t,i,r,n;return VN().w(function(e){for(;;)switch(e.n){case 0:if(i=this.webViewer.getHowManyImagesInBuffer(),r=this.webViewer.getCurrentIndex(),!(i<=0||r<0)){e.n=1;break;}return e.a(2,!1);case 1:if(!1!==this.bChanged||!this.workMode){e.n=2;break;}return e.n=2,this.saveToServerBeforeEdit();case 2:return n=this.webViewer.webViewerInitConfig.imageEditorServerCallback,e.a(2,(this.workMode&&n&&GN(null==n?void 0:n.rotateRight)?null==n||n.rotateRight():null===(t=this.editorViewer)||void 0===t||t.rotate(90,r),this.setChangedState(!0),this.updateState(),this.webViewer.clearSelectedAreas(),!0));}},e,this);})),function(){return u.apply(this,arguments);})},{key:"deskew",value:(l=Ew(VN().m(function e(){var t,i,r,n,o,a,s,l,u=this;return VN().w(function(e){for(;;)switch(e.n){case 0:if(t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex(),!(t<=0||i<0)){e.n=1;break;}return e.a(2,!1);case 1:if(r=this.webViewer.webViewerInitConfig,n=r.imageEditorEvents,o=r.imageEditorServerCallback,!1!==this.bChanged||!this.workMode){e.n=2;break;}return e.n=2,this.saveToServerBeforeEdit();case 2:if(!this.deskewStarted){e.n=3;break;}return e.a(2,!1);case 3:if(this.deskewStarted=!0,this.updateDeskewState(!1),!(this.workMode&&o&&GN(null==o?void 0:o.deskew))){e.n=4;break;}o.deskew(),this.setChangedState(!0),this.deskewStarted=!1,this.updateDeskewState(!0),e.n=7;break;case 4:if(n&&GN(null==n?void 0:n.deskew)){e.n=5;break;}return e.a(2,!1);case 5:return a=this.webViewer.getCurrentImgUUid(),s=this.webViewer.getCurrentIndex(),e.n=6,this.webViewer.myDvs.getImageData(a,{type:"blob",min:!0});case 6:l=e.v,n.deskew(l,function(e){u.webViewer.rotateInner(s,e,!0),u.setChangedState(!0),u.deskewStarted=!1,u.updateDeskewState(!0),u.updateSaveAndRestoreBtn();});case 7:return e.a(2,(this.updateState(),!0));}},e,this);})),function(){return l.apply(this,arguments);})},{key:"cropImage",value:(s=Ew(VN().m(function e(){var t,i,r,n,o,a,s,l,u;return VN().w(function(e){for(;;)switch(e.n){case 0:if(this.bCrop){e.n=1;break;}return e.a(2,!1);case 1:if(t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex(),!(t<=0||i<0)){e.n=2;break;}return e.a(2,!1);case 2:if(1===(r=this.editorViewer.getCropBoxes()).length){e.n=3;break;}return e.a(2,!1);case 3:if(n=r[0],o=n.left,a=n.top,s=n.width,l=n.height,!1!==this.bChanged||!this.workMode){e.n=4;break;}return e.n=4,this.saveToServerBeforeEdit();case 4:return u=this.webViewer.webViewerInitConfig.imageEditorServerCallback,e.a(2,(this.workMode&&u&&GN(null==u?void 0:u.crop)?u.crop(n):this.editorViewer.crop(i,o,a,s,l),this.setChangedState(!0),this.updateState(),this.webViewer.clearSelectedAreas(),!0));}},e,this);})),function(){return s.apply(this,arguments);})},{key:"cutImage",value:(a=Ew(VN().m(function e(){var t,i,r,n,o,a,s,l,u;return VN().w(function(e){for(;;)switch(e.n){case 0:if(this.bErase){e.n=1;break;}return e.a(2,!1);case 1:if(t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex(),!(t<=0||i<0)){e.n=2;break;}return e.a(2,!1);case 2:if(1===(r=this.editorViewer.getCropBoxes()).length){e.n=3;break;}return e.a(2,!1);case 3:if(n=r[0],o=n.left,a=n.top,s=n.width,l=n.height,!1!==this.bChanged||!this.workMode){e.n=4;break;}return e.n=4,this.saveToServerBeforeEdit();case 4:return u=this.webViewer.webViewerInitConfig.imageEditorServerCallback,e.a(2,(this.workMode&&u&&GN(null==u?void 0:u.erase)?u.erase(n):this.editorViewer.erase(i,o,a,s,l,this.cutColor),this.setChangedState(!0),this.updateState(),this.webViewer.clearSelectedAreas(),!0));}},e,this);})),function(){return a.apply(this,arguments);})},{key:"changeImageSizeInner",value:(o=Ew(VN().m(function e(){var t,i,r,n,o,a,s,l;return VN().w(function(e){for(;;)switch(e.n){case 0:if(t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex(),!(t<=0||i<0)){e.n=1;break;}return e.a(2,!1);case 1:if(r=document.getElementById("dvsImageEditorChangeH"),n=document.getElementById("dvsImageEditorChangeW"),o=$S(r.value,10),a=$S(n.value,10),!1!==this.bChanged||!this.workMode){e.n=2;break;}return e.n=2,this.saveToServerBeforeEdit();case 2:return s=this.webViewer.webViewerInitConfig.imageEditorServerCallback,this.workMode&&s&&GN(null==s?void 0:s.changeImageSize)?(l=document.getElementById("dvsImageEditorInterpolation"),s.changeImageSize(a,o,l.selectedIndex+1)):this.editorViewer.changePageSize(i,a,o),e.a(2,(this.setChangedState(!0),this.updateState(),this.closeChangeSizeDialog(),this.webViewer.clearSelectedAreas(),!0));}},e,this);})),function(){return o.apply(this,arguments);})},{key:"flipImage",value:(n=Ew(VN().m(function e(){var t,i,r;return VN().w(function(e){for(;;)switch(e.n){case 0:if(t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex(),!(t<=0||i<0)){e.n=1;break;}return e.a(2,!1);case 1:if(!1!==this.bChanged||!this.workMode){e.n=2;break;}return e.n=2,this.saveToServerBeforeEdit();case 2:return r=this.webViewer.webViewerInitConfig.imageEditorServerCallback,e.a(2,(this.workMode&&r&&GN(null==r?void 0:r.flip)?r.flip():this.editorViewer.flip(i),this.setChangedState(!0),this.updateState(),this.webViewer.clearSelectedAreas(),!0));}},e,this);})),function(){return n.apply(this,arguments);})},{key:"mirrorImage",value:(r=Ew(VN().m(function e(){var t,i,r;return VN().w(function(e){for(;;)switch(e.n){case 0:if(t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex(),!(t<=0||i<0)){e.n=1;break;}return e.a(2,!1);case 1:if(!1!==this.bChanged||!this.workMode){e.n=2;break;}return e.n=2,this.saveToServerBeforeEdit();case 2:return r=this.webViewer.webViewerInitConfig.imageEditorServerCallback,e.a(2,(this.workMode&&r&&GN(null==r?void 0:r.mirror)?r.mirror():this.editorViewer.mirror(i),this.setChangedState(!0),this.updateState(),this.webViewer.clearSelectedAreas(),!0));}},e,this);})),function(){return r.apply(this,arguments);})},{key:"saveImageAsync",value:(i=Ew(VN().m(function e(){var t,i,r,n,o,a,s;return VN().w(function(e){for(;;)switch(e.n){case 0:if(this.editorViewer){e.n=1;break;}return t=this.bDispose?"ImageEditorDispose":"ImageEditorNotExist",e.a(2,(this.webViewer.setError(t),uB.reject("The ImageEditor object has been disposed.")));case 1:if(this.bChanged||!this.workMode){e.n=2;break;}return e.a(2,uB.resolve());case 2:if(this.bChanged){e.n=3;break;}return e.a(2,uB.resolve());case 3:if(i=this.webViewer.webViewerInitConfig,r=i.viewerEvents,n=i.imageEditorServerCallback,o=this.webViewer.getCurrentImgUUid(),this.setChangedState(!1),this.updateState(),this.webViewer.clearSelectedAreas(),this.workMode&&n&&GN(null==n?void 0:n.save)){e.n=6;break;}if(r&&GN(null==r?void 0:r.save)){e.n=4;break;}return e.a(2,uB.reject());case 4:return e.n=5,this.webViewer.myDvs.getImageData(o,{type:"imageData"});case 5:return a=e.v,s=Fk(Fk({},this.webViewer.bufferService.getMetadataByUid(o)),{},{width:Math.floor(a.width),height:Math.floor(a.height)}),e.a(2,null==r?void 0:r.save(o,a.data.buffer,s,!0));case 6:return e.a(2,(n.save(o),uB.resolve()));}},e,this);})),function(){return i.apply(this,arguments);})},{key:"saveImage",value:(t=Ew(VN().m(function e(t){var i,r,n,o,a,s,l,u;return VN().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.editorViewer){e.n=1;break;}return e.a(2);case 1:if(this.bChanged){e.n=2;break;}return e.a(2);case 2:if(i=this.webViewer.webViewerInitConfig,r=i.viewerEvents,n=i.imageEditorServerCallback,o=t||this.webViewer.getCurrentImgUUid(),this.setChangedState(!1),this.updateState(),this.webViewer.clearSelectedAreas(),!(this.workMode&&n&&GN(null==n?void 0:n.save))){e.n=3;break;}n.save(o),e.n=9;break;case 3:if(r&&GN(null==r?void 0:r.save)){e.n=4;break;}return e.a(2);case 4:return e.n=5,this.webViewer.myDvs.getImageData(o,{type:"imageData"});case 5:return l=e.v,u=Fk(Fk({},(null===(a=this.webViewer)||void 0===a||null===(s=a.bufferService)||void 0===s?void 0:s.getMetadataByUid(o))||{}),{},{width:Math.floor(l.width),height:Math.floor(l.height)}),e.p=6,e.n=7,null==r?void 0:r.save(o,l.data.buffer,u,!0);case 7:e.n=9;break;case 8:e.p=8,e.v,this.setChangedState(!0),this.updateState();case 9:return e.a(2);}},e,this,[[6,8]]);})),function(e){return t.apply(this,arguments);})},{key:"saveToServerBeforeEdit",value:(e=Ew(VN().m(function e(){var t,i,r;return VN().w(function(e){for(;;)switch(e.n){case 0:if(t=this.webViewer.webViewerInitConfig.imageEditorServerCallback,i=this.webViewer.myViewer,!(this.workMode&&t&&GN(null==t?void 0:t.save))){e.n=2;break;}return i.updateViewerConfig({enableEmitPageRendered:!1}),this.webViewer.bEmitBufferChanged=!1,r=this.webViewer.getCurrentImgUUid(),e.n=1,t.save(r);case 1:this.webViewer.bEmitBufferChanged=!0,i.updateViewerConfig({enableEmitPageRendered:!0});case 2:return e.a(2);}},e,this);})),function(){return e.apply(this,arguments);})},{key:"bufferChanged",value:function value(e){return this.curIndex!==this.webViewer.getCurrentIndex()&&(this.curIndex=this.webViewer.getCurrentIndex(),this.updateState()),"shift"===e.operation&&this.bChanged||"add"===e.operation&&this.bChanged?(this.showSaveDialog(function(){},e.beforeStatus.currentUid),!1):("remove"===e.operation&&this.bChanged&&this.bChangedUid===e.beforeStatus.currentUid&&(this.setChangedState(!1),this.updateState()),!0);}},{key:"click",value:function value(){this.hideImageEditorDialog();var e=this.editorViewer.getViewerConfig();e.zoom<e.maxZoom?this.updateZoomInState(!0):this.updateZoomInState(!1),this.updateZoomOutState(!0);}},{key:"pageAreaSelected",value:function value(e,t){var i=1===t.length;this.bCrop=i,this.updateCropState(i,!1);var r=1===t.length;this.bErase=r,this.updateEraseState(r,!1);}},{key:"pageAreaUnselected",value:function value(){this.updateCropState(!1,!1),this.updateEraseState(!1,!1);}},{key:"wheel",value:function value(e,t){if(t.ctrlKey){var i=this.editorViewer.getViewerConfig(),r=i.zoom,n=r<i.maxZoom,o=r>i.minZoom;this.updateZoomInState(n),this.updateZoomOutState(o);}}},{key:"showMask",value:function value(){var e=document.createElement("div");e.className="dvs-imageEditor-mask",this.editorViewer.rootDom.appendChild(e);}},{key:"closeMask",value:function value(){var e=document.querySelector(".dvs-imageEditor-mask");e&&e.parentNode.removeChild(e);}},{key:"createSaveDialog",value:function value(){var e=this.editorSetting.dialogText,t=null==e?void 0:e.saveChangedImage;(HN(e)||HN(null==e?void 0:e.saveChangedImage))&&(t=jL.saveChangedImage);var i=Uq({tag:"div",className:"dvs-imageEditor-saveDlg",children:[{tag:"div",className:"dvs-imageEditor-saveDlg-header",children:[{tag:"i",className:"dynamsoft-dialog-close"}]},{tag:"div",className:"dvs-imageEditor-saveDlg-box",children:[{tag:"div",textContent:t[0]},{tag:"div",className:"dvs-imageEditor-saveDlg-btnGroup",children:[{tag:"input",className:"dynamsoft_btnSave",attributes:{type:"button",value:t[1]}},{tag:"input",className:"dynamsoft_btnCancel",attributes:{type:"button",value:t[2]}}]}]}]});return i.style.width=this.bMobile?"300px":"420px",i;}},{key:"showSaveDialog",value:function value(e,t){var i=this;if(document.querySelector(".dvs-imageEditor-saveDlg")||!this.bChanged)return!1;if(!this.promoteSaveChange)return this.saveImage(t),e(),!0;this.showMask();var r=this.createSaveDialog();this.editorViewer.rootDom.appendChild(r);var n=document.querySelector(".dynamsoft_btnSave"),o=document.querySelector(".dynamsoft_btnCancel"),a=document.querySelector(".dynamsoft-dialog-close");return a&&(a.onclick=function(){i.closeSaveDialog(),i.closeMask();}),n&&(n.onclick=Ew(VN().m(function r(){return VN().w(function(r){for(;;)switch(r.n){case 0:return r.n=1,i.saveImage(t);case 1:i.closeSaveDialog(),i.closeMask(),e();case 2:return r.a(2);}},r);}))),o&&(o.onclick=function(){i.restoreImage(t),i.closeSaveDialog(),i.closeMask(),e();}),!0;}},{key:"closeSaveDialog",value:function value(){var e=document.querySelector(".dvs-imageEditor-saveDlg");e&&e.parentNode.removeChild(e);}},{key:"createRotateDialog",value:function value(){var e=this.editorSetting.dialogText,t=null==e?void 0:e.dlgRotateAnyAngle;(HN(e)||HN(null==e?void 0:e.dlgRotateAnyAngle))&&(t=jL.dlgRotateAnyAngle);var i=!0===this.lastRotateKeepSize?"checked":"",r=this.workMode?"flex":"none",n=Uq({tag:"div",children:[{tag:"div",children:[{tag:"span",textContent:t[0]},{tag:"input",attributes:{id:"dvsImageEditorRotateAngle",type:"number",value:this.lastRotateAngle}}]},{tag:"div",attributes:{style:"display:".concat(r)},children:[{tag:"span",textContent:t[1]},{tag:"select",attributes:{size:"1",id:"dvsImageEditorInterpolation"},children:[{tag:"option",attributes:{value:"1"},textContent:"NearestNeighbor"},{tag:"option",attributes:{value:"2"},textContent:"Bilinear"},{tag:"option",attributes:{value:"3"},textContent:"Bicubic"}]}]},{tag:"div",children:[{tag:"label",children:[Fk({tag:"input",attributes:{type:"checkbox",id:"dvsImageEditorKeepSize"}},i&&{checked:"checked"}),{tag:"span",textContent:t[2]}]}]},{tag:"div",children:[{tag:"input",attributes:{id:"dvsImageEditorRotateOk",type:"button",value:t[3]}},{tag:"input",attributes:{id:"dvsImageEditorRotateCancel",type:"button",value:t[4]}}]}]});return n.className="dvs-imageEditor-rotateBox",n.id="dvsImageEditorRotateBox",n;}},{key:"showRotateDialog",value:function value(){var e=this;if(!document.getElementById("dvsImageEditorRotateBox")){var t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex();if(!(t<=0||i<0)){var r=document.getElementById("rotate".concat(this.editorViewer.postfix));if(r){var n=this.createRotateDialog();r.appendChild(n);var o=r.getBoundingClientRect(),a=o.width,s=o.height;n.style.left=a/2+"px",n.style.top=s/2+"px";var l=document.getElementById("dvsImageEditorRotateOk"),u=document.getElementById("dvsImageEditorRotateCancel");this.bindStopPropagation("dvsImageEditorRotateBox"),l&&(l.onclick=function(t){e.rotateInner();}),u&&(u.onclick=function(t){e.closeRotateDialog();});}}}}},{key:"closeRotateDialog",value:function value(){var e=document.getElementById("dvsImageEditorRotateBox");e&&e.parentNode.removeChild(e);}},{key:"createChangeSizeDialog",value:function value(e,t){var i=this.editorSetting.dialogText,r=null==i?void 0:i.dlgChangeImageSize;(HN(i)||HN(null==i?void 0:i.dlgChangeImageSize))&&(r=jL.dlgChangeImageSize);var n=this.workMode?"flex":"none",o=Uq({tag:"div",children:[{tag:"div",children:[{tag:"span",textContent:r[0]},{tag:"div",children:[{tag:"input",attributes:{id:"dvsImageEditorChangeH",type:"number",value:t}},{tag:"span",textContent:"pixel"}]}]},{tag:"div",attributes:{style:"margin-top:10px"},children:[{tag:"span",textContent:r[1]},{tag:"div",children:[{tag:"input",attributes:{id:"dvsImageEditorChangeW",type:"number",value:e}},{tag:"span",textContent:"pixel"}]}]},{tag:"div",attributes:{style:"display:".concat(n)},children:[{tag:"span",textContent:r[2]},{tag:"select",attributes:{size:"1",id:"dvsImageEditorInterpolation"},children:[{tag:"option",attributes:{value:"1"},textContent:"NearestNeighbor"},{tag:"option",attributes:{value:"2"},textContent:"Bilinear"},{tag:"option",attributes:{value:"3"},textContent:"Bicubic"}]}]},{tag:"div",children:[{tag:"input",attributes:{id:"dvsImageEditorChangeSizeOk",type:"button",value:r[3]}},{tag:"input",attributes:{id:"dvsImageEditorChangeSizeCancel",type:"button",value:r[4]}}]}]});return o.className="dvs-imageEditor-changeSizeBox",o.id="dvsImageEditorChangeSizeBox",o;}},{key:"showChangeSizeDialog",value:function value(){var e=this;if(!document.getElementById("dvsImageEditorChangeSizeBox")){var t=this.webViewer.getHowManyImagesInBuffer(),i=this.webViewer.getCurrentIndex();if(!(t<=0||i<0)){var r=document.getElementById("changeImageSize".concat(this.editorViewer.postfix));if(r){var n=this.editorViewer.getCurrentTab().currentPage,o=n.realTimeWidth,a=n.realTimeHeight,s=this.createChangeSizeDialog(Math.floor(o),Math.floor(a));r.appendChild(s);var l=r.getBoundingClientRect(),u=l.width,c=l.height;s.style.left=u/2+"px",s.style.top=c/2+"px";var h=document.getElementById("dvsImageEditorChangeSizeOk"),d=document.getElementById("dvsImageEditorChangeSizeCancel");this.bindStopPropagation("dvsImageEditorChangeSizeBox"),h&&(h.onclick=function(t){MO(t),e.changeImageSizeInner();}),d&&(d.onclick=function(t){MO(t),e.closeChangeSizeDialog();});}}}}},{key:"closeChangeSizeDialog",value:function value(){var e=document.getElementById("dvsImageEditorChangeSizeBox");e&&e.parentNode.removeChild(e);}}]);var e,t,i,r,n,o,a,s,l,u,c,h,d;}();function Uq(e){var t=e.tag,i=e.className,r=void 0===i?"":i,n=e.attributes,o=void 0===n?{}:n,a=e.textContent,s=void 0===a?"":a,l=e.children,u=void 0===l?[]:l,c=document.createElement(t);r&&(c.className=r);for(var h=0,d=aB(o);h<d.length;h++){var f=Ab(d[h],2),v=f[0],g=f[1];if("style"===v){var m=zq(g);for(var y in m)m.hasOwnProperty(y)&&(c.style[y]=m[y]);}else c.setAttribute(v,g);}return s&&(c.textContent=s),$k(u).call(u,function(e){var t=Uq(e);c.appendChild(t);}),c;}function zq(e){var t=e.split(";"),i={};return $k(t).call(t,function(e){var t,r=zS(e).call(e);if(r){var n=QE(t=r.split(":")).call(t,function(e){return zS(e).call(e);}),o=Ab(n,2),a=o[0],s=o[1],l=a.replace(/-(\w)/g,function(e,t){return t.toUpperCase();});i[l]=s;}}),i;}var Rq=function(){return Yk(function e(t,i){Xk(this,e),Wk(this,"inner",void 0),this.inner=new Aq(t,i);},[{key:"idPostfix",get:function get(){return this.inner.editorViewer.postfix;}},{key:"zoomOrigin",get:function get(){return this.inner.getZoomOrigin();},set:function set(e){this.inner.webViewer.setError("Successful"),this.inner.setZoomOrigin(e);}},{key:"show",value:function value(){return this.inner.webViewer.setError("Successful"),this.inner.show();}},{key:"hide",value:function value(){return this.inner.webViewer.setError("Successful"),this.inner.hideImageEditor();}},{key:"save",value:function value(){return this.inner.webViewer.setError("Successful"),this.inner.saveImageAsync();}},{key:"dispose",value:function value(){return this.inner.webViewer.setError("Successful"),this.inner.dispose();}},{key:"updateSelectionBoxStyle",value:function value(e){this.inner.setSelectionBoxStyle(e);}}]);}();function Nq(e,t){var i=t.getViewerConfig(),r=i.rows,n=i.columns,o=getComputedStyle(t.canvasContainer).fontSize,a=t.canvasContainer.getBoundingClientRect(),s=a.width,l=a.height,u=sW(e),c=s||0,h=l||0,d=sW(o).value,f=Math.floor(Math.min(h/(2*r+1),c/(2*n+1))),v=e,g=0;switch(u.unit){case"%":g=.01*u.value*c;break;case"em":g=u.value*d;break;default:g=u.value;}if(g>f)switch(u.unit){case"%":v="".concat(Math.floor(f/c*100),"%");break;case"em":v="".concat(Math.floor(f/d),"em");break;case"px":v="".concat(f,"px");break;default:v=f;}return v;}var Oq=function(){return Yk(function e(t,i){if(Xk(this,e),Wk(this,"stretchBarColor","black"),Wk(this,"bHide",!0),Wk(this,"pageMargin",10),Wk(this,"bSingleMode",!1),Wk(this,"bDispose",!1),Wk(this,"webViewer",void 0),Wk(this,"myThumbnailViewer",void 0),Wk(this,"thbStretchBar",null),Wk(this,"enableResizing",!1),Wk(this,"enableProps",["enableDragPage","enableResizing","autoSelectTopPage"]),Wk(this,"keyboardControl",!0),this.webViewer=t,i){var r=i.removeBtn;HN(null==r?void 0:r.removeMarkColor)||(r.checkMarkColor=r.removeMarkColor),HN(null==r?void 0:r.removeMarkLineWidth)||(r.checkMarkLineWidth=r.removeMarkLineWidth);var n=function(e){var t,i,r,n,o,a,s=e.size,l=e.pageMargin,u=e.checkbox,c=e.pageNumber,h=e.removeBtn,d=e.scrollDirection,f={};return $k(t=["showThumbnail","allowKeyboardControl","allowPageDragging","allowResizing","autoChangeIndex"]).call(t,function(t){var i;i=e[t],!HN(i)&&_N(i)&&(f[t]=e[t]);}),$k(i=["columns","rows"]).call(i,function(t){(function(e){var t=sW(e);return!(HN(t)||t.value<0);})(e[t])&&(f[t]=e[t]);}),$k(r=["background","hoverPageBackground","pageBackground","placeholderBackground","selectedPageBackground"]).call(r,function(t){XX(e[t])&&(f[t]=e[t]);}),$k(n=["border","hoverPageBorder","pageBorder","selectedPageBorder"]).call(n,function(t){qX(e[t])&&(f[t]=e[t]);}),$k(o=["location"]).call(o,function(t){var i;i=e[t],!HN(i)&&jN(i)&&(f[t]=e[t]);}),function(e){var t=sW(e);return!HN(t)&&!(t.value>100&&"%"===t.unit||t.value<0);}(s)&&(f.size=s),ZX(l)&&(f.pageMargin=l),HN(u)||(f.checkbox=u),HN(c)||(f.pageNumber=c),HN(h)||(f.removeBtn=h),-1!==WI(a=["vertical","horizontal"]).call(a,d)&&(f.scrollDirection=d),f;}(i);i=this.mergeThumbSettings(n);}else i=_LN(FL);this.myThumbnailViewer=this.webViewer.myViewer.createThumbnail(i),this.bDispose=!1,this.pageMargin=this.myThumbnailViewer.getThbConfigByName("gap"),this.webViewer.bThumbnailDispose=!1,this.setIfAutoScroll(this.webViewer.getIfAutoScroll()),i.show&&(this.bHide=!1,this.setPageMargin(this.pageMargin)),this.bindDefaultEvent(),this.initStretchBar(),this.allowResize=i.enableResizing;},[{key:"setDefaultError",value:function value(){var e=this.bDispose?"ThumbnailViewerDispose":"ThumbnailViewerNotExist";this.webViewer.setError(e);}},{key:"getLegalBorder",value:function value(e,t){var i,r;if(HN(e))return"";if(""===e)return"";var n=document.createElement("div");n.style.border=e;var o=n.style,a=o.borderWidth,s=o.borderColor,l=o.borderStyle;return uS(i=uS(r="".concat(""===a||"initial"===a||"medium"===a?"1px":a," ")).call(r,"initial"===l||"none"===l?"solid":l," ")).call(i,"initial"===s||"currentcolor"===s?t:s);}},{key:"mergeThumbSettings",value:function value(e){var t="horizontal",i=-1;switch(e.location||"left"){case"right":t="horizontal",i=1;break;case"top":t="vertical",i=-1;break;case"bottom":t="vertical",i=1;}var r=e.showThumbnail,n=e.size,o=e.columns,a=e.rows,s=e.autoChangeIndex,l=e.allowPageDragging,u=e.allowKeyboardControl,c=e.allowResizing,h=e.pageMargin,d=e.scrollDirection,f=e.background,v=e.border,g=e.hoverPageBackground,m=e.hoverPageBorder,y=e.pageBackground,p=e.pageBorder,w=e.placeholderBackground,b=e.selectedPageBackground,k=e.selectedPageBorder,S=h,x=h;a===o&&1===a&&(x=0,this.bSingleMode=!0);var C={location:t,sequence:i,show:r,size:n,columns:o,rows:a,autoSelectTopPage:s,enableDragPage:l,enableKeyboardControl:u,enableResizing:c,gap:S,margin:x,scrollDirection:d,thumbnailStyle:{background:f||this.webViewer.getBackground(),border:this.getLegalBorder(v,"rgba(0,0,0,0)")||""},hoveredPageStyle:{background:g||"rgb(239, 246, 253)",border:this.getLegalBorder(m,"rgb(238, 238, 238)")||"1px solid rgb(238, 238, 238)"},pageStyle:{background:y||"transparent",border:this.getLegalBorder(p,"rgb(238, 238, 238)")||"1px solid rgb(238, 238, 238)"},placeholderStyle:{background:w||"rgb(251, 236, 136)"},selectedPageStyle:{background:b||"rgb(199, 222, 252)",border:this.getLegalBorder(k,"rgb(125, 162, 206)")||"1px solid rgb(125, 162, 206)"},checkboxStyle:Fk(Fk({},this.webViewer.myViewer.getViewerConfig().checkboxStyle),xO(e.checkbox)),pageNumberStyle:Fk(Fk({},this.webViewer.myViewer.getViewerConfig().pageNumberStyle),xO(e.pageNumber)),removeBtnStyle:Fk(Fk({},this.webViewer.myViewer.getViewerConfig().removeBtnStyle),xO(e.removeBtn)),multiselectMode:1===this.webViewer.getMultiSelectMode()},V={};return tO(_LN(FL),V),tO(xO(C),V),V;}},{key:"bindDefaultEvent",value:function value(){this.myThumbnailViewer&&this.webViewer&&(this.bindDefaultKeyDown(),this.bindDefaultContextmenu());}},{key:"bindDefaultKeyDown",value:function value(){var e=this;this.myThumbnailViewer.on("keydown",function(t){if(e.keyboardControl)return"ArrowUp"===t.key||"Up"===t.key?(t.preventDefault(),void e.webViewer.previous()):void("ArrowDown"!==t.key&&"Down"!==t.key||(t.preventDefault(),e.webViewer.next()));});}},{key:"bindDefaultContextmenu",value:function value(){var e=this;this.myThumbnailViewer.on("contextmenu",function(t,i){e.webViewer.hideContextmenu&&i.preventDefault();});}},{key:"initStretchBar",value:function value(){var e=document.createElement("div");e.id="thbStretchBar",e.style.display="none",this.thbStretchBar=e;var t=this.getLocation(),i=this.myThumbnailViewer.innerViewer.rootDom;e.className="top"!==t&&"bottom"!==t?"dvs-thbStretchBarH dvs-thbStretchBar-".concat(t):"dvs-thbStretchBarV dvs-thbStretchBar-".concat(t),i.appendChild(e),this.bindStretchEvent(e);}},{key:"bindStretchEvent",value:function value(e){var t=this,i=0,r=0,n=!1,o=this.getLocation(),a=0,s=0,l=0,u=0,c=function c(_c3){if(t.myThumbnailViewer){var h=t.myThumbnailViewer.innerViewer.rootDom,d=t.webViewer.myViewer.rootDom,f=getComputedStyle(h),v=getComputedStyle(d);l=aW(f.width).value,u=aW(f.height).value,a=aW(v.width).value,s=aW(v.height).value,i=_c3.clientX,r=_c3.clientY,n=!0,o=t.getLocation(),e.style.background=t.stretchBarColor;}},h=function h(c){if(n&&t.myThumbnailViewer){var h="left"===o?c.clientX-i:i-c.clientX,d="top"===o?c.clientY-r:r-c.clientY;"right"===o&&t.thbStretchBar.classList.remove("dvs-thbStretchBar-right"),"bottom"===o&&t.thbStretchBar.classList.remove("dvs-thbStretchBar-bottom");var f=l+h;"top"!==o&&"bottom"!==o||(f=u+d),f<0&&(f=0),("left"===o||"right"===o)&&f>a&&(f=a),("top"===o||"bottom"===o)&&f>s&&(f=s),e.style[o]="".concat(f,"px");}},d=function d(i){if(n&&t.myThumbnailViewer){n=!1;var r,a=t.myThumbnailViewer.getThbConfigByName("size");switch(o){case"top":""!==e.style.top&&(r=aW(e.style.top),e.style.top="");break;case"bottom":""!==e.style.bottom&&(r=aW(e.style.bottom),e.style.bottom="",t.thbStretchBar.classList.add("dvs-thbStretchBar-bottom"));break;case"right":""!==e.style.right&&(r=aW(e.style.right),e.style.right="",t.thbStretchBar.classList.add("dvs-thbStretchBar-right"));break;default:""!==e.style.left&&(r=aW(e.style.left),e.style.left="");}e.style.background="",r&&a!==r.value&&(t.myThumbnailViewer.updateThbConfig({size:Math.floor(r.value)}),t.emitThumbnailResize(),t.resized());}};window.PointerEvent?(e.addEventListener("pointerdown",c),document.addEventListener("pointermove",h),document.addEventListener("pointerup",d)):window.MSPointerEvent?(e.addEventListener("MSPointerDown",c),document.addEventListener("MSPointerMove",h),document.addEventListener("MSPointerUp",d)):(e.addEventListener("mousedown",c),document.addEventListener("mousemove",h),document.addEventListener("mouseup",d));}},{key:"showThumbnail",get:function get(){return this.myThumbnailViewer.getThbConfig().show;},set:function set(e){this.showThumbnail===e&&!0===e||(this.bHide=!e,this.myThumbnailViewer.updateThbConfig({show:e}),this.setPageMargin(this.pageMargin));}},{key:"allowResize",get:function get(){return this.enableResizing;},set:function set(e){this.enableResizing=e,this.thbStretchBar.style.display=!0===e?"":"none";}},{key:"updateThumbnailConfig",value:function value(e){this.myThumbnailViewer.updateThbConfig(e);}},{key:"e",value:function value(){this.webViewer.setError("Successful");}},{key:"setError",value:function value(e){this.webViewer.setError(e);}},{key:"setBorder",value:function value(e){var t;if(!this.myThumbnailViewer)return!1;var i=this.getLocation(),r=this.myThumbnailViewer.innerViewer.defaultDom;if(!r)return!1;switch($k(t=["borderLeft","borderBottom","borderTop","borderRight"]).call(t,function(e){r.style[e]="";}),i){case"right":r.style.borderLeft=e;break;case"top":r.style.borderBottom=e;break;case"bottom":r.style.borderTop=e;break;default:r.style.borderRight=e;}return!0;}},{key:"getLocation",value:function value(){return this.myThumbnailViewer?"vertical"===this.myThumbnailViewer.getThbConfig().location?this.myThumbnailViewer.getThbConfig().sequence>0?"bottom":"top":this.myThumbnailViewer.getThbConfig().sequence>0?"right":"left":(this.setDefaultError(),"");}},{key:"setLocation",value:function value(e){var t=e||"left",i="horizontal",r=-1;if(this.myThumbnailViewer){switch(t){case"right":i="horizontal",r=1;break;case"top":i="vertical",r=-1;break;case"bottom":i="vertical",r=1;}this.myThumbnailViewer.updateThbConfig({location:i,sequence:r});var n=this.getLocation();return this.setBorder(this.webViewer.getBorder()),this.thbStretchBar.className="top"!==n&&"bottom"!==n?"dvs-thbStretchBarH dvs-thbStretchBar-".concat(n):"dvs-thbStretchBarV dvs-thbStretchBar-".concat(n),this.resized(),!0;}return this.setDefaultError(),!1;}},{key:"getSize",value:function value(){return this.myThumbnailViewer?this.myThumbnailViewer.getThbConfig().size:(this.setDefaultError(),!1);}},{key:"setSize",value:function value(e){return!/^((\d+em)|(\d+px)|(\d+%)|(\d+))$/.test(e)||e<0?(this.webViewer.setError("InvalidValue"),!1):e===this.myThumbnailViewer.getThbConfig().size||(this.myThumbnailViewer?(this.setPageMargin(this.pageMargin),this.myThumbnailViewer.updateThbConfig({size:e}),this.bHide?(this.show(),this.emitThumbnailResize(),this.hide()):this.emitThumbnailResize(),this.myThumbnailViewer.innerViewer.resized(),!0):(this.setDefaultError(),!1));}},{key:"getScrollDirection",value:function value(){return this.myThumbnailViewer?this.myThumbnailViewer.getThbConfig().scrollDirection:(this.setDefaultError(),!1);}},{key:"setScrollDirection",value:function value(e){return"horizontal"!==e&&(e="vertical"),this.myThumbnailViewer?(this.myThumbnailViewer.updateThbConfig({scrollDirection:e}),!0):(this.setDefaultError(),!1);}},{key:"getShowPageNumber",value:function value(){return this.myThumbnailViewer?"visible"===this.myThumbnailViewer.getThbConfig().pageNumberStyle.visibility:(this.setDefaultError(),!1);}},{key:"setShowPageNumber",value:function value(e){if(!_N(e))return this.webViewer.setError("InvalidValue"),!1;var t={visibility:e?"visible":"hidden"};return this.updatePageNumberStyle(t),!0;}},{key:"getShowCheckbox",value:function value(){return this.myThumbnailViewer?"visible"===this.myThumbnailViewer.getThbConfig().checkboxStyle.visibility:(this.setDefaultError(),!1);}},{key:"setShowCheckbox",value:function value(e){if(!_N(e))return this.webViewer.setError("InvalidValue"),!1;if(this.myThumbnailViewer){var t={visibility:e?"visible":"hidden"};this.updateCheckboxStyle(t);var i="visible"===t.visibility?1:0;return this.setMultiSelectMode(i),!0;}return this.setDefaultError(),!1;}},{key:"getShowRemoveBtn",value:function value(){return this.myThumbnailViewer?"visible"===this.myThumbnailViewer.getThbConfig().removeBtnStyle.visibility:(this.setDefaultError(),!1);}},{key:"setShowRemoveBtn",value:function value(e){if(!_N(e))return this.webViewer.setError("InvalidValue"),!1;if(this.myThumbnailViewer){var t={visibility:e?"visible":"hidden"};return this.updateRemoveBtnStyle(t),!0;}return this.setDefaultError(),!1;}},{key:"getPageMargin",value:function value(){if(this.myThumbnailViewer){var e=this.myThumbnailViewer.getThbConfig(),t=e.columns,i=e.rows;return t===i&&1===i?0:this.pageMargin;}return this.setDefaultError(),0;}},{key:"setPageMargin",value:function value(e){if(!/^((\d+em)|(\d+px)|(\d+%)|(\d+))$/.test(e)||e<0)return this.webViewer.setError("InvalidValue"),!1;this.pageMargin=e;var t=Nq(e,this.myThumbnailViewer.innerViewer);return this.myThumbnailViewer?(this.myThumbnailViewer.updateThbConfig({gap:t}),this.bSingleMode||this.myThumbnailViewer.updateThbConfig({margin:t}),this.resized(),!0):(this.setDefaultError(),!1);}},{key:"getEnableProp",value:function value(e){var t;return-1!==WI(t=this.enableProps).call(t,e)&&("enableResizing"===e?this.allowResize:this.myThumbnailViewer?this.myThumbnailViewer.getThbConfigByName(e):(this.setDefaultError(),!1));}},{key:"setEnableProp",value:function value(e,t){var i;return-1!==WI(i=this.enableProps).call(i,e)&&(_N(t)?("enableResizing"===e&&(this.allowResize=t),this.myThumbnailViewer?(this.myThumbnailViewer.updateThbConfig(Wk({},e,t)),!0):(this.setDefaultError(),!1)):(this.webViewer.setError("InvalidValue"),!1));}},{key:"getThumbSetting",value:function value(e){return this.myThumbnailViewer?this.myThumbnailViewer.getThbConfig().thumbnailStyle[e]:(this.setDefaultError(),"");}},{key:"setThumbSetting",value:function value(e,t){if(this.myThumbnailViewer){var i=Wk({},e,t);return this.myThumbnailViewer.updateThbConfig({thumbnailStyle:i}),!0;}return this.setDefaultError(),!1;}},{key:"getPageSetting",value:function value(e){return this.myThumbnailViewer?this.myThumbnailViewer.getThbConfig().pageStyle[e]:(this.setDefaultError(),"");}},{key:"setPageSetting",value:function value(e,t){if(this.myThumbnailViewer){var i=Wk({},e,t);return this.myThumbnailViewer.updateThbConfig({pageStyle:i}),!0;}return this.setDefaultError(),!1;}},{key:"getHoverSetting",value:function value(e){return this.myThumbnailViewer?this.myThumbnailViewer.getThbConfig().hoveredPageStyle[e]:(this.setDefaultError(),"");}},{key:"setHoverSetting",value:function value(e,t){if(this.myThumbnailViewer){var i=Wk({},e,t);return this.myThumbnailViewer.updateThbConfig({hoveredPageStyle:i}),!0;}return this.setDefaultError(),!1;}},{key:"getSelectSetting",value:function value(e){return this.myThumbnailViewer?this.myThumbnailViewer.getThbConfig().selectedPageStyle[e]:(this.setDefaultError(),"");}},{key:"setSelectSetting",value:function value(e,t){if(this.myThumbnailViewer){var i=Wk({},e,t);return this.myThumbnailViewer.updateThbConfig({selectedPageStyle:i}),!0;}return this.setDefaultError(),!1;}},{key:"getPlaceholderSetting",value:function value(e){return this.myThumbnailViewer?this.myThumbnailViewer.getThbConfig().placeholderStyle[e]:(this.setDefaultError(),"");}},{key:"setPlaceholderSetting",value:function value(e,t){if(this.myThumbnailViewer){var i=Wk({},e,t);return this.myThumbnailViewer.updateThbConfig({placeholderStyle:i}),!0;}return this.setDefaultError(),!1;}},{key:"show",value:function value(){return this.myThumbnailViewer?(this.webViewer.myViewer.setViewMode(1,1),this.webViewer.setIfSinglePageMode(!0),this.myThumbnailViewer.show(),this.bHide=!1,this.setPageMargin(this.pageMargin),!0):(this.setDefaultError(),!1);}},{key:"hide",value:function value(){return this.myThumbnailViewer?(this.bHide=!0,this.myThumbnailViewer.hide(),!0):(this.setDefaultError(),!1);}},{key:"dispose",value:function value(){if(this.bDispose)return!0;var e=this.webViewer.myViewer.removeThumbnail(this.myThumbnailViewer);return this.webViewer.resized(),e&&(this.bDispose=!0,this.webViewer.bThumbnailDispose=!0,this.myThumbnailViewer=void 0,this.webViewer.thumbnailViewer=void 0),e;}},{key:"updateViewMode",value:function value(e){if(!e)return this.webViewer.setError("InvalidValue"),!1;if(this.myThumbnailViewer){var t=e.columns,i=e.rows,r=e.scrollDirection;if(i&&t){var n;if(i<0||t<0)return this.webViewer.setError("InvalidPropertyValue"),!1;this.myThumbnailViewer.setViewMode(i,t),i===t&&1===i?(this.bSingleMode=!0,this.myThumbnailViewer.updateThbConfig({margin:0})):(this.bSingleMode=!1,this.setPageMargin(this.pageMargin),this.myThumbnailViewer.updateThbConfig({margin:this.myThumbnailViewer.getThbConfig().gap})),r&&-1!==WI(n=["horizontal","vertical"]).call(n,r)&&this.myThumbnailViewer.updateThbConfig({scrollDirection:r});}return this.resized(),!0;}return this.setDefaultError(),!1;}},{key:"updateCheckboxStyle",value:function value(e){return this.myThumbnailViewer?(this.myThumbnailViewer.updateThbConfig({checkboxStyle:e}),!0):(this.setDefaultError(),!1);}},{key:"updatePageNumberStyle",value:function value(e){return this.myThumbnailViewer?(this.myThumbnailViewer.updateThbConfig({pageNumberStyle:e}),!0):(this.setDefaultError(),!1);}},{key:"updateRemoveBtnStyle",value:function value(e){if(this.myThumbnailViewer){var t=Fk({},e);return HN(null==e?void 0:e.removeMarkColor)||(t.checkMarkColor=null==e?void 0:e.removeMarkColor),HN(null==e?void 0:e.removeMarkLineWidth)||(t.checkMarkLineWidth=null==e?void 0:e.removeMarkLineWidth),this.myThumbnailViewer.updateThbConfig({removeBtnStyle:t}),!0;}return this.setDefaultError(),!1;}},{key:"on",value:function value(e,t){if(e)if(GN(t)){var i=e;switch(e){case"onDrop":i="drop";break;case"rightclick":i="contextmenu";break;case"resize":i="dwtResize";break;default:i=e;}this.myThumbnailViewer.on(i,t);}else this.webViewer.setError("CallbackNotAFunction");}},{key:"off",value:function value(e,t){if(e){var i=e;switch(e){case"onDrop":i="drop";break;case"rightclick":i="contextmenu";break;case"resize":i="dwtResize";break;default:i=e;}if(HN(t))return this.myThumbnailViewer.off(i),"keydown"===i&&this.bindDefaultKeyDown(),void("contextmenu"===i&&this.bindDefaultContextmenu());GN(t)?this.myThumbnailViewer.off(i,t):this.webViewer.setError("CallbackNotAFunction");}}},{key:"setIfAutoScroll",value:function value(e){return!!this.myThumbnailViewer&&(this.myThumbnailViewer.updateThbConfig({autoSelectLatest:e,autoScroll:e}),!0);}},{key:"setMultiSelectMode",value:function value(e){return ZN(e)?this.myThumbnailViewer?(this.myThumbnailViewer.updateThbConfig({multiselectMode:1===e}),!0):(this.setDefaultError(),!1):(this.webViewer.setError("InvalidValue"),!1);}},{key:"emitThumbnailResize",value:function value(){if(this.myThumbnailViewer){var e=this.myThumbnailViewer.innerViewer.defaultDom;if(e){var t=e.getClientRects();if(!(t.length<1)){var i=t[0],r=i.width,n=i.height;this.myThumbnailViewer.innerViewer.emit("dwtResize",r,n);}}}}},{key:"resized",value:function value(){this.myThumbnailViewer&&this.myThumbnailViewer.innerViewer.resized();}},{key:"showFocusOutLine",value:function value(e){this.myThumbnailViewer&&this.myThumbnailViewer.innerViewer.context.setDisableFocusOutline(!e);}},{key:"getVisiblePagesInfo",value:function value(){return this.myThumbnailViewer?this.myThumbnailViewer.innerViewer.context.getVisiblePagesInfo():[];}}]);}(),Lq=function(){return Yk(function e(t,i){Xk(this,e),Wk(this,"inner",void 0),this.inner=new Oq(t,i);},[{key:"location",get:function get(){return this.inner.e(),this.inner.getLocation();},set:function set(e){this.inner.e(),this.inner.setLocation(e);}},{key:"size",get:function get(){return this.inner.e(),this.inner.getSize();},set:function set(e){this.inner.e(),this.inner.setSize(e);}},{key:"scrollDirection",get:function get(){return this.inner.e(),this.inner.getScrollDirection();},set:function set(e){this.inner.e(),this.inner.setScrollDirection(e);}},{key:"showPageNumber",get:function get(){return this.inner.e(),this.inner.getShowPageNumber();},set:function set(e){this.inner.e(),this.inner.setShowPageNumber(e);}},{key:"showCheckbox",get:function get(){return this.inner.e(),this.inner.getShowCheckbox();},set:function set(e){this.inner.e(),this.inner.setShowCheckbox(e);}},{key:"showRemoveBtn",get:function get(){return this.inner.e(),this.inner.getShowRemoveBtn();},set:function set(e){this.inner.e(),this.inner.setShowRemoveBtn(e);}},{key:"pageMargin",get:function get(){return this.inner.e(),this.inner.getPageMargin();},set:function set(e){this.inner.e(),ZX(e)?this.inner.setPageMargin(e):this.inner.setError("InvalidValue");}},{key:"border",get:function get(){return this.inner.e(),this.inner.getThumbSetting("border");},set:function set(e){this.inner.e(),qX(e)&&this.inner.setThumbSetting("border",e);}},{key:"background",get:function get(){return this.inner.e(),this.inner.getThumbSetting("background");},set:function set(e){this.inner.e(),ZN(e)&&(e=YX(e)),XX(e)&&this.inner.setThumbSetting("background",e);}},{key:"pageBackground",get:function get(){return this.inner.e(),this.inner.getPageSetting("background");},set:function set(e){this.inner.e(),ZN(e)&&(e=YX(e)),XX(e)&&this.inner.setPageSetting("background",e);}},{key:"pageBorder",get:function get(){return this.inner.e(),this.inner.getPageSetting("border");},set:function set(e){this.inner.e(),qX(e)&&this.inner.setPageSetting("border",e);}},{key:"hoverPageBackground",get:function get(){return this.inner.e(),this.inner.getHoverSetting("background");},set:function set(e){this.inner.e(),ZN(e)&&(e=YX(e)),XX(e)&&this.inner.setHoverSetting("background",e);}},{key:"hoverPageBorder",get:function get(){return this.inner.e(),this.inner.getHoverSetting("border");},set:function set(e){this.inner.e(),qX(e)&&this.inner.setHoverSetting("border",e);}},{key:"placeholderBackground",get:function get(){return this.inner.e(),this.inner.getPlaceholderSetting("background");},set:function set(e){this.inner.e(),ZN(e)&&(e=YX(e)),XX(e)&&this.inner.setPlaceholderSetting("background",e);}},{key:"selectedPageBorder",get:function get(){return this.inner.e(),this.inner.getSelectSetting("border");},set:function set(e){this.inner.e(),qX(e)&&this.inner.setSelectSetting("border",e);}},{key:"selectedPageBackground",get:function get(){return this.inner.e(),this.inner.getSelectSetting("background");},set:function set(e){this.inner.e(),ZN(e)&&(e=YX(e)),XX(e)&&this.inner.setSelectSetting("background",e);}},{key:"allowKeyboardControl",get:function get(){return this.inner.e(),this.inner.keyboardControl;},set:function set(e){this.inner.e(),_N(e)&&(this.inner.keyboardControl=e);}},{key:"allowPageDragging",get:function get(){return this.inner.e(),this.inner.getEnableProp("enableDragPage");},set:function set(e){this.inner.e(),this.inner.setEnableProp("enableDragPage",e);}},{key:"allowResizing",get:function get(){return this.inner.e(),this.inner.getEnableProp("enableResizing");},set:function set(e){this.inner.e(),this.inner.setEnableProp("enableResizing",e);}},{key:"autoChangeIndex",get:function get(){return this.inner.e(),this.inner.getEnableProp("autoSelectTopPage");},set:function set(e){this.inner.e(),this.inner.setEnableProp("autoSelectTopPage",e);}},{key:"show",value:function value(){return this.inner.e(),this.inner.show();}},{key:"hide",value:function value(){return this.inner.e(),this.inner.hide();}},{key:"dispose",value:function value(){return this.inner.e(),this.inner.dispose();}},{key:"updateViewMode",value:function value(e){return this.inner.e(),this.inner.updateViewMode(e);}},{key:"updateCheckboxStyle",value:function value(e){return this.inner.e(),this.inner.updateCheckboxStyle(e);}},{key:"updatePageNumberStyle",value:function value(e){return this.inner.e(),this.inner.updatePageNumberStyle(e);}},{key:"on",value:function value(e,t){return this.inner.e(),this.inner.on(e,t);}},{key:"off",value:function value(e,t){return this.inner.e(),this.inner.off(e,t);}},{key:"getVisiblePagesInfo",value:function value(){return this.inner.e(),this.inner.getVisiblePagesInfo();}}]);}(),Wq={root:{style:{},className:"dvs-web-viewer",id:"root",children:[{type:"Group",dataId:"body",className:"dvs-body",children:[{type:"MainCanvas",style:{},dataId:"canvas",className:"dvs-canvas"}]}]}},Hq=function(){function e(t,i){Xk(this,e),Wk(this,"myDvs",void 0),Wk(this,"myViewer",void 0),Wk(this,"error",void 0),Wk(this,"containerElement",void 0),Wk(this,"imageEditor",void 0),Wk(this,"customElement",void 0),Wk(this,"thumbnailViewer",void 0),Wk(this,"bindViewUI",!1),Wk(this,"hideContextmenu",!0),Wk(this,"acceptDrop",void 0),Wk(this,"bShowImageEditor",void 0),Wk(this,"bThumbnailDispose",void 0),Wk(this,"bufferService",void 0),Wk(this,"webViewerInitConfig",{}),Wk(this,"bEmitBufferChanged",!0),Wk(this,"pageMargin",10),Wk(this,"initWidth",void 0),Wk(this,"initHeight",void 0),Wk(this,"bSingleMode",!0),Wk(this,"oldEnableDrag",!0),Wk(this,"oldBShowThumbnail",!1),Wk(this,"outerBorder","1px solid rgb(204, 204, 204)"),Wk(this,"minZoom",.02),Wk(this,"maxZoom",65),Wk(this,"bindViewEvent",!1),Wk(this,"resizeObserver",null),this.acceptDrop=!0,this.bShowImageEditor=!1,this.error=new qL(),this.bufferService=t||new ZL(),this.webViewerInitConfig=i||{},this.init(),this.bufferService.bindViewer(this);}return Yk(e,[{key:"init",value:function value(){var t=this;e.isInstallDVSPlugin||(SY.use(DX),SY.use(FX),SY.use(QY),SY.use(nW),SY.use(AX),e.isInstallDVSPlugin=!0),this.myDvs=new SY({space:this.bufferService.space,container:""}),this.myViewer=this.myDvs.createViewer({uiConfig:_LN(Wq),viewerConfig:_LN(HL)}),this.myViewer.updateViewerConfig({cropBoxConfig:_LN(XL)});var i=this.webViewerInitConfig.viewerEvents;GN(null==i?void 0:i.bufferChanged)&&this.myViewer.on("bufferChanged",function(e,r){t.bEmitBufferChanged&&i.bufferChanged(e,r);}),GN(null==i?void 0:i.removeBtnClick)&&this.myViewer.on("removeBtnClick",function(e){i.removeBtnClick(e);}),this.initBind();}},{key:"initBind",value:function value(){var e=this.webViewerInitConfig.viewerContainer;if(HN(e))return!1;var t=e.container,i=e.width,r=e.height;return!!this.bindView(t)&&(HN(i)||(this.setWidth(i),this.initWidth=this.getWidth()),HN(r)||(this.setHeight(r),this.initHeight=this.getHeight()),this.show(),!0);}},{key:"bindDefaultKeyEvent",value:function value(){var e=this;this.myViewer.on("keydown",function(t){var i=e.myViewer.getViewerConfig(),r=i.rows,n=i.columns,o=i.displayMode;if(!(r<1&&n<1||"single"===o))return"ArrowUp"===t.key||"Up"===t.key?(t.preventDefault(),void e.previous()):void("ArrowDown"!==t.key&&"Down"!==t.key||(t.preventDefault(),e.next()));});}},{key:"bindDefaultDrop",value:function value(){var e=this,t=this.webViewerInitConfig.viewerEvents;this.myViewer.on("drop",function(i,r){e.acceptDrop&&t.onDrop(i,r);});}},{key:"bindDefaultRightClick",value:function value(){var e=this.webViewerInitConfig.viewerEvents;this.myViewer.on("contextmenu",function(t,i){e.rightclick(t,i);});}},{key:"preventDefaultContextmenu",value:function value(){var e=this;this.myViewer.on("contextmenu",function(t,i){e.hideContextmenu&&i.preventDefault();});}},{key:"bindViewerEvents",value:function value(){var e=this;if(this.myViewer){var t=this.webViewerInitConfig.viewerEvents;this.myViewer.off("bufferChanged"),this.bindDefaultKeyEvent(),this.preventDefaultContextmenu(),$k(WL).call(WL,function(i){t&&GN(t[i])&&("onDrop"===i?e.bindDefaultDrop():"rightclick"===i?e.bindDefaultRightClick():"bufferChanged"===i?e.myViewer.on("bufferChanged",function(i,r){e.bEmitBufferChanged&&t.bufferChanged(i,r);}):e.myViewer.on(i,function(e,r){t[i](e,r);}));}),this.bindViewEvent=!0;}}},{key:"unbindViewEvents",value:function value(){var e=this;$k(WL).call(WL,function(t){"bufferChanged"!==t&&e.myViewer.off(t);});}},{key:"initViewer",value:function value(){this.myViewer.updateViewerConfig({autoSelectLatest:!0,maxZoom:this.maxZoom,minZoom:this.minZoom}),$N()?this.setCursor("default"):this.setCursor("crosshair"),this.setAcceptDrop(!0),this.setAllowSlide(!0);}},{key:"getErrorInfo",value:function value(e){return RL[e].errorString||"Successful";}},{key:"disConnectObserver",value:function value(){this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null);}},{key:"emitPageRendered",value:function value(){var e,t=this;this.myViewer.updateViewerConfig({enableEmitPageRendered:!0});var i=this.myViewer.getCurrentTab();i&&$k(e=i.children).call(e,function(e,i){e.isVisible&&t.myViewer.emit("pageRendered",i);});}},{key:"updateViewerConfig",value:function value(e){this.myViewer.updateViewerConfig(e);}},{key:"resetImageEditorButton",value:function value(){this.imageEditor&&this.imageEditor.inner.resetButtonState();}},{key:"resized",value:function value(){return!!this.myViewer&&(this.myViewer.resized(),!0);}},{key:"setBufferService",value:function value(e){return!!e&&e!==this.bufferService&&(this.bufferService.webViewer=void 0,this.myDvs.setSpace(e.space),this.bufferService=e,this.bufferService.bindViewer(this),this.bufferService.isActiveFile?this.bufferService.openDocument(this.bufferService.getCurrentDocument()):this.bufferService.isActiveTag&&this.bufferService.filterImagesByTag(this.bufferService.getCurrentTag(),function(){},function(){}),this.resized(),!0);}},{key:"setDefaultError",value:function value(){var e=this.webViewerInitConfig.viewerError,t=this.myDvs.context.errorService,i=t.errorCode,r=t.errorMessage;GN(null==e?void 0:e.setError)&&null!=e&&e.setError(i,r),this.error.setError(i,r);}},{key:"setError",value:function value(e){var t=this.webViewerInitConfig.viewerError,i=RL[e],r=i.errorCode,n=i.errorString;GN(null==t?void 0:t.setError)&&null!=t&&t.setError(r,n),this.error.setError(r,n);}},{key:"show",value:function value(){return this.bindViewUI?!!this.myViewer&&(this.myViewer.show(),this.setPageMargin(this.pageMargin),!0):(this.setError("UnBindViewer"),!1);}},{key:"hide",value:function value(){return this.bindViewUI?!!this.myViewer&&(this.myViewer.hide(),!0):(this.setError("UnBindViewer"),!1);}},{key:"setOperationMode",value:function value(e){if(this.myViewer){var t="default";switch(e){case 1:t="crop";break;case 3:t="zoomOut";break;case 2:t="zoomIn";break;case 4:t="annotation";break;default:t="default";}this.myViewer.updateViewerConfig({toolType:t});}}},{key:"bindView",value:function value(e){var t,i,r,n=this,o=null;if(this.closeImageEditor(),e&&(o="DIV"===(null==e?void 0:e.nodeName)?e:document.getElementById(e)),HN(o)||QN(o))return this.setError("ElementNotExist"),!1;if(jN(o.id)||(o.id=rO()),(null===(t=o)||void 0===t||null===(i=t.getElementsByClassName("dvs-root dvs-web-viewer"))||void 0===i?void 0:i.length)>0)return this.setError("AlReadyBindViewer"),!1;if(!(r=this.myViewer.bindContainer(o)))return this.setDefaultError(),!1;var a=this.webViewerInitConfig.viewerEvents;if(a&&GN(a.onBind)&&a.onBind(o),this.bindViewUI=!0,this.containerElement=o,this.initWidth=this.getWidth(),this.initHeight=this.getHeight(),this.initViewer(),this.setBorder(this.outerBorder),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),GN(window.ResizeObserver)){var s=new ResizeObserver(function(){var e;(null===(e=document)||void 0===e?void 0:e.body)&&n.render();});s.observe(this.myViewer.rootDom),this.resizeObserver=s;}else this.resizeObserver=null;return this.bindViewUI&&!this.bindViewEvent&&this.bindViewerEvents(),r;}},{key:"unbindView",value:function value(){if(!this.bindViewUI)return!0;var e;if(this.resetViewerSettings(!1),this.disposeComponent(),e=this.myViewer.unbindContainer()){this.hide(),this.unbindViewEvents(),this.bindViewUI=!1,this.bindViewEvent=!1;var t=this.webViewerInitConfig.viewerEvents;t&&GN(t.onUnBind)&&t.onUnBind(this.containerElement),this.containerElement="";}else this.setDefaultError();return e;}},{key:"getIdPostfix",value:function value(){return this.bindViewUI?!!this.myViewer&&this.myViewer.postfix:(this.setError("UnBindViewer"),"");}},{key:"getCursor",value:function value(){return this.bindViewUI?!!this.myViewer&&this.myViewer.getViewerConfig().canvasStyle.cursor:(this.setError("UnBindViewer"),"");}},{key:"setCursor",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;if(!this.myViewer)return!1;if(("zoom-in"===e||"zoom-out"===e)&&!this.getIfSinglePageMode())return this.setError("CursorInvalidMode"),!1;"crosshair"===this.getCursor()&&"crosshair"!==e&&this.clearSelectedAreas();var t="default",i=0;switch(e){case"zoom-out":t="zoom-out",i=3;break;case"zoom-in":t="zoom-in",i=2;break;case"crosshair":t="crosshair",i=1;break;case"pointer":t="pointer",i=0;break;default:t="default",i=0;}return this.myViewer.updateViewerConfig({canvasStyle:{cursor:t}}),this.setOperationMode(i),!0;}},{key:"setIfSinglePageMode",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;if(!this.myViewer)return!1;var t=e?"single":"multiple",i=0;if(e)this.bSingleMode=!0,i=0;else{var r=this.myViewer.getViewerConfig(),n=r.rows,o=r.columns;(n>1||o>1)&&(i=this.myViewer.getViewerConfig().gap,this.bSingleMode=!1);}return this.myViewer.updateViewerConfig({displayMode:t,margin:i}),this.clearSelectedAreas(),this.resized(),!0;}},{key:"getIfSinglePageMode",value:function value(){return this.bindViewUI?!!this.myViewer&&"single"===this.myViewer.getViewerConfigByName("displayMode"):(this.setError("UnBindViewer"),!1);}},{key:"setZoom",value:function value(e){return this.bindViewUI?!!this.myViewer&&(this.myViewer.updateViewerConfig({zoom:e}),!0):(this.setError("UnBindViewer"),!1);}},{key:"getZoom",value:function value(){return this.bindViewUI?!!this.myViewer&&this.myViewer.getViewerConfigByName("zoom"):(this.setError("UnBindViewer"),"");}},{key:"setZoomOrigin",value:function value(e){var t,i;if(!this.bindViewUI)return this.setError("UnBindViewer"),"";if(!this.myViewer)return!1;if(!ON(e)||!jN(null==e?void 0:e.x)||!jN(null==e?void 0:e.y))return this.setError("InvalidValue"),!1;var r=e.x,n=e.y;return-1===WI(t=["left","right","center"]).call(t,r)||-1===WI(i=["top","bottom","center"]).call(i,n)?(this.setError("InvalidValue"),!1):(this.updateViewerConfig({zoomOrigin:{x:r,y:n}}),!0);}},{key:"getZoomOrigin",value:function value(){return this.bindViewUI?!!this.myViewer&&this.myViewer.getViewerConfigByName("zoomOrigin"):(this.setError("UnBindViewer"),"");}},{key:"setAcceptDrop",value:function value(e){return this.bindViewUI?!!this.myViewer&&(_N(e)?(this.acceptDrop=e,!0):(this.setError("InvalidValue"),!1)):(this.setError("UnBindViewer"),!1);}},{key:"getAcceptDrop",value:function value(){return this.bindViewUI?!!this.myViewer&&this.acceptDrop:(this.setError("UnBindViewer"),"");}},{key:"setAllowSlide",value:function value(e){return this.bindViewUI?!!this.myViewer&&(_N(e)?(this.myViewer.updateViewerConfig({enableSlide:e}),!0):(this.setError("InvalidValue"),!1)):(this.setError("UnBindViewer"),!1);}},{key:"getAllowSlide",value:function value(){return this.bindViewUI?!!this.myViewer&&this.myViewer.getViewerConfigByName("enableSlide"):(this.setError("UnBindViewer"),"");}},{key:"setShowRemoveBtn",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;if(!this.myViewer)return!1;if(!_N(e))return this.setError("InvalidValue"),!1;var t=e?"visible":"hidden";return this.myViewer.updateViewerConfig({removeBtnStyle:{visibility:t}}),!0;}},{key:"getShowRemoveBtn",value:function value(){return this.bindViewUI?!!this.myViewer&&"visible"===this.myViewer.getViewerConfig().removeBtnStyle.visibility:(this.setError("UnBindViewer"),"");}},{key:"setShowCheckbox",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;if(!this.myViewer)return!1;if(!_N(e))return this.setError("InvalidValue"),!1;var t=e?"visible":"hidden",i="visible"===t?1:0;return this.myViewer.updateViewerConfig({checkboxStyle:{visibility:t}}),this.setMultiSelectMode(i),this.thumbnailViewer&&(this.thumbnailViewer.showCheckbox=!0),!0;}},{key:"getShowCheckbox",value:function value(){return this.bindViewUI?!!this.myViewer&&"visible"===this.myViewer.getViewerConfig().checkboxStyle.visibility:(this.setError("UnBindViewer"),"");}},{key:"getSelectionRectAspectRatio",value:function value(){if(!this.bindViewUI)return this.setError("UnBindViewer"),"";if(!this.myViewer)return!1;var e=this.myViewer.cropBoxConfig,t=e.aspectRatio;return!1===e.keepAspectRatio||t<1?0:this.myViewer.cropBoxConfig.aspectRatio;}},{key:"setSelectionRectAspectRatio",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;if(!this.myViewer)return!1;var t=e>0,i=e>0?e:0;return this.myViewer.updateViewerConfig({cropBoxConfig:{aspectRatio:i,keepAspectRatio:t}}),!0;}},{key:"getIfAutoScroll",value:function value(){return this.bindViewUI?!!this.myViewer&&this.myViewer.getViewerConfig().autoScroll:(this.setError("UnBindViewer"),"");}},{key:"setIfAutoScroll",value:function value(e){return this.bindViewUI?!!this.myViewer&&(_N(e)?(this.thumbnailViewer&&this.thumbnailViewer.inner.setIfAutoScroll(e),this.imageEditor&&this.imageEditor.inner.setIfAutoScroll(e),this.myViewer.updateViewerConfig({autoSelectLatest:e,autoScroll:e}),!0):(this.setError("InvalidValue"),!1)):(this.setError("UnBindViewer"),!1);}},{key:"getPageMargin",value:function value(){return this.bindViewUI?!!this.myViewer&&this.pageMargin:(this.setError("UnBindViewer"),0);}},{key:"setPageMargin",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;if(!this.myViewer)return!1;if(!/^((\d+em)|(\d+px)|(\d+%)|(\d+))$/.test(e)||e<0)return this.setError("InvalidValue"),!1;if(!ZX(e))return!1;this.pageMargin=e;var t=Nq(e,this.myViewer);return this.myViewer.updateViewerConfig({gap:t}),this.bSingleMode||this.myViewer.updateViewerConfig({margin:t}),this.resized(),!0;}},{key:"getWidth",value:function value(){if(!this.bindViewUI)return this.setError("UnBindViewer"),"";if(this.myViewer){var e=this.myViewer.dwtWidth||"";if(window.navigator.userAgent.match(/Trident/g)||window.navigator.userAgent.match(/MSIE/g)){var t=this.myViewer.rootDom,i=getComputedStyle(t).borderLeftWidth,r=2*aW(i).value;if(ZN(e))return e+r;}return e;}return"";}},{key:"setWidth",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;if(jN(e)&&!/^((\d+em)|(\d+px)|(\d+%)|(\d+))$/.test(e)||ZN(e)&&e<0)return this.setError("InvalidWidth"),!1;if(e===this.myViewer.dwtWidth)return!0;if(this.myViewer.dwtWidth=e,this.myViewer.getViewerConfig().show&&this.setPageMargin(this.pageMargin),this.thumbnailViewer){var t=this.thumbnailViewer.size;"%"===sW(t).unit&&this.thumbnailViewer.inner.emitThumbnailResize();}return!0;}},{key:"getHeight",value:function value(){if(!this.bindViewUI)return this.setError("UnBindViewer"),"";if(this.myViewer){var e=this.myViewer.dwtHeight||"";if(window.navigator.userAgent.match(/Trident/g)||window.navigator.userAgent.match(/MSIE/g)){var t=this.myViewer.rootDom,i=getComputedStyle(t).borderLeftWidth,r=2*aW(i).value;if(ZN(e))return e+r;}return e;}return"";}},{key:"setHeight",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;if(jN(e)&&!/^((\d+em)|(\d+px)|(\d+%)|(\d+))$/.test(e)||ZN(e)&&e<0)return this.setError("InvalidHeight"),!1;if(e===this.myViewer.dwtHeight)return!0;if(this.myViewer.dwtHeight=e,this.myViewer.getViewerConfig().show&&this.setPageMargin(this.pageMargin),this.thumbnailViewer){var t=this.thumbnailViewer.size;"%"===sW(t).unit&&this.thumbnailViewer.inner.emitThumbnailResize();}return!0;}},{key:"getBackground",value:function value(){return this.bindViewUI?this.myViewer?this.myViewer.getViewerConfig().canvasStyle.background:"":(this.setError("UnBindViewer"),"");}},{key:"setBackground",value:function value(e){return this.bindViewUI?!(!this.myViewer&&!this.thumbnailViewer||!XX(e)||(this.myViewer&&this.myViewer.updateViewerConfig({canvasStyle:{background:e}}),this.thumbnailViewer&&(this.thumbnailViewer.background=e),0)):(this.setError("UnBindViewer"),!1);}},{key:"getBorder",value:function value(){return this.bindViewUI?this.outerBorder:(this.setError("UnBindViewer"),"");}},{key:"setBorder",value:function value(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;if(!this.myViewer)return!1;if(!qX(e))return!1;var i=this.myViewer.rootDom;return i&&(i.style.border=e),this.outerBorder=e,this.thumbnailViewer&&this.thumbnailViewer.inner.setBorder(e),t&&this.myViewer.externalResized(),!0;}},{key:"getInnerBorder",value:function value(){return this.bindViewUI?!!this.myViewer&&this.myViewer.getViewerConfig().viewerStyle.border:(this.setError("UnBindViewer"),"");}},{key:"setInnerBorder",value:function value(e){return this.bindViewUI?!!this.myViewer&&!!qX(e)&&(this.myViewer.updateViewerConfig({viewerStyle:{border:e}}),this.resized(),!0):(this.setError("UnBindViewer"),!1);}},{key:"getSelectedPageBorder",value:function value(){return this.bindViewUI?!!this.myViewer&&this.myViewer.getViewerConfig().selectedPageStyle.border:(this.setError("UnBindViewer"),"");}},{key:"setSelectedPageBorder",value:function value(e){return this.bindViewUI?!!this.myViewer&&!!qX(e)&&(this.myViewer.updateViewerConfig({selectedPageStyle:{border:e}}),this.thumbnailViewer&&(this.thumbnailViewer.selectedPageBorder=e),!0):(this.setError("UnBindViewer"),!1);}},{key:"getSelectedPageBackground",value:function value(){return this.bindViewUI?!!this.myViewer&&this.myViewer.getViewerConfig().selectedPageStyle.background:(this.setError("UnBindViewer"),"");}},{key:"setSelectedPageBackground",value:function value(e){return this.bindViewUI?!(!this.myViewer&&!this.thumbnailViewer||!XX(e)||(this.myViewer.updateViewerConfig({selectedPageStyle:{background:e}}),this.thumbnailViewer&&(this.thumbnailViewer.selectedPageBackground=e),0)):(this.setError("UnBindViewer"),!1);}},{key:"getShowPageNumber",value:function value(){return this.bindViewUI?!!this.myViewer&&"visible"===this.myViewer.getViewerConfig().pageNumberStyle.visibility:(this.setError("UnBindViewer"),"");}},{key:"setShowPageNumber",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;if(!this.myViewer)return!1;if(!_N(e))return this.setError("InvalidValue"),!1;var t={visibility:e?"visible":"hidden"};return this.updatePageNumberStyle(t),!0;}},{key:"setMultiSelectMode",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;if(!this.myViewer)return!1;if(!ZN(e))return this.setError("InvalidValue"),!1;var t=1===e;return this.myViewer.updateViewerConfig({multiselectMode:t}),this.thumbnailViewer&&this.thumbnailViewer.inner.setMultiSelectMode(e),t&&this.setCursor("pointer"),!0;}},{key:"getMultiSelectMode",value:function value(){return this.bindViewUI?!!this.myViewer&&(this.myViewer.getViewerConfig().multiselectMode?1:0):(this.setError("UnBindViewer"),"");}},{key:"setAllowPageDragging",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;if(!this.myViewer)return!1;if(!_N)return this.setError("InvalidValue"),!1;var t=e;return this.bSingleMode&&(this.oldEnableDrag=e,t=!1),this.myViewer.updateViewerConfig({enableDragPage:t}),!0;}},{key:"getAllowPageDragging",value:function value(){return this.bindViewUI?!!this.myViewer&&(this.bSingleMode?this.oldEnableDrag:this.myViewer.getViewerConfig().enableDragPage):(this.setError("UnBindViewer"),"");}},{key:"getAutoChangeIndex",value:function value(){return this.bindViewUI?!!this.myViewer&&this.myViewer.getViewerConfig().autoSelectTopPage:(this.setError("UnBindViewer"),"");}},{key:"setAutoChangeIndex",value:function value(e){return this.bindViewUI?!!this.myViewer&&(_N(e)?(this.myViewer.updateViewerConfig({autoSelectTopPage:e}),!0):(this.setError("InvalidValue"),!1)):(this.setError("UnBindViewer"),!1);}},{key:"getSelectedAreaBorderColor",value:function value(){return this.bindViewUI?!!this.myViewer&&this.myViewer.cropBoxConfig.borderColor:(this.setError("UnBindViewer"),"");}},{key:"setSelectedAreaBorderColor",value:function value(e){return this.bindViewUI?!!this.myViewer&&!!XX(e)&&(this.myViewer.updateViewerConfig({cropBoxConfig:{borderColor:e,ctrlBorderColor:e}}),!0):(this.setError("UnBindViewer"),!1);}},{key:"updateCheckboxStyle",value:function value(e){return this.bindViewUI?(this.myViewer.updateViewerConfig({checkboxStyle:e}),this.thumbnailViewer&&this.thumbnailViewer.inner.updateCheckboxStyle(e),!0):(this.setError("UnBindViewer"),!1);}},{key:"updatePageNumberStyle",value:function value(e){return this.bindViewUI?!(!this.myViewer&&!this.thumbnailViewer||(this.myViewer&&this.myViewer.updateViewerConfig({pageNumberStyle:e}),this.thumbnailViewer&&this.thumbnailViewer.updatePageNumberStyle(e),0)):(this.setError("UnBindViewer"),!1);}},{key:"updateRemoveBtnStyle",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;var t=Fk({},e);return HN(null==e?void 0:e.removeMarkColor)||(t.checkMarkColor=null==e?void 0:e.removeMarkColor),HN(null==e?void 0:e.removeMarkLineWidth)||(t.checkMarkLineWidth=null==e?void 0:e.removeMarkLineWidth),this.myViewer.updateViewerConfig({removeBtnStyle:t}),this.thumbnailViewer&&this.thumbnailViewer.inner.updateRemoveBtnStyle(t),!0;}},{key:"getUISettings",value:function value(){return this.bindViewUI?!!this.myViewer&&this.myViewer.uiConfig:(this.setError("UnBindViewer"),!1);}},{key:"resetViewerSettings",value:function value(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;if(!this.myViewer)return!1;var t=_LN(HL);return this.initViewer(),this.setWidth(this.initWidth),this.setHeight(this.initHeight),this.setBorder("1px solid rgb(204, 204, 204)",e),this.pageMargin=10,this.bSingleMode=!0,this.oldEnableDrag=!0,this.myViewer.updateViewerConfig({rows:1,columns:1,margin:0,gap:10,zoom:1,enableDragPage:!1,scrollDirection:"vertical",displayMode:"multiple",fitType:"window",autoSelectTopPage:!1,autoScroll:!0,viewerStyle:t.viewerStyle,canvasStyle:t.canvasStyle,pageStyle:t.pageStyle,selectedPageStyle:t.selectedPageStyle,hoveredPageStyle:t.hoveredPageStyle,placeholderStyle:t.placeholderStyle,checkboxStyle:t.checkboxStyle,pageNumberStyle:t.pageNumberStyle}),this.resized(),!0;}},{key:"updateUISettings",value:function value(){return!!this.bindViewUI||(this.setError("UnBindViewer"),!1);}},{key:"setSelectionBoxStyle",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),"";if(!ON(e))return!1;if(!this.myViewer)return!1;var t=Dq(e);return this.updateCropBoxConfig(t),!0;}},{key:"getSelectionBoxStyle",value:function value(){return this.bindViewUI?!!this.myViewer&&Mq(this.myViewer.cropBoxConfig):(this.setError("UnBindViewer"),"");}},{key:"updateCropBoxConfig",value:function value(e){return!!this.myViewer&&(this.myViewer.updateViewerConfig({cropBoxConfig:e}),!0);}},{key:"isFocusOutLine",value:function value(){return!!this.myViewer&&this.myViewer.context.showOutline;}},{key:"showFocusOutLine",value:function value(e){this.thumbnailViewer&&this.thumbnailViewer.inner.showFocusOutLine(e),this.imageEditor&&this.imageEditor.inner.editorViewer.context.setDisableFocusOutline(!e),this.myViewer.context.setDisableFocusOutline(!e);}},{key:"getIfShowVideoContainer",value:function value(){return!!this.myViewer&&this.myViewer.getViewerConfig().showVideoContainer;}},{key:"showVideoContainer",value:function value(e){return!!this.myViewer&&(this.getIfShowVideoContainer()===e||(this.thumbnailViewer&&(e?(this.oldBShowThumbnail=this.thumbnailViewer.inner.showThumbnail,this.thumbnailViewer.inner.showThumbnail=!1):this.thumbnailViewer.inner.showThumbnail=this.oldBShowThumbnail),this.myViewer.updateViewerConfig({showVideoContainer:e})),!0);}},{key:"updateVideoImage",value:function value(e){var t=this.myViewer.updateVideoImage(e);return t||this.setDefaultError(),t;}},{key:"createThumbnailViewer",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),null;if(this.thumbnailViewer)return this.setError("ThumbnailViewerExist"),this.thumbnailViewer;this.thumbnailViewer=new Lq(this,e),this.setBorder(this.outerBorder);var t=this.webViewerInitConfig.viewerEvents;return GN(null==t?void 0:t.removeBtnClick)&&this.thumbnailViewer.on("removeBtnClick",function(e){t.removeBtnClick(e);}),this.showFocusOutLine(this.isFocusOutLine()),this.thumbnailViewer;}},{key:"createImageEditor",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),null;if(this.imageEditor)this.setError("ImageEditorExist");else{var t,i,r=WN(_LN(YL),this.webViewerInitConfig.imageEditorUiConfig);r.border=this.getBorder(),r.selectionRectAspectRatio=this.getSelectionRectAspectRatio();var n=r;GN(null===(t=this.webViewerInitConfig)||void 0===t?void 0:t.beforeImageEditorCreated)&&null!==(i=this.webViewerInitConfig)&&void 0!==i&&i.beforeImageEditorCreated(n),e&&(n=WN(n,e)),this.imageEditor=new Rq(this,n);var o=this.getSelectionBoxStyle();this.imageEditor.updateSelectionBoxStyle(o);}return this.showFocusOutLine(this.isFocusOutLine()),this.imageEditor;}},{key:"closeImageEditor",value:function value(){this.imageEditor&&(this.imageEditor.dispose(),this.imageEditor=void 0);}},{key:"createCustomElement",value:function value(e,t,i){if(!this.bindViewUI)return this.setError("UnBindViewer"),null;var r=t||"right",n=!!_N(i)&&i;return HN(e)?(this.setError("ElementRequired"),null):e instanceof HTMLDivElement?(this.customElement?this.setError("CustomElementExist"):this.customElement=new jX(this,e,r,n),this.customElement):(this.setError("ElementNotExist"),null);}},{key:"getCurrentIndex",value:function value(){var e=-1;return this.getHowManyImagesInBuffer()>0&&(e=this.myViewer.getCurrentIndex(),(HN(e)||e<0)&&this.setDefaultError()),e;}},{key:"getCurrentImgUUid",value:function value(){var e=this.myViewer.getCurrentIndex();return-1===e?"":this.bufferService.getUidByIndex(e);}},{key:"getHowManyImagesInBuffer",value:function value(){return!!this.myViewer&&(HN(this.myViewer.currentPageCount)?0:this.myViewer.currentPageCount);}},{key:"getSelectedImagesIndices",value:function value(){return!!this.myViewer&&this.myViewer.getSelectedIndexes();}},{key:"setButtonClass",value:function value(e,t){return this.bindViewUI?HN(e)||HN(t)?(this.setError("InvalidValue"),!1):(this.myViewer.setButtonClass(e,t),!0):(this.setError("UnBindViewer"),!1);}},{key:"setViewMode",value:function value(e,t){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;var i=!1,r="vertical";if(!ZN(e)||!ZN(t))return this.setError("InvalidValue"),!1;this.myViewer.updateViewerConfig({enableEmitPageRendered:!1}),this.thumbnailViewer&&this.thumbnailViewer.hide();var n=this.myViewer.getViewerConfig(),o=n.rows,a=n.columns;return-1===e&&-1===t?(this.setIfSinglePageMode(!0),i=!0):(t<0&&(r="horizontal",t=-t),e=e<0?-e:e,this.myViewer.updateViewerConfig({scrollDirection:r}),i=this.myViewer.setViewMode(t,e),1===e&&1===t?(this.bSingleMode=!0,1===o&&1===a||(this.oldEnableDrag=this.myViewer.getViewerConfig().enableDragPage),this.myViewer.updateViewerConfig({margin:0,enableDragPage:!1})):(this.bSingleMode=!1,this.setPageMargin(this.pageMargin),this.myViewer.updateViewerConfig({enableDragPage:this.oldEnableDrag})),this.setIfSinglePageMode(!1),i||this.setDefaultError(),"zoom-in"===this.getCursor()&&this.setCursor("crosshair")),this.emitPageRendered(),i;}},{key:"setFitType",value:function value(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"window";if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;var i="window";return-1===WI(e=["width","height","window"]).call(e,t)?(this.setError("InvalidValue"),!1):(i=t,this.myViewer.updateViewerConfig({fitType:i}),!0);}},{key:"setSelectedAreas",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;if("crosshair"!==this.getCursor())return this.setError("OperationError"),!1;var t,i=[],r=!0;if(this.getCurrentIndex()<0)return this.setError("NoImage"),!1;if(HN(e)||HN(e.length)||0===e.length)return this.setError("InvalidLeftOrTopOrRightOrBottom"),!1;if(e.length&&e.length>0)for(var n=0;n<e.length;n++){var o=e[n],a=o.left,s=o.right,l=o.top,u=o.bottom;if(t={},ZN(a+s+l+u)){if(a<0||l<0||s<0||u<0)continue;if(a>s||l>u)continue;t.left=a,t.top=l,t.width=s-a,t.height=u-l,i.push(t);}}return 0===i.length?(this.setError("InvalidLeftOrTopOrRightOrBottom"),!1):((r=this.myViewer.setCropBox(i,!0))||this.setDefaultError(),r);}},{key:"clearSelectedAreas",value:function value(){if(!this.bindViewUI)return this.setError("UnBindViewer"),!1;var e=!0;return!(this.getHowManyImagesInBuffer()<=0)&&(e=this.myViewer.clearCropBox(),this.myViewer.render(),e||this.setDefaultError(),e);}},{key:"next",value:function value(){if(!this.bindViewUI)return this.setError("UnBindViewer"),-1;if(!this.myViewer)return!1;var e=this.getHowManyImagesInBuffer();if(e<=0)return this.setError("NoImage"),-1;if(0===e)return 0;var t=this.getIfAutoScroll();return!1===t&&this.setIfAutoScroll(!0),this.imageEditor&&this.imageEditor.inner&&this.imageEditor.inner.bShowImageEditor?this.imageEditor.inner.nextImage():this.myViewer.nextPage(),!1===t&&this.setIfAutoScroll(!1),this.getCurrentIndex();}},{key:"previous",value:function value(){if(!this.bindViewUI)return this.setError("UnBindViewer"),-1;if(!this.myViewer)return!1;var e=this.getHowManyImagesInBuffer();if(e<=0)return this.setError("NoImage"),-1;if(0===e)return 0;var t=this.getIfAutoScroll();return!1===t&&this.setIfAutoScroll(!0),this.imageEditor&&this.imageEditor.inner&&this.imageEditor.inner.bShowImageEditor?this.imageEditor.inner.previousImage():this.myViewer.prevPage(),!1===t&&this.setIfAutoScroll(!1),this.getCurrentIndex();}},{key:"first",value:function value(){if(!this.bindViewUI)return this.setError("UnBindViewer"),-1;if(this.getHowManyImagesInBuffer()<=0)return this.setError("NoImage"),-1;var e=this.getIfAutoScroll();return!1===e&&this.setIfAutoScroll(!0),this.imageEditor&&this.imageEditor.inner&&this.imageEditor.inner.bShowImageEditor?this.imageEditor.inner.first():this.myViewer.firstPage(),this.myViewer.firstPage(),!1===e&&this.setIfAutoScroll(!1),0;}},{key:"last",value:function value(){if(!this.bindViewUI)return this.setError("UnBindViewer"),-1;var e=this.getHowManyImagesInBuffer();if(e<=0)return this.setError("NoImage"),-1;var t=this.getIfAutoScroll();return!1===t&&this.setIfAutoScroll(!0),this.imageEditor&&this.imageEditor.inner&&this.imageEditor.inner.bShowImageEditor?this.imageEditor.inner.last():this.myViewer.lastPage(),!1===t&&this.setIfAutoScroll(!1),e-1;}},{key:"gotoPage",value:function value(e){if(!this.bindViewUI)return this.setError("UnBindViewer"),-1;var t=this.getHowManyImagesInBuffer();if(t<=0)return this.setError("NoImage"),-1;if(t<0||e>=this.getHowManyImagesInBuffer())return this.setError("IndexOutOfRange"),-1;if(!/^(\d+)$/.test(e)||e<0)return this.setError("MobileServer_InvalidIndex"),-1;var i=this.getIfAutoScroll();return!1===i&&this.setIfAutoScroll(!0),this.imageEditor&&this.imageEditor.inner&&this.imageEditor.inner.bShowImageEditor?this.imageEditor.inner.goToPage(e):this.myViewer.gotoPage(e),!1===i&&this.setIfAutoScroll(!1),this.resized(),e;}},{key:"render",value:function value(){return this.bindViewUI?!!this.myViewer&&(this.myViewer.dwtRender(),this.myViewer.externalResized(),this.resized(),!0):(this.setError("UnBindViewer"),!1);}},{key:"on",value:function value(e,t){if(!e)return this.setError("InvalidValue"),!1;if(!GN(t))return this.setError("CallbackNotAFunction"),!1;var i=e;switch(e){case"onDrop":i="drop";break;case"rightclick":i="contextmenu";break;case"resize":i="dwtResize";break;default:i=e;}return this.myViewer.on(i,t),!0;}},{key:"off",value:function value(e,t){if(!e)return this.setError("InvalidValue"),!1;var i=e;switch(e){case"onDrop":i="drop";break;case"rightclick":i="contextmenu";break;case"resize":i="dwtResize";break;default:i=e;}if(HN(t)){this.myViewer.off(i),"contextmenu"===e&&this.preventDefaultContextmenu();var r=this.webViewerInitConfig.viewerEvents;WI(WL).call(WL,e)>=0&&GN(r[e])&&("onDrop"===e?this.bindDefaultDrop():"rightclick"===e?this.bindDefaultRightClick():this.myViewer.on(i,function(t,i){r[e](t,i);}));}else{if(!GN(t))return this.setError("CallbackNotAFunction"),!1;this.myViewer.off(i,t);}return!0;}},{key:"disposeComponent",value:function value(){this.disConnectObserver(),this.imageEditor&&this.imageEditor.dispose(),this.thumbnailViewer&&this.thumbnailViewer.dispose(),this.customElement&&this.customElement.dispose();}},{key:"dispose",value:function value(){if(this.myViewer){this.myViewer.off("bufferChanged"),this.disposeComponent(),this.myViewer.destroy(),this.myViewer=null;var e=this.webViewerInitConfig.viewerEvents;e&&GN(e.onUnBind)&&e.onUnBind(this.containerElement);}this.bufferService&&(this.bufferService.space.destroy(),this.bufferService=null),this.myDvs&&(this.myDvs.destroy(),this.myDvs=null);}},{key:"rotateInner",value:function value(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:90,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.myViewer)return!1;if(!ZN(e)||e<0)return this.setError("InvalidIndex"),!1;var r=this.getHowManyImagesInBuffer();return r<0?(this.setError("NoImage"),!1):e>=r?(this.setError("IndexOutOfRange"),!1):ZN(t)?(this.myViewer.updateViewerConfig({rotationType:i?"clip":"contain"}),this.myViewer.rotate(t,e)):(this.setError("InvalidValue"),!1);}},{key:"rotate",value:function value(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:90,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!ZN(e)||e<0)return this.setError("InvalidIndex"),uB.reject(this.getErrorInfo("InvalidIndex"));var r=this.getHowManyImagesInBuffer();if(r<0)return this.setError("NoImage"),uB.reject(this.getErrorInfo("NoImage"));if(e>=r)return this.setError("IndexOutOfRange"),uB.reject(this.getErrorInfo("IndexOutOfRange"));if(!ZN(t))return this.setError("InvalidValue"),uB.reject(this.getErrorInfo("InvalidValue"));var n=this.webViewerInitConfig.viewerEvents;return n&&GN(null==n?void 0:n.rotate)?n.rotate(e,t,i):(this.myViewer.updateViewerConfig({rotationType:i?"clip":"contain"}),this.myViewer.rotate(t,e),this.saveToServer(e));}},{key:"crop",value:(i=Ew(VN().m(function e(t,i){var r,n,o,a,s,l,u,c,h,d;return VN().w(function(e){for(;;)switch(e.n){case 0:if(r=this.getHowManyImagesInBuffer(),!(t<0)&&ZN(t)){e.n=1;break;}return e.a(2,(this.setError("InvalidIndex"),uB.reject(this.getErrorInfo("InvalidIndex"))));case 1:if(!(r<0)){e.n=2;break;}return e.a(2,(this.setError("NoImage"),uB.reject(this.getErrorInfo("NoImage"))));case 2:if(!(t>=r)){e.n=3;break;}return e.a(2,(this.setError("IndexOutOfRange"),uB.reject(this.getErrorInfo("IndexOutOfRange"))));case 3:if(n=i.x,o=i.y,a=i.width,s=i.height,!HN(i)&&ZN(n+o+a+s)){e.n=4;break;}return e.a(2,(this.setError("InvalidValue"),uB.reject(this.getErrorInfo("InvalidValue"))));case 4:if(!(n<0||o<0||a<=0||s<=0)){e.n=5;break;}return e.a(2,(this.setError("InvalidValue"),uB.reject(this.getErrorInfo("InvalidValue"))));case 5:if(l=this.myViewer.getCurrentTab().getChildByIndex(t),u=this.bufferService.space.statusStore.get(l.uid),c=u.realTimeWidth,h=u.realTimeHeight,!(a>c||s>h)){e.n=6;break;}return e.a(2,(this.setError("WidthOrHeightOutOfImageSize"),uB.reject(this.getErrorInfo("WidthOrHeightOutOfImageSize"))));case 6:return d=this.webViewerInitConfig.viewerEvents,e.a(2,d&&GN(null==d?void 0:d.crop)?d.crop(t,n,o,a,s):(this.myViewer.crop(t,n,o,a,s),this.saveToServer(t)));}},e,this);})),function(e,t){return i.apply(this,arguments);})},{key:"saveToServer",value:(t=Ew(VN().m(function e(t){var i,r,n,o;return VN().w(function(e){for(;;)switch(e.n){case 0:if(i=this.bufferService.getUidByIndex(t),(r=this.webViewerInitConfig.viewerEvents)&&GN(null==r?void 0:r.save)){e.n=1;break;}return e.a(2,uB.reject());case 1:return e.n=2,this.myDvs.getImageData(i,{type:"imageData"});case 2:return n=e.v,o=Fk(Fk({},this.bufferService.getMetadataByUid(i)),{},{width:Math.floor(n.width),height:Math.floor(n.height)}),e.a(2,r.save(i,n.data.buffer,o,!1));}},e,this);})),function(e){return t.apply(this,arguments);})},{key:"overlayRectangle",value:function value(e,t,i,r,n,o,a){if(HN(e)||HN(t)||HN(i)||HN(r)||HN(n))return!1;var s=r-t,l=n-i;return!(s<=0||l<=0)&&this.myViewer.overlayRectangle(e,t,i,s,l,o,a);}},{key:"selectPages",value:function value(e){if(!this.myViewer)return!1;var t=e[e.length-1],i=this.getCurrentIndex();return this.imageEditor&&this.imageEditor.inner&&this.imageEditor.inner.bShowImageEditor&&t!==i?this.imageEditor.inner.selectPages(e):this.myViewer.setSelectedIndexes(e);}},{key:"removePageByUid",value:function value(e){if(!this.myViewer)return!1;var t=this.myViewer.getIndexByUid(e);return null!==t&&this.myViewer.removePage(t);}},{key:"removePageByIndexes",value:function value(e){return!!this.myViewer&&this.myViewer.removePage(e);}},{key:"removeAllPages",value:function value(){return!!this.myViewer&&this.myViewer.removeAllPages();}},{key:"getVisiblePagesInfo",value:function value(){return this.myViewer?this.myViewer.context.getVisiblePagesInfo():[];}}]);var t,i;}();Wk(Hq,"isInstallDVSPlugin",!1);var Fq=function(){return Yk(function e(t,i){Xk(this,e),Wk(this,"webViewer",void 0),Wk(this,"elements",[]),this.webViewer=new Hq(t,i),this.elements=[],this.focusOutlineEnabled=!1;},[{key:"e",value:function value(){this.webViewer.setError("Successful");}},{key:"focusOutlineEnabled",get:function get(){return this.webViewer.isFocusOutLine();},set:function set(e){this.e(),this.webViewer.showFocusOutLine(e);}},{key:"idPostfix",get:function get(){return this.e(),this.webViewer.getIdPostfix();}},{key:"width",get:function get(){return this.e(),this.webViewer.getWidth();},set:function set(e){this.e(),this.webViewer.setWidth(e);}},{key:"height",get:function get(){return this.e(),this.webViewer.getHeight();},set:function set(e){this.e(),this.webViewer.setHeight(e);}},{key:"background",get:function get(){return this.e(),this.webViewer.getBackground();},set:function set(e){this.e(),ZN(e)&&(e=YX(e)),this.webViewer.setBackground(e);}},{key:"border",get:function get(){return this.e(),this.webViewer.getBorder();},set:function set(e){this.e(),this.webViewer.setBorder(e);}},{key:"innerBorder",get:function get(){return this.e(),this.webViewer.getInnerBorder();},set:function set(e){this.e(),this.webViewer.setInnerBorder(e);}},{key:"selectedPageBorder",get:function get(){return this.e(),this.webViewer.getSelectedPageBorder();},set:function set(e){this.e(),this.webViewer.setSelectedPageBorder(e);}},{key:"selectedPageBackground",get:function get(){return this.e(),this.webViewer.getSelectedPageBackground();},set:function set(e){this.e(),ZN(e)&&(e=YX(e)),this.webViewer.setSelectedPageBackground(e);}},{key:"selectedAreaBorderColor",get:function get(){return this.e(),this.webViewer.getSelectedAreaBorderColor();},set:function set(e){this.e(),ZN(e)&&(e=YX(e)),this.webViewer.setSelectedAreaBorderColor(e);}},{key:"selectionRectAspectRatio",get:function get(){return this.e(),this.webViewer.getSelectionRectAspectRatio();},set:function set(e){this.e(),this.webViewer.setSelectionRectAspectRatio(e);}},{key:"showPageNumber",get:function get(){return this.e(),this.webViewer.getShowPageNumber();},set:function set(e){this.e(),this.webViewer.setShowPageNumber(e);}},{key:"showCheckbox",get:function get(){return this.e(),this.webViewer.getShowCheckbox();},set:function set(e){this.e(),this.webViewer.setShowCheckbox(e);}},{key:"cursor",get:function get(){return this.e(),this.webViewer.getCursor();},set:function set(e){this.e(),this.webViewer.setCursor(e);}},{key:"ifAutoScroll",get:function get(){return this.e(),this.webViewer.getIfAutoScroll();},set:function set(e){this.e(),this.webViewer.setIfAutoScroll(e);}},{key:"pageMargin",get:function get(){return this.e(),this.webViewer.getPageMargin();},set:function set(e){this.e(),this.webViewer.setPageMargin(e);}},{key:"zoom",get:function get(){return this.e(),this.webViewer.getZoom();},set:function set(e){this.e(),this.webViewer.setZoom(e);}},{key:"zoomOrigin",get:function get(){return this.e(),this.webViewer.getZoomOrigin();},set:function set(e){this.e(),this.webViewer.setZoomOrigin(e);}},{key:"singlePageMode",get:function get(){return this.e(),this.webViewer.getIfSinglePageMode();},set:function set(e){this.e(),this.webViewer.setIfSinglePageMode(e);}},{key:"acceptDrop",get:function get(){return this.e(),this.webViewer.getAcceptDrop();},set:function set(e){this.e(),this.webViewer.setAcceptDrop(e);}},{key:"allowSlide",get:function get(){return this.e(),this.webViewer.getAllowSlide();},set:function set(e){this.e(),this.webViewer.setAllowSlide(e);}},{key:"autoChangeIndex",get:function get(){return this.e(),this.webViewer.getAutoChangeIndex();},set:function set(e){this.e(),this.webViewer.setAutoChangeIndex(e);}},{key:"selectionMode",get:function get(){return this.e(),this.webViewer.getMultiSelectMode();},set:function set(e){this.e(),this.webViewer.setMultiSelectMode(e);}},{key:"allowPageDragging",get:function get(){return this.e(),this.webViewer.getAllowPageDragging();},set:function set(e){this.e(),this.webViewer.setAllowPageDragging(e);}},{key:"selectedImagesIndices",get:function get(){return this.e(),this.webViewer.getSelectedImagesIndices();}},{key:"next",value:function value(){return this.e(),this.webViewer.next();}},{key:"previous",value:function value(){return this.e(),this.webViewer.previous();}},{key:"first",value:function value(){return this.e(),this.webViewer.first();}},{key:"last",value:function value(){return this.e(),this.webViewer.last();}},{key:"gotoPage",value:function value(e){return this.e(),this.webViewer.gotoPage(e);}},{key:"render",value:function value(){return this.e(),this.webViewer.render();}},{key:"show",value:function value(){return this.e(),this.webViewer.show();}},{key:"hide",value:function value(){return this.e(),this.webViewer.hide();}},{key:"on",value:function value(e,t){return this.e(),this.webViewer.on(e,t);}},{key:"off",value:function value(e,t){return this.e(),this.webViewer.off(e,t);}},{key:"createImageEditor",value:function value(e){return this.e(),this.webViewer.createImageEditor(e);}},{key:"createThumbnailViewer",value:function value(e){return this.e(),this.webViewer.createThumbnailViewer(e);}},{key:"createCustomElement",value:function value(e,t,i){return this.e(),this.webViewer.createCustomElement(e,t,i);}},{key:"updateCheckboxStyle",value:function value(e){return this.e(),this.webViewer.updateCheckboxStyle(e);}},{key:"updatePageNumberStyle",value:function value(e){return this.e(),this.webViewer.updatePageNumberStyle(e);}},{key:"updateSelectionBoxStyle",value:function value(e){return this.e(),this.webViewer.setSelectionBoxStyle(e);}},{key:"clearSelectedAreas",value:function value(){return this.e(),this.webViewer.clearSelectedAreas();}},{key:"setSelectedAreas",value:function value(e){return this.e(),this.webViewer.setSelectedAreas(e);}},{key:"fitWindow",value:function value(e){return this.e(),this.webViewer.setFitType(e);}},{key:"setButtonClass",value:function value(e,t){return this.e(),this.webViewer.setButtonClass(e,t);}},{key:"setViewMode",value:function value(e,t){return this.e(),this.webViewer.setViewMode(e,t);}},{key:"bind",value:function value(e){this.e();var t,i,r=e;if(t=r,window.ShadowRoot&&t instanceof window.ShadowRoot){var n=document.createElement("div");r.appendChild(n),this.elements.push(n),r=n;}if(i=r,"object"==("undefined"==typeof HTMLElement?"undefined":Bh(HTMLElement))?i instanceof HTMLElement:i&&"object"==Bh(i)&&1===i.nodeType&&"string"==typeof i.nodeName){var o=function(e){var t=e;if(window.ShadowRoot)for(;t;){if(t instanceof window.ShadowRoot)return t;t=t.parentNode;}return!1;}(r);if(o){var a=document.createElement("style");a.innerHTML=['@import url("',Dynamsoft.DWT.ResourcesPath,"/src/dynamsoft.webtwain.viewer.css",'")'].join(""),o.appendChild(a);var s=document.createElement("style");s.innerHTML=['@import url("',Dynamsoft.DWT.ResourcesPath,"/src/dynamsoft.webtwain.css",'")'].join(""),o.appendChild(s),this.elements.push(a,s);}else o=!1;r.id&&""!==r.id||(r.id=["dwt_",rO()].join(""));}return this.webViewer.bindView(r);}},{key:"unbind",value:function value(){var e;return this.e(),$k(e=this.elements).call(e,function(e){e.parentNode&&e.parentNode.removeChild(e);}),this.webViewer.unbindView();}},{key:"getUISettings",value:function value(){return this.e(),this.webViewer.getUISettings();}},{key:"updateUISettings",value:function value(){return this.e(),this.webViewer.updateUISettings();}},{key:"resetUISettings",value:function value(){return this.e(),this.webViewer.resetViewerSettings();}},{key:"getVisiblePagesInfo",value:function value(){return this.e(),this.webViewer.getVisiblePagesInfo();}}]);}(),jq=function(e){function t(e,i){return Xk(this,t),IN(this,t,[e,i]);}return Mb(t,e),Yk(t,[{key:"errorCode",get:function get(){return this.webViewer.error.getError().errCode;}},{key:"errorString",get:function get(){return this.webViewer.error.getError().errorString;}},{key:"SelectedImagesIndices",get:function get(){return this.webViewer.getSelectedImagesIndices();}},{key:"rotate",value:function value(e,t,i){return this.webViewer.rotate(e,t,i);}},{key:"crop",value:function value(e,t){return this.webViewer.crop(e,t);}}]);}(Fq);HTMLCanvasElement.prototype.toBlob||mN(HTMLCanvasElement.prototype,"toBlob",{value:function value(e,t,i){for(var r=atob(this.toDataURL(t,i).split(",")[1]),n=r.length,o=new Uint8Array(n),a=0;a<n;a++)o[a]=r.charCodeAt(a);e(new Blob([o],{type:t||"image/png"}));}});var Yq=window.Dynamsoft||window;Yq.DWTViewer=Fq,Yq.DWTViewerEx=jq;}();
