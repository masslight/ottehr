{"version":3,"file":"AppointmentNotesHistory.js","sourceRoot":"","sources":["AppointmentNotesHistory.tsx"],"names":[],"mappings":"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","sourcesContent":["import EditOutlinedIcon from '@mui/icons-material/EditOutlined';\nimport {\n  Box,\n  CircularProgress,\n  IconButton,\n  Paper,\n  Table,\n  TableBody,\n  TableCell,\n  TableRow,\n  TextField,\n  Typography,\n  useTheme,\n} from '@mui/material';\nimport Oystehr from '@oystehr/sdk';\nimport { Appointment, Location } from 'fhir/r4b';\nimport { ReactElement, useMemo, useState } from 'react';\nimport { formatLastModifiedTag } from '../helpers';\nimport { patchAppointmentComment } from '../helpers';\nimport { NoteHistory } from '../helpers/activityLogsUtils';\nimport { EvolveUser } from '../hooks/useEvolveUser';\nimport { EditPatientInfoDialog } from './dialogs';\n\ninterface AppointmentNotesHistoryProps {\n  appointment: Appointment | undefined;\n  location: Location;\n  curNoteAndHistory: NoteHistory[] | undefined;\n  user: EvolveUser | undefined;\n  oystehr: Oystehr | undefined;\n  setAppointment: (value: React.SetStateAction<Appointment | undefined>) => void;\n  getAndSetHistoricResources: ({ logs, notes }: { logs?: boolean; notes?: boolean }) => Promise<void>;\n}\n\nexport default function AppointmentNotesHistory({\n  appointment,\n  location,\n  curNoteAndHistory,\n  user,\n  oystehr,\n  setAppointment,\n  getAndSetHistoricResources,\n}: AppointmentNotesHistoryProps): ReactElement {\n  const theme = useTheme();\n  // for historical notes (not sure if needed)\n  const noteLastModified = formatLastModifiedTag('comment', appointment, location);\n  const [noteEdit, setNoteEdit] = useState<string>(appointment?.comment || '');\n  const [editNoteDialogOpen, setEditNoteDialogOpen] = useState<boolean>(false);\n  const [loading, setLoading] = useState<boolean>(false);\n  const [error, setError] = useState<boolean>(false);\n\n  const handleNoteUpdate = async (e: React.FormEvent<HTMLFormElement>): Promise<void> => {\n    e.preventDefault();\n    setLoading(true);\n    if (!appointment || !oystehr) {\n      setError(true);\n    } else {\n      try {\n        const updatedAppointment = await patchAppointmentComment(appointment, noteEdit, user, oystehr);\n        console.log('updatedAppointment', updatedAppointment);\n        setAppointment(updatedAppointment);\n        await getAndSetHistoricResources({ notes: true });\n        setEditNoteDialogOpen(false);\n      } catch (e) {\n        console.log('error updating appointment', e);\n        setError(true);\n      }\n    }\n    setLoading(false);\n  };\n\n  const noteBlock = (note: string, dtAdded: string, showEdit: boolean): ReactElement => (\n    <>\n      <Box sx={{ display: 'flex', mt: 2, justifyContent: 'space-between' }}>\n        {note !== '' && (\n          <>\n            <Typography\n              sx={{\n                display: 'flex',\n                justifyContent: 'flex-start',\n                alignItems: 'center',\n                color: theme.palette.primary.dark,\n                whiteSpace: 'pre-line',\n              }}\n              variant=\"body1\"\n            >\n              {note}\n            </Typography>\n            {showEdit && (\n              <IconButton\n                sx={{ color: 'primary.main', width: '24px', height: '24px' }}\n                onClick={() => setEditNoteDialogOpen(true)}\n              >\n                <EditOutlinedIcon sx={{ width: '24px', height: '24px' }} />\n              </IconButton>\n            )}\n          </>\n        )}\n      </Box>\n      <Box display=\"flex\" justifyContent=\"space-between\">\n        <Typography\n          sx={{\n            display: 'flex',\n            justifyContent: 'flex-start',\n            alignItems: 'center',\n            color: theme.palette.secondary.light,\n            mt: `${note !== '' ? '13px' : '0'}`,\n          }}\n          variant=\"body2\"\n        >\n          {note === '' && `note removed `}\n          {dtAdded}\n        </Typography>\n        {note === '' && showEdit && (\n          <IconButton\n            sx={{ color: 'primary.main', width: '24px', height: '24px' }}\n            onClick={() => setEditNoteDialogOpen(true)}\n          >\n            <EditOutlinedIcon sx={{ width: '24px', height: '24px' }} />\n          </IconButton>\n        )}\n      </Box>\n    </>\n  );\n\n  const { curNote, notesHistory } = useMemo(() => {\n    const curNoteAndHistoryCopy = [...(curNoteAndHistory || [])];\n    const curNote = curNoteAndHistoryCopy?.shift();\n    const notesHistory = curNoteAndHistoryCopy;\n    return { curNote, notesHistory };\n  }, [curNoteAndHistory]);\n\n  // for historical notes (not sure if needed)\n  if (noteLastModified && appointment?.comment) {\n    return (\n      <Paper\n        sx={{\n          marginTop: 2,\n          padding: 3,\n        }}\n      >\n        <Typography variant=\"h4\" color=\"primary.dark\">\n          Current tracking board note\n        </Typography>\n        {noteBlock(appointment.comment, noteLastModified, true)}\n      </Paper>\n    );\n  }\n\n  return (\n    <Paper\n      sx={{\n        marginTop: 2,\n        padding: 3,\n      }}\n    >\n      <Typography variant=\"h4\" color=\"primary.dark\">\n        Current tracking board note\n      </Typography>\n\n      {curNoteAndHistory ? (\n        <>\n          {curNote && (\n            <Table size=\"small\" style={{ tableLayout: 'fixed' }}>\n              <TableBody>\n                <TableRow sx={{ '&:last-child td': { borderBottom: 0 } }}>\n                  <TableCell\n                    sx={{\n                      width: '50%',\n                      color: theme.palette.primary.dark,\n                      padding: '0 8px 16px 0px',\n                    }}\n                  >\n                    {noteBlock(curNote.note, curNote.noteAddedByAndWhen, true)}\n                  </TableCell>\n                </TableRow>\n              </TableBody>\n            </Table>\n          )}\n\n          {notesHistory.length > 0 && (\n            <Typography variant=\"h4\" color=\"primary.dark\" sx={{ mt: 1 }}>\n              History\n            </Typography>\n          )}\n\n          <Table size=\"small\" style={{ tableLayout: 'fixed' }}>\n            <TableBody>\n              {notesHistory?.map((note, idx) => (\n                <TableRow key={idx} sx={{ '&:last-child td': { borderBottom: 0 } }}>\n                  <TableCell\n                    sx={{\n                      width: '50%',\n                      color: theme.palette.primary.dark,\n                      padding: '0 8px 16px 0px',\n                    }}\n                  >\n                    {noteBlock(note.note, note.noteAddedByAndWhen, false)}\n                  </TableCell>\n                </TableRow>\n              ))}\n            </TableBody>\n          </Table>\n        </>\n      ) : (\n        <CircularProgress size=\"20px\" sx={{ marginTop: 2.8, marginLeft: 1 }} />\n      )}\n\n      <EditPatientInfoDialog\n        title=\"Update current tracking board note\"\n        modalOpen={editNoteDialogOpen}\n        onClose={() => {\n          setEditNoteDialogOpen(false);\n          setNoteEdit(appointment?.comment || '');\n        }}\n        input={\n          <>\n            <TextField\n              multiline\n              label=\"Note\"\n              required\n              sx={{ width: '500px' }}\n              value={noteEdit}\n              onChange={(e) => setNoteEdit(e.target.value.trimStart())}\n              inputProps={{ maxLength: 160 }}\n            />\n          </>\n        }\n        onSubmit={handleNoteUpdate}\n        submitButtonName=\"Update note\"\n        loading={loading}\n        error={error}\n        errorMessage=\"Failed to update note\"\n      />\n    </Paper>\n  );\n}\n"]}