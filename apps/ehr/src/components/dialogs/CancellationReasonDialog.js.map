{"version":3,"file":"CancellationReasonDialog.js","sourceRoot":"","sources":["CancellationReasonDialog.tsx"],"names":[],"mappings":"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","sourcesContent":["import LoadingButton from '@mui/lab/LoadingButton';\nimport {\n  Button,\n  Dialog,\n  DialogActions,\n  DialogContent,\n  DialogTitle,\n  FormControl,\n  InputLabel,\n  ListItemText,\n  MenuItem,\n  Select,\n  SelectChangeEvent,\n  Typography,\n} from '@mui/material';\nimport { Appointment, Encounter } from 'fhir/r4b';\nimport { enqueueSnackbar } from 'notistack';\nimport React, { ReactElement, useState } from 'react';\nimport { CancelAppointmentZambdaInput, CancellationReasonOptionsInPerson } from 'utils';\nimport { cancelAppointment } from '../../api/api';\nimport { dataTestIds } from '../../constants/data-test-ids';\nimport { useApiClients } from '../../hooks/useAppClients';\n\ninterface CancellationReasonDialogProps {\n  handleClose: () => void;\n  getResourceBundle: () => Promise<void>;\n  appointment: Appointment;\n  encounter: Encounter;\n  open: boolean;\n  getAndSetResources: ({ logs, notes }: { logs?: boolean; notes?: boolean }) => Promise<void>;\n}\n\nexport default function CancellationReasonDialog({\n  handleClose,\n  getResourceBundle,\n  appointment,\n  encounter,\n  open,\n  getAndSetResources,\n}: CancellationReasonDialogProps): ReactElement {\n  const { oystehrZambda } = useApiClients();\n  const [cancellationReason, setCancellationReason] = useState<CancellationReasonOptionsInPerson | ''>('');\n  const [cancelLoading, setCancelLoading] = useState<boolean>(false);\n  const [error, setError] = useState<boolean>(false);\n  const buttonSx = {\n    fontWeight: 500,\n    textTransform: 'none',\n    borderRadius: 6,\n  };\n  const ITEM_HEIGHT = 34;\n  const ITEM_PADDING_Y = 16;\n\n  const MenuProps = {\n    PaperProps: {\n      style: {\n        maxHeight: ITEM_HEIGHT * 8 + ITEM_PADDING_Y,\n        width: 350,\n      },\n    },\n  };\n\n  const handleCancel = async (event: React.FormEvent<HTMLFormElement>): Promise<void> => {\n    event.preventDefault();\n    setCancelLoading(true);\n    if (!(cancellationReason && encounter && encounter.id && encounter.statusHistory)) {\n      console.error(\n        'one of cancellationReason, encounter, encounter.id, or encounter.statusHistory is null or undefined'\n      );\n      return;\n    }\n\n    const zambdaParams: CancelAppointmentZambdaInput = {\n      appointmentID: appointment.id || '',\n      cancellationReason: cancellationReason,\n    };\n\n    let response;\n    let apiErr = false;\n    try {\n      if (!oystehrZambda) throw new Error('Zambda client not found');\n      response = await cancelAppointment(oystehrZambda, zambdaParams);\n    } catch (error) {\n      console.log(`Failed to cancel appointment: ${error}`);\n      apiErr = true;\n    } finally {\n      if (response && !apiErr) {\n        await getResourceBundle();\n        await getAndSetResources({ logs: true }).catch((error: any) => {\n          console.log('error getting activity logs after cancellation', error);\n        });\n        enqueueSnackbar('An error getting updated activity logs. Please try refreshing the page.', {\n          variant: 'error',\n        });\n        handleClose();\n        setError(false);\n      } else {\n        setError(true);\n      }\n      setCancelLoading(false);\n    }\n  };\n\n  const handleChange = (event: SelectChangeEvent<typeof cancellationReason>): void => {\n    const value = event.target.value as CancellationReasonOptionsInPerson;\n    if (value && setCancellationReason) {\n      setCancellationReason(value);\n    }\n  };\n\n  const handleDialogClose = (): void => {\n    handleClose();\n    setError(false);\n  };\n\n  return (\n    <Dialog\n      open={open}\n      onClose={handleDialogClose}\n      disableScrollLock\n      sx={{\n        '.MuiPaper-root': {\n          padding: 1,\n          width: '444px',\n          maxWidth: 'initial',\n        },\n      }}\n    >\n      <form onSubmit={(e) => handleCancel(e)}>\n        <DialogTitle variant=\"h4\" color=\"primary.dark\" sx={{ width: '100%' }}>\n          Patient's cancelation reason\n        </DialogTitle>\n        <DialogContent>\n          <div>\n            <FormControl required sx={{ mt: 2, width: '100%' }}>\n              <InputLabel id=\"select-label\">Cancelation reason</InputLabel>\n              <Select\n                data-testid={dataTestIds.visitDetailsPage.cancelationReasonDropdown}\n                labelId=\"select-label\"\n                id=\"select\"\n                label=\"Cancelation reason\"\n                value={cancellationReason}\n                onChange={handleChange}\n                renderValue={(selected) => selected}\n                MenuProps={MenuProps}\n              >\n                {Object.keys(CancellationReasonOptionsInPerson).map((reason) => (\n                  <MenuItem key={reason} value={reason}>\n                    <ListItemText primary={reason} />\n                  </MenuItem>\n                ))}\n              </Select>\n            </FormControl>\n          </div>\n        </DialogContent>\n        <DialogActions sx={{ justifyContent: 'flex-start', marginLeft: 1 }}>\n          <LoadingButton\n            data-testid={dataTestIds.visitDetailsPage.cancelVisitDialogue}\n            loading={cancelLoading}\n            type=\"submit\"\n            variant=\"contained\"\n            color=\"primary\"\n            size=\"medium\"\n            sx={buttonSx}\n          >\n            Cancel visit\n          </LoadingButton>\n          <Button variant=\"text\" onClick={handleDialogClose} size=\"medium\" sx={buttonSx}>\n            Keep\n          </Button>\n        </DialogActions>\n        {error && (\n          <Typography color=\"error\" variant=\"body2\" my={1} mx={2}>\n            There was an error cancelling this appointment, please try again.\n          </Typography>\n        )}\n      </form>\n    </Dialog>\n  );\n}\n"]}