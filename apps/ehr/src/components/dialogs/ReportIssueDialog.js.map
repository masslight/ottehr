{"version":3,"file":"ReportIssueDialog.js","sourceRoot":"","sources":["ReportIssueDialog.tsx"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuBA,oCA4JC;AAnLD,wDAAmD;AACnD,0CAAiH;AAIjH,+BAAiC;AACjC,+BAA+C;AAC/C,+BAAwD;AACxD,2DAAsD;AAetD,SAAwB,iBAAiB,CAAC,EAWjB;IAXzB,iBA4JC;QA3JC,IAAI,UAAA,EACJ,WAAW,iBAAA,EACX,OAAO,aAAA,EACP,OAAO,aAAA,EACP,WAAW,iBAAA,EACX,SAAS,eAAA,EACT,QAAQ,cAAA,EACR,eAAe,qBAAA,EACf,YAAY,kBAAA,EACZ,eAAe,qBAAA;IAET,IAAA,KAA8C,IAAA,gBAAQ,EAAU,KAAK,CAAC,EAArE,kBAAkB,QAAA,EAAE,qBAAqB,QAA4B,CAAC;IACvE,IAAA,KAAkC,IAAA,gBAAQ,EAAS,EAAE,CAAC,EAArD,YAAY,QAAA,EAAE,eAAe,QAAwB,CAAC;IACvD,IAAA,KAAoB,IAAA,gBAAQ,EAAU,KAAK,CAAC,EAA3C,KAAK,QAAA,EAAE,QAAQ,QAA4B,CAAC;IACnD,IAAM,QAAQ,GAAG;QACf,UAAU,EAAE,GAAG;QACf,aAAa,EAAE,MAAM;QACrB,YAAY,EAAE,CAAC;KAChB,CAAC;IAEF,IAAM,IAAI,GAAG,IAAA,uBAAa,GAAE,CAAC;IAE7B,IAAM,iBAAiB,GAAG,UAAO,KAAuC;;;;;oBACtE,KAAK,CAAC,cAAc,EAAE,CAAC;oBACvB,QAAQ,CAAC,KAAK,CAAC,CAAC;oBAChB,qBAAqB,CAAC,IAAI,CAAC,CAAC;oBAEtB,kBAAkB,GAAkB;wBACxC,YAAY,EAAE,eAAe;wBAC7B,MAAM,EAAE,aAAa;wBACrB,QAAQ,EAAE;4BACR;gCACE,MAAM,EAAE,CAAC,uCAA+B,CAAC;6BAC1C;yBACF;wBACD,SAAS,EAAE;4BACT,IAAI,EAAE,WAAW;4BACjB,SAAS,EAAE,oBAAa,SAAS,CAAC,EAAE,CAAE;yBACvC;wBACD,IAAI,EAAE,gBAAQ,CAAC,GAAG,EAAE,CAAC,KAAK,EAAE,IAAI,EAAE;wBAClC,OAAO,EAAE;4BACP;gCACE,aAAa,EAAE,YAAY;6BAC5B;yBACF;qBACF,CAAC;oBAEF,IAAI,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,OAAO,EAAE,CAAC;wBAClB,kBAAkB,CAAC,MAAM,GAAG;4BAC1B,IAAI,EAAE,cAAc;4BACpB,SAAS,EAAE,IAAI,CAAC,OAAO;yBACxB,CAAC;oBACJ,CAAC;oBACD,IAAI,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,EAAE,EAAE,CAAC;wBAChB,kBAAkB,CAAC,OAAO,GAAG;4BAC3B,IAAI,EAAE,SAAS;4BACf,SAAS,EAAE,kBAAW,OAAO,CAAC,EAAE,CAAE;yBACnC,CAAC;oBACJ,CAAC;oBAEK,KAAK,GAAG,EAAE,CAAC;oBACjB,IAAI,WAAW,aAAX,WAAW,uBAAX,WAAW,CAAE,EAAE,EAAE,CAAC;wBACpB,KAAK,CAAC,IAAI,CAAC;4BACT,IAAI,EAAE,aAAa;4BACnB,SAAS,EAAE,sBAAe,WAAW,CAAC,EAAE,CAAE;yBAC3C,CAAC,CAAC;oBACL,CAAC;oBACD,IAAI,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,CAAE,EAAE,EAAE,CAAC;wBACjB,KAAK,CAAC,IAAI,CAAC;4BACT,IAAI,EAAE,UAAU;4BAChB,SAAS,EAAE,mBAAY,QAAQ,CAAC,EAAE,CAAE;yBACrC,CAAC,CAAC;oBACL,CAAC;oBACD,IAAI,KAAK,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;wBACrB,kBAAkB,CAAC,KAAK,GAAG,KAAK,CAAC;oBACnC,CAAC;;;;oBAGC,qBAAM,CAAA,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,IAAI,CAAC,MAAM,CAAC,kBAAkB,CAAC,CAAA,EAAA;;oBAA9C,SAA8C,CAAC;oBAC/C,eAAe,CAAC,+BAA+B,CAAC,CAAC;oBACjD,YAAY,CAAC,SAAS,CAAC,CAAC;oBACxB,eAAe,CAAC,IAAI,CAAC,CAAC;oBACtB,WAAW,EAAE,CAAC;;;;oBAEd,OAAO,CAAC,GAAG,CAAC,OAAO,EAAE,GAAC,CAAC,CAAC;oBACxB,QAAQ,CAAC,IAAI,CAAC,CAAC;;;oBAEjB,qBAAqB,CAAC,KAAK,CAAC,CAAC;oBAC7B,eAAe,CAAC,EAAE,CAAC,CAAC;;;;SACrB,CAAC;IAEF,IAAM,iBAAiB,GAAG;QACxB,WAAW,EAAE,CAAC;QACd,eAAe,CAAC,EAAE,CAAC,CAAC;QACpB,QAAQ,CAAC,KAAK,CAAC,CAAC;IAClB,CAAC,CAAC;IAEF,OAAO,CACL,CAAC,iBAAM,CACL,IAAI,CAAC,CAAC,IAAI,CAAC,CACX,OAAO,CAAC,CAAC,WAAW,CAAC,CACrB,iBAAiB,CACjB,EAAE,CAAC,CAAC;YACF,gBAAgB,EAAE;gBAChB,OAAO,EAAE,CAAC;gBACV,KAAK,EAAE,OAAO;gBACd,QAAQ,EAAE,SAAS;aACpB;SACF,CAAC,CAEF;MAAA,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,UAAC,CAAC,IAAK,OAAA,iBAAiB,CAAC,CAAC,CAAC,EAApB,CAAoB,CAAC,CAC1C;QAAA,CAAC,sBAAW,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,cAAc,CAAC,EAAE,CAAC,CAAC,EAAE,KAAK,EAAE,MAAM,EAAE,CAAC,CACnE;;QACF,EAAE,sBAAW,CACb;QAAA,CAAC,wBAAa,CACZ;UAAA,CAAC,GAAG,CACF;YAAA,CAAC,qBAAU,CACT;;;YAEF,EAAE,qBAAU,CACZ;YAAA,CAAC,oBAAS,CACR,QAAQ,CACR,SAAS,CACT,OAAO,CAAC,CAAC,CAAC,CAAC,CACX,WAAW,CAAC,CAAC,6BAA6B,CAAC,CAC3C,KAAK,CAAC,CAAC,YAAY,CAAC,CACpB,QAAQ,CAAC,CAAC,UAAC,CAAC,IAAK,OAAA,eAAe,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,EAA/B,CAA+B,CAAC,CACjD,EAAE,CAAC,CAAC,EAAE,SAAS,EAAE,CAAC,EAAE,KAAK,EAAE,MAAM,EAAE,CAAC,EAExC;UAAA,EAAE,GAAG,CACP;QAAA,EAAE,wBAAa,CACf;QAAA,CAAC,wBAAa,CAAC,EAAE,CAAC,CAAC,EAAE,cAAc,EAAE,YAAY,EAAE,UAAU,EAAE,CAAC,EAAE,CAAC,CACjE;UAAA,CAAC,uBAAa,CACZ,OAAO,CAAC,CAAC,kBAAkB,CAAC,CAC5B,QAAQ,CAAC,CAAC,YAAY,CAAC,IAAI,EAAE,KAAK,EAAE,CAAC,CACrC,IAAI,CAAC,QAAQ,CACb,OAAO,CAAC,WAAW,CACnB,KAAK,CAAC,SAAS,CACf,IAAI,CAAC,QAAQ,CACb,EAAE,CAAC,CAAC,QAAQ,CAAC,CAEb;;UACF,EAAE,uBAAa,CACf;UAAA,CAAC,iBAAM,CAAC,OAAO,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,iBAAiB,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,QAAQ,CAAC,CAC5E;;UACF,EAAE,iBAAM,CACV;QAAA,EAAE,wBAAa,CACf;QAAA,CAAC,KAAK,IAAI,CACR,CAAC,qBAAU,CAAC,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CACrD;;UACF,EAAE,qBAAU,CAAC,CACd,CACH;MAAA,EAAE,IAAI,CACR;IAAA,EAAE,iBAAM,CAAC,CACV,CAAC;AACJ,CAAC","sourcesContent":["import LoadingButton from '@mui/lab/LoadingButton';\nimport { Button, Dialog, DialogActions, DialogContent, DialogTitle, TextField, Typography } from '@mui/material';\nimport { AlertColor } from '@mui/material/Alert';\nimport Oystehr from '@oystehr/sdk';\nimport { Appointment, Communication, Encounter, Location, Patient } from 'fhir/r4b';\nimport { DateTime } from 'luxon';\nimport { ReactElement, useState } from 'react';\nimport { COMMUNICATION_ISSUE_REPORT_CODE } from 'utils';\nimport useEvolveUser from '../../hooks/useEvolveUser';\n\ninterface ReportIssueDialogProps {\n  open: boolean;\n  handleClose: () => void;\n  oystehr: Oystehr | undefined;\n  patient: Patient | undefined;\n  appointment: Appointment | undefined;\n  encounter: Encounter;\n  location: Location;\n  setToastMessage: React.Dispatch<React.SetStateAction<string | undefined>>;\n  setToastType: React.Dispatch<React.SetStateAction<AlertColor | undefined>>;\n  setSnackbarOpen: React.Dispatch<React.SetStateAction<boolean>>;\n}\n\nexport default function ReportIssueDialog({\n  open,\n  handleClose,\n  oystehr,\n  patient,\n  appointment,\n  encounter,\n  location,\n  setToastMessage,\n  setToastType,\n  setSnackbarOpen,\n}: ReportIssueDialogProps): ReactElement {\n  const [reportIssueLoading, setReportIssueLoading] = useState<boolean>(false);\n  const [issueDetails, setIssueDetails] = useState<string>('');\n  const [error, setError] = useState<boolean>(false);\n  const buttonSx = {\n    fontWeight: 500,\n    textTransform: 'none',\n    borderRadius: 6,\n  };\n\n  const user = useEvolveUser();\n\n  const handleReportIssue = async (event: React.FormEvent<HTMLFormElement>): Promise<void> => {\n    event.preventDefault();\n    setError(false);\n    setReportIssueLoading(true);\n\n    const issueCommunication: Communication = {\n      resourceType: 'Communication',\n      status: 'in-progress',\n      category: [\n        {\n          coding: [COMMUNICATION_ISSUE_REPORT_CODE],\n        },\n      ],\n      encounter: {\n        type: 'Encounter',\n        reference: `Encounter/${encounter.id}`,\n      },\n      sent: DateTime.now().toISO() || '',\n      payload: [\n        {\n          contentString: issueDetails,\n        },\n      ],\n    };\n\n    if (user?.profile) {\n      issueCommunication.sender = {\n        type: 'Practitioner',\n        reference: user.profile,\n      };\n    }\n    if (patient?.id) {\n      issueCommunication.subject = {\n        type: 'Patient',\n        reference: `Patient/${patient.id}`,\n      };\n    }\n\n    const about = [];\n    if (appointment?.id) {\n      about.push({\n        type: 'Appointment',\n        reference: `Appointment/${appointment.id}`,\n      });\n    }\n    if (location?.id) {\n      about.push({\n        type: 'Location',\n        reference: `Location/${location.id}`,\n      });\n    }\n    if (about.length > 0) {\n      issueCommunication.about = about;\n    }\n\n    try {\n      await oystehr?.fhir.create(issueCommunication);\n      setToastMessage('Issue submitted successfully!');\n      setToastType('success');\n      setSnackbarOpen(true);\n      handleClose();\n    } catch (e) {\n      console.log('error', e);\n      setError(true);\n    }\n    setReportIssueLoading(false);\n    setIssueDetails('');\n  };\n\n  const handleDialogClose = (): void => {\n    handleClose();\n    setIssueDetails('');\n    setError(false);\n  };\n\n  return (\n    <Dialog\n      open={open}\n      onClose={handleClose}\n      disableScrollLock\n      sx={{\n        '.MuiPaper-root': {\n          padding: 1,\n          width: '444px',\n          maxWidth: 'initial',\n        },\n      }}\n    >\n      <form onSubmit={(e) => handleReportIssue(e)}>\n        <DialogTitle variant=\"h4\" color=\"primary.dark\" sx={{ width: '100%' }}>\n          Report Issue\n        </DialogTitle>\n        <DialogContent>\n          <div>\n            <Typography>\n              Did you or the patient have an issue interacting with the software? Please let us know what you\n              experienced. This feedback will be submitted directly to the development team.\n            </Typography>\n            <TextField\n              required\n              multiline\n              minRows={3}\n              placeholder={'Enter issue details here...'}\n              value={issueDetails}\n              onChange={(e) => setIssueDetails(e.target.value)}\n              sx={{ marginTop: 1, width: '100%' }}\n            />\n          </div>\n        </DialogContent>\n        <DialogActions sx={{ justifyContent: 'flex-start', marginLeft: 1 }}>\n          <LoadingButton\n            loading={reportIssueLoading}\n            disabled={issueDetails.trim() === ''}\n            type=\"submit\"\n            variant=\"contained\"\n            color=\"primary\"\n            size=\"medium\"\n            sx={buttonSx}\n          >\n            Submit Issue\n          </LoadingButton>\n          <Button variant=\"text\" onClick={handleDialogClose} size=\"medium\" sx={buttonSx}>\n            Cancel\n          </Button>\n        </DialogActions>\n        {error && (\n          <Typography color=\"error\" variant=\"body2\" my={1} mx={2}>\n            There was an error sending this issue report, please try again.\n          </Typography>\n        )}\n      </form>\n    </Dialog>\n  );\n}\n"]}