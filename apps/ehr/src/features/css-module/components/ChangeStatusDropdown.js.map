{"version":3,"file":"ChangeStatusDropdown.js","sourceRoot":"","sources":["ChangeStatusDropdown.tsx"],"names":[],"mappings":"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","sourcesContent":["import { CircularProgress, FormControl, Grid, MenuItem, Select, SelectChangeEvent, Skeleton } from '@mui/material';\nimport { styled } from '@mui/system';\nimport { enqueueSnackbar } from 'notistack';\nimport React, { useEffect, useState } from 'react';\nimport { getVisitStatus, Visit_Status_Array, VisitStatusLabel, VisitStatusWithoutUnknown } from 'utils';\nimport { CHIP_STATUS_MAP } from '../../../components/AppointmentTableRow';\nimport { dataTestIds } from '../../../constants/data-test-ids';\nimport { handleChangeInPersonVisitStatus } from '../../../helpers/inPersonVisitStatusUtils';\nimport { useApiClients } from '../../../hooks/useAppClients';\nimport useEvolveUser from '../../../hooks/useEvolveUser';\nimport { useAppointment } from '../hooks/useAppointment';\n\nconst StyledSelect = styled(Select)<{ hasDropdown?: string; arrowColor: string }>(\n  ({ hasDropdown: hasDropdown, arrowColor: arrowColor }) => ({\n    height: '32px',\n    borderRadius: '4px',\n    paddingLeft: '12px',\n    paddingRight: '12px',\n    boxShadow: 'none',\n    '& .MuiSelect-select': {\n      paddingRight: '32px !important',\n    },\n    '& .MuiOutlinedInput-notchedOutline': {\n      border: 'none',\n    },\n    '& .MuiSvgIcon-root': {\n      display: 'none',\n    },\n    ...(hasDropdown && {\n      '&::after': {\n        content: '\"\"',\n        position: 'absolute',\n        right: '12px',\n        top: '50%',\n        transform: 'translateY(-50%)',\n        width: '10px',\n        height: '7px',\n        // cSpell:disable-next %3C svg\n        backgroundImage: `url(\"data:image/svg+xml,%3Csvg width='10' height='7' viewBox='0 0 10 7' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M5 6.83317L0 1.83317L1.16667 0.666504L5 4.49984L8.83333 0.666504L10 1.83317L5 6.83317Z' fill='${encodeURIComponent(\n          arrowColor\n        )}'/%3E%3C/svg%3E\")`,\n        backgroundRepeat: 'no-repeat',\n        backgroundPosition: 'center',\n        pointerEvents: 'none',\n      },\n    }),\n  })\n);\n\nexport const ChangeStatusDropdown = ({\n  appointmentID,\n  onStatusChange,\n  getAndSetResources,\n}: {\n  appointmentID?: string;\n  onStatusChange: (status: VisitStatusWithoutUnknown) => void;\n  getAndSetResources?: ({ logs, notes }: { logs?: boolean; notes?: boolean }) => Promise<void>;\n}): React.ReactElement => {\n  const [statusLoading, setStatusLoading] = useState<boolean>(false);\n  const [status, setStatus] = useState<VisitStatusWithoutUnknown | undefined>(undefined);\n  const { oystehrZambda } = useApiClients();\n  const user = useEvolveUser();\n  const { visitState: telemedData, refetch } = useAppointment(appointmentID);\n  const { appointment, encounter } = telemedData;\n\n  useEffect(() => {\n    if (!encounter?.id || !appointment) {\n      return;\n    }\n\n    const encounterStatus = getVisitStatus(appointment, encounter);\n\n    if (encounterStatus === 'unknown') {\n      console.warn('Encounter status is unknown, so not setting a status');\n      return;\n    }\n\n    setStatus(encounterStatus);\n    onStatusChange(encounterStatus);\n  }, [appointment, encounter, onStatusChange]);\n\n  if (!user || !encounter?.id || statusLoading || !status) {\n    return (\n      <Grid item>\n        <Skeleton aria-busy=\"true\" sx={{ marginTop: -1 }} width={120} height={52} />\n      </Grid>\n    );\n  }\n\n  const encounterId: string = encounter.id;\n\n  const nonDropdownStatuses = ['checked out', 'canceled', 'no show'];\n  const hasDropdown = !nonDropdownStatuses.includes(status);\n\n  const updateInPersonVisitStatus = async (event: SelectChangeEvent<VisitStatusLabel | unknown>): Promise<void> => {\n    if ((event.target.value as VisitStatusWithoutUnknown) === 'completed') {\n      alert('To mark a visit as completed, scroll to the bottom of the \"Progress Note\" and click \"Review & Sign\"');\n      return;\n    }\n    setStatusLoading(true);\n    try {\n      await handleChangeInPersonVisitStatus(\n        {\n          encounterId,\n          user,\n          updatedStatus: event.target.value as VisitStatusWithoutUnknown,\n        },\n        oystehrZambda\n      );\n      await refetch();\n      if (getAndSetResources) {\n        await getAndSetResources({ logs: true }).catch((error: any) => {\n          console.log('error getting activity logs after status dropdown update', error);\n          enqueueSnackbar('An error getting updated activity logs. Please try refreshing the page.', {\n            variant: 'error',\n          });\n        });\n      }\n    } catch (error) {\n      console.error(error);\n      enqueueSnackbar('An error occurred. Please try again.', { variant: 'error' });\n    } finally {\n      setStatusLoading(false);\n    }\n  };\n\n  return (\n    <Grid item>\n      <div id=\"user-set-appointment-status\">\n        <FormControl size=\"small\">\n          <StyledSelect\n            data-testid={dataTestIds.cssHeader.appointmentStatus}\n            id=\"appointment-status\"\n            value={status}\n            {...(hasDropdown ? { hasDropdown: 'true' } : {})}\n            arrowColor={CHIP_STATUS_MAP[status].color.primary}\n            onChange={updateInPersonVisitStatus}\n            sx={{\n              border: `1px solid ${CHIP_STATUS_MAP[status].color.primary}`,\n              borderRadius: '7px',\n              backgroundColor: CHIP_STATUS_MAP[status].background.primary,\n              color: CHIP_STATUS_MAP[status].color.primary,\n              '&:hover': {\n                backgroundColor: CHIP_STATUS_MAP[status].background.primary,\n                filter: 'brightness(0.95)',\n              },\n            }}\n            MenuProps={{\n              PaperProps: {\n                sx: {\n                  maxHeight: 300,\n                  '& .MuiMenuItem-root': {\n                    padding: '6px 16px',\n                  },\n                },\n              },\n            }}\n          >\n            {Visit_Status_Array.filter((statusTemp) => {\n              let allHiddenStatuses: Partial<VisitStatusLabel>[] = [\n                'no show',\n                'unknown',\n                ...(['cancelled', 'intake', 'provider', 'ready for provider', 'discharged'].filter(\n                  (s) => s !== status\n                ) as Partial<VisitStatusLabel>[]),\n              ];\n              if (status === 'ready for provider' || status === 'intake') {\n                allHiddenStatuses = allHiddenStatuses.filter((s) => s !== 'provider');\n              }\n              return !allHiddenStatuses.includes(statusTemp);\n            }).map((statusTemp) => (\n              <MenuItem\n                key={statusTemp}\n                value={statusTemp}\n                sx={{\n                  backgroundColor: CHIP_STATUS_MAP[statusTemp].background.primary,\n                  color: CHIP_STATUS_MAP[statusTemp].color.primary,\n                  '&:hover': {\n                    backgroundColor: CHIP_STATUS_MAP[statusTemp].background.primary,\n                    filter: 'brightness(0.95)',\n                  },\n                  '&.Mui-selected': {\n                    backgroundColor: CHIP_STATUS_MAP[statusTemp].background.primary,\n                    color: CHIP_STATUS_MAP[statusTemp].color.primary,\n                    '&:hover': {\n                      backgroundColor: CHIP_STATUS_MAP[statusTemp].background.primary,\n                      filter: 'brightness(0.95)',\n                    },\n                  },\n                }}\n              >\n                {statusTemp}\n              </MenuItem>\n            ))}\n          </StyledSelect>\n        </FormControl>\n        {statusLoading && <CircularProgress size=\"20px\" sx={{ marginTop: 2.8, marginLeft: 1 }} />}\n      </div>\n    </Grid>\n  );\n};\n"]}