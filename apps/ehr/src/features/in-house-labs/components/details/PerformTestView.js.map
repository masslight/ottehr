{"version":3,"file":"PerformTestView.js","sourceRoot":"","sources":["PerformTestView.tsx"],"names":[],"mappings":"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","sourcesContent":["import { LoadingButton } from '@mui/lab';\nimport { Box, Button, Paper, Typography } from '@mui/material';\nimport Oystehr from '@oystehr/sdk';\nimport React, { useState } from 'react';\nimport { FormProvider, SubmitHandler, useForm } from 'react-hook-form';\nimport { useParams } from 'react-router-dom';\nimport { handleInHouseLabResults } from 'src/api/api';\nimport { useApiClients } from 'src/hooks/useAppClients';\nimport { getFormattedDiagnoses, InHouseOrderDetailPageItemDTO, LoadingState, PageName, ResultEntryInput } from 'utils';\nimport { InHouseLabsDetailsCard } from './InHouseLabsDetailsCard';\nimport { ResultEntryRadioButton } from './ResultEntryRadioButton';\nimport { ResultEntryTable } from './ResultsEntryTable';\n\ninterface PerformTestViewProps {\n  testDetails: InHouseOrderDetailPageItemDTO;\n  setLoadingState: (loadingState: LoadingState) => void;\n  onBack: () => void;\n}\n\nexport const PerformTestView: React.FC<PerformTestViewProps> = ({ testDetails, setLoadingState, onBack }) => {\n  const methods = useForm<ResultEntryInput>({ mode: 'onChange' });\n  const { serviceRequestID } = useParams<{ testId: string; serviceRequestID: string }>();\n  const {\n    handleSubmit,\n    formState: { isValid },\n  } = methods;\n  const { oystehrZambda: oystehr } = useApiClients();\n\n  const [showDetails, setShowDetails] = useState(false);\n  // const [notes, setNotes] = useState(testDetails.notes || '');\n  const [submittingResults, setSubmittingResults] = useState<boolean>(false);\n  const [error, setError] = useState<string[] | undefined>(undefined);\n\n  const handleResultEntrySubmit: SubmitHandler<ResultEntryInput> = async (data): Promise<void> => {\n    setSubmittingResults(true);\n    if (!oystehr) {\n      console.log('no oystehr client! :o'); // todo add error handling\n      return;\n    }\n    if (!serviceRequestID) return; // todo better error handling\n    console.log('data being submitted', data);\n    try {\n      await handleInHouseLabResults(oystehr, {\n        serviceRequestId: serviceRequestID,\n        data: data,\n      });\n      setLoadingState(LoadingState.initial);\n    } catch (e) {\n      const sdkError = e as Oystehr.OystehrSdkError;\n      console.log('error entering results', sdkError.code, sdkError.message);\n      const errorMessage = [sdkError.message];\n      setError(errorMessage);\n    }\n    setSubmittingResults(false);\n  };\n\n  return (\n    <Box>\n      <Typography variant=\"body1\" sx={{ mb: 2, fontWeight: 'medium' }}>\n        {getFormattedDiagnoses(testDetails.diagnosesDTO)}\n      </Typography>\n\n      <Typography variant=\"h4\" color=\"primary.dark\" sx={{ mb: 3, fontWeight: 'bold' }}>\n        Perform Test & Enter Results\n      </Typography>\n\n      <FormProvider {...methods}>\n        <form onSubmit={handleSubmit(handleResultEntrySubmit)}>\n          <Paper sx={{ mb: 2 }}>\n            <Box sx={{ p: 3 }}>\n              <Box display=\"flex\" justifyContent=\"space-between\" alignItems=\"center\" mb={3}>\n                <Typography variant=\"h5\" color=\"primary.dark\" fontWeight=\"bold\">\n                  {testDetails.testItemName}\n                </Typography>\n                <Box\n                  sx={{\n                    bgcolor: '#E8DEFF',\n                    color: '#5E35B1',\n                    fontWeight: 'bold',\n                    px: 2,\n                    py: 0.5,\n                    borderRadius: '4px',\n                    fontSize: '0.75rem',\n                  }}\n                >\n                  {testDetails.status}\n                </Box>\n              </Box>\n\n              {testDetails.labDetails.components.radioComponents.map((component, idx) => {\n                return (\n                  <ResultEntryRadioButton\n                    key={`radio-btn-${idx}-${component.componentName}`}\n                    testItemComponent={component}\n                  />\n                );\n              })}\n\n              {testDetails.labDetails.components.groupedComponents.length > 0 && (\n                <ResultEntryTable testItemComponents={testDetails.labDetails.components.groupedComponents} />\n              )}\n              <InHouseLabsDetailsCard\n                testDetails={testDetails}\n                page={PageName.performEnterResults}\n                showDetails={showDetails}\n                setShowDetails={setShowDetails}\n              />\n            </Box>\n          </Paper>\n          <Box display=\"flex\" justifyContent=\"space-between\">\n            <Button variant=\"outlined\" onClick={onBack} sx={{ borderRadius: '50px', px: 4 }}>\n              Back\n            </Button>\n\n            <LoadingButton\n              variant=\"contained\"\n              color=\"primary\"\n              loading={submittingResults}\n              disabled={!isValid}\n              type=\"submit\"\n              sx={{ borderRadius: '50px', px: 4 }}\n            >\n              Submit\n            </LoadingButton>\n          </Box>\n          {error &&\n            error.length > 0 &&\n            error.map((msg, idx) => (\n              <Box sx={{ textAlign: 'right', paddingTop: 1 }} key={idx}>\n                <Typography sx={{ color: 'error.dark' }}>\n                  {typeof msg === 'string' ? msg : JSON.stringify(msg, null, 2)}\n                </Typography>\n              </Box>\n            ))}\n        </form>\n      </FormProvider>\n    </Box>\n  );\n};\n"]}