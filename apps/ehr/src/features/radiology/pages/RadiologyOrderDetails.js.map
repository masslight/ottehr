{"version":3,"file":"RadiologyOrderDetails.js","sourceRoot":"","sources":["RadiologyOrderDetails.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Button, Chip, CircularProgress, Typography } from '@mui/material';\nimport { Box, Stack, useTheme } from '@mui/system';\nimport React, { useCallback, useState } from 'react';\nimport { useNavigate, useParams } from 'react-router-dom';\nimport { radiologyLaunchViewer } from 'src/api/api';\nimport { useApiClients } from 'src/hooks/useAppClients';\nimport { CSSPageTitle } from '../../../telemed/components/PageTitle';\nimport radiologyIcon from '../../../themes/ottehr/icons/mui-radiology.svg';\nimport { WithRadiologyBreadcrumbs } from '../components/RadiologyBreadcrumbs';\nimport { RadiologyOrderHistoryCard } from '../components/RadiologyOrderHistoryCard';\nimport { RadiologyOrderLoading } from '../components/RadiologyOrderLoading';\nimport { RadiologyTableStatusChip } from '../components/RadiologyTableStatusChip';\nimport { usePatientRadiologyOrders } from '../components/usePatientRadiologyOrders';\n\nexport const RadiologyOrderDetailsPage: React.FC = () => {\n  const { oystehrZambda } = useApiClients();\n  const urlParams = useParams();\n  const serviceRequestId = urlParams.serviceRequestID as string;\n  const navigate = useNavigate();\n  const theme = useTheme();\n\n  const [isLaunchingViewer, setIsLaunchingViewer] = useState(false);\n  const [launchViewerError, setLaunchViewerError] = useState<string | null>(null);\n\n  const { orders, loading } = usePatientRadiologyOrders({\n    serviceRequestId,\n  });\n\n  const handleBack = (): void => {\n    navigate(-1);\n  };\n\n  const handleViewImageClick = useCallback(async (): Promise<void> => {\n    setIsLaunchingViewer(true);\n    setLaunchViewerError(null);\n\n    if (!oystehrZambda) {\n      console.error('oystehrZambda is not defined');\n      return;\n    }\n\n    try {\n      const response = await radiologyLaunchViewer(oystehrZambda, {\n        serviceRequestId: serviceRequestId,\n      });\n\n      if (response) {\n        window.open(response.url, '_blank');\n      } else {\n        setLaunchViewerError('Could not launch viewer');\n      }\n    } catch (err) {\n      console.error('Error launching viewer:', err);\n      setLaunchViewerError('An error occurred launching the viewer');\n    } finally {\n      setIsLaunchingViewer(false);\n    }\n  }, [serviceRequestId, oystehrZambda]);\n\n  const order = orders.find((order) => order.serviceRequestId === serviceRequestId);\n\n  if (loading || !order) {\n    return <RadiologyOrderLoading />;\n  }\n\n  return (\n    <WithRadiologyBreadcrumbs sectionName={order.studyType}>\n      <div style={{ maxWidth: '714px', margin: '0 auto' }}>\n        <Stack spacing={2} sx={{ p: 3 }}>\n          {order.isStat ? (\n            <Chip\n              size=\"small\"\n              label=\"STAT\"\n              sx={{\n                borderRadius: '4px',\n                border: 'none',\n                fontWeight: 900,\n                fontSize: '14px',\n                textTransform: 'uppercase',\n                background: theme.palette.error.main,\n                color: 'white',\n                padding: '8px',\n                height: '24px',\n                width: 'fit-content',\n              }}\n              variant=\"outlined\"\n            />\n          ) : null}\n          <CSSPageTitle>{`Radiology: ${order.studyType}`}</CSSPageTitle>\n\n          <Box\n            sx={{\n              display: 'flex',\n              justifyContent: 'space-between',\n              alignItems: 'center',\n              mb: 1,\n            }}\n          >\n            <Box\n              sx={{\n                display: 'flex',\n                alignItems: 'center',\n                gap: 1,\n                flexDirection: 'row',\n                fontWeight: 'bold',\n              }}\n            >\n              <Typography variant=\"body1\" sx={{ fontWeight: 'medium' }}>\n                {order.diagnosis}\n              </Typography>\n            </Box>\n            <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, flexDirection: 'row' }}>\n              <RadiologyTableStatusChip status={order.status} />\n            </Box>\n          </Box>\n\n          <Box sx={{ border: '1px solid #e0e0e0', borderRadius: 1, backgroundColor: '#fff' }}>\n            <Box sx={{ padding: 2 }}>\n              <Button\n                variant=\"outlined\"\n                startIcon={\n                  <Box\n                    sx={{\n                      fill: 'gray',\n                    }}\n                    component=\"img\"\n                    src={radiologyIcon}\n                    style={{ width: '30px', marginRight: '8px' }}\n                  />\n                }\n                endIcon={isLaunchingViewer ? <CircularProgress size={16} color=\"inherit\" /> : null}\n                onClick={() => handleViewImageClick()}\n                sx={{ borderRadius: '50px', textTransform: 'none' }}\n                disabled={order.status === 'pending' || isLaunchingViewer}\n              >\n                {isLaunchingViewer ? 'Launching Image...' : 'View Image'}\n              </Button>\n\n              {launchViewerError && (\n                <Box sx={{ mt: 2, color: 'error.main' }}>\n                  <Typography color=\"error\">{launchViewerError}</Typography>\n                </Box>\n              )}\n\n              {order.clinicalHistory && (\n                <Box sx={{ mt: 2 }}>\n                  <Typography variant=\"body2\" sx={{ fontWeight: 'medium', mb: 1, textDecoration: 'underline' }}>\n                    Clinical History\n                  </Typography>\n                  <Typography variant=\"body2\" sx={{ color: 'text.secondary' }}>\n                    {order.clinicalHistory}\n                  </Typography>\n                </Box>\n              )}\n\n              {order.result != null ? (\n                <Box sx={{ mt: 2 }}>\n                  <Typography variant=\"body2\" sx={{ fontWeight: 'medium', mb: 1, textDecoration: 'underline' }}>\n                    Report\n                  </Typography>\n                  <Typography variant=\"body2\">\n                    <div dangerouslySetInnerHTML={{ __html: atob(order.result) }} />\n                  </Typography>\n                </Box>\n              ) : (\n                <div />\n              )}\n            </Box>\n          </Box>\n\n          <RadiologyOrderHistoryCard orderHistory={order.history} />\n\n          <Button\n            variant=\"outlined\"\n            color=\"primary\"\n            sx={{\n              borderRadius: 28,\n              padding: '8px 22px',\n              alignSelf: 'flex-start',\n              marginTop: 2,\n              textTransform: 'none',\n            }}\n            onClick={handleBack}\n          >\n            Back\n          </Button>\n        </Stack>\n      </div>\n    </WithRadiologyBreadcrumbs>\n  );\n};\n"]}