{"version":3,"file":"EditEmployee.js","sourceRoot":"","sources":["EditEmployee.tsx"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAcA,mCA0MC;AAxND,gCAAyC;AACzC,0CAAqF;AACrF,uCAA4C;AAC5C,+BAAqD;AACrD,qDAAmD;AACnD,+BAAkG;AAClG,kCAA4D;AAC5D,qEAAgE;AAChE,yEAAwE;AACxE,4DAAyD;AACzD,kEAAiE;AACjE,wDAAuD;AACvD,yDAAoD;AAEpD,SAAwB,gBAAgB;IAAxC,iBA0MC;;IAzMO,IAAA,KAA6B,IAAA,6BAAa,GAAE,EAA1C,OAAO,aAAA,EAAE,aAAa,mBAAoB,CAAC;IAC7C,IAAA,KAA0B,IAAA,gBAAQ,GAAW,EAA5C,QAAQ,QAAA,EAAE,WAAW,QAAuB,CAAC;IAC9C,IAAA,KAAkB,IAAA,gBAAQ,GAAQ,EAAjC,IAAI,QAAA,EAAE,OAAO,QAAoB,CAAC;IACnC,IAAA,KAA8B,IAAA,gBAAQ,EAAqB,SAAS,CAAC,EAApE,UAAU,QAAA,EAAE,aAAa,QAA2C,CAAC;IACtE,IAAA,KAAwB,IAAA,gBAAQ,EAAU,KAAK,CAAC,EAA/C,OAAO,QAAA,EAAE,UAAU,QAA4B,CAAC;IACjD,IAAA,KAAsB,IAAA,gBAAQ,EAAC,EAAE,MAAM,EAAE,EAAE,EAAE,CAAC,EAA7C,MAAM,QAAA,EAAE,SAAS,QAA4B,CAAC;IAErD,IAAM,YAAY,GAA0B,IAAA,eAAO,EAAC;;QAClD,IAAI,MAAA,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,eAAe,0CAAE,aAAa,EAAE,CAAC;YACzC,OAAO,IAAA,kCAA0B,EAAC,IAAI,CAAC,eAAe,CAAC,CAAC;QAC1D,CAAC;QACD,OAAO,EAAE,CAAC;IACZ,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC,CAAC;IAEX,+BAA+B;IACvB,IAAA,EAAE,GAAK,IAAA,4BAAS,GAAE,GAAhB,CAAiB;IAE3B,0EAA0E;IAC1E,IAAA,iBAAS,EAAC;QACR,IAAI,OAAO,GAAG,KAAK,CAAC;QAEpB,SAAe,OAAO;;;;;;4BACpB,IAAI,CAAC,OAAO,EAAE,CAAC;gCACb,MAAM,IAAI,KAAK,CAAC,6BAA6B,CAAC,CAAC;4BACjD,CAAC;4BACD,IAAI,CAAC,aAAa,EAAE,CAAC;gCACnB,MAAM,IAAI,KAAK,CAAC,yBAAyB,CAAC,CAAC;4BAC7C,CAAC;iCACG,CAAA,EAAE,IAAI,CAAC,OAAO,CAAA,EAAd,wBAAc;4BAChB,OAAO,GAAG,IAAI,CAAC;4BACH,qBAAM,IAAA,oBAAc,EAAC,aAAa,EAAE;oCAC9C,MAAM,EAAE,EAAE;iCACX,CAAC,EAAA;;4BAFI,GAAG,GAAG,SAEV;4BACF,IAAI,OAAO,EAAE,CAAC;gCACE,OAAO,GAAqB,GAAG,KAAxB,EAAE,cAAc,GAAK,GAAG,eAAR,CAAS;gCAC9C,aAAa,CAAC,cAAc,CAAC,CAAC;gCAC9B,OAAO,CAAC,OAAO,CAAC,CAAC;gCACjB,WAAW,CAAC,IAAA,qCAAiB,EAAC,OAAO,CAAC,CAAC,CAAC;gCACxC,OAAO,GAAG,KAAK,CAAC;4BAClB,CAAC;;;;;;SAEJ;QAED,IAAI,CAAC,OAAO,EAAE,CAAC;YACb,OAAO,EAAE,CAAC,KAAK,CAAC,UAAC,KAAK,IAAK,OAAA,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,EAAlB,CAAkB,CAAC,CAAC;QACjD,CAAC;QAED,OAAO;YACL,OAAO,GAAG,KAAK,CAAC;QAClB,CAAC,CAAC;IACJ,CAAC,EAAE,CAAC,OAAO,EAAE,EAAE,EAAE,aAAa,CAAC,CAAC,CAAC;IAEjC,SAAe,oBAAoB;;;;;;wBACjC,IAAI,CAAC,aAAa,EAAE,CAAC;4BACnB,MAAM,IAAI,KAAK,CAAC,8BAA8B,CAAC,CAAC;wBAClD,CAAC;wBACuB,qBAAM,IAAA,oBAAc,EAAC,aAAa,EAAE;gCAC1D,MAAM,EAAE,EAAE;6BACX,CAAC,EAAA;;wBAFI,eAAe,GAAG,SAEtB;wBACI,QAAQ,GAAG,eAAe,CAAC,IAAI,CAAC;wBACtC,OAAO,CAAC,QAAQ,CAAC,CAAC;wBAClB,WAAW,CAAC,IAAA,qCAAiB,EAAC,QAAQ,CAAC,CAAC,CAAC;;;;;KAC1C;IAED,IAAM,oBAAoB,GAAG,UAAO,IAAwB;;;;;oBAC1D,UAAU,CAAC,IAAI,CAAC,CAAC;oBACjB,IAAI,CAAC,aAAa,EAAE,CAAC;wBACnB,MAAM,IAAI,KAAK,CAAC,yBAAyB,CAAC,CAAC;oBAC7C,CAAC;oBACD,SAAS,CAAC,EAAE,MAAM,EAAE,EAAE,EAAE,CAAC,CAAC;oBAE1B,IAAI,CAAC,CAAA,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,EAAE,CAAA,EAAE,CAAC;wBACd,MAAM,IAAI,KAAK,CAAC,sBAAsB,CAAC,CAAC;oBAC1C,CAAC;;;;oBAGC,qBAAM,IAAA,oBAAc,EAAC,aAAa,EAAE,EAAE,MAAM,EAAE,IAAI,CAAC,EAAE,EAAE,IAAI,MAAA,EAAE,CAAC,EAAA;;oBAA9D,SAA8D,CAAC;oBAC/D,qBAAM,oBAAoB,EAAE,EAAA;;oBAA5B,SAA4B,CAAC;oBAC7B,IAAA,2BAAe,EAAC,mBAAY,IAAI,mBAAgB,EAAE;wBAChD,OAAO,EAAE,SAAS;qBACnB,CAAC,CAAC;;;;oBAEG,gBAAc,oBAAa,IAAI,4BAAyB,CAAC;oBAC/D,SAAS,CAAC,UAAC,IAAI,IAAK,OAAA,uBAAM,IAAI,KAAE,MAAM,EAAE,UAAG,aAAW,CAAE,IAAG,EAAvC,CAAuC,CAAC,CAAC;oBAC7D,IAAA,2BAAe,EAAC,UAAG,aAAW,CAAE,EAAE;wBAChC,OAAO,EAAE,OAAO;qBACjB,CAAC,CAAC;;;oBAEH,UAAU,CAAC,KAAK,CAAC,CAAC;;;;;SAErB,CAAC;IAEF,OAAO,CACL,CAAC,uBAAa,CAAC,QAAQ,CAAC,CAAC,eAAe,CAAC,CACvC;MAAA,EACE;QAAA,CAAC,eAAI,CAAC,SAAS,CAAC,SAAS,CAAC,KAAK,CAAC,UAAU,CAAC,QAAQ,CAAC,cAAc,CAAC,QAAQ,CACzE;UAAA,CAAC,eAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,OAAO,CAAC,CAAC,KAAK,CAAC,CAAC,MAAM,CAAC,CAC1C;YAAA,CAAC,iBAAiB,CAClB;YAAA,CAAC,2BAAiB,CAChB,KAAK,CAAC,CAAC;YACL,EAAE,IAAI,EAAE,YAAY,EAAE,QAAQ,EAAE,WAAW,EAAE;YAC7C,EAAE,IAAI,EAAE,GAAG,EAAE,QAAQ,EAAE,CAAA,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,IAAI,KAAI,CAAC,mBAAQ,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,EAAG,EAAE;SAChE,CAAC,EAGJ;;YAAA,CAAC,gBAAgB,CACjB;YAAA,CAAC,qBAAU,CACT,OAAO,CAAC,IAAI,CACZ,KAAK,CAAC,cAAc,CACpB,SAAS,CAAC,CAAC,CAAC,CAAC,CACb,EAAE,CAAC,CAAC,EAAE,OAAO,EAAE,MAAM,EAAE,aAAa,EAAE,KAAK,EAAE,UAAU,EAAE,QAAQ,EAAE,UAAU,EAAE,gBAAgB,EAAE,CAAC,CAElG;cAAA,CAAC,CAAA,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,IAAI,KAAI,CAAC,mBAAQ,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,EAAG,CACvC;cAAA,CAAC,QAAQ,KAAK,SAAS,IAAI,CAAC,QAAQ,IAAI,CACtC,CAAC,eAAI,CAAC,KAAK,CAAC,aAAa,CAAC,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC,EAAE,UAAU,EAAE,CAAC,EAAE,CAAC,EAAG,CAC/E,CACH;YAAA,EAAE,qBAAU,CACZ;YAAA,CAAC,qBAAU,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAChC;cAAA,CAAC,CAAA,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,KAAK,KAAI,CAAC,mBAAQ,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,EAAG,CAC1C;YAAA,EAAE,qBAAU,CAEZ;;YAAA,CAAC,kBAAkB,CACnB;YAAA,CAAC,cAAG,CACF;cAAA,CAAC,IAAI,IAAI,CACP,CAAC,6BAAuB,CACtB,WAAW,CAAC,cAAc,CAC1B,YAAY,CAAC,CAAC,IAAI,CAAC,CACnB,QAAQ,CAAC,CAAC,QAAQ,CAAC,CACnB,QAAQ,CAAC,CAAC,YAAY,CAAC,CACvB,oBAAoB,CAAC,CAAC,oBAAoB,CAAC,EAC3C,CACH,CAED;;cAAA,CAAC,QAAQ,IAAI,CACX,CAAC,gBAAK,CAAC,EAAE,CAAC,CAAC,EAAE,OAAO,EAAE,CAAC,EAAE,SAAS,EAAE,CAAC,EAAE,CAAC,CACtC;kBAAA,CAAC,qBAAU,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,cAAc,CAAC,EAAE,CAAC,CAAC,EAAE,UAAU,EAAE,gBAAgB,EAAE,CAAC,CACjF;;kBACF,EAAE,qBAAU,CACZ;kBAAA,CAAC,UAAU,CAAC,CAAC,CAAC,CACZ,CAAC,uBAAI,CAAC,EAAE,CAAC,CAAC,uBAAgB,UAAU,CAAE,CAAC,CACrC;sBAAA,CAAC,iBAAM,CAAC,OAAO,CAAC,WAAW,CAAC,EAAE,CAAC,CAAC,EAAE,SAAS,EAAE,CAAC,EAAE,CAAC,CAC/C;;sBACF,EAAE,iBAAM,CACV;oBAAA,EAAE,uBAAI,CAAC,CACR,CAAC,CAAC,CAAC,CACF,CAAC,uBAAI,CAAC,EAAE,CAAC,CAAC,iCAA0B,MAAA,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,eAAe,0CAAE,EAAE,CAAE,CAAC,CAC9D;sBAAA,CAAC,iBAAM,CAAC,OAAO,CAAC,WAAW,CAAC,EAAE,CAAC,CAAC,EAAE,SAAS,EAAE,CAAC,EAAE,CAAC,CAC/C;;sBACF,EAAE,iBAAM,CACV;oBAAA,EAAE,uBAAI,CAAC,CACR,CACH;gBAAA,EAAE,gBAAK,CAAC,CACT,CAED;;cAAA,CAAC,oCAAoC,CACrC;cAAA,CAAC,QAAQ,KAAK,SAAS,CAAC,CAAC,CAAC,CACxB,CAAC,mBAAQ,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,SAAS,EAAE,CAAC,CAAC,EAAE,CAAC,EAAG,CACjD,CAAC,CAAC,CAAC,CACF,CAAC,gBAAK,CAAC,EAAE,CAAC,CAAC,EAAE,OAAO,EAAE,CAAC,EAAE,SAAS,EAAE,CAAC,EAAE,CAAC,CACtC;kBAAA,CAAC,qBAAU,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,cAAc,CAAC,EAAE,CAAC,CAAC,EAAE,UAAU,EAAE,gBAAgB,EAAE,CAAC,CACjF;oBAAA,CAAC,QAAQ,CAAC,CAAC,CAAC,oBAAoB,CAAC,CAAC,CAAC,kBAAkB,CACvD;kBAAA,EAAE,qBAAU,CACZ;kBAAA,CAAC,qBAAU,CAAC,OAAO,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CACvC;oBAAA,CAAC,QAAQ;gBACP,CAAC,CAAC,6FAA6F;gBAC/F,CAAC,CAAC,iFAAiF,CACvF;kBAAA,EAAE,qBAAU,CAEZ;;kBAAA,CAAC,sCAAsC,CACvC;kBAAA,CAAC,MAAM,CAAC,MAAM,IAAI,CAChB,CAAC,qBAAU,CAAC,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAC9C;sBAAA,CAAC,MAAM,CAAC,MAAM,CAChB;oBAAA,EAAE,qBAAU,CAAC,CACd,CAED;;kBAAA,CAAC,mBAAa,CACZ,OAAO,CAAC,WAAW,CACnB,KAAK,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,SAAS,CAAC,CACtC,WAAW,CAAC,CAAC,2BAAW,CAAC,aAAa,CAAC,oBAAoB,CAAC,CAC5D,EAAE,CAAC,CAAC;gBACF,aAAa,EAAE,MAAM;gBACrB,YAAY,EAAE,EAAE;gBAChB,SAAS,EAAE,CAAC;gBACZ,UAAU,EAAE,MAAM;gBAClB,WAAW,EAAE,CAAC;aACf,CAAC,CACF,OAAO,CAAC,CAAC,OAAO,CAAC,CACjB,OAAO,CAAC,CACN,QAAQ,CAAC,CAAC,CAAC,cAAM,OAAA,oBAAoB,CAAC,YAAY,CAAC,EAAlC,CAAkC,CAAC,CAAC,CAAC,cAAM,OAAA,oBAAoB,CAAC,UAAU,CAAC,EAAhC,CAC9D,CAAC,CAED;oBAAA,CAAC,QAAQ,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,UAAU,CACvC;kBAAA,EAAE,mBAAa,CACjB;gBAAA,EAAE,gBAAK,CAAC,CACT,CACH;YAAA,EAAE,cAAG,CACP;UAAA,EAAE,eAAI,CACR;QAAA,EAAE,eAAI,CACR;MAAA,GACF;IAAA,EAAE,uBAAa,CAAC,CACjB,CAAC;AACJ,CAAC","sourcesContent":["import { LoadingButton } from '@mui/lab';\nimport { Box, Button, Chip, Grid, Paper, Skeleton, Typography } from '@mui/material';\nimport { enqueueSnackbar } from 'notistack';\nimport { useEffect, useMemo, useState } from 'react';\nimport { Link, useParams } from 'react-router-dom';\nimport { allLicensesForPractitioner, PractitionerLicense, User, UserActivationMode } from 'utils';\nimport { getUserDetails, userActivation } from '../api/api';\nimport CustomBreadcrumbs from '../components/CustomBreadcrumbs';\nimport EmployeeInformationForm from '../components/EmployeeInformation';\nimport { dataTestIds } from '../constants/data-test-ids';\nimport { checkUserIsActive } from '../helpers/checkUserIsActive';\nimport { useApiClients } from '../hooks/useAppClients';\nimport PageContainer from '../layout/PageContainer';\n\nexport default function EditEmployeePage(): JSX.Element {\n  const { oystehr, oystehrZambda } = useApiClients();\n  const [isActive, setIsActive] = useState<boolean>();\n  const [user, setUser] = useState<User>();\n  const [scheduleId, setScheduleId] = useState<string | undefined>(undefined);\n  const [loading, setLoading] = useState<boolean>(false);\n  const [errors, setErrors] = useState({ submit: '' });\n\n  const userLicenses: PractitionerLicense[] = useMemo(() => {\n    if (user?.profileResource?.qualification) {\n      return allLicensesForPractitioner(user.profileResource);\n    }\n    return [];\n  }, [user]);\n\n  // get the user id from the url\n  const { id } = useParams();\n\n  // get the user from the database, wait for the response before continuing\n  useEffect(() => {\n    let loading = false;\n\n    async function getUser(): Promise<void> {\n      if (!oystehr) {\n        throw new Error('Oystehr client is undefined');\n      }\n      if (!oystehrZambda) {\n        throw new Error('Zambda Client not found');\n      }\n      if (id && !loading) {\n        loading = true;\n        const res = await getUserDetails(oystehrZambda, {\n          userId: id,\n        });\n        if (loading) {\n          const { user: appUser, userScheduleId } = res;\n          setScheduleId(userScheduleId);\n          setUser(appUser);\n          setIsActive(checkUserIsActive(appUser));\n          loading = false;\n        }\n      }\n    }\n\n    if (!loading) {\n      getUser().catch((error) => console.log(error));\n    }\n\n    return () => {\n      loading = false;\n    };\n  }, [oystehr, id, oystehrZambda]);\n\n  async function getUserAndUpdatePage(): Promise<void> {\n    if (!oystehrZambda) {\n      throw new Error('oystehrZambda is not defined');\n    }\n    const userDetailsTemp = await getUserDetails(oystehrZambda, {\n      userId: id,\n    });\n    const userTemp = userDetailsTemp.user;\n    setUser(userTemp);\n    setIsActive(checkUserIsActive(userTemp));\n  }\n\n  const handleUserActivation = async (mode: UserActivationMode): Promise<void> => {\n    setLoading(true);\n    if (!oystehrZambda) {\n      throw new Error('Zambda Client not found');\n    }\n    setErrors({ submit: '' });\n\n    if (!user?.id) {\n      throw new Error('User ID is undefined');\n    }\n\n    try {\n      await userActivation(oystehrZambda, { userId: user.id, mode });\n      await getUserAndUpdatePage();\n      enqueueSnackbar(`User was ${mode}d successfully`, {\n        variant: 'success',\n      });\n    } catch {\n      const errorString = `Failed to ${mode} user. Please try again`;\n      setErrors((prev) => ({ ...prev, submit: `${errorString}` }));\n      enqueueSnackbar(`${errorString}`, {\n        variant: 'error',\n      });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <PageContainer tabTitle={'Edit Employee'}>\n      <>\n        <Grid container direction=\"row\" alignItems=\"center\" justifyContent=\"center\">\n          <Grid item maxWidth={'584px'} width={'100%'}>\n            {/* Breadcrumbs */}\n            <CustomBreadcrumbs\n              chain={[\n                { link: '/employees', children: 'Employees' },\n                { link: '#', children: user?.name || <Skeleton width={150} /> },\n              ]}\n            />\n\n            {/* Page Title */}\n            <Typography\n              variant=\"h3\"\n              color=\"primary.dark\"\n              marginTop={2}\n              sx={{ display: 'flex', flexDirection: 'row', alignItems: 'center', fontWeight: '600 !important' }}\n            >\n              {user?.name || <Skeleton width={250} />}\n              {isActive !== undefined && !isActive && (\n                <Chip label=\"Deactivated\" color=\"error\" size=\"small\" sx={{ marginLeft: 3 }} />\n              )}\n            </Typography>\n            <Typography variant=\"body1\" my={2}>\n              {user?.email || <Skeleton width={250} />}\n            </Typography>\n\n            {/* Page Content */}\n            <Box>\n              {user && (\n                <EmployeeInformationForm\n                  submitLabel=\"Save changes\"\n                  existingUser={user}\n                  isActive={isActive}\n                  licenses={userLicenses}\n                  getUserAndUpdatePage={getUserAndUpdatePage}\n                />\n              )}\n\n              {isActive && (\n                <Paper sx={{ padding: 3, marginTop: 3 }}>\n                  <Typography variant=\"h4\" color=\"primary.dark\" sx={{ fontWeight: '600 !important' }}>\n                    Provider schedule\n                  </Typography>\n                  {scheduleId ? (\n                    <Link to={`/schedule/id/${scheduleId}`}>\n                      <Button variant=\"contained\" sx={{ marginTop: 1 }}>\n                        Edit schedule\n                      </Button>\n                    </Link>\n                  ) : (\n                    <Link to={`/schedule/new/provider/${user?.profileResource?.id}`}>\n                      <Button variant=\"contained\" sx={{ marginTop: 1 }}>\n                        Create schedule\n                      </Button>\n                    </Link>\n                  )}\n                </Paper>\n              )}\n\n              {/* Activate or Deactivate Profile */}\n              {isActive === undefined ? (\n                <Skeleton height={300} sx={{ marginTop: -8 }} />\n              ) : (\n                <Paper sx={{ padding: 3, marginTop: 3 }}>\n                  <Typography variant=\"h4\" color=\"primary.dark\" sx={{ fontWeight: '600 !important' }}>\n                    {isActive ? 'Deactivate profile' : 'Activate profile'}\n                  </Typography>\n                  <Typography variant=\"body1\" marginTop={1}>\n                    {isActive\n                      ? 'When you deactivate this account, this employee will not have access to the system anymore.'\n                      : 'Activate this user account. This will immediately give the user the Staff role.'}\n                  </Typography>\n\n                  {/* Error on submit if request fails */}\n                  {errors.submit && (\n                    <Typography color=\"error\" variant=\"body2\" mt={1}>\n                      {errors.submit}\n                    </Typography>\n                  )}\n\n                  <LoadingButton\n                    variant=\"contained\"\n                    color={isActive ? 'error' : 'primary'}\n                    data-testid={dataTestIds.employeesPage.deactivateUserButton}\n                    sx={{\n                      textTransform: 'none',\n                      borderRadius: 28,\n                      marginTop: 4,\n                      fontWeight: 'bold',\n                      marginRight: 1,\n                    }}\n                    loading={loading}\n                    onClick={\n                      isActive ? () => handleUserActivation('deactivate') : () => handleUserActivation('activate')\n                    }\n                  >\n                    {isActive ? 'Deactivate' : 'Activate'}\n                  </LoadingButton>\n                </Paper>\n              )}\n            </Box>\n          </Grid>\n        </Grid>\n      </>\n    </PageContainer>\n  );\n}\n"]}