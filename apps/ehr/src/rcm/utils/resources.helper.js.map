{"version":3,"file":"resources.helper.js","sourceRoot":"","sources":["resources.helper.ts"],"names":[],"mappings":"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","sourcesContent":["import Oystehr from '@oystehr/sdk';\nimport { Bundle, Coverage, DomainResource, FhirResource, Patient, RelatedPerson } from 'fhir/r4b';\nimport { DateTime } from 'luxon';\nimport { NameInformation, PersonInformation } from './form-values.types';\n\nexport const mapGenderToLabel: { [name in Exclude<Patient['gender'], undefined>]: string } = {\n  male: 'Male',\n  female: 'Female',\n  other: 'Intersex',\n  unknown: 'Unknown',\n};\n\nexport const genderOptions = Object.keys(mapGenderToLabel)\n  .filter((gender) => gender !== 'unknown')\n  .map((gender) => ({ label: mapGenderToLabel[gender as Exclude<Patient['gender'], undefined>], value: gender }));\n\nexport const RELATIONSHIP_TO_INSURED = ['Child', 'Parent', 'Spouse', 'Other', 'Self'];\n\nexport const DIAGNOSES_SEQUENCE_LETTER = ['A.', 'B.', 'C.', 'D.', 'E.', 'F.', 'G.', 'H.', 'I.', 'J.', 'K.', 'L.'];\n\nexport const findResourceByType = <Type extends FhirResource>(data: FhirResource[], type: string): Type | undefined => {\n  return data.find((resource: FhirResource): resource is Type => resource.resourceType === type);\n};\n\nexport const findResourceByTypeAndId = <Type>(\n  data: Bundle<FhirResource>[],\n  type?: string,\n  id?: string\n): Type | undefined => {\n  if (!type || !id) {\n    return;\n  }\n  return data.find((resource: FhirResource) => resource.resourceType === type && resource.id === id) as unknown as\n    | Type\n    | undefined;\n};\n\nexport const filterResourcesByType = <Type>(data: Bundle<FhirResource>[], type: string): Type[] => {\n  return data.filter((resource: FhirResource) => resource.resourceType === type) as unknown as Type[];\n};\n\nexport const getDateFromFormat = (value?: string, format?: string): DateTime | undefined => {\n  if (!value) {\n    return;\n  }\n  return DateTime.fromFormat(value, format || 'yyyy-MM-dd');\n};\n\nexport const getDateFromISO = (value?: string): DateTime | undefined => {\n  if (!value) {\n    return;\n  }\n  return DateTime.fromISO(value);\n};\n\nexport const generateOpByResourceData = <A extends DomainResource>(\n  newData: A,\n  currentData: A,\n  field: keyof A\n): 'remove' | 'add' | 'replace' => {\n  if (newData[field] === undefined && currentData[field] !== undefined) {\n    return 'remove';\n  }\n  if (newData[field] !== undefined && currentData[field] === undefined) {\n    return 'add';\n  }\n  return 'replace';\n};\n\nexport const getCoverageRelatedResources = async (\n  oystehr: Oystehr,\n  coverageReference?: string\n): Promise<(Coverage | Patient | RelatedPerson)[]> => {\n  if (!coverageReference) {\n    return [];\n  }\n\n  const resources: (Coverage | Patient | RelatedPerson)[] = [];\n\n  const coverageResource = (\n    await oystehr.fhir.search<Coverage>({\n      resourceType: 'Coverage',\n      params: [{ name: '_id', value: coverageReference.split('/')[1] }],\n    })\n  ).unbundle();\n\n  const coverage = findResourceByType<Coverage>(coverageResource, 'Coverage');\n\n  resources.push(...coverageResource);\n\n  const subscriberReference = coverage?.subscriber?.reference;\n  if (subscriberReference) {\n    const subscriberResource = (\n      await oystehr.fhir.search<Patient | RelatedPerson>({\n        resourceType: subscriberReference.split('/')[0] as 'Patient' | 'RelatedPerson',\n        params: [{ name: '_id', value: subscriberReference.split('/')[1] }],\n      })\n    ).unbundle();\n\n    resources.push(...subscriberResource);\n  }\n\n  return resources;\n};\n\nexport const mapPersonInformationToResource = (\n  person: Patient | RelatedPerson,\n  information: PersonInformation\n): void => {\n  if (information.dob) {\n    person.birthDate = information.dob.toFormat('yyyy-MM-dd');\n  } else {\n    person.birthDate = undefined;\n  }\n\n  if (information.sex) {\n    person.gender = information.sex as Patient['gender'];\n  } else {\n    person.gender = undefined;\n  }\n\n  mapPersonNameToResource(person, information);\n\n  const city = information.city.trim();\n  const address = information.address.trim();\n  const state = information.state;\n  const zip = information.zip.trim();\n\n  if (!city && !address && !state && !zip) {\n    person.address = undefined;\n  } else {\n    if (!person.address || person.address.length === 0) {\n      person.address = [{}];\n    }\n    if (!person.address[0].line || person.address[0].line.length === 0) {\n      person.address[0].line = [];\n    }\n\n    if (city) {\n      person.address[0].city = city;\n    } else {\n      person.address[0].city = undefined;\n    }\n\n    if (address) {\n      person.address[0].line[0] = address;\n    } else {\n      person.address[0].line = undefined;\n    }\n\n    if (state) {\n      person.address[0].state = state;\n    } else {\n      person.address[0].state = undefined;\n    }\n\n    if (zip) {\n      person.address[0].postalCode = zip;\n    } else {\n      person.address[0].postalCode = undefined;\n    }\n  }\n\n  const phone = information.phone;\n  if (phone) {\n    if (!person.telecom?.find((item) => item.system === 'phone')) {\n      person.telecom = [...(person.telecom || []), { system: 'phone', value: phone }];\n    } else {\n      person.telecom = person.telecom.map((item) =>\n        item.system === 'phone' ? { system: 'phone', value: phone } : item\n      );\n    }\n  } else {\n    person.telecom = person.telecom?.filter((item) => item.system !== 'phone');\n  }\n};\n\nexport const mapPersonNameToResource = (person: Patient | RelatedPerson, information: NameInformation): void => {\n  const lastName = information.lastName.trim();\n  const firstName = information.firstName.trim();\n  const middleName = information.middleName.trim();\n\n  if (!lastName && !firstName && !middleName) {\n    person.name = undefined;\n  } else {\n    if (!person.name || person.name.length === 0) {\n      person.name = [{}];\n    }\n    if (!person.name[0].given || person.name[0].given.length === 0) {\n      person.name[0].given = [];\n    }\n\n    if (lastName) {\n      person.name[0].family = lastName;\n    } else {\n      person.name[0].family = undefined;\n    }\n\n    if (!information.middleName && !information.lastName) {\n      person.name[0].given = undefined;\n    } else {\n      if (firstName) {\n        person.name[0].given[0] = firstName;\n      }\n\n      if (middleName) {\n        person.name[0].given[1] = middleName;\n      } else {\n        person.name[0].given.splice(1, 1);\n      }\n    }\n  }\n};\n"]}