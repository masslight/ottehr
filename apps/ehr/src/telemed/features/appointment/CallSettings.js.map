{"version":3,"file":"CallSettings.js","sourceRoot":"","sources":["CallSettings.tsx"],"names":[],"mappings":"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","sourcesContent":["import {\n  Button,\n  Dialog,\n  DialogActions,\n  DialogContent,\n  DialogTitle,\n  FormControl,\n  InputLabel,\n  MenuItem,\n  Select,\n  SelectChangeEvent,\n} from '@mui/material';\nimport { useAudioInputs, useAudioVideo, useVideoInputs } from 'amazon-chime-sdk-component-library-react';\nimport { ConsoleLogger, DefaultDeviceController } from 'amazon-chime-sdk-js';\nimport { FC, useCallback, useEffect, useMemo, useRef, useState } from 'react';\n\ninterface CallSettingsProps {\n  onClose: () => void;\n}\n\nexport const CallSettings: FC<CallSettingsProps> = ({ onClose }) => {\n  // const meetingManager = useMeetingManager();\n  const audioVideo = useAudioVideo();\n  const { devices: audioDevices, selectedDevice: initialAudioDevice } = useAudioInputs();\n  const { devices: videoDevices, selectedDevice: initialVideoDevice } = useVideoInputs();\n\n  const [selectedAudioDevice, setSelectedAudioDevice] = useState(initialAudioDevice);\n  const [selectedVideoPreviewDeviceId, setSelectedVideoPreviewDeviceId] = useState(initialVideoDevice);\n\n  const videoPreviewRef = useRef<HTMLVideoElement>(null);\n\n  const previewDeviceController = useMemo(() => {\n    const logger = new ConsoleLogger('preview');\n    return new DefaultDeviceController(logger);\n  }, []);\n\n  const handleSave = async (): Promise<void> => {\n    await stopAudioVideoPreviewAndUsage();\n\n    if (selectedVideoPreviewDeviceId !== initialVideoDevice) {\n      await audioVideo?.startVideoInput(selectedVideoPreviewDeviceId || initialVideoDevice || videoDevices[0].deviceId);\n    }\n\n    onClose();\n  };\n\n  const handleClose = async (): Promise<void> => {\n    await stopAudioVideoPreviewAndUsage();\n    await audioVideo?.startAudioInput(initialAudioDevice || audioDevices[0].deviceId);\n    onClose();\n  };\n\n  const stopAudioVideoPreviewAndUsage = useCallback(async (): Promise<void> => {\n    if (previewDeviceController && videoPreviewRef.current) {\n      await previewDeviceController?.stopVideoPreviewForVideoInput(videoPreviewRef.current);\n    }\n    await previewDeviceController?.stopVideoInput();\n    await previewDeviceController?.stopAudioInput();\n  }, [previewDeviceController]);\n\n  useEffect(() => {\n    return () => void stopAudioVideoPreviewAndUsage();\n  }, [stopAudioVideoPreviewAndUsage]);\n\n  const startVideoPreview = useCallback(\n    async (deviceId: string): Promise<void> => {\n      if (previewDeviceController && videoPreviewRef.current) {\n        await previewDeviceController.stopVideoInput();\n        await previewDeviceController.startVideoInput(deviceId);\n        previewDeviceController.startVideoPreviewForVideoInput(videoPreviewRef.current);\n      }\n    },\n    [previewDeviceController]\n  );\n\n  const handleVideoDeviceChange = async (event: SelectChangeEvent<string>): Promise<void> => {\n    const deviceId = event.target.value;\n    setSelectedVideoPreviewDeviceId(deviceId);\n  };\n  const handleAudioDeviceChange = async (event: SelectChangeEvent<string>): Promise<void> => {\n    const deviceId = event.target.value;\n\n    setSelectedAudioDevice(deviceId);\n    await audioVideo?.startAudioInput(deviceId);\n  };\n\n  useEffect(() => {\n    let isDisposed = false;\n    if (selectedVideoPreviewDeviceId) {\n      setTimeout(() => {\n        if (!isDisposed) {\n          void startVideoPreview(selectedVideoPreviewDeviceId.toString());\n        }\n      }, 200);\n    }\n    return () => {\n      isDisposed = true;\n    };\n  }, [selectedVideoPreviewDeviceId, startVideoPreview]);\n\n  return (\n    <Dialog open onClose={onClose}>\n      <DialogTitle>Call Settings</DialogTitle>\n      <DialogContent>\n        <video\n          ref={videoPreviewRef}\n          autoPlay\n          muted\n          playsInline\n          style={{\n            height: '100%',\n            width: '100%',\n          }}\n        ></video>\n        <FormControl fullWidth margin=\"normal\">\n          <InputLabel>Camera</InputLabel>\n          <Select value={selectedVideoPreviewDeviceId?.toString()} onChange={handleVideoDeviceChange} label=\"Camera\">\n            {videoDevices.map((device) => (\n              <MenuItem key={device.deviceId} value={device.deviceId}>\n                {device.label}\n              </MenuItem>\n            ))}\n          </Select>\n        </FormControl>\n\n        <FormControl fullWidth margin=\"normal\">\n          <InputLabel>Microphone</InputLabel>\n          <Select value={selectedAudioDevice?.toString()} onChange={handleAudioDeviceChange} label=\"Microphone\">\n            {audioDevices.map((device) => (\n              <MenuItem key={device.deviceId} value={device.deviceId}>\n                {device.label}\n              </MenuItem>\n            ))}\n          </Select>\n        </FormControl>\n      </DialogContent>\n      <DialogActions sx={{ alignItems: 'center', justifyContent: 'flex-end', padding: '16px 24px' }}>\n        <Button onClick={handleClose} sx={{ marginRight: 1 }} variant=\"text\">\n          Cancel\n        </Button>\n        <Button onClick={handleSave} variant=\"contained\">\n          Save Changes\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n};\n"]}