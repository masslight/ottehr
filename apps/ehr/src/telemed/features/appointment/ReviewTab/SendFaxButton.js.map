{"version":3,"file":"SendFaxButton.js","sourceRoot":"","sources":["SendFaxButton.tsx"],"names":[],"mappings":"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","sourcesContent":["import FaxOutlinedIcon from '@mui/icons-material/FaxOutlined';\nimport { Box, FormControl, FormHelperText, InputLabel, OutlinedInput, Tooltip, Typography } from '@mui/material';\nimport { Appointment, Encounter } from 'fhir/r4b';\nimport { enqueueSnackbar } from 'notistack';\nimport { phone } from 'phone';\nimport { FC, useMemo, useState } from 'react';\nimport InputMask from 'src/components/InputMask';\nimport { getVisitStatus, isPhoneNumberValid, TelemedAppointmentStatusEnum } from 'utils';\nimport { RoundedButton } from '../../../../components/RoundedButton';\nimport { dataTestIds } from '../../../../constants/data-test-ids';\nimport { ConfirmationDialog } from '../../../components';\nimport { useGetAppointmentAccessibility } from '../../../hooks';\nimport { useOystehrAPIClient } from '../../../hooks/useOystehrAPIClient';\n\ninterface SendFaxButtonProps {\n  appointment?: Appointment;\n  encounter?: Encounter;\n  css: boolean;\n}\n\nexport const SendFaxButton: FC<SendFaxButtonProps> = ({ appointment, encounter, css }: SendFaxButtonProps) => {\n  const apiClient = useOystehrAPIClient();\n  const [openTooltip, setOpenTooltip] = useState(false);\n\n  const inPersonStatus = useMemo(\n    () => appointment && encounter && getVisitStatus(appointment, encounter),\n    [appointment, encounter]\n  );\n  const appointmentAccessibility = useGetAppointmentAccessibility();\n\n  const [faxNumber, setFaxNumber] = useState('');\n  const [faxError, setFaxError] = useState(false);\n\n  const errorMessage = useMemo(() => {\n    if (\n      (css && inPersonStatus && !['intake', 'completed'].includes(inPersonStatus)) ||\n      appointmentAccessibility.status !== TelemedAppointmentStatusEnum.complete\n    ) {\n      return \"Once the visit note has been signed, you will have the option to fax a copy to the patient's Primary Care Physician.\";\n    }\n    return null;\n  }, [css, inPersonStatus, appointmentAccessibility.status]);\n\n  const handleSendFax = async (): Promise<void> => {\n    if (faxError) {\n      enqueueSnackbar('Please enter a valid fax number.', { variant: 'error' });\n      return;\n    }\n\n    if (!apiClient || !appointment?.id) {\n      throw new Error('api client not defined or appointment ID is missing');\n    }\n\n    try {\n      await apiClient.sendFax({\n        appointmentId: appointment.id,\n        faxNumber,\n      });\n      enqueueSnackbar('Fax sent.', { variant: 'success' });\n    } catch (error: any) {\n      console.error('Error sending fax:', error);\n      enqueueSnackbar('Error sending fax.', { variant: 'error' });\n    }\n  };\n\n  return (\n    <Box sx={{ display: 'flex', justifyContent: 'end' }}>\n      <Tooltip\n        placement=\"top\"\n        open={openTooltip && errorMessage !== null}\n        onClose={() => setOpenTooltip(false)}\n        onOpen={() => setOpenTooltip(true)}\n        title={<Typography>{errorMessage !== null && errorMessage}</Typography>}\n      >\n        <Box>\n          <ConfirmationDialog\n            title=\"Send Fax\"\n            description={\n              <FormControl variant=\"outlined\" fullWidth error={faxError} sx={{ mt: 2, mb: -2 }}>\n                <InputLabel shrink required htmlFor=\"fax-number\">\n                  Fax number\n                </InputLabel>\n                <OutlinedInput\n                  id=\"fax-number\"\n                  label=\"Fax number\"\n                  notched\n                  required\n                  type=\"tel\"\n                  placeholder=\"(XXX) XXX-XXXX\"\n                  value={faxNumber}\n                  inputMode=\"numeric\"\n                  inputComponent={InputMask as any}\n                  inputProps={{\n                    mask: '(000) 000-0000',\n                  }}\n                  onChange={(e) => {\n                    const number = e.target.value.replace(/\\D/g, '');\n                    setFaxNumber(number);\n                    if (isPhoneNumberValid(number) && phone(number).isValid) {\n                      setFaxError(false);\n                    } else {\n                      setFaxError(true);\n                    }\n                  }}\n                />\n                <FormHelperText error sx={{ visibility: faxError ? 'visible' : 'hidden' }}>\n                  Fax number must be 10 digits in the format (xxx) xxx-xxxx and a valid number\n                </FormHelperText>\n              </FormControl>\n            }\n            response={handleSendFax}\n            actionButtons={{\n              proceed: {\n                text: 'Send',\n                disabled: faxNumber === '' || faxError,\n              },\n              back: { text: 'Cancel' },\n              reverse: true,\n            }}\n          >\n            {(showDialog) => (\n              <RoundedButton\n                disabled={errorMessage !== null}\n                variant=\"outlined\"\n                onClick={showDialog}\n                startIcon={<FaxOutlinedIcon color=\"inherit\" />}\n                data-testid={dataTestIds.progressNotePage.sendFaxButton}\n              >\n                Send Fax\n              </RoundedButton>\n            )}\n          </ConfirmationDialog>\n        </Box>\n      </Tooltip>\n    </Box>\n  );\n};\n"]}