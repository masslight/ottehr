{"version":3,"file":"VideoChatContainer.js","sourceRoot":"","sources":["VideoChatContainer.tsx"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,qGAMkD;AAClD,2DAAkE;AAClE,+BAA6D;AAC7D,mEAAkE;AAClE,qCAAgD;AAChD,qDAAoD;AACpD,yCAAwC;AAEjC,IAAM,kBAAkB,GAAO;IACpC,IAAM,cAAc,GAAG,IAAA,2BAAY,EAAC,yBAAiB,EAAE,CAAC,aAAa,CAAC,CAAC,CAAC;IACxE,IAAM,cAAc,GAAG,IAAA,4DAAiB,GAAE,CAAC;IAC3C,IAAM,UAAU,GAAG,IAAA,wDAAa,GAAE,CAAC;IAC7B,IAAA,KAAkC,IAAA,wDAAa,GAAE,EAA/C,WAAW,iBAAA,EAAE,cAAc,oBAAoB,CAAC;IACxD,IAAM,aAAa,GAAG,IAAA,2DAAgB,GAAE,CAAC;IACnC,IAAA,KAA0D,IAAA,gBAAQ,EAAC,KAAK,CAAC,EAAxE,wBAAwB,QAAA,EAAE,2BAA2B,QAAmB,CAAC;IAEhF,IAAM,mBAAmB,GAAG,IAAA,mBAAW,EAAC;;;wBACtC,qBAAM,CAAA,UAAU,aAAV,UAAU,uBAAV,UAAU,CAAE,cAAc,EAAE,CAAA,EAAA;;oBAAlC,SAAkC,CAAC;oBACnC,qBAAM,CAAA,UAAU,aAAV,UAAU,uBAAV,UAAU,CAAE,cAAc,EAAE,CAAA,EAAA;;oBAAlC,SAAkC,CAAC;;;;SACpC,EAAE,CAAC,UAAU,CAAC,CAAC,CAAC;IAEjB,IAAA,iBAAS,EAAC;QACR,OAAO,cAAM,OAAA,KAAK,mBAAmB,EAAE,EAA1B,CAA0B,CAAC;IAC1C,CAAC,EAAE,CAAC,mBAAmB,CAAC,CAAC,CAAC;IAE1B,IAAA,iBAAS,EAAC;QACR,IAAI,UAAU,GAAG,KAAK,CAAC;QAEvB,IAAM,SAAS,GAAG;;;;;6BACZ,cAAc,CAAC,WAAW,EAA1B,wBAA0B;wBACtB,2BAA2B,GAAG,IAAI,iDAA2B,CACjE,cAAc,CAAC,WAAW,CAAC,OAAO,EAClC,cAAc,CAAC,WAAW,CAAC,QAAQ,CACpC,CAAC;wBACI,OAAO,GAAG;4BACd,YAAY,EAAE,uDAAY,CAAC,aAAa;yBACzC,CAAC;wBAEF,qBAAM,cAAc,CAAC,IAAI,CAAC,2BAA2B,EAAE,OAAO,CAAC,EAAA;;wBAA/D,SAA+D,CAAC;wBAEhE,IAAI,UAAU,EAAE,CAAC;4BACf,sBAAO;wBACT,CAAC;wBAED,qBAAM,cAAc,CAAC,KAAK,EAAE,EAAA;;wBAA5B,SAA4B,CAAC;;;;;aAEhC,CAAC;QAEF,KAAK,SAAS,EAAE,CAAC;QAEjB,OAAO;YACL,UAAU,GAAG,IAAI,CAAC;QACpB,CAAC,CAAC;IACJ,CAAC,EAAE,CAAC,cAAc,EAAE,cAAc,CAAC,WAAW,CAAC,CAAC,CAAC;IAEjD,IAAA,iBAAS,EAAC;QACR,SAAe,MAAM;;;;;iCACf,CAAA,CAAC,cAAc,IAAI,aAAa,KAAK,CAAC,IAAI,CAAC,wBAAwB,CAAA,EAAnE,wBAAmE;4BACrE,2BAA2B,CAAC,IAAI,CAAC,CAAC;4BAClC,qBAAM,WAAW,EAAE,EAAA;;4BAAnB,SAAmB,CAAC;;;;;;SAEvB;QAED,KAAK,MAAM,EAAE,CAAC;QACd,uGAAuG;QACvG,uDAAuD;IACzD,CAAC,EAAE,CAAC,cAAc,EAAE,aAAa,CAAC,CAAC,CAAC;IAEpC,OAAO,CACL,CAAC,iCAAe,CACd;MAAA,CAAC,qBAAS,CAAC,AAAD,EACZ;IAAA,EAAE,iCAAe,CAAC,CACnB,CAAC;AACJ,CAAC,CAAC;AAjEW,QAAA,kBAAkB,sBAiE7B","sourcesContent":["import {\n  DeviceLabels,\n  useAudioVideo,\n  useLocalVideo,\n  useMeetingManager,\n  useMeetingStatus,\n} from 'amazon-chime-sdk-component-library-react';\nimport { MeetingSessionConfiguration } from 'amazon-chime-sdk-js';\nimport { FC, useCallback, useEffect, useState } from 'react';\nimport { getSelectors } from '../../../shared/store/getSelectors';\nimport { useVideoCallStore } from '../../state';\nimport { VideoChatLayout } from './VideoChatLayout';\nimport { VideoRoom } from './VideoRoom';\n\nexport const VideoChatContainer: FC = () => {\n  const videoCallState = getSelectors(useVideoCallStore, ['meetingData']);\n  const meetingManager = useMeetingManager();\n  const audioVideo = useAudioVideo();\n  const { toggleVideo, isVideoEnabled } = useLocalVideo();\n  const meetingStatus = useMeetingStatus();\n  const [isCameraTurnedOnForStart, setIsCameraTurnedOnForStart] = useState(false);\n\n  const stopAudioVideoUsage = useCallback(async (): Promise<void> => {\n    await audioVideo?.stopVideoInput();\n    await audioVideo?.stopAudioInput();\n  }, [audioVideo]);\n\n  useEffect(() => {\n    return () => void stopAudioVideoUsage();\n  }, [stopAudioVideoUsage]);\n\n  useEffect(() => {\n    let isDisposed = false;\n\n    const startCall = async (): Promise<void> => {\n      if (videoCallState.meetingData) {\n        const meetingSessionConfiguration = new MeetingSessionConfiguration(\n          videoCallState.meetingData.Meeting,\n          videoCallState.meetingData.Attendee\n        );\n        const options = {\n          deviceLabels: DeviceLabels.AudioAndVideo,\n        };\n\n        await meetingManager.join(meetingSessionConfiguration, options);\n\n        if (isDisposed) {\n          return;\n        }\n\n        await meetingManager.start();\n      }\n    };\n\n    void startCall();\n\n    return () => {\n      isDisposed = true;\n    };\n  }, [meetingManager, videoCallState.meetingData]);\n\n  useEffect(() => {\n    async function toggle(): Promise<void> {\n      if (!isVideoEnabled && meetingStatus === 1 && !isCameraTurnedOnForStart) {\n        setIsCameraTurnedOnForStart(true);\n        await toggleVideo();\n      }\n    }\n\n    void toggle();\n    // ignoring the deps here not to rerender every time, cause for some reason toggleVideo is not memoized\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isVideoEnabled, meetingStatus]);\n\n  return (\n    <VideoChatLayout>\n      <VideoRoom />\n    </VideoChatLayout>\n  );\n};\n"]}