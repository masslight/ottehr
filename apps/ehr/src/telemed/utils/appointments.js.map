{"version":3,"file":"appointments.js","sourceRoot":"","sources":["appointments.ts"],"names":[],"mappings":"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","sourcesContent":["import { Appointment, DocumentReference, Encounter, EncounterStatusHistory, FhirResource } from 'fhir/r4b';\nimport { DateTime, Duration } from 'luxon';\nimport {\n  ApptTelemedTab,\n  GetTelemedAppointmentsInput,\n  mapStatusToTelemed,\n  PATIENT_PHOTO_CODE,\n  PROJECT_NAME,\n  RefreshableAppointmentData,\n  ReviewAndSignData,\n  TelemedAppointmentInformation,\n  TelemedAppointmentStatus,\n  TelemedAppointmentStatusEnum,\n  TelemedStatusHistoryElement,\n} from 'utils';\nimport { VisitResources } from '../state';\nimport { diffInMinutes } from './diffInMinutes';\n\nexport const ApptTabToStatus: Record<ApptTelemedTab, TelemedAppointmentStatus[]> = {\n  [ApptTelemedTab.ready]: [TelemedAppointmentStatusEnum.ready],\n  [ApptTelemedTab.provider]: [TelemedAppointmentStatusEnum['pre-video'], TelemedAppointmentStatusEnum['on-video']],\n  [ApptTelemedTab['not-signed']]: [TelemedAppointmentStatusEnum.unsigned],\n  [ApptTelemedTab.complete]: [TelemedAppointmentStatusEnum.complete, TelemedAppointmentStatusEnum.cancelled],\n};\n\nexport enum UnsignedFor {\n  'under12' = 'under12',\n  'more24' = 'more24',\n  'all' = 'all',\n}\n\nexport const compareLuxonDates = (a: DateTime, b: DateTime): number => a.toMillis() - b.toMillis();\n\nexport const getAppointmentUnsignedLengthTime = (history: TelemedStatusHistoryElement[]): number => {\n  const lastHistoryRecord = history.at(-1);\n  const currentTimeISO = new Date().toISOString();\n\n  return compareLuxonDates(\n    DateTime.fromISO(lastHistoryRecord?.end || currentTimeISO),\n    DateTime.fromISO(lastHistoryRecord?.start || currentTimeISO)\n  );\n};\n\nexport const compareAppointments = (\n  isNotSignedTab: boolean,\n  appointmentA: TelemedAppointmentInformation,\n  appointmentB: TelemedAppointmentInformation\n): number => {\n  if (isNotSignedTab) {\n    return (\n      getAppointmentUnsignedLengthTime(appointmentB.telemedStatusHistory) -\n      getAppointmentUnsignedLengthTime(appointmentA.telemedStatusHistory)\n    );\n  } else {\n    return compareLuxonDates(DateTime.fromISO(appointmentA.start!), DateTime.fromISO(appointmentB.start!));\n  }\n};\n\nexport const filterAppointments = (\n  appointments: TelemedAppointmentInformation[],\n  unsignedFor: UnsignedFor,\n  tab: ApptTelemedTab,\n  showOnlyNext: boolean,\n  availableStates: string[]\n): TelemedAppointmentInformation[] => {\n  if (![ApptTelemedTab['not-signed'], ApptTelemedTab.ready].includes(tab)) {\n    return appointments;\n  }\n\n  if (tab === ApptTelemedTab.ready) {\n    if (showOnlyNext) {\n      const oldest = appointments\n        .filter((appointment) => availableStates.includes(appointment.locationVirtual.state!))\n        .sort((a, b) => compareLuxonDates(DateTime.fromISO(a.start!), DateTime.fromISO(b.start!)))?.[0];\n\n      return oldest ? [oldest] : [];\n    } else {\n      return appointments;\n    }\n  }\n\n  const getUnsignedTime = (history: TelemedStatusHistoryElement[]): string => {\n    const unsigned = history.find((element) => element.status === TelemedAppointmentStatusEnum.unsigned);\n    if (!unsigned || !unsigned.start) {\n      return DateTime.now().toISO()!;\n    }\n    return unsigned.start;\n  };\n\n  const now = DateTime.now();\n\n  switch (unsignedFor) {\n    case UnsignedFor.under12:\n      return appointments.filter(\n        (appointment) => DateTime.fromISO(getUnsignedTime(appointment.telemedStatusHistory)) > now.minus({ hours: 12 })\n      );\n\n    case UnsignedFor.more24:\n      return appointments.filter(\n        (appointment) => DateTime.fromISO(getUnsignedTime(appointment.telemedStatusHistory)) <= now.minus({ hours: 24 })\n      );\n    default:\n      return appointments;\n  }\n};\n\nexport const getAppointmentWaitingTime = (statuses?: TelemedStatusHistoryElement[]): number | string => {\n  if (!statuses) {\n    return '...';\n  }\n\n  const onVideoIndex = statuses?.findIndex((status) => status.status === TelemedAppointmentStatusEnum['on-video']);\n\n  const statusesToWait = onVideoIndex === -1 ? statuses : statuses.slice(0, onVideoIndex);\n\n  const start = statusesToWait.at(0)!.start!;\n  const end = statusesToWait.at(-1)?.end;\n\n  return end\n    ? diffInMinutes(DateTime.fromISO(end), DateTime.fromISO(start))\n    : diffInMinutes(DateTime.now(), DateTime.fromISO(start));\n};\n\nexport const formatVideoTimerTime = (difference: Duration): string => {\n  const m = Math.abs(difference.minutes);\n  const s = Math.floor(Math.abs(difference.seconds));\n\n  const addZero = (num: number): string => {\n    return num < 10 ? `0${num}` : num.toString();\n  };\n\n  return `${m}:${addZero(s)}`;\n};\n\nexport const updateEncounterStatusHistory = (\n  newStatus:\n    | 'planned'\n    | 'arrived'\n    | 'triaged'\n    | 'in-progress'\n    // cSpell:disable-next onleave\n    | 'onleave'\n    | 'finished'\n    | 'cancelled'\n    | 'entered-in-error'\n    | 'unknown',\n  history?: EncounterStatusHistory[]\n): EncounterStatusHistory[] => {\n  const now = DateTime.now().toString();\n  const newItem = { status: newStatus, period: { start: now } };\n\n  if (!history || history.length === 0) {\n    return [newItem];\n  }\n\n  history.at(-1)!.period.end = now;\n  history.push(newItem);\n\n  return history;\n};\n\nexport const createRefreshableAppointmentData = (originalData: VisitResources[]): RefreshableAppointmentData => {\n  const photoUrls = extractPhotoUrlsFromAppointmentData(originalData);\n  return { patientConditionPhotoUrls: photoUrls };\n};\n\nexport const extractPhotoUrlsFromAppointmentData = (appointment: VisitResources[]): string[] => {\n  return (\n    (appointment\n      ?.filter(\n        (resource: FhirResource) =>\n          resource.resourceType === 'DocumentReference' &&\n          resource.status === 'current' &&\n          resource.type?.coding?.[0].code === PATIENT_PHOTO_CODE\n      )\n      .flatMap((docRef: FhirResource) => (docRef as DocumentReference).content.map((cnt) => cnt.attachment.url))\n      .filter(Boolean) as string[]) || []\n  );\n};\n\nexport const extractReviewAndSignAppointmentData = (data: VisitResources[]): ReviewAndSignData | undefined => {\n  const appointment = data?.find(\n    (resource: FhirResource) => resource.resourceType === 'Appointment'\n  ) as unknown as Appointment;\n\n  if (!appointment) {\n    return;\n  }\n\n  const appointmentStatus = appointment.status;\n\n  const encounter = data?.find(\n    (resource: FhirResource) => resource.resourceType === 'Encounter'\n  ) as unknown as Encounter;\n\n  if (!encounter) {\n    return;\n  }\n\n  const encounterStatusHistory = encounter.statusHistory ?? [];\n  const finishedHistoryEntry = encounterStatusHistory.find((historyElement) => historyElement.status === 'finished');\n  const finishedAtTime = finishedHistoryEntry?.period?.end;\n  const encounterStatus = finishedHistoryEntry?.status;\n  if (!encounterStatus) {\n    return;\n  }\n\n  const telemedAppointmentStatus = mapStatusToTelemed(encounterStatus, appointmentStatus);\n\n  return telemedAppointmentStatus === TelemedAppointmentStatusEnum.complete\n    ? { signedOnDate: finishedAtTime }\n    : undefined;\n};\n\nexport const TelemedAppointmentStatusToPalette: {\n  [status in TelemedAppointmentStatusEnum]: {\n    background: {\n      primary: string;\n      secondary?: string;\n    };\n    color: {\n      primary: string;\n      secondary?: string;\n    };\n  };\n} = {\n  ready: {\n    background: {\n      primary: '#FFE0B2',\n    },\n    color: {\n      primary: '#E65100',\n    },\n  },\n  'pre-video': {\n    background: {\n      primary: '#B3E5FC',\n    },\n    color: {\n      primary: '#01579B',\n    },\n  },\n  'on-video': {\n    background: {\n      primary: '#D1C4E9',\n    },\n    color: {\n      primary: '#311B92',\n    },\n  },\n  unsigned: {\n    background: {\n      primary: '#FFCCBC',\n    },\n    color: {\n      primary: '#BF360C',\n    },\n  },\n  complete: {\n    background: {\n      primary: '#C8E6C9',\n    },\n    color: {\n      primary: '#1B5E20',\n    },\n  },\n  cancelled: {\n    background: {\n      primary: '#FFCCBC',\n    },\n    color: {\n      primary: '#BF360C',\n    },\n  },\n};\n\nexport type GetAppointmentsRequestParams = Pick<\n  GetTelemedAppointmentsInput,\n  | 'usStatesFilter'\n  | 'providersFilter'\n  | 'dateFilter'\n  | 'groupsFilter'\n  | 'patientFilter'\n  | 'statusesFilter'\n  | 'locationsIdsFilter'\n  | 'visitTypesFilter'\n>;\n\nexport const APPT_STATUS_MAP: {\n  [status in TelemedAppointmentStatus]: {\n    background: {\n      primary: string;\n      secondary?: string;\n    };\n    color: {\n      primary: string;\n      secondary?: string;\n    };\n  };\n} = {\n  ready: {\n    background: {\n      primary: '#FFE0B2',\n    },\n    color: {\n      primary: '#E65100',\n    },\n  },\n  'pre-video': {\n    background: {\n      primary: '#B3E5FC',\n    },\n    color: {\n      primary: '#01579B',\n    },\n  },\n  'on-video': {\n    background: {\n      primary: '#D1C4E9',\n    },\n    color: {\n      primary: '#311B92',\n    },\n  },\n  unsigned: {\n    background: {\n      primary: '#FFCCBC',\n    },\n    color: {\n      primary: '#BF360C',\n    },\n  },\n  complete: {\n    background: {\n      primary: '#C8E6C9',\n    },\n    color: {\n      primary: '#1B5E20',\n    },\n  },\n  cancelled: {\n    background: {\n      primary: '#FFCCBC',\n    },\n    color: {\n      primary: '#BF360C',\n    },\n  },\n};\n\nexport const quickTexts: string[] = [\n  `Hello from ${PROJECT_NAME} Telemedicine. A provider will see you soon. Please have your child with you, seated & in a quiet room. Please be in an area where you have strong wifi connection sufficient for video use. Have your video turned on. Questions? Call <phone>202-555-1212</phone>`,\n  `Hello from ${PROJECT_NAME} Telemedicine. Due to high volumes our providers are busier than usual. A provider will message you when they have an update or are ready to see you. We apologize for the delay. Questions? Call <phone>202-555-1212</phone>`,\n  `Hello from ${PROJECT_NAME} Telemedicine. We tried connecting, you seem to be having trouble connecting. If you still want a visit, log out then log back in. Click “Return to call” and we will connect with you in 5-10 minutes. If you are still having trouble, call <phone>202-555-1212</phone>`,\n  `Hello from ${PROJECT_NAME} Telemedicine. We are sorry you canceled your visit. If accidental, please request a new visit. We will be sure to see you. If you are experiencing technical difficulties, call <phone>202-555-1212</phone>`,\n];\n"]}